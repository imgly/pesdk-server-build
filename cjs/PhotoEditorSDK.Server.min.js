var Jr=Object.defineProperty,sp=Object.prototype.hasOwnProperty,R=Object.assign,be=(e,t)=>()=>(t||(t={exports:{}},e(t.exports,t)),t.exports),pa=e=>Jr(e,"__esModule",{value:!0}),xe=(e,t)=>{pa(e);for(var i in t)Jr(e,i,{get:t[i],enumerable:!0})},op=(e,t)=>{if(pa(e),typeof t=="object"||typeof t=="function")for(let i in t)!sp.call(e,i)&&i!=="default"&&Jr(e,i,{get:()=>t[i],enumerable:!0});return e},Cr=e=>e&&e.__esModule?e:op(Jr({},"default",{value:e,enumerable:!0}),e),_i=(e,t,i)=>new Promise((r,s)=>{var o=l=>{try{a(i.next(l))}catch(d){s(d)}},n=l=>{try{a(i.throw(l))}catch(d){s(d)}},a=l=>l.done?r(l.value):Promise.resolve(l.value).then(o,n);a((i=i.apply(e,t)).next())});var ma=be((i_,ua)=>{"use strict";var np=/[|\\{}()[\]^$+*?.]/g;ua.exports=function(e){if(typeof e!="string")throw new TypeError("Expected a string");return e.replace(np,"\\$&")}});var ga=be((r_,fa)=>{"use strict";fa.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}});var So=be((s_,_a)=>{var ei=ga(),ya={};for(var wo in ei)ei.hasOwnProperty(wo)&&(ya[ei[wo]]=wo);var L=_a.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var Ke in L)if(L.hasOwnProperty(Ke)){if(!("channels"in L[Ke]))throw new Error("missing channels property: "+Ke);if(!("labels"in L[Ke]))throw new Error("missing channel labels property: "+Ke);if(L[Ke].labels.length!==L[Ke].channels)throw new Error("channel and label counts mismatch: "+Ke);var ap=L[Ke].channels,lp=L[Ke].labels;delete L[Ke].channels,delete L[Ke].labels,Object.defineProperty(L[Ke],"channels",{value:ap}),Object.defineProperty(L[Ke],"labels",{value:lp})}L.rgb.hsl=function(e){var t=e[0]/255,i=e[1]/255,r=e[2]/255,s=Math.min(t,i,r),o=Math.max(t,i,r),n=o-s,a,l,d;return o===s?a=0:t===o?a=(i-r)/n:i===o?a=2+(r-t)/n:r===o&&(a=4+(t-i)/n),a=Math.min(a*60,360),a<0&&(a+=360),d=(s+o)/2,o===s?l=0:d<=.5?l=n/(o+s):l=n/(2-o-s),[a,l*100,d*100]};L.rgb.hsv=function(e){var t,i,r,s,o,n=e[0]/255,a=e[1]/255,l=e[2]/255,d=Math.max(n,a,l),p=d-Math.min(n,a,l),u=function(c){return(d-c)/6/p+1/2};return p===0?s=o=0:(o=p/d,t=u(n),i=u(a),r=u(l),n===d?s=r-i:a===d?s=1/3+t-r:l===d&&(s=2/3+i-t),s<0?s+=1:s>1&&(s-=1)),[s*360,o*100,d*100]};L.rgb.hwb=function(e){var t=e[0],i=e[1],r=e[2],s=L.rgb.hsl(e)[0],o=1/255*Math.min(t,Math.min(i,r));return r=1-1/255*Math.max(t,Math.max(i,r)),[s,o*100,r*100]};L.rgb.cmyk=function(e){var t=e[0]/255,i=e[1]/255,r=e[2]/255,s,o,n,a;return a=Math.min(1-t,1-i,1-r),s=(1-t-a)/(1-a)||0,o=(1-i-a)/(1-a)||0,n=(1-r-a)/(1-a)||0,[s*100,o*100,n*100,a*100]};function hp(e,t){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2)}L.rgb.keyword=function(e){var t=ya[e];if(t)return t;var i=Infinity,r;for(var s in ei)if(ei.hasOwnProperty(s)){var o=ei[s],n=hp(e,o);n<i&&(i=n,r=s)}return r};L.keyword.rgb=function(e){return ei[e]};L.rgb.xyz=function(e){var t=e[0]/255,i=e[1]/255,r=e[2]/255;t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92;var s=t*.4124+i*.3576+r*.1805,o=t*.2126+i*.7152+r*.0722,n=t*.0193+i*.1192+r*.9505;return[s*100,o*100,n*100]};L.rgb.lab=function(e){var t=L.rgb.xyz(e),i=t[0],r=t[1],s=t[2],o,n,a;return i/=95.047,r/=100,s/=108.883,i=i>.008856?Math.pow(i,1/3):7.787*i+16/116,r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,s=s>.008856?Math.pow(s,1/3):7.787*s+16/116,o=116*r-16,n=500*(i-r),a=200*(r-s),[o,n,a]};L.hsl.rgb=function(e){var t=e[0]/360,i=e[1]/100,r=e[2]/100,s,o,n,a,l;if(i===0)return l=r*255,[l,l,l];r<.5?o=r*(1+i):o=r+i-r*i,s=2*r-o,a=[0,0,0];for(var d=0;d<3;d++)n=t+1/3*-(d-1),n<0&&n++,n>1&&n--,6*n<1?l=s+(o-s)*6*n:2*n<1?l=o:3*n<2?l=s+(o-s)*(2/3-n)*6:l=s,a[d]=l*255;return a};L.hsl.hsv=function(e){var t=e[0],i=e[1]/100,r=e[2]/100,s=i,o=Math.max(r,.01),n,a;return r*=2,i*=r<=1?r:2-r,s*=o<=1?o:2-o,a=(r+i)/2,n=r===0?2*s/(o+s):2*i/(r+i),[t,n*100,a*100]};L.hsv.rgb=function(e){var t=e[0]/60,i=e[1]/100,r=e[2]/100,s=Math.floor(t)%6,o=t-Math.floor(t),n=255*r*(1-i),a=255*r*(1-i*o),l=255*r*(1-i*(1-o));r*=255;switch(s){case 0:return[r,l,n];case 1:return[a,r,n];case 2:return[n,r,l];case 3:return[n,a,r];case 4:return[l,n,r];case 5:return[r,n,a]}};L.hsv.hsl=function(e){var t=e[0],i=e[1]/100,r=e[2]/100,s=Math.max(r,.01),o,n,a;return a=(2-i)*r,o=(2-i)*s,n=i*s,n/=o<=1?o:2-o,n=n||0,a/=2,[t,n*100,a*100]};L.hwb.rgb=function(e){var t=e[0]/360,i=e[1]/100,r=e[2]/100,s=i+r,o,n,a,l;s>1&&(i/=s,r/=s),o=Math.floor(6*t),n=1-r,a=6*t-o,(o&1)!==0&&(a=1-a),l=i+a*(n-i);var d,p,u;switch(o){default:case 6:case 0:d=n,p=l,u=i;break;case 1:d=l,p=n,u=i;break;case 2:d=i,p=n,u=l;break;case 3:d=i,p=l,u=n;break;case 4:d=l,p=i,u=n;break;case 5:d=n,p=i,u=l;break}return[d*255,p*255,u*255]};L.cmyk.rgb=function(e){var t=e[0]/100,i=e[1]/100,r=e[2]/100,s=e[3]/100,o,n,a;return o=1-Math.min(1,t*(1-s)+s),n=1-Math.min(1,i*(1-s)+s),a=1-Math.min(1,r*(1-s)+s),[o*255,n*255,a*255]};L.xyz.rgb=function(e){var t=e[0]/100,i=e[1]/100,r=e[2]/100,s,o,n;return s=t*3.2406+i*-1.5372+r*-.4986,o=t*-.9689+i*1.8758+r*.0415,n=t*.0557+i*-.204+r*1.057,s=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:s*12.92,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:o*12.92,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:n*12.92,s=Math.min(Math.max(0,s),1),o=Math.min(Math.max(0,o),1),n=Math.min(Math.max(0,n),1),[s*255,o*255,n*255]};L.xyz.lab=function(e){var t=e[0],i=e[1],r=e[2],s,o,n;return t/=95.047,i/=100,r/=108.883,t=t>.008856?Math.pow(t,1/3):7.787*t+16/116,i=i>.008856?Math.pow(i,1/3):7.787*i+16/116,r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,s=116*i-16,o=500*(t-i),n=200*(i-r),[s,o,n]};L.lab.xyz=function(e){var t=e[0],i=e[1],r=e[2],s,o,n;o=(t+16)/116,s=i/500+o,n=o-r/200;var a=Math.pow(o,3),l=Math.pow(s,3),d=Math.pow(n,3);return o=a>.008856?a:(o-16/116)/7.787,s=l>.008856?l:(s-16/116)/7.787,n=d>.008856?d:(n-16/116)/7.787,s*=95.047,o*=100,n*=108.883,[s,o,n]};L.lab.lch=function(e){var t=e[0],i=e[1],r=e[2],s,o,n;return s=Math.atan2(r,i),o=s*360/2/Math.PI,o<0&&(o+=360),n=Math.sqrt(i*i+r*r),[t,n,o]};L.lch.lab=function(e){var t=e[0],i=e[1],r=e[2],s,o,n;return n=r/360*2*Math.PI,s=i*Math.cos(n),o=i*Math.sin(n),[t,s,o]};L.rgb.ansi16=function(e){var t=e[0],i=e[1],r=e[2],s=1 in arguments?arguments[1]:L.rgb.hsv(e)[2];if(s=Math.round(s/50),s===0)return 30;var o=30+(Math.round(r/255)<<2|Math.round(i/255)<<1|Math.round(t/255));return s===2&&(o+=60),o};L.hsv.ansi16=function(e){return L.rgb.ansi16(L.hsv.rgb(e),e[2])};L.rgb.ansi256=function(e){var t=e[0],i=e[1],r=e[2];if(t===i&&i===r)return t<8?16:t>248?231:Math.round((t-8)/247*24)+232;var s=16+36*Math.round(t/255*5)+6*Math.round(i/255*5)+Math.round(r/255*5);return s};L.ansi16.rgb=function(e){var t=e%10;if(t===0||t===7)return e>50&&(t+=3.5),t=t/10.5*255,[t,t,t];var i=(~~(e>50)+1)*.5,r=(t&1)*i*255,s=(t>>1&1)*i*255,o=(t>>2&1)*i*255;return[r,s,o]};L.ansi256.rgb=function(e){if(e>=232){var t=(e-232)*10+8;return[t,t,t]}e-=16;var i,r=Math.floor(e/36)/5*255,s=Math.floor((i=e%36)/6)/5*255,o=i%6/5*255;return[r,s,o]};L.rgb.hex=function(e){var t=((Math.round(e[0])&255)<<16)+((Math.round(e[1])&255)<<8)+(Math.round(e[2])&255),i=t.toString(16).toUpperCase();return"000000".substring(i.length)+i};L.hex.rgb=function(e){var t=e.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!t)return[0,0,0];var i=t[0];t[0].length===3&&(i=i.split("").map(function(a){return a+a}).join(""));var r=parseInt(i,16),s=r>>16&255,o=r>>8&255,n=r&255;return[s,o,n]};L.rgb.hcg=function(e){var t=e[0]/255,i=e[1]/255,r=e[2]/255,s=Math.max(Math.max(t,i),r),o=Math.min(Math.min(t,i),r),n=s-o,a,l;return n<1?a=o/(1-n):a=0,n<=0?l=0:s===t?l=(i-r)/n%6:s===i?l=2+(r-t)/n:l=4+(t-i)/n+4,l/=6,l%=1,[l*360,n*100,a*100]};L.hsl.hcg=function(e){var t=e[1]/100,i=e[2]/100,r=1,s=0;return i<.5?r=2*t*i:r=2*t*(1-i),r<1&&(s=(i-.5*r)/(1-r)),[e[0],r*100,s*100]};L.hsv.hcg=function(e){var t=e[1]/100,i=e[2]/100,r=t*i,s=0;return r<1&&(s=(i-r)/(1-r)),[e[0],r*100,s*100]};L.hcg.rgb=function(e){var t=e[0]/360,i=e[1]/100,r=e[2]/100;if(i===0)return[r*255,r*255,r*255];var s=[0,0,0],o=t%1*6,n=o%1,a=1-n,l=0;switch(Math.floor(o)){case 0:s[0]=1,s[1]=n,s[2]=0;break;case 1:s[0]=a,s[1]=1,s[2]=0;break;case 2:s[0]=0,s[1]=1,s[2]=n;break;case 3:s[0]=0,s[1]=a,s[2]=1;break;case 4:s[0]=n,s[1]=0,s[2]=1;break;default:s[0]=1,s[1]=0,s[2]=a}return l=(1-i)*r,[(i*s[0]+l)*255,(i*s[1]+l)*255,(i*s[2]+l)*255]};L.hcg.hsv=function(e){var t=e[1]/100,i=e[2]/100,r=t+i*(1-t),s=0;return r>0&&(s=t/r),[e[0],s*100,r*100]};L.hcg.hsl=function(e){var t=e[1]/100,i=e[2]/100,r=i*(1-t)+.5*t,s=0;return r>0&&r<.5?s=t/(2*r):r>=.5&&r<1&&(s=t/(2*(1-r))),[e[0],s*100,r*100]};L.hcg.hwb=function(e){var t=e[1]/100,i=e[2]/100,r=t+i*(1-t);return[e[0],(r-t)*100,(1-r)*100]};L.hwb.hcg=function(e){var t=e[1]/100,i=e[2]/100,r=1-i,s=r-t,o=0;return s<1&&(o=(r-s)/(1-s)),[e[0],s*100,o*100]};L.apple.rgb=function(e){return[e[0]/65535*255,e[1]/65535*255,e[2]/65535*255]};L.rgb.apple=function(e){return[e[0]/255*65535,e[1]/255*65535,e[2]/255*65535]};L.gray.rgb=function(e){return[e[0]/100*255,e[0]/100*255,e[0]/100*255]};L.gray.hsl=L.gray.hsv=function(e){return[0,0,e[0]]};L.gray.hwb=function(e){return[0,100,e[0]]};L.gray.cmyk=function(e){return[0,0,0,e[0]]};L.gray.lab=function(e){return[e[0],0,0]};L.gray.hex=function(e){var t=Math.round(e[0]/100*255)&255,i=(t<<16)+(t<<8)+t,r=i.toString(16).toUpperCase();return"000000".substring(r.length)+r};L.rgb.gray=function(e){var t=(e[0]+e[1]+e[2])/3;return[t/255*100]}});var xa=be((o_,ba)=>{var $r=So();function dp(){for(var e={},t=Object.keys($r),i=t.length,r=0;r<i;r++)e[t[r]]={distance:-1,parent:null};return e}function cp(e){var t=dp(),i=[e];for(t[e].distance=0;i.length;)for(var r=i.pop(),s=Object.keys($r[r]),o=s.length,n=0;n<o;n++){var a=s[n],l=t[a];l.distance===-1&&(l.distance=t[r].distance+1,l.parent=r,i.unshift(a))}return t}function pp(e,t){return function(i){return t(e(i))}}function up(e,t){for(var i=[t[e].parent,e],r=$r[t[e].parent][e],s=t[e].parent;t[s].parent;)i.unshift(t[s].parent),r=pp($r[t[s].parent][s],r),s=t[s].parent;return r.conversion=i,r}ba.exports=function(e){for(var t=cp(e),i={},r=Object.keys(t),s=r.length,o=0;o<s;o++){var n=r[o],a=t[n];if(a.parent===null)continue;i[n]=up(n,t)}return i}});var wa=be((n_,va)=>{var To=So(),mp=xa(),yi={},fp=Object.keys(To);function gp(e){var t=function(i){return i==null?i:(arguments.length>1&&(i=Array.prototype.slice.call(arguments)),e(i))};return"conversion"in e&&(t.conversion=e.conversion),t}function _p(e){var t=function(i){if(i==null)return i;arguments.length>1&&(i=Array.prototype.slice.call(arguments));var r=e(i);if(typeof r=="object")for(var s=r.length,o=0;o<s;o++)r[o]=Math.round(r[o]);return r};return"conversion"in e&&(t.conversion=e.conversion),t}fp.forEach(function(e){yi[e]={},Object.defineProperty(yi[e],"channels",{value:To[e].channels}),Object.defineProperty(yi[e],"labels",{value:To[e].labels});var t=mp(e),i=Object.keys(t);i.forEach(function(r){var s=t[r];yi[e][r]=_p(s),yi[e][r].raw=gp(s)})});va.exports=yi});var Ta=be((a_,Sa)=>{"use strict";const bi=wa(),es=(e,t)=>function(){const i=e.apply(bi,arguments);return`[${i+t}m`},ts=(e,t)=>function(){const i=e.apply(bi,arguments);return`[${38+t};5;${i}m`},is=(e,t)=>function(){const i=e.apply(bi,arguments);return`[${38+t};2;${i[0]};${i[1]};${i[2]}m`};function yp(){const e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],gray:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};t.color.grey=t.color.gray;for(const s of Object.keys(t)){const o=t[s];for(const n of Object.keys(o)){const a=o[n];t[n]={open:`[${a[0]}m`,close:`[${a[1]}m`},o[n]=t[n],e.set(a[0],a[1])}Object.defineProperty(t,s,{value:o,enumerable:!1}),Object.defineProperty(t,"codes",{value:e,enumerable:!1})}const i=s=>s,r=(s,o,n)=>[s,o,n];t.color.close="[39m",t.bgColor.close="[49m",t.color.ansi={ansi:es(i,0)},t.color.ansi256={ansi256:ts(i,0)},t.color.ansi16m={rgb:is(r,0)},t.bgColor.ansi={ansi:es(i,10)},t.bgColor.ansi256={ansi256:ts(i,10)},t.bgColor.ansi16m={rgb:is(r,10)};for(let s of Object.keys(bi)){if(typeof bi[s]!="object")continue;const o=bi[s];s==="ansi16"&&(s="ansi"),"ansi16"in o&&(t.color.ansi[s]=es(o.ansi16,0),t.bgColor.ansi[s]=es(o.ansi16,10)),"ansi256"in o&&(t.color.ansi256[s]=ts(o.ansi256,0),t.bgColor.ansi256[s]=ts(o.ansi256,10)),"rgb"in o&&(t.color.ansi16m[s]=is(o.rgb,0),t.bgColor.ansi16m[s]=is(o.rgb,10))}return t}Object.defineProperty(Sa,"exports",{enumerable:!0,get:yp})});var Ea=be((l_,Ra)=>{"use strict";Ra.exports=(e,t)=>{t=t||process.argv;const i=e.startsWith("-")?"":e.length===1?"-":"--",r=t.indexOf(i+e),s=t.indexOf("--");return r!==-1&&(s===-1?!0:r<s)}});var Ca=be((h_,Oa)=>{"use strict";const bp=require("os"),pt=Ea(),De=process.env;let xi;pt("no-color")||pt("no-colors")||pt("color=false")?xi=!1:(pt("color")||pt("colors")||pt("color=true")||pt("color=always"))&&(xi=!0);"FORCE_COLOR"in De&&(xi=De.FORCE_COLOR.length===0||parseInt(De.FORCE_COLOR,10)!==0);function xp(e){return e===0?!1:{level:e,hasBasic:!0,has256:e>=2,has16m:e>=3}}function vp(e){if(xi===!1)return 0;if(pt("color=16m")||pt("color=full")||pt("color=truecolor"))return 3;if(pt("color=256"))return 2;if(e&&!e.isTTY&&xi!==!0)return 0;const t=xi?1:0;if(process.platform==="win32"){const i=bp.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(i[0])>=10&&Number(i[2])>=10586?Number(i[2])>=14931?3:2:1}if("CI"in De)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(i=>i in De)||De.CI_NAME==="codeship"?1:t;if("TEAMCITY_VERSION"in De)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(De.TEAMCITY_VERSION)?1:0;if(De.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in De){const i=parseInt((De.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(De.TERM_PROGRAM){case"iTerm.app":return i>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(De.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(De.TERM)||"COLORTERM"in De?1:(De.TERM==="dumb",t)}function Ro(e){const t=vp(e);return xp(t)}Oa.exports={supportsColor:Ro,stdout:Ro(process.stdout),stderr:Ro(process.stderr)}});var Aa=be((d_,ka)=>{"use strict";const wp=/(?:\\(u[a-f\d]{4}|x[a-f\d]{2}|.))|(?:\{(~)?(\w+(?:\([^)]*\))?(?:\.\w+(?:\([^)]*\))?)*)(?:[ \t]|(?=\r?\n)))|(\})|((?:.|[\r\n\f])+?)/gi,Da=/(?:^|\.)(\w+)(?:\(([^)]*)\))?/g,Sp=/^(['"])((?:\\.|(?!\1)[^\\])*)\1$/,Tp=/\\(u[a-f\d]{4}|x[a-f\d]{2}|.)|([^\\])/gi,Rp=new Map([["n",`
`],["r","\r"],["t","	"],["b","\b"],["f","\f"],["v","\v"],["0","\0"],["\\","\\"],["e",""],["a","\x07"]]);function Pa(e){return e[0]==="u"&&e.length===5||e[0]==="x"&&e.length===3?String.fromCharCode(parseInt(e.slice(1),16)):Rp.get(e)||e}function Ep(e,t){const i=[],r=t.trim().split(/\s*,\s*/g);let s;for(const o of r)if(!isNaN(o))i.push(Number(o));else if(s=o.match(Sp))i.push(s[2].replace(Tp,(n,a,l)=>a?Pa(a):l));else throw new Error(`Invalid Chalk template style argument: ${o} (in style '${e}')`);return i}function Op(e){Da.lastIndex=0;const t=[];let i;for(;(i=Da.exec(e))!==null;){const r=i[1];if(i[2]){const s=Ep(r,i[2]);t.push([r].concat(s))}else t.push([r])}return t}function Fa(e,t){const i={};for(const s of t)for(const o of s.styles)i[o[0]]=s.inverse?null:o.slice(1);let r=e;for(const s of Object.keys(i))if(Array.isArray(i[s])){if(!(s in r))throw new Error(`Unknown Chalk style: ${s}`);i[s].length>0?r=r[s].apply(r,i[s]):r=r[s]}return r}ka.exports=(e,t)=>{const i=[],r=[];let s=[];if(t.replace(wp,(o,n,a,l,d,p)=>{if(n)s.push(Pa(n));else if(l){const u=s.join("");s=[],r.push(i.length===0?u:Fa(e,i)(u)),i.push({inverse:a,styles:Op(l)})}else if(d){if(i.length===0)throw new Error("Found extraneous } in Chalk template literal");r.push(Fa(e,i)(s.join(""))),s=[],i.pop()}else s.push(p)}),r.push(s.join("")),i.length>0){const o=`Chalk template literal is missing ${i.length} closing bracket${i.length===1?"":"s"} (\`}\`)`;throw new Error(o)}return r.join("")}});var Na=be((c_,kr)=>{"use strict";const Eo=ma(),we=Ta(),Oo=Ca().stdout,Cp=Aa(),Ia=process.platform==="win32"&&!(process.env.TERM||"").toLowerCase().startsWith("xterm"),Ba=["ansi","ansi","ansi256","ansi16m"],Ma=new Set(["gray"]),vi=Object.create(null);function La(e,t){t=t||{};const i=Oo?Oo.level:0;e.level=t.level===void 0?i:t.level,e.enabled="enabled"in t?t.enabled:e.level>0}function Dr(e){if(!this||!(this instanceof Dr)||this.template){const t={};return La(t,e),t.template=function(){const i=[].slice.call(arguments);return kp.apply(null,[t.template].concat(i))},Object.setPrototypeOf(t,Dr.prototype),Object.setPrototypeOf(t.template,t),t.template.constructor=Dr,t.template}La(this,e)}Ia&&(we.blue.open="[94m");for(const e of Object.keys(we))we[e].closeRe=new RegExp(Eo(we[e].close),"g"),vi[e]={get(){const t=we[e];return rs.call(this,this._styles?this._styles.concat(t):[t],this._empty,e)}};vi.visible={get(){return rs.call(this,this._styles||[],!0,"visible")}};we.color.closeRe=new RegExp(Eo(we.color.close),"g");for(const e of Object.keys(we.color.ansi)){if(Ma.has(e))continue;vi[e]={get(){const t=this.level;return function(){const i=we.color[Ba[t]][e].apply(null,arguments),r={open:i,close:we.color.close,closeRe:we.color.closeRe};return rs.call(this,this._styles?this._styles.concat(r):[r],this._empty,e)}}}}we.bgColor.closeRe=new RegExp(Eo(we.bgColor.close),"g");for(const e of Object.keys(we.bgColor.ansi)){if(Ma.has(e))continue;const t="bg"+e[0].toUpperCase()+e.slice(1);vi[t]={get(){const i=this.level;return function(){const r=we.bgColor[Ba[i]][e].apply(null,arguments),s={open:r,close:we.bgColor.close,closeRe:we.bgColor.closeRe};return rs.call(this,this._styles?this._styles.concat(s):[s],this._empty,e)}}}}const Dp=Object.defineProperties(()=>{},vi);function rs(e,t,i){const r=function(){return Pp.apply(r,arguments)};r._styles=e,r._empty=t;const s=this;return Object.defineProperty(r,"level",{enumerable:!0,get(){return s.level},set(o){s.level=o}}),Object.defineProperty(r,"enabled",{enumerable:!0,get(){return s.enabled},set(o){s.enabled=o}}),r.hasGrey=this.hasGrey||i==="gray"||i==="grey",r.__proto__=Dp,r}function Pp(){const e=arguments,t=e.length;let i=String(arguments[0]);if(t===0)return"";if(t>1)for(let s=1;s<t;s++)i+=" "+e[s];if(!this.enabled||this.level<=0||!i)return this._empty?"":i;const r=we.dim.open;Ia&&this.hasGrey&&(we.dim.open="");for(const s of this._styles.slice().reverse())i=s.open+i.replace(s.closeRe,s.open)+s.close,i=i.replace(/\r?\n/g,`${s.close}$&${s.open}`);return we.dim.open=r,i}function kp(e,t){if(!Array.isArray(t))return[].slice.call(arguments,1).join(" ");const i=[].slice.call(arguments,2),r=[t.raw[0]];for(let s=1;s<t.length;s++)r.push(String(i[s-1]).replace(/[{}\\]/g,"\\$&")),r.push(String(t.raw[s]));return Cp(e,r.join(""))}Object.defineProperties(Dr.prototype,vi);kr.exports=Dr();kr.exports.supportsColor=Oo;kr.exports.default=kr.exports});var wi=be((za,Pr)=>{(function(){var e,t,i,r,s,o;typeof performance!="undefined"&&performance!==null&&performance.now?Pr.exports=function(){return performance.now()}:typeof process!="undefined"&&process!==null&&process.hrtime?(Pr.exports=function(){return(e()-s)/1e6},t=process.hrtime,e=function(){var n;return n=t(),n[0]*1e9+n[1]},r=e(),o=process.uptime()*1e9,s=r-o):Date.now?(Pr.exports=function(){return Date.now()-i},i=Date.now()):(Pr.exports=function(){return new Date().getTime()-i},i=new Date().getTime())}).call(za)});var Ga=be(Fp=>{xe(Fp,{default:()=>Co});class Co{constructor(e){this._editor=e}serialize(...e){const t=new Ti(this._editor);return t.serialize(...e)}deserialize(e){const t=new Si(this._editor,e);return t.deserialize()}}Co.version="1.0.0"});var Ua=be(Ap=>{xe(Ap,{default:()=>ko});class ko{constructor(e){this._editor=e}serialize(...e){const t=new Ei(this._editor);return t.serialize(...e)}deserialize(e){const t=new Ri(this._editor,e);return t.deserialize()}}ko.version="1.0.1"});var Ka=be(Ip=>{xe(Ip,{default:()=>Do});class Do{constructor(e){this._editor=e}serialize(...e){const t=new Ci(this._editor);return t.serialize(...e)}deserialize(e){const t=new Oi(this._editor,e);return t.deserialize()}}Do.version="2.0.0"});var ja=be(Bp=>{xe(Bp,{default:()=>Po});class Po{constructor(e){this._editor=e}serialize(...e){const t=new Di(this._editor);return t.serialize(...e)}deserialize(e){const t=new ki(this._editor,e);return t.deserialize()}}Po.version="3.0.0"});var Wa=be(Mp=>{xe(Mp,{default:()=>Fo});class Fo{constructor(e){this._editor=e}serialize(...e){const t=new Fi(this._editor);return t.serialize(...e)}deserialize(e){const t=new Pi(this._editor,e);return t.deserialize()}}Fo.version="3.1.0"});var Va=be(Lp=>{xe(Lp,{default:()=>Ao});class Ao{constructor(e){this._editor=e}serialize(...e){const t=new Ii(this._editor);return t.serialize(...e)}deserialize(e){const t=new Ai(this._editor,e);return t.deserialize()}}Ao.version="3.2.0"});var Ha=be(Np=>{xe(Np,{default:()=>Io});class Io{constructor(e){this._editor=e}serialize(...e){const t=new Mi(this._editor);return t.serialize(...e)}deserialize(e){const t=new Bi(this._editor,e);return t.deserialize()}}Io.version="3.4.0"});var qa=be(zp=>{xe(zp,{default:()=>Bo});class Bo{constructor(e){this._editor=e}serialize(...e){const t=new Ni(this._editor);return t.serialize(...e)}deserialize(e){const t=new Li(this._editor,e);return t.deserialize()}}Bo.version="3.5.0"});var Ya=be(Gp=>{xe(Gp,{default:()=>Mo});class Mo{constructor(e){this._editor=e}serialize(...e){const t=new Gi(this._editor);return t.serialize(...e)}deserialize(e){const t=new zi(this._editor,e);return t.deserialize()}}Mo.version="3.6.0"});var Xa=be(Up=>{xe(Up,{default:()=>Lo});class Lo{constructor(e){this._editor=e}serialize(...e){const t=new Ki(this._editor);return t.serialize(...e)}deserialize(e){const t=new Ui(this._editor,e);return t.deserialize()}}Lo.version="3.7.0"});var Qa=be(Kp=>{xe(Kp,{default:()=>No});class No{constructor(e){this._editor=e}serialize(...e){const t=new Wi(this._editor);return t.serialize(...e)}deserialize(e){const t=new ji(this._editor,e);return t.deserialize()}}No.version="3.8.0"});var Za=be(jp=>{xe(jp,{default:()=>zo});class zo{constructor(e){this._editor=e}serialize(...e){const t=new os(this._editor);return t.serialize(...e)}deserialize(e){const t=new ss(this._editor,e);return t.deserialize()}}zo.version="3.9.0"});const Wp=e=>{if(!process.env.REACT_APP_BROWSER){const t=require("fs");return new Promise((i,r)=>{try{t.readFile(e,(s,o)=>{s?r(s):i([e,o])})}catch(s){r(s)}})}},Vp=e=>{if(!process.env.REACT_APP_BROWSER){const t=require("request");return new Promise((i,r)=>{t.get(e,{encoding:null},(s,o,n)=>{if(s)return r(s);if(o.statusCode!==200)return r(new Error(`Server responded with status code ${o.statusCode}`));i([e,o.body])})})}};var je={load(e,t={cors:!0,value:"anonymous"}){const i=()=>{if(process.env.REACT_APP_BROWSER)return Promise.resolve([e,e]);if(!process.env.REACT_APP_BROWSER)return e.substr(0,5)==="data:"?Promise.resolve([e,e]):e.match(/^(https?|ftp|file):\/\//)?Vp(e):Wp(e)};return i().then(([r,s])=>this._createAndLoadImage(r,s,t))},loadImage(e,t={cors:!0,value:"anonymous"}){return process.env.REACT_APP_BROWSER?this._loadWithoutExif(e,t):this.load(e,t)},_loadWithoutExif(e,t={cors:!0,value:"anonymous"}){return new Promise((i,r)=>{const s=new window.Image;s.addEventListener("load",()=>{i(s)}),s.addEventListener("error",()=>{r(new Error(`Failed to load image at ${e}`))}),t.cors&&(s.crossOrigin=t.value),s.src=e})},_createAndLoadImage(e,t,i={cors:!0,value:"anonymous"}){return new Promise((r,s)=>{if(process.env.REACT_APP_BROWSER){const o=this._loadWithoutExif(t,i).then(a=>r(a)),n=new Promise((a,l)=>{this._loadAsDataURL(t,i).then(d=>{const p=new window.Image;p.addEventListener("load",()=>{a(p)}),p.src=d,p.rawSource=d}).catch(d=>{o.then(p=>a(p))})});return this._stringEndsWith(t,".svg")?o.then(a=>r(a)):n.then(a=>r(a))}if(!process.env.REACT_APP_BROWSER){const o=require("canvas"),n=new o.Image;n.src=t,n.rawSource=t,n.filePath=e,r(n)}})},_stringEndsWith(e,t,i=e.length){return(i===void 0||i>e.length)&&(i=e.length),e.substring(i-t.length,i)===t},_loadAsDataURL(e,t={cors:!0,value:"anonymous"}){return process.env.REACT_APP_BROWSER?new Promise((i,r)=>{const s=new XMLHttpRequest;s.onload=function(){const o=new FileReader;o.onloadend=function(){o.error&&r(o.error),i(o.result)},o.readAsDataURL(s.response)},s.open("GET",e),s.responseType="blob",s.withCredentials=t.cors&&t.value==="use-credentials",s.send()}):Promise.reject(new Error("Loading images as data urls is only supported in browser environments."))},loadXHR(e,t){return new Promise((i,r)=>{let s;window.XDomainRequest?(s=new window.XDomainRequest,t&&s.overrideMimeType(t),s.onload=function(){i(s)},s.onerror=function(o){r(o)}):window.XMLHttpRequest&&(s=new window.XMLHttpRequest,t&&s.overrideMimeType(t),s.onreadystatechange=function(o){s.readyState===4&&(s.status===200?i(s):r(new Error(`HTTP Status ${s.status}`)))}),s.open("GET",e,!0),s.send()})}};const Hp=function(){"use strict";var t,i,r,s=Object.prototype.toString,o=typeof setImmediate!="undefined"?function(b){return setImmediate(b)}:setTimeout;try{Object.defineProperty({},"x",{}),t=function(b,g,E,v){return Object.defineProperty(b,g,{value:E,writable:!0,configurable:v!==!1})}}catch(y){t=function(g,E,v){return g[E]=v,g}}r=function(){var b,g,E;function v(w,A){this.fn=w,this.self=A,this.next=void 0}return{add:function(A,I){E=new v(A,I),g?g.next=E:b=E,g=E,E=void 0},drain:function(){var A=b;for(b=g=i=void 0;A;)A.fn.call(A.self),A=A.next}}}();function n(y,b){r.add(y,b),i||(i=o(r.drain))}function a(y){var b,g=typeof y;return y!=null&&(g=="object"||g=="function")&&(b=y.then),typeof b=="function"?b:!1}function l(){for(var y=0;y<this.chain.length;y++)d(this,this.state===1?this.chain[y].success:this.chain[y].failure,this.chain[y]);this.chain.length=0}function d(y,b,g){var E,v;try{b===!1?g.reject(y.msg):(b===!0?E=y.msg:E=b.call(void 0,y.msg),E===g.promise?g.reject(TypeError("Promise-chain cycle")):(v=a(E))?v.call(E,g.resolve,g.reject):g.resolve(E))}catch(w){g.reject(w)}}function p(y){var b,g=this;if(g.triggered)return;g.triggered=!0,g.def&&(g=g.def);try{(b=a(y))?n(function(){var E=new m(g);try{b.call(y,function(){p.apply(E,arguments)},function(){u.apply(E,arguments)})}catch(v){u.call(E,v)}}):(g.msg=y,g.state=1,g.chain.length>0&&n(l,g))}catch(E){u.call(new m(g),E)}}function u(y){var b=this;if(b.triggered)return;b.triggered=!0,b.def&&(b=b.def),b.msg=y,b.state=2,b.chain.length>0&&n(l,b)}function c(y,b,g,E){for(var v=0;v<b.length;v++)(function(A){y.resolve(b[A]).then(function(z){g(A,z)},E)})(v)}function m(y){this.def=y,this.triggered=!1}function x(y){this.promise=y,this.state=0,this.triggered=!1,this.chain=[],this.msg=void 0}function _(y){if(typeof y!="function")throw TypeError("Not a function");if(this.__NPO__!==0)throw TypeError("Not a promise");this.__NPO__=1;var b=new x(this);this.then=function(E,v){var w={success:typeof E=="function"?E:!0,failure:typeof v=="function"?v:!1};return w.promise=new this.constructor(function(I,z){if(typeof I!="function"||typeof z!="function")throw TypeError("Not a function");w.resolve=I,w.reject=z}),b.chain.push(w),b.state!==0&&n(l,b),w.promise},this.catch=function(E){return this.then(void 0,E)};try{y.call(void 0,function(E){p.call(b,E)},function(E){u.call(b,E)})}catch(g){u.call(b,g)}}var f=t({},"constructor",_,!1);return _.prototype=f,t(f,"__NPO__",0,!1),t(_,"resolve",function(b){var g=this;return b&&typeof b=="object"&&b.__NPO__===1?b:new g(function(v,w){if(typeof v!="function"||typeof w!="function")throw TypeError("Not a function");v(b)})}),t(_,"reject",function(b){return new this(function(E,v){if(typeof E!="function"||typeof v!="function")throw TypeError("Not a function");v(b)})}),t(_,"all",function(b){var g=this;return s.call(b)!="[object Array]"?g.reject(TypeError("Not an array")):b.length===0?g.resolve([]):new g(function(v,w){if(typeof v!="function"||typeof w!="function")throw TypeError("Not a function");var A=b.length,I=Array(A),z=0;c(g,b,function(U,X){I[U]=X,++z===A&&v(I)},w)})}),t(_,"race",function(b){var g=this;return s.call(b)!="[object Array]"?g.reject(TypeError("Not an array")):new g(function(v,w){if(typeof v!="function"||typeof w!="function")throw TypeError("Not a function");c(g,b,function(I,z){v(z)},w)})}),_};var Ja=typeof global=="undefined"?window:global;const $a=typeof Promise!="undefined"?Promise:Hp();Ja.Promise=Ja.Promise||$a;var N=$a;const Go=Cr(require("url")),qp=5e3,Fr=typeof window!="undefined"?window:global;class rt{constructor(e){this._url=e,this._parsedUrl=Go.default.parse(this._url,!0)}_isJSONPRequest(){const{query:e}=this._parsedUrl;for(const t in e){const i=e[t];if(i==="?")return!0}return!1}load(){return this._isJSONPRequest()?this._loadJSONP():this._loadJSON()}_loadJSON(){return new N((e,t)=>{let i;Fr.XDomainRequest?(i=new Fr.XDomainRequest,i.onload=function(){const r=JSON.parse(i.responseText);e(r)},i.onerror=function(r){t(r)},i.open("GET",this._url,!0),i.send()):Fr.XMLHttpRequest&&(i=new XMLHttpRequest,i.onreadystatechange=function(r){if(i.readyState===4)if(i.status===200){const s=JSON.parse(i.responseText);e(s)}else t(new Error(`HTTP Status ${i.status}`))},i.open("GET",this._url,!0),i.send())})}_loadJSONP(){let e=!1,t=!1;const i=`pesdk${Math.round(Math.random()*99999999999999)}`;return new N((r,s)=>{const o=this._createJSONPNode(i);Fr[i]=n=>{this._removeJSONPNode(o),e||(t=!0,r(n))},Fr.setTimeout(()=>{t||(this._removeJSONPNode(o),e=!0,s(new Error("Timeout of 5 seconds exceeded.")))},qp)})}_createJSONPNode(e){const t=this._buildJSONPUrl(e),i=document.querySelector("head"),r=document.createElement("script");return r.src=t,i.appendChild(r),r}_removeJSONPNode(e){e.parentNode.removeChild(e)}_buildJSONPUrl(e){const{query:t}=this._parsedUrl;let i=null;for(const r in t)if(t[r]==="?"){i=r;break}return delete this._parsedUrl.search,t[i]=e,Go.default.format(this._parsedUrl)}}const Uo={};xe(Uo,{ImageLoader:()=>je,JSONLoader:()=>rt});class el{static head(e){return e[0]}static tail(e){return e.slice(1)}static last(e){return e[e.length-1]}static init(e){return e.slice(0,e.length-1)}static remove(e,t){return e.filter((i,r,s)=>!t(i,r,s))}static findIndex(e,t){for(let i=0;i<e.length;i++)if(t(e[i]))return i;return-1}static find(e,t){for(let i=0;i<e.length;i++)if(t(e[i]))return e[i];return}static flatten(e){return e.reduce(function(t,i){return t.concat(Array.isArray(i)?el.flatten(i):i)},[])}static range(e,t){const i=[];if(t>e)for(let r=e;r<t;r++)i.push(r);return i}static repeat(e,t){const i=[];for(let r=0;r<t;r++)i[r]=e;return i}static zip(e,t){const i=Math.min(e.length,t.length),r=[];for(let s=0;s<i;s++)r[s]=[e[s],t[s]];return r}}var tl=el;const Nt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Yp={encode(e){let t="",i,r,s,o,n,a,l,d=0;do i=e[d++],r=e[d++],s=e[d++],o=i>>2,n=(i&3)<<4|r>>4,a=(r&15)<<2|s>>6,l=s&63,isNaN(r)?a=l=64:isNaN(s)&&(l=64),t=t+Nt.charAt(o)+Nt.charAt(n)+Nt.charAt(a)+Nt.charAt(l),i=r=s="",o=n=a=l="";while(d<e.length);return t},decode(e){let t,i,r,s,o,n,a,l=0;const d=[],p=/[^A-Za-z0-9+/=]/g;if(p.exec(e))throw new Error(`There were invalid base64 characters in the input text.
Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='
Expect errors in decoding.`);e=e.replace(/[^A-Za-z0-9+/=]/g,"");do s=Nt.indexOf(e.charAt(l++)),o=Nt.indexOf(e.charAt(l++)),n=Nt.indexOf(e.charAt(l++)),a=Nt.indexOf(e.charAt(l++)),t=s<<2|o>>4,i=(o&15)<<4|n>>2,r=(n&3)<<6|a,d.push(t),n!==64&&d.push(i),a!==64&&d.push(r),t=i=r="",s=o=n=a="";while(l<e.length);return d}};var Ze=Yp;class zt{static isArray(e){return Object.prototype.toString.call(e)==="[object Array]"}static mapRange(e,t,i){return(e-t.getMin())*i.getLength()/t.getLength()+i.getMin()}static isPlainObject(e){if(typeof e!="object"||!e)return!1;if(typeof Object.getPrototypeOf=="function"){const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}return Object.prototype.toString.call(e)==="[object Object]"}static isMobile(){if(typeof navigator=="undefined")return!1;const e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}static isBrowser(){return typeof window!="undefined"}static isNode(){return typeof window=="undefined"&&typeof global!="undefined"}static values(e){const t=[];for(const i in e)t.push(e[i]);return t}static generateUUID(){let e=new Date().getTime();return process.env.REACT_APP_BROWSER&&(typeof window.performance!="undefined"&&typeof window.performance.now=="function"&&(e+=window.performance.now())),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const i=(e+Math.random()*16)%16|0;return e=Math.floor(e/16),(t==="x"?i:i&3|8).toString(16)})}static isDOMElement(e){return typeof HTMLElement=="object"?e instanceof HTMLElement:e&&typeof e=="object"&&e!==null&&e.nodeType===1&&typeof e.nodeName=="string"}static isTouchEvent(e){return e.type.indexOf("touch")!==-1}static resizeVectorToFit(e,t){const i=Math.min(t.x/e.x,t.y/e.y),r=e.clone().multiply(i);return r}static resizeVectorToFill(e,t){const i=e.x/e.y,r=t.x/t.y;return i>r?t.clone().set(t.y*i,t.y):t.clone().set(t.x,t.x/i)}static isExtendable(e){return typeof e!="undefined"&&e!==null&&(typeof e=="object"||typeof e=="function")}static defaults(e,...t){const i={};for(const r in e)i[r]=e[r];for(let r=0;r<t.length;r++){const s=t[r];for(const o in s)typeof i[o]=="undefined"&&(i[o]=s[o])}return i}static deepMerge(e,...t){const i=(r,s)=>{if(s===void 0)return i(null,r);if(Array.isArray(s))return[...s];if(!zt.isPlainObject(s))return s;if(!zt.isPlainObject(r))return R({},s);const o=R({},r);return Object.keys(s).forEach(n=>{const a=s[n];if(a===void 0)return;o[n]=i(r[n],a)}),o};return t.reduce(i,e)}static deepDefaults(e,...t){const i=[...t].reverse();return zt.deepMerge(...i,e)}static deepClone(e){const t={};for(const i in e)zt.isExtendable(e[i])?t[i]=zt.deepClone(e[i]):t[i]=e[i];return t}static getDeepProperty(e,t){if(typeof t=="string")return e[t];if(!Array.isArray(t))return;const i=(r,s)=>{let o;try{o=s(r)}catch(n){if(!(n instanceof TypeError))throw n}return o};return t.reduce((r,s)=>r?typeof s=="function"?i(r,s):r[s]:null,e)}static extend(e,...t){const i={};for(const r in e)i[r]=e[r];for(let r=0;r<t.length;r++){const s=t[r];for(const o in s)i[o]=s[o]}return i}static clone(e){return this.extend({},e)}static createBlobURIFromDataURI(e){const t=typeof window=="undefined"?global:window;if(!t.Blob||!t.URL||!ArrayBuffer||!Uint8Array)return e;const i=Ze.decode(e.split(",")[1]),r=e.split(",")[0].split(":")[1].split(";")[0],s=new ArrayBuffer(i.length),o=new Uint8Array(s);for(let a=0;a<i.length;a++)o[a]=i[a];const n=new t.Blob([s],{type:r});return t.URL.createObjectURL(n)}static getUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0,i=e==="x"?t:t&3|8;return i.toString(16)})}static createCanvas(){if(!process.env.REACT_APP_BROWSER){const e=require("canvas").Canvas;return new e(300,150)}if(process.env.REACT_APP_BROWSER)return document.createElement("canvas")}static convertHtmlImageToRGBACanvas(e,t){const i=t||zt.createCanvas();i.width=e.width,i.height=e.height;const r=i.getContext("2d");return r.clearRect(0,0,i.width,i.height),r.drawImage(e,0,0,e.width,e.height),i}static isPowerOfTwo(e){return(e.x&e.x-1)===0&&(e.y&e.y-1)===0}static nextLowestPOT(e){for(let t=1;t<32;t<<=1)e|=e>>t;return e-(e>>1)}static nextHighestPOT(e){e--;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}static moveArrayItem(e,t,i){if(i>=e.length){let r=i-e.length;for(;r--+1;)e.push(void 0)}e.splice(i,0,e.splice(t,1)[0])}static ensureCanvasDimensions(e,t){return e.width!==t.x||e.height!==t.y?(e.width=t.x,e.height=t.y,!0):!1}static byteArrayToString(e){return e.map(t=>String.fromCharCode(t)).join("")}static clamp(e,t,i){return Math.max(t,Math.min(e,i))}static wildCardMatch(e,t){return new RegExp(`^${t.split("*").join(".*")}$`).test(e)}static flipObject(e){const t={};for(const i in e)t[e[i]]=i;return t}static cloneOptions(e){const t={};for(const i in e){let r=e[i];Array.isArray(r)?r=r.slice():r.clone&&(r=r.clone()),t[i]=r}return t}static ISODateString(e){function t(i){return i<10?`0${i}`:i}return`${e.getUTCFullYear()}-${t(e.getUTCMonth()+1)}-${t(e.getUTCDate())}T${t(e.getUTCHours())}:${t(e.getUTCMinutes())}:${t(e.getUTCSeconds())}Z`}static getCrossOriginValue(e){return e?e==="none"?void 0:e:"anonymous"}static shallowEqual(e,t){if(e===t)return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;const i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;const s=hasOwnProperty.bind(t);for(let o=0;o<i.length;o++)if(!s(i[o])||e[i[o]]!==t[i[o]])return!1;return!0}static enableIf(e,t){return e?t:void 0}static invariant(e,t){if(!e){const i=new Error(t);throw i}}static executePromises(e){const t=e.length;let i=0;const r=[],s=[];return new Promise((o,n)=>{const a=()=>{i++,i>=t&&(s.length<=0?o(r):n(s))},l=p=>{r.push(p),a()},d=p=>{s.push(p),a()};e.forEach(p=>{p.then(l).catch(d)})})}}zt.Array=tl;var S=zt;const Xp=[{name:"trace",type:"trace",background:"#EEEEEE",color:"#AAAAAA"},{name:"info",type:"log",background:"#BDE5F8",color:"#00529B"},{name:"warn",type:"warn",background:"#FEEFB3",color:"#9F6000"},{name:"error",type:"error",background:"#FFBABA",color:"#D8000C"},{name:"log",type:"log",background:"#EEEEEE",color:"#1f4f6b"}],Ko=()=>console&&console.group&&console.groupCollapsed&&console.groupEnd,Qp=()=>typeof navigator!="undefined"&&navigator.userAgent.match(/Gecko|WebKit/i)&&!navigator.userAgent.match(/Trident/),Zp=(e,t)=>{if(process.env.REACT_APP_BROWSER)return["background: #2D7BFF; line-height: 20px; padding: 4px 0","background: #2B2B2B; color: white; line-height: 20px; padding: 4px 0","background: #2D7BFF; line-height: 20px; padding: 4px 0",`background: ${e}; color: ${t}; line-height: 20px; padding: 4px 0; font-weight: bold`,"background: #2B2B2B; color: white; line-height: 20px; padding: 4px 0","background: #2D7BFF; line-height: 20px; padding: 4px 0"];if(!process.env.REACT_APP_BROWSER){const i=Na();return[i.bgHex("#2D7BFF"),i.bgHex("#2B2B2B").white,i.bgHex("#2D7BFF"),i.bgHex(e).hex(t).bold,i.bgHex("#2B2B2B").white,i.bgHex("#2D7BFF")]}};class Jp{constructor(e="warn",t=Xp){this._levels=[...t],this._maxLevel=this.getLevelIndexByName(e),this._consoleFuncs={trace:(...i)=>{Ko()?(console.groupCollapsed(...i),console.trace(),console.groupEnd()):console.trace(...i)}},this._levels.forEach(({name:i})=>{this[i]=(r,...s)=>{this._log(i,r,...s)}})}getLevelIndexByName(e){return S.Array.findIndex(this._levels,t=>t.name===e)}getLevelObjectByName(e){return S.Array.find(this._levels,t=>t.name===e)}canLog(e){const t=this.getLevelIndexByName(e);return t<0?!1:t>=this._maxLevel}setLevel(e){const t=this.getLevelIndexByName(e);if(t<0)return;this._maxLevel=t}_log(e,t,...i){const r=this.getLevelObjectByName(e);if(!r||!this.canLog(e))return;const{name:s,type:o,background:n,color:a}=r,l=i.filter(c=>c!==void 0).map(c=>c.toObject?JSON.parse(JSON.stringify(c.toObject())):c),d=this._consoleFuncs[o]||console[o]?(...c)=>console[o](...c):(...c)=>console.log(...c),p=l.length,u=Zp(n,a);if(process.env.REACT_APP_BROWSER){if(!Qp()){const c=l.length;if(c<=0){d(`PhotoEditorSDK | ${t} `);return}if(c===1&&typeof l[0]=="string"){d(`PhotoEditorSDK | ${t} | ${l[0]}`);return}d(`PhotoEditorSDK | ${t} | `,...l);return}if(p<=0){d(`%c  %c PhotoEditorSDK %c  %c ${t} %c %c  `,...u);return}if(p===1&&typeof l[0]=="string"){d(`%c  %c PhotoEditorSDK %c  %c ${t} %c  ${l[0]}  %c  `,...u);return}Ko()?(console.groupCollapsed(`%c  %c PhotoEditorSDK %c  %c ${t} %c`,...S.Array.init(u)),d(...l),console.groupEnd()):d(`%c  %c PhotoEditorSDK %c  %c ${t} %c`,...S.Array.init(u),...l)}if(!process.env.REACT_APP_BROWSER){const c=`${u[0](" ")} ${u[1]("PhotoEditorSDK")} ${u[2](" ")} ${u[3](t)}`,m=`${u[5](" ")} `;if(p<=0){d(`${c} ${m}`);return}if(p===1&&typeof l[0]=="string"){d(`${c} ${u[4](l[0])} ${m}`);return}Ko()?(console.groupCollapsed(`${c} ${m}`),d(...l),console.groupEnd()):d(`${c} ${m}`,...l)}}image(e="",t){if(process.env.REACT_APP_BROWSER){let i=new window.Image;const r=()=>{const{width:s}=i,{height:o}=i;e&&console.log(e),console.log("%c+",`
        font-size: 1px;
        padding: 0px ${Math.floor(s/2)}px;
        line-height: ${o}px;
        background: url(${i.src});
        color: transparent;
        background-repeat: no-repeat;
        background-size: ${s}px ${o}px;`)};return i.onload=r,t instanceof window.HTMLCanvasElement?i.src=t.toDataURL():t instanceof window.Image?(i=t,r()):typeof t=="string"?i.src=t:this.log(e,t),i}}texture(e="",t){if(process.env.REACT_APP_BROWSER){if(!t){this.log(e,"texture: null or undefined");return}const i=t.getBaseTexture(),r=i.getRenderers(),s=S.Array.find(r,a=>a&&a.constructor.type==="WebGL"),{width:o,height:n}=i.getFrame();if(s){const a=s.getContext(),l=i.getGLTextureForRenderer(s);this.logGlTexture(a,l,o,n,e)}else jo.image(e,i.getSource())}}logGlTexture(e,t,i=150,r=150,s){if(process.env.REACT_APP_BROWSER){e.bindTexture(e.TEXTURE_2D,t);const o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0);const n=new Uint8Array(i*r*4);e.readPixels(0,0,i,r,e.RGBA,e.UNSIGNED_BYTE,n),e.deleteFramebuffer(o);const a=document.createElement("canvas");a.width=i,a.height=r;const l=a.getContext("2d"),d=l.createImageData(i,r);return d.data.set(n),l.putImageData(d,0,0),jo.image(s,a)}}}const jo=new Jp("warn");var k=jo;const me={};xe(me,{ImageFormat:()=>_t,OptionType:()=>h,RenderType:()=>Ie,RendererType:()=>q,UniformType:()=>D});const Ie={IMAGE:"image",DATAURL:"data-url",BUFFER:"buffer",BLOB:"blob",MSBLOB:"ms-blob"},_t={PNG:"image/png",JPEG:"image/jpeg",RAW:"raw"},h={NUMBER:"number",VECTOR2:"vector2",COLOR_MATRIX:"color-matrix",COLOR:"color",ARRAY:"array",OBJECT:"object",STRING:"string",BOOLEAN:"boolean",CONFIGURABLE:"configurable",IMAGE:"image",FUNCTION:"function",TEXTURE:"texture",ALL:"*"},D={SAMPLER2D:"sampler2d",INT:"i",INT1:"1i",INT2:"2i",INT3:"3i",INT4:"4i",FLOAT:"f",FLOAT1:"1f",FLOAT2:"2f",FLOAT_VECTOR2:"2fv",FLOAT3:"3f",FLOAT4:"4f",MAT3:"mat3",MAT3FV:"mat3fv",MAT4:"mat4"},q={WEBGL:"webgl",CANVAS:"canvas"};class st{constructor(e,t,i,r=1){this.r=e,this.g=t,this.b=i,this.a=r}toRGBA(){const e=[Math.round(this.r*255),Math.round(this.g*255),Math.round(this.b*255),this.a.toFixed(2)];return`rgba(${e.join(",")})`}set(e,t,i,r=this.a){return this.r=e,this.g=t,this.b=i,this.a=r,this}toRGB(){return[Math.round(this.r*255),Math.round(this.g*255),Math.round(this.b*255)]}toHex(){const e=[this._componentToHex(Math.round(this.r*255)),this._componentToHex(Math.round(this.g*255)),this._componentToHex(Math.round(this.b*255))];return`#${e.join("")}`}toGLColor(){return[this.r,this.g,this.b,this.a]}toArray(){return this.toGLColor()}toRGBGLColor(){return[this.r,this.g,this.b]}toHSV(){const e=Math.max(this.r,this.g,this.b),t=Math.min(this.r,this.g,this.b);let i,r;const s=e,o=e-t;if(r=e===0?0:o/e,e===t)i=0;else{switch(e){case this.r:i=(this.g-this.b)/o,this.g<this.b&&(i+=6);break;case this.g:i=(this.b-this.r)/o+2;break;case this.b:i=(this.r-this.g)/o+4;break}i/=6}return[i,r,s]}fromHSV(e,t,i){return this.copy(st.fromHSV(e,t,i)),this}static fromHSV(e,t,i,r=1){let[s,o,n]=[];const a=Math.floor(e*6),l=e*6-a,d=i*(1-t),p=i*(1-l*t),u=i*(1-(1-l)*t);switch(a%6){case 0:s=i,o=u,n=d;break;case 1:s=p,o=i,n=d;break;case 2:s=d,o=i,n=u;break;case 3:s=d,o=p,n=i;break;case 4:s=u,o=d,n=i;break;case 5:s=i,o=d,n=p;break}return new st(s,o,n,r)}static fromArray(e){return new st(e[0],e[1],e[2],e[3])}static fromHex(e){const[t,i,r]=e.match(/[0-9A-fa-f]{1,2}/g);return new st(parseInt(t,16)/255,parseInt(i,16)/255,parseInt(r,16)/255,1)}clone(){return new st(this.r,this.g,this.b,this.a)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this.a+=e.a,this}minus(e){return this.r-=e.r,this.g-=e.g,this.b-=e.b,this.a-=e.a,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this.a*=e,this}divideScalar(e){return this.r/=e,this.g/=e,this.b/=e,this.a/=e,this}clamp(e,t){return this.r=Math.min(Math.max(this.r,e),t),this.g=Math.min(Math.max(this.g,e),t),this.b=Math.min(Math.max(this.b,e),t),this.a=Math.min(Math.max(this.a,e),t),this}mix(e,t){return this.r=(1-t)*this.r+t*e.r,this.g=(1-t)*this.g+t*e.g,this.b=(1-t)*this.b+t*e.b,this.a=(1-t)*this.a+t*e.a,this}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this}equals(e){return this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}_componentToHex(e){const t=e.toString(16);return t.length===1?`0${t}`:t}toString(){return`Color(${this.r}, ${this.g}, ${this.b}, ${this.a})`}static get TRANSPARENT(){return new st(0,0,0,0)}static get WHITE(){return new st(1,1,1,1)}static get BLACK(){return new st(0,0,0,1)}static get RED(){return new st(1,0,0,1)}static get BLUE(){return new st(0,0,1,1)}static get GREEN(){return new st(0,1,0,1)}}var O=st;const $p=12;class eu{constructor(){this._maxListeners=$p,this._events={},this._pipeDestinations=[]}pipeEvents(e){this._pipeDestinations.push(e)}unpipeEvents(e){const t=this._pipeDestinations.indexOf(e);if(t===-1)return;this._pipeDestinations.splice(t,1)}on(e,t){if(typeof e=="undefined")throw new Error(`Invalid event type: \`${e}\``);if(typeof t!="function")throw new TypeError;const i=this._events[e]||(this._events[e]=[]);return i.indexOf(t)!==-1?this:(i.push(t),this._maxListeners&&i.length>this._maxListeners&&(k.warn("EventEmitter",`Possible memory leak detected, added ${i.length} \`${e}\` listeners (current limit is ${this._maxListeners})`),typeof console!="undefined"&&console.trace()),this)}once(e,t){if(typeof e=="undefined")throw new Error(`Invalid event type: \`${e}\``);const i=this;function r(){i.off(e,r),t.apply(null,arguments)}return this.on(e,r)}off(e,...t){if(typeof e=="undefined")throw new Error(`Invalid event type: \`${e}\``);if(t.length===0)return this._events[e]=null,this;const i=t[0];if(typeof i!="function")throw new TypeError;const r=this._events[e];if(!r||!r.length)return this;const s=r.indexOf(i);return s===-1?this:(r.splice(s,1),this)}emit(e,...t){if(typeof e=="undefined")throw new Error(`Invalid event type: \`${e}\``);this._pipeDestinations.forEach(r=>{r.emit(e,...t)});const i=this._events[e];return!i||!i.length?!1:(i.slice(0).forEach(r=>r.apply(null,t)),!0)}setMaxListeners(e){if(parseInt(e,10)!==e)throw new TypeError;this._maxListeners=e}}var Pe=eu;var ut={checkFramebufferStatus(e,t){const i=t.checkFramebufferStatus(t.FRAMEBUFFER),r={[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT]:"Incomplete attachment",[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT]:"Missing attachment",[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS]:"Incomplete dimensions",[t.FRAMEBUFFER_UNSUPPORTED]:"Framebuffer unsupported"};i!==t.FRAMEBUFFER_COMPLETE&&k.warn(e,`Framebuffer incomplete: ${r[i]}`)},determineGPUName(e){let t=null,i=null;e||(i=document.createElement("canvas"),e=i.getContext("experimental-webgl")||i.getContext("webgl"));const r=e&&e.getExtension("WEBGL_debug_renderer_info");return r&&(t=e.getParameter(r.UNMASKED_RENDERER_WEBGL),i&&i.remove()),t},isGPUBlacklisted(e,t=null){return!1}};class We{constructor(e,t){this.x=e,this.y=t,typeof this.x=="undefined"&&(this.x=0),typeof this.y=="undefined"&&(this.y=0)}set(e,t){return this.x=e,this.y=t,this}clone(){return new We(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}clamp(e,t){const i=e!==null&&typeof e!="undefined",r=t!==null&&typeof t!="undefined";return!(e instanceof We)&&i&&(e=new We(e,e)),!(t instanceof We)&&r&&(t=new We(t,t)),i&&(this.x=Math.max(e.x,this.x),this.y=Math.max(e.y,this.y)),r&&(this.x=Math.min(t.x,this.x),this.y=Math.min(t.y,this.y)),this}divide(e,t){return e instanceof We?(this.x/=e.x,this.y/=e.y):(this.x/=e,this.y/=typeof t=="undefined"?e:t),this}subtract(e,t){return e instanceof We?(this.x-=e.x,this.y-=e.y):(this.x-=e,this.y-=typeof t=="undefined"?e:t),this}multiply(e,t){return e instanceof We?(this.x*=e.x,this.y*=e.y):(this.x*=e,this.y*=typeof t=="undefined"?e:t),this}add(e,t){return e instanceof We?(this.x+=e.x,this.y+=e.y):(this.x+=e,this.y+=typeof t=="undefined"?e:t),this}dot(e,t){return e instanceof We?this.x*e.x+this.y*e.y:this.x*e+this.y*(typeof t=="undefined"?e:t)}equals(e,t){return e instanceof We?e.x===this.x&&e.y===this.y:e===this.x&&t===this.y}flip(){const e=this.x;return this.x=this.y,this.y=e,this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}floor(){return this.x|=0,this.y|=0,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}len(){return Math.sqrt(this.x*this.x+this.y*this.y)}min(){return Math.min(this.x,this.y)}max(){return Math.max(this.x,this.y)}toObject(){return{x:this.x,y:this.y}}toString(){return`Vector2({ x: ${this.x}, y: ${this.y} })`}roundDecimal(e){return this.x=parseFloat(this.x.toFixed(e)),this.y=parseFloat(this.y.toFixed(e)),this}asArray(e=!1){return e?[this.y,this.x]:[this.x,this.y]}static fromObject(e){return new We(e.x,e.y)}static get NULL(){return new We(0,0)}}var B=We;class il{constructor(){this.reset()}multiply(e){let t,i,r,s,o,n;return t=this.a*e.a+this.b*e.c,i=this.a*e.b+this.b*e.d,r=this.c*e.a+this.d*e.c,s=this.c*e.b+this.d*e.d,o=this.tx*e.a+this.ty*e.c+e.tx,n=this.tx*e.b+this.ty*e.d+e.ty,this.a=t,this.b=i,this.c=r,this.d=s,this.tx=o,this.ty=n,this}applyToVector(e){const{x:t,y:i}=e;return e=e.clone(),e.x=this.a*t+this.c*i+this.tx,e.y=this.b*t+this.d*i+this.tx,e}applyInverseToVector(e){const t=1/(this.a*this.d+this.c*-this.b),{x:i,y:r}=e;return e=e.clone(),e.x=this.d*t*i+-this.c*t*r+(this.ty*this.c-this.tx*this.d)*t,e.y=this.a*t*r+-this.b*t*i+(-this.ty*this.a+this.tx*this.b)*t,e}rectangleToCoordinates(e,t=new B(0,0)){const i=e.width*(1-t.x),r=e.width*-t.x,s=e.height*(1-t.y),o=e.height*-t.y,n=[];return n.push(new B(this.a*r+this.c*o+this.tx,this.d*o+this.b*r+this.ty)),n.push(new B(this.a*i+this.c*o+this.tx,this.d*o+this.b*i+this.ty)),n.push(new B(this.a*i+this.c*s+this.tx,this.d*s+this.b*i+this.ty)),n.push(new B(this.a*r+this.c*s+this.tx,this.d*s+this.b*r+this.ty)),n}reset(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0}toArray(){const e=[this.a,this.b,0,this.c,this.d,0,this.tx,this.ty,1];return typeof Float32Array=="undefined"?e:new Float32Array(e)}toString(){return`Matrix({ a: ${this.a}, b: ${this.b}, c: ${this.c}, d: ${this.d}, tx: ${this.tx}, ty: ${this.ty} })`}static get IDENTITY(){return new il}}var ot=il;class ns{constructor(e=0,t=0,i=0,r=0){this.x=e,this.y=t,this.width=i,this.height=r}set(e,t,i,r){return this.x=e,this.y=t,this.width=i,this.height=r,this}clone(){return new ns(this.x,this.y,this.width,this.height)}copy(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}equals(e,t,i,r){if(e instanceof ns)return e.x===this.x&&e.y===this.y&&e.width===this.width&&e.height===this.height;const s=e;return s===this.x&&t===this.y&&i===this.width&&r===this.height}translate(e,t){return e instanceof B&&(t=e.y,e=e.x),this.x+=e,this.y+=t,this}scale(e,t){return e instanceof B?(t=e.y,e=e.x):t===void 0&&(t=e),this.width*=e,this.height*=t,this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.width=Math.round(this.width),this.height=Math.round(this.height),this}getPosition(){return new B(this.x,this.y)}getSize(){return new B(this.width,this.height)}insetBy(e,t){return this.x+=e,this.y+=t,this.width-=2*e,this.height-=2*t,this}intersects(e){const t=new B(this.x,this.y),i=new B(this.x+this.width,this.y+this.height),r=new B(e.x,e.y),s=new B(e.x+e.width,e.y+e.height);return!(r.x>i.x||t.x>s.x||s.y<t.y||i.y<r.y)}toString(){return`Rectangle({ x: ${this.x}, y: ${this.y}, width: ${this.width}, height: ${this.height} })`}static FromDiagonalPoints(e,t){let i=!1;t.x-e.x<0&&(i=!0);const r=i?t:e,s=i?e:t,o=s.x-r.x,n=s.y-r.y;return new ns(r.x,r.y,o,n)}}var fe=ns;const Wo={};xe(Wo,{BATCH_SIZE:()=>ti,Color:()=>O,Constants:()=>me,EventEmitter:()=>Pe,GLUtils:()=>ut,Log:()=>k,Matrix:()=>ot,Rectangle:()=>fe,Utils:()=>S,VERTEX_BYTE_SIZE:()=>St,VERTEX_SIZE:()=>rl,Vector2:()=>B});const ti=2e3,rl=5,St=rl*4;class tu{constructor(){this._position=new B(0,0),this._scale=new B(1,1),this._pivot=new B(0,0),this._rotation=0,this._lastRotation=null,this._alpha=1,this._visible=!0,this._worldTransform=new ot,this._parent=null,this._shaders=[],this._boundsNeedUpdate=!0,this._bounds=new fe(0,0,1,1),this._localBoundsNeedUpdate=!0,this._localBounds=new fe(0,0,1,1),this._tint=16777215,this._filterRectangle=new fe(0,0,0,0)}renderWebGL(e){k.warn(this.constructor.name,"`renderWebGL` is abstract and not implemented in inherited class")}renderCanvas(e){k.warn(this.constructor.name,"`renderCanvas` is abstract and not implemented in inherited class")}updateTransform(){const e=this._parent?this._parent.getWorldTransform():ot.IDENTITY,t=this._worldTransform,i=this._rotation!==this._lastRotation;i&&(this._sinRotation=Math.sin(this._rotation),this._cosRotation=Math.cos(this._rotation),this._lastRotation=this._rotation),t.a=this._cosRotation*this._scale.x,t.b=this._sinRotation*this._scale.x,t.c=-this._sinRotation*this._scale.y,t.d=this._cosRotation*this._scale.y,t.tx=this._position.x,t.ty=this._position.y,(this._pivot.x||this._pivot.y)&&(t.tx-=this._pivot.x*t.a+this._pivot.y*t.c,t.ty-=this._pivot.x*t.b+this._pivot.y*t.d),t.multiply(e),this._boundsNeedUpdate=!0,this._localBoundsNeedUpdate=!0}addShader(e){this._shaders.push(e)}removeShader(e){const t=this._shaders.indexOf(e);return t!==-1?(this._shaders.splice(t,1),!0):!1}removeShaderAt(e){return this._shaders[e]?(this._shaders.splice(e,1),!0):!1}getBounds(){return this._bounds.clone()}getPosition(){return this._position}setPosition(e,t){e instanceof B?this._position.copy(e):this._position.set(e,t),this._boundsNeedUpdate=!0,this._localBoundsNeedUpdate=!0}getScale(){return this._scale}setScale(e,t){e instanceof B?this._scale.copy(e):this._scale.set(e,t),this._boundsNeedUpdate=!0,this._localBoundsNeedUpdate=!0}getPivot(){return this._pivot}setPivot(e,t){e instanceof B?this._pivot.copy(e):this._pivot.set(e,t),this._boundsNeedUpdate=!0,this._localBoundsNeedUpdate=!0}getRotation(){return this._rotation}setRotation(e){this._rotation=e,this._boundsNeedUpdate=!0,this._localBoundsNeedUpdate=!0}getAlpha(){return this._alpha}setAlpha(e){this._alpha=e}getWorldAlpha(){return this._parent?this._parent.getAlpha()*this._alpha:this._alpha}getWorldTransform(){return this._worldTransform}getParent(){return this._parent}setParent(e){this._parent=e}getFilterRectangle(){return this._filterRectangle}setFilterRectangle(e){this._filterRectangle.copy(e)}getTint(){return this._tint}setTint(e){this._tint=e}isVisible(){return this._visible}setVisible(e){this._visible=e}}var Vi=tu;class iu extends Vi{constructor(...e){super(...e);this._children=[],this._filters=[]}addFilter(e){this._filters.push(e)}removeFilter(e){const t=this._filters.indexOf(e);return t!==-1?(this._filters.splice(t,1),!0):!1}setFilters(e){this._filters=e}addChild(e){const t=e.getParent();t!==null&&t.removeChild(e),e.setParent(this),this._children.push(e)}prependChild(e){const t=e.getParent();t!==null&&t.removeChild(e),e.setParent(this),this._children.unshift(e)}hasChild(e){const t=this._children.indexOf(e);return t!==-1}removeChild(e){const t=this._children.indexOf(e);t!==-1?(this._children.splice(t,1),e.setParent(null)):k.info(this.constructor.name,"Tried to remove a child that does not exist")}clearChildren(){this._children=[]}renderWebGL(e){if(!this._visible)return;const t=e.getFilterManager();this._filters&&this._filters.length&&t.pushFilters(this,this._filters),e.getCurrentObjectRenderer().start(),this._renderWebGL(e),this._children.forEach(i=>{i.renderWebGL(e)}),e.getCurrentObjectRenderer().flush(),this._filters&&this._filters.length&&t.popFilters(),e.getCurrentObjectRenderer().start()}_renderWebGL(e){}renderCanvas(e){if(!this._visible)return;const t=e.getFilterManager();this._filters&&this._filters.length&&t.pushFilters(this,this._filters),this._renderCanvas(e),this._children.forEach(i=>{i.renderCanvas(e)}),this._filters&&this._filters.length&&t.popFilters()}_renderCanvas(e){}updateTransform(){super.updateTransform(),this._children.forEach(e=>{e.updateTransform()})}getLocalBounds(){return this._localBoundsNeedUpdate&&(this._localBoundsNeedUpdate=!1),this._localBounds.clone()}getBounds(){return this._boundsNeedUpdate&&(this._boundsNeedUpdate=!1),this._bounds.clone()}getChildren(){return this._children}getFilters(){return this._filters}dispose(){}}var as=iu;"use strict";var ru=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],su=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function ol(e,t,i,r,s,o){if(isNaN(o)||o<1)return;o|=0;var n=e.data,a,l,d,p,u,c,m,x,_,f,y,b,g,E,v,w,A,I,z,H,U,X,Q,re,Ae=o+o+1,Ge=r-1,oe=s-1,ee=o+1,he=ee*(ee+1)/2,ne=new sl,ct,te=ne;for(d=1;d<Ae;d++)te=te.next=new sl,d==ee&&(ct=te);te.next=ne;var ge=null,Ue=null;m=c=0;var Mt=ru[o],Lt=su[o];for(l=0;l<s;l++){for(w=A=I=z=x=_=f=y=0,b=ee*(H=n[c]),g=ee*(U=n[c+1]),E=ee*(X=n[c+2]),v=ee*(Q=n[c+3]),x+=he*H,_+=he*U,f+=he*X,y+=he*Q,te=ne,d=0;d<ee;d++)te.r=H,te.g=U,te.b=X,te.a=Q,te=te.next;for(d=1;d<ee;d++)p=c+((Ge<d?Ge:d)<<2),x+=(te.r=H=n[p])*(re=ee-d),_+=(te.g=U=n[p+1])*re,f+=(te.b=X=n[p+2])*re,y+=(te.a=Q=n[p+3])*re,w+=H,A+=U,I+=X,z+=Q,te=te.next;for(ge=ne,Ue=ct,a=0;a<r;a++)n[c+3]=Q=y*Mt>>Lt,Q!==0?(Q=255/Q,n[c]=(x*Mt>>Lt)*Q,n[c+1]=(_*Mt>>Lt)*Q,n[c+2]=(f*Mt>>Lt)*Q):n[c]=n[c+1]=n[c+2]=0,x-=b,_-=g,f-=E,y-=v,b-=ge.r,g-=ge.g,E-=ge.b,v-=ge.a,p=m+((p=a+o+1)<Ge?p:Ge)<<2,w+=ge.r=n[p],A+=ge.g=n[p+1],I+=ge.b=n[p+2],z+=ge.a=n[p+3],x+=w,_+=A,f+=I,y+=z,ge=ge.next,b+=H=Ue.r,g+=U=Ue.g,E+=X=Ue.b,v+=Q=Ue.a,w-=H,A-=U,I-=X,z-=Q,Ue=Ue.next,c+=4;m+=r}for(a=0;a<r;a++){for(A=I=z=w=_=f=y=x=0,c=a<<2,b=ee*(H=n[c]),g=ee*(U=n[c+1]),E=ee*(X=n[c+2]),v=ee*(Q=n[c+3]),x+=he*H,_+=he*U,f+=he*X,y+=he*Q,te=ne,d=0;d<ee;d++)te.r=H,te.g=U,te.b=X,te.a=Q,te=te.next;for(u=r,d=1;d<=o;d++)c=u+a<<2,x+=(te.r=H=n[c])*(re=ee-d),_+=(te.g=U=n[c+1])*re,f+=(te.b=X=n[c+2])*re,y+=(te.a=Q=n[c+3])*re,w+=H,A+=U,I+=X,z+=Q,te=te.next,d<oe&&(u+=r);for(c=a,ge=ne,Ue=ct,l=0;l<s;l++)p=c<<2,n[p+3]=Q=y*Mt>>Lt,Q>0?(Q=255/Q,n[p]=x*Mt>>Lt,n[p+1]=_*Mt>>Lt,n[p+2]=f*Mt>>Lt):n[p]=n[p+1]=n[p+2]=0,x-=b,_-=g,f-=E,y-=v,b-=ge.r,g-=ge.g,E-=ge.b,v-=ge.a,p=a+((p=l+ee)<oe?p:oe)*r<<2,x+=w+=ge.r=n[p],_+=A+=ge.g=n[p+1],f+=I+=ge.b=n[p+2],y+=z+=ge.a=n[p+3],ge=ge.next,b+=H=Ue.r,g+=U=Ue.g,E+=X=Ue.b,v+=Q=Ue.a,w-=H,A-=U,I-=X,z-=Q,Ue=Ue.next,c+=r}}function sl(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}let Vo;process.env.REACT_APP_BROWSER&&(Vo=window.Image);process.env.REACT_APP_BROWSER||(Vo=require("canvas").Image);var Se=Vo;class Gt{constructor(e=1,t=0,i=0,r=0,s=0,o=0,n=1,a=0,l=0,d=0,p=0,u=0,c=1,m=0,x=0,_=0,f=0,y=0,b=1,g=0){this.set(e,t,i,r,s,o,n,a,l,d,p,u,c,m,x,_,f,y,b,g)}set(e,t,i,r,s,o,n,a,l,d,p,u,c,m,x,_,f,y,b,g){this.a=e,this.b=t,this.c=i,this.d=r,this.e=s,this.f=o,this.g=n,this.h=a,this.i=l,this.j=d,this.k=p,this.l=u,this.m=c,this.n=m,this.o=x,this.p=_,this.q=f,this.r=y,this.s=b,this.t=g}reset(){this.a=1,this.b=0,this.c=0,this.d=0,this.e=0,this.f=0,this.g=1,this.h=0,this.i=0,this.j=0,this.k=0,this.l=0,this.m=1,this.n=0,this.o=0,this.p=0,this.q=0,this.r=0,this.s=1,this.t=0}apply(e){const t=this.a*e.r+this.b*e.g+this.c*e.b+this.d*e.a+this.e,i=this.f*e.r+this.g*e.g+this.h*e.b+this.i*e.a+this.j,r=this.k*e.r+this.l*e.g+this.m*e.b+this.n*e.a+this.o,s=this.p*e.r+this.q*e.g+this.r*e.b+this.s*e.a+this.t;return new O(t,i,r,s)}multiply(e){let t,i,r,s,o,n,a,l,d,p,u,c,m,x,_,f,y,b,g,E;const v=e,w=this;return t=v.a*w.a+v.b*w.f+v.c*w.k+v.d*w.p,i=v.a*w.b+v.b*w.g+v.c*w.l+v.d*w.q,r=v.a*w.c+v.b*w.h+v.c*w.m+v.d*w.r,s=v.a*w.d+v.b*w.i+v.c*w.n+v.d*w.s,n=v.f*w.a+v.g*w.f+v.h*w.k+v.i*w.p,a=v.f*w.b+v.g*w.g+v.h*w.l+v.i*w.q,l=v.f*w.c+v.g*w.h+v.h*w.m+v.i*w.r,d=v.f*w.d+v.g*w.i+v.h*w.n+v.i*w.s,u=v.k*w.a+v.l*w.f+v.m*w.k+v.n*w.p,c=v.k*w.b+v.l*w.g+v.m*w.l+v.n*w.q,m=v.k*w.c+v.l*w.h+v.m*w.m+v.n*w.r,x=v.k*w.d+v.l*w.i+v.m*w.n+v.n*w.s,f=v.p*w.a+v.q*w.f+v.r*w.k+v.s*w.p,y=v.p*w.b+v.q*w.g+v.r*w.l+v.s*w.q,b=v.p*w.c+v.q*w.h+v.r*w.m+v.s*w.r,g=v.p*w.d+v.q*w.i+v.r*w.n+v.s*w.s,o=v.a*w.e+v.b*w.j+v.c*w.o+v.d*w.t+v.e,p=v.f*w.e+v.g*w.j+v.h*w.o+v.i*w.t+v.j,_=v.k*w.e+v.l*w.j+v.m*w.o+v.n*w.t+v.o,E=v.p*w.e+v.q*w.j+v.r*w.o+v.s*w.t+v.t,this.a=t,this.b=i,this.c=r,this.d=s,this.e=o,this.f=n,this.g=a,this.h=l,this.i=d,this.j=p,this.k=u,this.l=c,this.m=m,this.n=x,this.o=_,this.p=f,this.q=y,this.r=b,this.s=g,this.t=E,this}clone(){const e=new Gt;return e.set(this.a,this.b,this.c,this.d,this.e,this.f,this.g,this.h,this.i,this.j,this.k,this.l,this.m,this.n,this.o,this.p,this.q,this.r,this.s,this.t),e}equals(e){return this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f&&this.g===e.g&&this.h===e.h&&this.i===e.i&&this.j===e.j&&this.k===e.k&&this.l===e.l&&this.m===e.m&&this.n===e.n&&this.o===e.o&&this.p===e.p&&this.q===e.q&&this.r===e.r&&this.s===e.s&&this.t===e.t}getOffsets(){return[this.e,this.j,this.o,this.t]}toString(){return`ColorMatrix( ${this.a}, ${this.b}, ${this.c}, ${this.d}, ${this.e},
      ${this.f}, ${this.g}, ${this.h}, ${this.i}, ${this.j},
      ${this.k}, ${this.l}, ${this.m}, ${this.n}, ${this.o},
      ${this.p}, ${this.q}, ${this.r}, ${this.s}, ${this.t} )`}toArray(){return"abcdefghijklmnopqrst".split("").map(e=>this[e])}static get IDENTITY(){return new Gt}static createBrightnessMatrix(e){const t=new Gt;return t.e=e,t.j=e,t.o=e,t}static createContrastMatrix(e){const t=new Gt,i=(1-e)/2;return t.a=t.g=t.m=e,t.e=t.j=t.o=i,t}static createSaturationMatrix(e=1){const t=new Gt,i=1-e,r=.213*i,s=.715*i,o=.072*i;return t.a=r+e,t.b=s,t.c=o,t.f=r,t.g=s+e,t.h=o,t.k=r,t.l=s,t.m=o+e,t}static createExposureMatrix(e=0){const t=Math.pow(2,e);return new Gt(t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0)}static createLinearMatrix(e=1,t=0){const i=new Gt;return i.a=i.g=i.m=e,i.e=i.j=i.o=t,i}}var Ar=Gt;class ls extends Pe{constructor(e={},t={}){super();this.availableOptions=this.availableOptions||{},this.availableOptions=S.extend(this.availableOptions,t),this._onConfigurableUpdate=this._onConfigurableUpdate.bind(this),this._initOptions(e)}_buildConfigError(e){let t="";return this.constructor.name&&(t=`${this.constructor.name}: `),t+=e,new Error(t)}_onOptionsChange(){}validateSettings(){return new N((e,t)=>{for(const i in this.availableOptions){const r=this.availableOptions[i];if(r.required&&typeof this._options[i]=="undefined")return t(this._buildConfigError(`Option \`${i}\` is required.`))}e()})}_initOptions(e={}){this._options={};let t,i,r;const s=this;for(t in this.availableOptions){if(r=t.charAt(0).toUpperCase()+t.slice(1),i=this.availableOptions[t],[h.STRING,h.NUMBER,h.BOOLEAN,h.OBJECT,h.VECTOR2,h.COLOR,h.CONFIGURABLE,h.COLOR_MATRIX,h.ARRAY,h.IMAGE,h.FUNCTION,h.ALL].indexOf(i.type)===-1)throw this._buildConfigError(`Unknown option type: \`${i.type}\``);const o=function(a,l){s[`set${r}`]=function(d,p,u){s.setOption(a,d,p,u)},s[`get${r}`]=function(){return s.getOption(a)}};if(o(t,i),i.type===h.CONFIGURABLE&&(this._options[t]=new ls(void 0,i.structure||{}),this._options[t].on("update",this._onConfigurableUpdate)),!(t in e)||typeof e[t]=="undefined")if(typeof i.default!="undefined"){let n=i.default;typeof i.default=="function"&&(n=i.default()),this[`set${r}`](n,!1,!0)}else i.type!==h.CONFIGURABLE&&(this._options[t]=void 0)}for(t in e){if(typeof this.availableOptions[t]=="undefined")throw new Error(`Invalid option: ${t}`);typeof e[t]!="undefined"&&(r=t.charAt(0).toUpperCase()+t.slice(1),this[`set${r}`](e[t],!1,!0))}}set(e,t=!0){for(const i in e)this.setOption(i,e[i],!1);this._onOptionsChange(),t&&this.emit("update",this,e)}getOption(e){return this._options[e]}hasOption(e){return!!this.availableOptions[e]}getOptionDefault(e){const t=this.availableOptions[e];if(!t)throw new Error(`Invalid option: ${e}`);return t.default}resetOptions(){this.set(this.getDefaultOptions())}getDefaultOptions(){const e={};for(const t in this.availableOptions){const i=this.availableOptions[t].default;if(typeof i=="undefined")continue;e[t]=i}return e}getOptions(){return R({},this._options)}equals(e){const t=e.getOptions();return this.optionsEqual(t)}optionsEqual(e){for(const t in e){const i=e[t];if(!this._optionEquals(t,i))return!1}return!0}_optionEquals(e,t){const i=this.availableOptions[e];if(typeof i=="undefined")throw new Error(`Invalid option: ${e}`);const r=this.availableOptions[e].type,s=this._options[e];if(s===t)return!0;if(typeof t=="undefined"||typeof s=="undefined")return!1;switch(r){case h.OBJECT:return typeof s.optionsEqual=="function"?s.optionsEqual(t._options):s===t;case h.STRING:case h.NUMBER:case h.BOOLEAN:case h.FUNCTION:case"*":return s===t;case h.VECTOR2:return s.equals(t);case h.COLOR:case h.COLOR_MATRIX:return t.equals(s);case h.CONFIGURABLE:return s.optionsEqual(t);case h.ARRAY:return this._arrayOptionEquals(e,t);case h.IMAGE:return s.src===t.src}}_arrayOptionEquals(e,t){const i=this._options[e];if(t.length!==i.length)return!1;let r=!0;for(let s=0;s<i.length;s++){const o=i[s],n=t[s];if(o instanceof ls){if(typeof n=="undefined"||!o.optionsEqual(n)){r=!1;break}}else if(n!==o){r=!1;break}}return r}serializeOptions(e=Object.keys(this._options),t=!1){const i={};return e.forEach(r=>{if(typeof this.availableOptions[r]=="undefined")return k.warn(`Trying to serialize a key that does not exist: ${r}`);if(this.availableOptions[r].serializable===!1)return;i[r]=this.serializeOption(r,t)}),i}serializeOption(e,t=!1){const i=this.availableOptions[e],r=i.type,s=this._options[e];if(!s)return s;if(i.serializable===!1)throw new Error(`Option \`${e}\` is not serializable.`);switch(r){case h.STRING:case h.NUMBER:case h.BOOLEAN:case h.OBJECT:case h.FUNCTION:case h.ALL:return s;case h.VECTOR2:return t?s.toObject():s.clone();case h.COLOR:case h.COLOR_MATRIX:return t?s.toArray():s.clone();case h.CONFIGURABLE:return s.serializeOptions(void 0,t);case h.ARRAY:return s.slice(0);case h.IMAGE:return t?s.src:s}}setOption(e,t,i=!0,r=!1){const s=this.availableOptions[e];if(!s)throw new Error(`Invalid option: ${e}`);if(typeof s.setter!="undefined"&&(t=s.setter.call(this,t,r)),typeof s.validation!="undefined"&&s.validation(t),t===null||typeof t=="undefined"){if(s.required)throw this._buildConfigError(`Option \`${e}\` is required.`);this._options[e]=t}else switch(s.type){case h.STRING:{if(typeof t!==h.STRING)throw this._buildConfigError(`Option \`${e}\` has to be a string.`);const{available:o}=s;if(typeof o!="undefined"&&o.indexOf(t)===-1)throw this._buildConfigError(`Invalid value for \`${e}\` (valid values are: ${s.available.join(", ")})`);this._options[e]=t;break}case h.NUMBER:if(typeof t!==h.NUMBER)throw this._buildConfigError(`Option \`${e}\` has to be a number.`);this._options[e]=t;break;case h.BOOLEAN:if(typeof t!==h.BOOLEAN)throw this._buildConfigError(`Option \`${e}\` has to be a boolean.`);this._options[e]=t;break;case h.VECTOR2:if(!(t instanceof B)&&!(typeof t=="object"&&"x"in t&&"y"in t))throw this._buildConfigError(`Option \`${e}\` has to be an instance of Vector2 or an Object holding x and y values.`);t instanceof B?this._options[e]=t.clone():this._options[e]=B.fromObject(t);break;case h.COLOR:if(!(t instanceof O))throw this._buildConfigError(`Option \`${e}\` has to be an instance of Color.`);this._options[e]=t;break;case h.COLOR_MATRIX:if(!(t instanceof Ar))throw this._buildConfigError(`Option \`${e}\` has to be an instance of ColorMatrix.`);this._options[e]=t.clone();break;case h.FUNCTION:if(typeof t!="function")throw this._buildConfigError(`Option \`${e}\` has to be a function.`);this._options[e]=t;break;case h.OBJECT:case"*":this._options[e]=t;break;case h.IMAGE:if(typeof t=="string"){const o=new Se;o.crossOrigin=S.getCrossOriginValue(s.crossOrigin),o.src=t,this._options[e]=o}else if(t instanceof Se||typeof HTMLCanvasElement!="undefined"&&t instanceof HTMLCanvasElement||typeof HTMLImageElement!="undefined"&&t instanceof HTMLImageElement)this._options[e]=t;else throw this._buildConfigError(`Option \`${e}\` has to be an Image, Canvas or String.`);break;case h.CONFIGURABLE:t instanceof ls?this._options[e]=t:this._options[e].set(t);break;case h.ARRAY:if(!(t instanceof Array))throw this._buildConfigError(`Option \`${e}\` has to be an Array.`);this._options[e]=t.slice(0);break;default:throw this._buildConfigError(`Unknown option type: \`${s.type}\``)}i&&(this._onOptionsChange(),this.emit("update",this,{[e]:t}))}_onConfigurableUpdate(...e){this.emit("update",...e)}hasChanges(){const e=this.getDefaultOptions();return!this.optionsEqual(e)}}var G=ls;const{Log:Ho,Utils:ou}=Wo;class nu{constructor(e,t,i,r,s){this._renderer=e,this._vertexSource=t,this._fragmentSource=i,this._uniforms=r||{},this._uniformLocations={},this._attributes=s||[],this._attributeLocations={},this._onContextChange=this._onContextChange.bind(this),this._renderer.on("context",this._onContextChange),this._init()}_init(){this._compile();const e=this._renderer.getContext();e.useProgram(this._program),this._cacheUniformLocations(),this._cacheAttributeLocations()}_onContextChange(){this._init()}setupBuffers(e,t){const i=this._renderer.getContext();i.bindBuffer(i.ARRAY_BUFFER,e),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t),i.vertexAttribPointer(this._attributeLocations.a_position,2,i.FLOAT,!1,St,0),i.vertexAttribPointer(this._attributeLocations.a_texCoord,2,i.FLOAT,!1,St,2*4),i.vertexAttribPointer(this._attributeLocations.a_color,4,i.UNSIGNED_BYTE,!0,St,4*4)}syncUniforms(){Object.keys(this._uniforms).forEach(e=>{this.syncUniform(e)})}syncUniform(e){const t=this._renderer.getContext(),i=this._uniforms[e],r=this._uniformLocations[e];switch(i.type){case D.SAMPLER2D:t.uniform1i(r,i.value);break;case D.INT:case D.INT1:t.uniform1i(r,i.value);break;case D.INT2:t.uniform2i(r,i.value[0],i.value[1]);break;case D.INT3:t.uniform3i(r,i.value[0],i.value[1],i.value[2]);break;case D.INT4:t.uniform4i(r,i.value[0],i.value[1],i.value[2],i.value[3]);break;case D.FLOAT:case D.FLOAT1:t.uniform1f(r,i.value);break;case D.FLOAT2:t.uniform2f(r,i.value[0],i.value[1]);break;case D.FLOAT3:t.uniform3f(r,i.value[0],i.value[1],i.value[2]);break;case D.FLOAT4:t.uniform4f(r,i.value[0],i.value[1],i.value[2],i.value[3]);break;case D.FLOAT_VECTOR2:t.uniform2fv(r,i.value);break;case D.MAT3:case D.MAT3FV:t.uniformMatrix3fv(r,!1,i.value);break;case D.MAT4:t.uniformMatrix4fv(r,!1,i.value);break;default:Ho.warn(this.constructor.name,`Unknown uniform type: ${i.type}`)}}_cacheAttributeLocations(){const e=this._renderer.getContext();this._attributes.forEach(t=>{this._attributeLocations[t]=e.getAttribLocation(this._program,t)})}_cacheUniformLocations(){const e=this._renderer.getContext(),t=Object.keys(this._uniforms);t.forEach(i=>{this._uniformLocations[i]=e.getUniformLocation(this._program,i)})}_addPrecisionToSource(e){const t=this._renderer.getMaxFloatPrecision();let i="mediump";return ou.isMobile()&&t==="highp"&&(i="highp"),`precision ${i} float;
${e}`}_compile(){const e=this._renderer.getContext(),t=this._compileShader(e.VERTEX_SHADER,this._vertexSource);this._vertexShader=t;const i=this._addPrecisionToSource(this._fragmentSource),r=this._compileShader(e.FRAGMENT_SHADER,i);this._fragmentShader=r;const s=e.createProgram();e.attachShader(s,t),e.attachShader(s,r),e.linkProgram(s);const o=e.getProgramParameter(s,e.LINK_STATUS);if(o)this._program=s;else{let n=e.getProgramInfoLog(s);e.isContextLost()&&(n="WebGL context lost"),e.deleteProgram(s),Ho.error(this.constructor.name,`WebGL program linking error: ${n}`)}}_compileShader(e,t){const i=this._renderer.getContext(),r=i.createShader(e);i.shaderSource(r,t),i.compileShader(r);const s=i.getShaderParameter(r,i.COMPILE_STATUS);if(!s){let o=i.getShaderInfoLog(r);i.isContextLost()&&(o="WebGL context lost"),i.deleteShader(r),Ho.error(this.constructor.name,`WebGL shader compilation error: ${o}`)}return r}setUniform(e,t,i=!1){this._uniforms[e].value=t,i&&this.syncUniform(e)}setUniforms(e,t=!1){for(const i in e)this._uniforms[i].value=e[i],t&&this.syncUniform(i)}getUniforms(){return this._uniforms}getAttributes(){return this._attributes}getAttributeLocations(){return this._attributeLocations}getProgram(){return this._program}dispose(){const e=this._renderer.getContext();e.deleteProgram(this._program),e.deleteShader(this._vertexShader),e.deleteShader(this._fragmentShader),this._uniforms=null,this._uniformLocations=null,this._attributes=null,this._attributeLocations=null,this._renderer.off("context",this._onContextChange)}}var Hi=nu;var nl=`uniform sampler2D u_image;
varying vec2 v_texCoord;
varying vec4 v_color;

void main() {
  gl_FragColor = texture2D(u_image, v_texCoord) * v_color;
}
`;var al=`attribute vec2 a_position;
attribute vec2 a_texCoord;
attribute vec4 a_color;
varying vec2 v_texCoord;
varying vec4 v_color;
uniform mat3 u_projMatrix;

void main() {
  gl_Position = vec4((u_projMatrix * vec3(a_position, 1)).xy, 0, 1);
  v_texCoord = a_texCoord;
  v_color = vec4(a_color.rgb * a_color.a, a_color.a);
}
`;const{UniformType:ll}=me;class Tt extends Hi{constructor(e,t,i){t=t||Tt.defaultVertexSource,i=i||Tt.defaultFragmentSource,super(e,t,i,Tt.defaultUniforms,Tt.defaultAttributes)}}Tt.defaultVertexSource=al;Tt.defaultFragmentSource=nl;const au=new ot;Tt.defaultUniforms={u_image:{type:ll.SAMPLER2D,value:0},u_projMatrix:{type:ll.MAT3,value:au.toArray()}};Tt.defaultAttributes=["a_position","a_texCoord","a_color"];var Rt=Tt;const{OptionType:qo,UniformType:Yo,RendererType:hl}=me;class lu extends G{_initOptions(e={}){this._shaders=[],this._availableUniforms=Rt.defaultUniforms,this._attributes=Rt.defaultAttributes,this._vertexSource=Rt.defaultVertexSource,this._fragmentSource=Rt.defaultFragmentSource,this._initUniforms(),super._initOptions(e)}_initUniforms(){this._uniforms={};for(const e in this._availableUniforms){const t=this._availableUniforms[e];this._uniforms[e]={type:t.type,value:t.default||null}}for(const e in this.availableOptions){const t=this.availableOptions[e];t.uniformType?this._uniforms[`u_${e}`]={type:t.uniformType,value:t.default||null}:k.trace(this.constructor.name,`Option \`${e}\` is missing a \`uniformType\`!`)}}setOption(e,t,i=!0){super.setOption(e,t,i);let r=t;const s=this.availableOptions[e];if(!s.uniformType)return;const o=`u_${e}`;switch(s.type){case qo.COLOR:s.uniformType===Yo.FLOAT4?r=t.toGLColor():s.uniformType===Yo.FLOAT3&&(r=t.toRGBGLColor());break;case qo.VECTOR2:r=[t.x,t.y];break;case qo.COLOR_MATRIX:{r=[t.a,t.b,t.c,t.d,t.f,t.g,t.h,t.i,t.k,t.l,t.m,t.n,t.p,t.q,t.r,t.s];const n=[t.e,t.j,t.o,t.t];this._uniforms[`${o}_vec`]={value:n,type:Yo.FLOAT4}}}this.setUniform(o,r)}setUniform(e,t,i=!1){this._uniforms[e].value=t}setUniforms(e,t=!1){for(const i in e)this._uniforms[i].value=e[i],t&&this.syncUniform(i)}syncUniform(e){this._shaders.forEach(t=>{t.syncUniform(e)})}syncUniforms(){this._shaders.forEach(e=>{e.syncUniforms()})}getShaderForRenderer(e){const t=e.getContext();let i=this._shaders[t.id];return i||(i=new Hi(e,this._vertexSource,this._fragmentSource,this._uniforms,this._attributes),this._shaders[t.id]=i),i}apply(e,t,i,r=!1){e.isOfType(hl.WEBGL)?this._applyWebGL(e,t,i,r):e.isOfType(hl.CANVAS)&&this._applyCanvas(e,t,i,r)}_applyWebGL(e,t,i,r=!1){const s=e.getContext(),o=this.getShaderForRenderer(e);e.setRenderTarget(i),r&&i.clear(),e.setShader(o);const n=e.getCurrentRenderTarget().getProjectionMatrix().toArray();o.setUniform("u_projMatrix",n),o.syncUniforms(),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,t.getTexture()),s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0)}_applyCanvas(e,t,i,r=!1){const s=t.getCanvas(),o=i.getContext();k.warn(this.constructor.name,"`_applyCanvas` is not implemented. Just copying image data from `inputTarget` to `outputTarget`."),o.clearRect(0,0,s.width,s.height),o.drawImage(s,0,0)}dispose(){this._shaders.forEach(e=>e.dispose()),this._shaders=[]}_blurImage(e,t,i){const r=10,s=e.getCanvas(),o=Math.min(1,r/(i*Math.min(s.width,s.height))),n=S.createCanvas();n.width=Math.round(s.width*o),n.height=Math.round(s.height*o);const a=n.getContext("2d");a.drawImage(s,0,0,s.width,s.height,0,0,n.width,n.height);const l=i*Math.min(n.width,n.height),d=a.getImageData(0,0,n.width,n.height);ol(d,0,0,n.width,n.height,l),a.putImageData(d,0,0),t.getContext().drawImage(n,0,0,n.width,n.height,0,0,s.width,s.height)}}var yt=lu;var dl=`uniform sampler2D u_image;
varying vec2 v_texCoord;
varying vec4 v_color;

void main() {
  vec4 color = texture2D(u_image, v_texCoord);
  gl_FragColor = vec4(color.a > 0. ? color.rgb / color.a : vec3(0), color.a);
}
`;class Xo extends yt{constructor(){super();this._fragmentSource=dl}}var cl=`uniform sampler2D u_image;
varying vec2 v_texCoord;
uniform vec4 u_color;

void main() {
  vec4 color = texture2D(u_image, v_texCoord);
  gl_FragColor = vec4(mix(color.rgb, u_color.rgb, u_color.a), color.a) * color.a;
}
`;const{OptionType:hu,UniformType:du}=me;class pl extends yt{constructor(...e){super(...e);this._fragmentSource=cl}_applyCanvas(e,t,i,r=!1){const s=t.getCanvas(),o=t.getContext(),n=i.getContext(),{color:a}=this._options,l=o.getImageData(0,0,s.width,s.height),d=n.getImageData(0,0,s.width,s.height),p=s.width*s.height,u=new O,c=new O;for(let m=0;m<p*4;m+=4){u.set(l.data[m]/255,l.data[m+1]/255,l.data[m+2]/255,l.data[m+3]/255),c.set(d.data[m]/255,d.data[m+1]/255,d.data[m+2]/255,d.data[m+3]/255);const x=c.r+u.a*(u.r-c.r);d.data[m]=(x+u.a*(a.r-x))*255;const _=c.g+u.a*(u.g-c.g);d.data[m+1]=(_+u.a*(a.g-_))*255;const f=c.b+u.a*(u.b-c.b);d.data[m+2]=(f+u.a*(a.b-f))*255}n.putImageData(d,0,0)}}pl.prototype.availableOptions={color:{type:hu.COLOR,default:O.WHITE,uniformType:du.FLOAT4}};var ul=pl;var ml=`uniform sampler2D u_image;
varying vec2 v_texCoord;
uniform vec4 u_color;
uniform int u_mode;

vec3 W = vec3(0.2125, 0.7154, 0.0721);

void main() {
  vec4 color = texture2D(u_image, v_texCoord);
  if (u_mode == 0) {
    gl_FragColor = color * color.a;
  } else if (u_mode == 1) {
    gl_FragColor = vec4(mix(color.rgb, u_color.rgb, u_color.a), color.a) * color.a;
  } else if (u_mode == 2) {
    float luminance = dot(color.rgb, W);
    vec3 colorized = vec3(luminance) * u_color.rgb;
    gl_FragColor = vec4(mix(color.rgb, colorized, u_color.a), color.a) * color.a;
  }
}
`;const{OptionType:fl,UniformType:gl}=me;class qi extends yt{constructor(...e){super(...e);this._fragmentSource=ml}_applyCanvas(e,t,i,r=!1){const s=t.getCanvas(),o=t.getContext(),n=i.getContext(),a=o.getImageData(0,0,s.width,s.height),{mode:l,color:d}=this._options,{r:p,g:u,b:c,a:m}=d,x=[.2125,.7154,.0721];switch(l){case qi.MODES.SOLID:for(let _=0;_<s.width*s.height;_++){const f=_*4;a.data[f]+=(p*255-a.data[f])*m,a.data[f+1]+=(u*255-a.data[f+1])*m,a.data[f+2]+=(c*255-a.data[f+2])*m}break;case qi.MODES.COLORIZED:for(let _=0;_<s.width*s.height;_++){const f=_*4,y=a.data[f]/255*x[0]+a.data[f+1]/255*x[1]+a.data[f+2]/255*x[2],b=new O(y*p,y*u,y*c);a.data[f]+=(b.r*255-a.data[f])*m,a.data[f+1]+=(b.g*255-a.data[f+1])*m,a.data[f+2]+=(b.b*255-a.data[f+2])*m}break}n.putImageData(a,0,0)}}qi.MODES={NONE:0,SOLID:1,COLORIZED:2};qi.prototype.availableOptions={color:{type:fl.COLOR,default:O.WHITE,uniformType:gl.FLOAT4},mode:{type:fl.NUMBER,default:qi.MODES.NONE,uniformType:gl.INT}};var _l=qi;var yl=`uniform sampler2D u_image;
varying vec2 v_texCoord;
uniform sampler2D u_overlayImage;
uniform int u_blendMode;
uniform float u_alpha;

const float EPSILON = 0.000001;

vec4 overlay(vec4 a, vec4 b) {
    vec3 result = mix(
          1.0 - 2.0 * (1.0 - a.rgb) * (1.0 - b.rgb),
          2.0 * a.rgb * b.rgb,
          vec3(a.r < 0.5, a.g < 0.5, a.b < 0.5)
      );
    return mix(a, vec4(result, a.a), u_alpha * b.a);
}

vec4 hardLight(vec4 b, vec4 a) {
    vec3 result = mix(
          1.0 - 2.0 * (1.0 - a.rgb) * (1.0 - b.rgb),
          2.0 * a.rgb * b.rgb,
          vec3(a.r < 0.5, a.g < 0.5, a.b < 0.5)
      );
    return mix(b, vec4(result, b.a), u_alpha * a.a);
}

vec4 softLight(vec4 a, vec4 b) {
    vec3 result = mix(
          2.0 * a.rgb * (1.0 - b.rgb) + (2.0 * b.rgb - 1.0) * sqrt(a.rgb),
          2.0 * a.rgb * b.rgb + a.rgb * a.rgb * (1.0 - 2.0 * b.rgb),
          vec3(b.r < 0.5, b.g < 0.5, b.b < 0.5)
      );
    return mix(a, vec4(result, a.a), u_alpha * b.a);
}

vec4 multiply(vec4 a, vec4 b) {
    vec3 result = a.rgb * b.rgb;
    return mix(a, vec4(result, a.a), u_alpha * b.a);
}

vec4 darken(vec4 a, vec4 b) {
    vec3 result = min(a.rgb, b.rgb);
    return mix(a, vec4(result, a.a), u_alpha * b.a);
}

vec4 lighten(vec4 a, vec4 b) {
    vec3 result = max(a.rgb, b.rgb);
    return mix(a, vec4(result, a.a), u_alpha * b.a);
}

vec4 screen(vec4 a, vec4 b) {
    vec3 result = 1.0 - (1.0 - a.rgb) * (1.0 - b.rgb);
    return mix(a, vec4(result, a.a), u_alpha * b.a);
}

vec4 colorBurn(vec4 a, vec4 b) {
    vec3 result = clamp(1.0 - (1.0 - a.rgb) / max(b.rgb, EPSILON), 0.0, 1.0);
    return mix(a, vec4(result, a.a), u_alpha * b.a);
}

vec4 normal(vec4 a, vec4 b) {
    return mix(a, vec4(b.rgb, a.a), u_alpha * b.a);
}

void main() {
  vec4 color = texture2D(u_image, v_texCoord);
  vec4 overlayColor = texture2D(u_overlayImage, v_texCoord);

  vec4 resultColor;
  if (u_blendMode == 0) {
    resultColor = normal(color, overlayColor);
  } else if (u_blendMode == 1) {
    resultColor = overlay(color, overlayColor);
  } else if (u_blendMode == 2) {
    resultColor = hardLight(color, overlayColor);
  } else if (u_blendMode == 3) {
    resultColor = softLight(color, overlayColor);
  } else if (u_blendMode == 4) {
    resultColor = multiply(color, overlayColor);
  } else if (u_blendMode == 5) {
    resultColor = darken(color, overlayColor);
  } else if (u_blendMode == 6) {
    resultColor = lighten(color, overlayColor);
  } else if (u_blendMode == 7) {
    resultColor = screen(color, overlayColor);
  } else if (u_blendMode == 8) {
    resultColor = colorBurn(color, overlayColor);
  }
  gl_FragColor = vec4(resultColor.rgb * resultColor.a, resultColor.a);
}
`;const{OptionType:hs,UniformType:Qo}=me,Zo=1e-6;class Je extends yt{constructor(...e){super(...e);this._fragmentSource=yl,this._lastImage=null}_applyCanvas(e,t,i,r=!1){const s=this._options.overlayTexture.getRenderTarget().getContext(),o=t.getCanvas(),n=t.getContext(),a=i.getContext(),l=n.getImageData(0,0,o.width,o.height),d=s.getImageData(0,0,o.width,o.height),{blendMode:p,alpha:u}=this._options,c=new O,m=new O,x=new O;for(let _=0;_<o.width*o.height*4;_+=4){c.set(l.data[_]/255,l.data[_+1]/255,l.data[_+2]/255,l.data[_+3]/255),m.set(d.data[_]/255,d.data[_+1]/255,d.data[_+2]/255,d.data[_+3]/255);let f,y,b,g,E,v,w,A,I;switch(p){case Je.BLEND_MODES.NORMAL:x.set(c.r+m.a*u*(m.r-c.r),c.g+m.a*u*(m.g-c.g),c.b+m.a*u*(m.b-c.b),c.a);break;case Je.BLEND_MODES.OVERLAY:f=1-2*(1-c.r)*(1-m.r),y=2*c.r*m.r,b=f+(c.r<.5?1:0)*(y-f),g=1-2*(1-c.g)*(1-m.g),E=2*c.g*m.g,v=g+(c.g<.5?1:0)*(E-g),w=1-2*(1-c.b)*(1-m.b),A=2*c.b*m.b,I=w+(c.b<.5?1:0)*(A-w),x.set(c.r+m.a*u*(b-c.r),c.g+m.a*u*(v-c.g),c.b+m.a*u*(I-c.b),c.a);break;case Je.BLEND_MODES.HARD_LIGHT:f=1-2*(1-m.r)*(1-c.r),y=2*m.r*c.r,b=f+(m.r<.5?1:0)*(y-f),g=1-2*(1-m.g)*(1-c.g),E=2*m.g*c.g,v=g+(m.g<.5?1:0)*(E-g),w=1-2*(1-m.b)*(1-c.b),A=2*m.b*c.b,I=w+(m.b<.5?1:0)*(A-w),x.set(c.r+m.a*u*(b-c.r),c.g+m.a*u*(v-c.g),c.b+m.a*u*(I-c.b),c.a);break;case Je.BLEND_MODES.SOFT_LIGHT:f=2*c.r*(1-m.r)+(2*m.r-1)*Math.sqrt(c.r),y=2*c.r*m.r+c.r*c.r*(1-2*m.r),b=f+(m.r<.5?1:0)*(y-f),g=2*c.g*(1-m.g)+(2*m.g-1)*Math.sqrt(c.g),E=2*c.g*m.g+c.g*c.g*(1-2*m.g),v=g+(m.g<.5?1:0)*(E-g),w=2*c.b*(1-m.b)+(2*m.b-1)*Math.sqrt(c.b),A=2*c.b*m.b+c.b*c.b*(1-2*m.b),I=w+(m.b<.5?1:0)*(A-w),x.set(c.r+m.a*u*(b-c.r),c.g+m.a*u*(v-c.g),c.b+m.a*u*(I-c.b),c.a);break;case Je.BLEND_MODES.MULTIPLY:b=c.r*m.r,v=c.g*m.g,I=c.b*m.b,x.set(c.r+m.a*u*(b-c.r),c.g+m.a*u*(v-c.g),c.b+m.a*u*(I-c.b),c.a);break;case Je.BLEND_MODES.DARKEN:b=Math.min(c.r,m.r),v=Math.min(c.g,m.g),I=Math.min(c.b,m.b),x.set(c.r+m.a*u*(b-c.r),c.g+m.a*u*(v-c.g),c.b+m.a*u*(I-c.b),c.a);break;case Je.BLEND_MODES.LIGHTEN:b=Math.max(c.r,m.r),v=Math.max(c.g,m.g),I=Math.max(c.b,m.b),x.set(c.r+m.a*u*(b-c.r),c.g+m.a*u*(v-c.g),c.b+m.a*u*(I-c.b),c.a);break;case Je.BLEND_MODES.SCREEN:b=1-(1-c.r)*(1-m.r),v=1-(1-c.g)*(1-m.g),I=1-(1-c.b)*(1-m.b),x.set(c.r+m.a*u*(b-c.r),c.g+m.a*u*(v-c.g),c.b+m.a*u*(I-c.b),c.a);break;case Je.BLEND_MODES.COLOR_BURN:b=Math.max(0,Math.min(1,1-(1-c.r)/Math.max(m.r,Zo))),v=Math.max(0,Math.min(1,1-(1-c.g)/Math.max(m.g,Zo))),I=Math.max(0,Math.min(1,1-(1-c.b)/Math.max(m.b,Zo))),x.set(c.r+m.a*u*(b-c.r),c.g+m.a*u*(v-c.g),c.b+m.a*u*(I-c.b),c.a);break}l.data[_]=x.r*255,l.data[_+1]=x.g*255,l.data[_+2]=x.b*255,l.data[_+3]=x.a*255}a.putImageData(l,0,0)}}Je.BLEND_MODES={NORMAL:0,OVERLAY:1,HARD_LIGHT:2,SOFT_LIGHT:3,MULTIPLY:4,DARKEN:5,LIGHTEN:6,SCREEN:7,COLOR_BURN:8};Je.prototype.availableOptions={blendMode:{type:hs.NUMBER,default:Je.BLEND_MODES.NORMAL,uniformType:Qo.INT},overlayImage:{type:hs.NUMBER,required:!0,uniformType:Qo.SAMPLER2D},overlayTexture:{type:hs.OBJECT,required:!0},alpha:{type:hs.NUMBER,default:1,uniformType:Qo.FLOAT}};var bl=Je;const Jo={};xe(Jo,{ColorOverlayFilter:()=>ul,OverlayFilter:()=>bl,TintFilter:()=>_l,UnpremultiplyFilter:()=>Xo});class de extends Pe{constructor(e){super();this.id=de.id++,this._onSourceLoaded=this._onSourceLoaded.bind(this),this._renderers=[],this._glTextures={},this._source=e,this._dirty=!0,this._glUnit=0,this._mipMapping=!1,this._magFilter=de.DefaultMagFilter,this._minFilter=de.DefaultMinFilter,this._repeatX=de.ClampToEdge,this._repeatY=de.ClampToEdge,this._pixelRatio=1,this._loaded=!1,this._frame=new fe(0,0,100,100),e&&this._loadSource()}resizeTo(e){if(this._frame.width===e.x&&this._frame.height===e.y)return;this._frame.width=e.x,this._frame.height=e.y,this._dirty=!0}_loadSource(){const e=this._source,t=e.complete,i=e.constructor.name==="Canvas"||e.tagName&&e.tagName.toUpperCase()==="CANVAS";if(t||i)return this._onSourceLoaded();e.addEventListener&&e.addEventListener("load",this._onSourceLoaded)}_onSourceLoaded(){this._loaded=!0,this.emit("loaded"),this.update()}_updateGLFilters(){const e=new B(this._source.width,this._source.height);S.isPowerOfTwo(e)?(k.info(this.constructor.name,"Mip-mapping enabled"),this._minFilter=de.TrilinearFilter,this._mipMapping=!0):(this._minFilter=de.LinearFilter,this._mipMapping=!1)}update(){(this._frame.width!==this._source.width||this._frame.height!==this._source.height)&&(this._frame=new fe(0,0,this._source.width,this._source.height),this._dirty=!0),this._updateGLFilters(),this.emit("update")}getRenderers(){return[...this._renderers]}getGLFilter(e,t){switch(t){case"min":return this.constructor.getGLFilter(e,this._minFilter);case"mag":return this.constructor.getGLFilter(e,this._magFilter)}}static getGLFilter(e,t){switch(t){case de.LinearFilter:return e.LINEAR;case de.NearestFilter:return e.NEAREST;case de.BilinearFilter:return e.LINEAR_MIPMAP_NEAREST;case de.TrilinearFilter:return e.LINEAR_MIPMAP_LINEAR}}isLoaded(){return this._loaded}setLoaded(e){this._loaded=e}getSource(){return this._source}setSource(e){this._source=e}getGLTextureForRenderer(e){return this._glTextures[e.id]}setGLTextureForRenderer(e,t){this._renderers[t.id]=t,this._glTextures[t.id]=e}getFrame(){return this._frame}setFrame(e){this._frame=e}getDimensions(){return new B(this._frame.width,this._frame.height)}getPixelRatio(){return this._pixelRatio}setPixelRatio(e){this._pixelRatio=e}getGLUnit(){return this._glUnit}setGLUnit(e){this._glUnit=e}setMinFilter(e){this._minFilter=e}getMinFilter(){return this._minFilter}setMagFilter(e){this._magFilter=e}getMagFilter(){return this._magFilter}setRepeatX(e){this._repeatX=e}getRepeatX(){return this._repeatX}setRepeatY(e){this._repeatY=e}getRepeatY(){return this._repeatY}getGLRepeat(e,t){const i=t==="x"?this.getRepeatX():this.getRepeatY();switch(i){case de.ClampToEdge:return e.CLAMP_TO_EDGE;case de.Repeat:return e.REPEAT;case de.MirroredRepeat:return e.MIRRORED_REPEAT}}isDirty(){return this._dirty}setDirty(e){this._dirty=e}disposeGLTextures(){this._renderers.forEach(e=>{this.disposeGLTexturesForRenderer(e)})}disposeGLTexturesForRenderer(e){if(!this._glTextures[e.id])return;const t=e.getContext();t.deleteTexture(this._glTextures[e.id]),delete this._glTextures[e.id],this._renderers[e.id]||delete this._renderers[e.id]}isMipMappingEnabled(){return this._mipMapping}setMipMappingEnabled(e){this._mipMapping=e}dispose(e=null){this.disposeGLTextures(),this._source=void 0}}de.NearestFilter=0;de.LinearFilter=1;de.BilinearFilter=2;de.TrilinearFilter=3;de.DefaultMagFilter=de.NearestFilter;de.DefaultMinFilter=de.LinearFilter;de.ClampToEdge=0;de.Repeat=1;de.MirroredRepeat=2;de.id=0;var Be=de;class cu{constructor(e,t,i,r,s){this._width=e,this._height=t,this._pixelRatio=i,this._baseTexture=new Be,this._canvas=r||this._createCanvas(),this._context=s||this._canvas.getContext("2d"),this._baseTexture.setSource(this._canvas),this._canvas.width=this._width*this._pixelRatio,this._canvas.height=this._height*this._pixelRatio,this._filterStack=[{renderTarget:this,filter:[]}]}_createCanvas(){return S.createCanvas()}clear(){const e=this._context;e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,this._width*this._pixelRatio,this._height*this._pixelRatio)}resizeTo(e){this._baseTexture.resizeTo(e),this._width!==e.x&&(this._width=e.x,this._canvas.width=this._width*this._pixelRatio),this._height!==e.y&&(this._height=e.y,this._canvas.height=this._height*this._pixelRatio)}getCanvas(){return this._canvas}getContext(){return this._context}getFilterStack(){return this._filterStack}getWidth(){return this._width}getHeight(){return this._height}getPixelRatio(){return this._pixelRatio}setPixelRatio(e){this._pixelRatio=e}getDimensions(){return new B(this._width,this._height)}getBaseTexture(){return this._baseTexture}dispose(){this._canvas=null,this._context=null,this._baseTexture.dispose()}}var Ut=cu;class pu{constructor(e){this._renderer=e,this._filterStack=[{renderTarget:e.getCurrentRenderTarget(),filters:[]}],this._currentFrame=null,this._textures=[],this._textureFrame=new fe(0,0,e.getWidth(),e.getHeight())}resizeTo(e){this._textureFrame.width=e.x,this._textureFrame.height=e.y,this._textures.forEach(t=>t.resizeTo(e))}pushFilters(e,t){const i=e.getBounds();this._currentFrame=i;const r=this._getOrCreateRenderTarget();this._renderer.setRenderTarget(r),this._filterStack.push({renderTarget:r,filters:t}),r.clear()}popFilters(){const{filters:e,renderTarget:t}=this._filterStack.pop(),i=this._filterStack[this._filterStack.length-1],r=t,s=i.renderTarget;return e.length===1?(e[0].apply(this._renderer,r,s),this._textures.push(r)):this._applyFilters(e,r,s),e}_applyFilters(e,t,i){let r=t,s=this._getOrCreateRenderTarget(!0);const o=e[e.length-1];e.forEach((n,a)=>{const l=n===o;if(l)n.apply(this._renderer,r,i);else{n.apply(this._renderer,r,s);const d=r;r=s,s=d}}),this._textures.push(r),this._textures.push(s)}_getOrCreateRenderTarget(e){let t=this._textures.pop();return t||(t=new Ut(this._textureFrame.width,this._textureFrame.height,1)),e&&t.clear(),t}setFilterStack(e){this._filterStack=e}dispose(){}}var Yi=pu;class uu{constructor(e){this._renderer=e,this._context=this._renderer.getContext(),this._vertices=new Float32Array([0,0,100,0,100,100,0,100]),this._uvs=new Float32Array([0,0,1,0,1,1,0,1]),this._indices=new Uint16Array([0,1,2,0,3,2]),this._colors=new Float32Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]),this._initBuffers(),this._uploadBuffers()}map(e,t){const{x:i,y:r}=t;this._uvs[2]=t.width/e.width,this._uvs[4]=this._uvs[2],this._uvs[5]=t.height/e.height,this._uvs[7]=this._uvs[5],this._vertices[0]=i,this._vertices[1]=r,this._vertices[2]=i+t.width,this._vertices[3]=r,this._vertices[4]=this._vertices[2],this._vertices[5]=r+t.height,this._vertices[6]=i,this._vertices[7]=this._vertices[5],this._uploadBuffers()}_initBuffers(){const e=this._context;this._vertexBuffer&&(e.deleteBuffer(this._vertexBuffer),this._vertexBuffer=null),this._indexBuffer&&(e.deleteBuffer(this._indexBuffer),this._indexBuffer=null),this._vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,(8+8+16)*4,e.DYNAMIC_DRAW),this._indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this._indices,e.STATIC_DRAW)}_uploadBuffers(){const e=this._context;e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,this._vertices),e.bufferSubData(e.ARRAY_BUFFER,8*4,this._uvs),e.bufferSubData(e.ARRAY_BUFFER,(8+8)*4,this._colors)}getVertexBuffer(){return this._vertexBuffer}getIndexBuffer(){return this._indexBuffer}dispose(){const e=this._context;this._vertexBuffer&&(e.deleteBuffer(this._vertexBuffer),this._vertexBuffer=null),this._indexBuffer&&(e.deleteBuffer(this._indexBuffer),this._indexBuffer=null)}}var xl=uu;class mu{constructor(e,t,i,r,s=!1){this._renderer=e,this._gl=e.getContext(),this._width=t,this._height=i,this._frame=null,this._pixelRatio=r,this._projectionMatrix=new ot,this._mipMapping=!1,this._baseTexture=new Be;const o=this._baseTexture.getFrame();o.width=t,o.height=i,this._baseTexture.setPixelRatio(r),this._baseTexture.setLoaded(!0),this._framebuffer=null,this._isRoot=s,this._filterStack=[{renderTarget:this,filter:[]}],s||this._initFrameBuffer()}resizeTo(e){this._width=e.x|0,this._height=e.y|0,this._baseTexture.resizeTo(e),this._isRoot||this._resizeTexture(),this._baseTexture.setMinFilter(this._getMinFilter()),this._baseTexture.setMagFilter(this._getMagFilter()),this._calculateProjectionMatrix()}_getMinFilter(){let e=Be.DefaultMinFilter;return this._mipMapping&&(e=Be.TrilinearFilter),e}_getMagFilter(){return Be.DefaultMagFilter}_resizeTexture(){const e=this._gl,t=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this._texture&&(e.deleteTexture(this._texture),this._texture=null),this._texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this._texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,i,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindFramebuffer(e.FRAMEBUFFER,this._framebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this._texture,0),this._baseTexture.setGLTextureForRenderer(this._texture,this._renderer),this._renderer._options.debug&&ut.checkFramebufferStatus("WebGLRenderTarget#_initFramebuffer",e);const r=new B(this._width,this._height);S.isPowerOfTwo(r)?(k.info("WebGLRenderTarget","Mip-mapping enabled"),this._mipMapping=!0):this._mipMapping=!1,this._baseTexture.setMipMappingEnabled(this._mipMapping)}activate(){const e=this._gl;e.bindFramebuffer(e.FRAMEBUFFER,this._framebuffer),this._calculateProjectionMatrix(),e.viewport(0,0,this._width*this._pixelRatio,this._height*this._pixelRatio),e.disable(e.STENCIL_TEST)}clear(e=O.TRANSPARENT){const t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,this._framebuffer),this._renderer._options.debug&&ut.checkFramebufferStatus("WebGLRenderTarget#clear",t),t.clearColor.apply(t,e.toGLColor()),t.clear(t.COLOR_BUFFER_BIT)}_calculateProjectionMatrix(){const e=this._projectionMatrix;e.reset();const t=this._frame||new fe(0,0,this._width,this._height),{x:i,y:r}=t;this._isRoot?(e.a=1/this._width*2,e.d=-1/this._height*2,e.tx=-1-i*e.a,e.ty=1-r*e.d):(e.a=1/this._width*2,e.d=1/this._height*2,e.tx=-1-i*e.a,e.ty=-1-r*e.d)}_initFrameBuffer(){const e=this._gl;this._framebuffer&&(e.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._texture&&(e.deleteTexture(this._texture),this._texture=null),this._framebuffer=e.createFramebuffer(),this._texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this._texture),e.bindFramebuffer(e.FRAMEBUFFER,this._framebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this._texture,0),this._baseTexture.setGLTextureForRenderer(this._texture,this._renderer),this.resizeTo(new B(this._width,this._height)),this._renderer._options.debug&&ut.checkFramebufferStatus("WebGLRenderTarget#_initFramebuffer",e)}getProjectionMatrix(){return this._projectionMatrix}getTexture(){return this._texture}getFrame(){return this._frame}setFrame(e){this._frame=e}getFilterStack(){return this._filterStack}getPixelRatio(){return this._pixelRatio}setPixelRatio(e){this._pixelRatio=e,this._isRoot||this._resizeTexture()}getBaseTexture(){return this._baseTexture}dispose(){const e=this._gl;this._baseTexture.dispose(),this._framebuffer&&(e.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._texture&&(e.deleteTexture(this._texture),this._texture=null)}}var Kt=mu;const{RendererType:fu}=me;class gu{constructor(e){this._renderer=e,this._filterStack=[{filters:[]}],this._currentFrame=null,this._renderTargets=[],this._textureFrame=new fe(0,0,e.getWidth(),e.getHeight()),this._onContextChange=this._onContextChange.bind(this),this._renderer.on("context",this._onContextChange),this._onContextChange()}resizeTo(e){this._textureFrame.width=e.x,this._textureFrame.height=e.y,this._renderTargets.forEach(t=>t.resizeTo(e))}getFilterStack(){return this._filterStack}setFilterStack(e){this._filterStack=e}_getOrCreateRenderTarget(e){let t=this._renderTargets.pop();return t||(t=new Kt(this._renderer,this._textureFrame.width,this._textureFrame.height,1)),t.setFrame(this._currentFrame),e&&t.clear(),t}pushFilters(e,t){const i=e.getBounds();this._currentFrame=i;const r=e.getFilterRectangle();r.width>0&&r.height>0&&(this._currentFrame=r);const s=this._getOrCreateRenderTarget();this._renderer.setRenderTarget(s),s.clear(),this._filterStack.push({renderTarget:s,filters:t})}popFilters(){const{filters:e,renderTarget:t}=this._filterStack.pop(),i=this._filterStack[this._filterStack.length-1],r=t,s=i.renderTarget;this._quad.map(this._textureFrame,r.getFrame());const o=e[0].getShaderForRenderer(this._renderer),n=this._quad.getVertexBuffer(),a=this._quad.getIndexBuffer(),l=this._renderer.getContext();l.bindBuffer(l.ARRAY_BUFFER,n),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,a);const d=o.getAttributeLocations();return l.vertexAttribPointer(d.a_position,2,l.FLOAT,!1,0,0),l.vertexAttribPointer(d.a_texCoord,2,l.FLOAT,!1,0,2*4*4),l.vertexAttribPointer(d.a_color,4,l.FLOAT,!1,0,4*4*4),this._renderer.updateTexture(r.getBaseTexture(),!1),e.length===1?(e[0].apply(this._renderer,r,s),this._renderTargets.push(r)):this._applyFilters(e,r,s),e}_applyFilters(e,t,i){let r=t,s=this._getOrCreateRenderTarget(!0);this._renderer.updateTexture(s.getBaseTexture(),!1);const o=e[e.length-1];e.forEach((n,a)=>{const l=n===o;if(l)n.apply(this._renderer,r,i,!0);else{n.apply(this._renderer,r,s,!0);const d=r;r=s,s=d}}),this._renderTargets.push(r),this._renderTargets.push(s)}_onContextChange(){this._renderTargets.length=0,this._renderer.isOfType(fu.WEBGL)&&(this._quad&&this._quad.dispose(),this._quad=new xl(this._renderer))}dispose(){this._renderer.off("context",this._onContextChange),this._quad&&this._quad.dispose(),this._renderTargets.forEach(e=>{e.dispose()})}}var Xi=gu;const vl=typeof window!="undefined"&&window.performance&&window.performance.now?window.performance.now.bind(window.performance):wi();class _u{constructor(e){this._context=e,this._tracking=!1;const t=this;for(const i in e){const r=e[i];typeof r=="function"?this[i]=function(...s){const o=e[i];if(!t._tracking)return o.apply(e,s);const n=vl(),a=o.apply(e,s),l=vl()-n,d={functionName:i,arguments:s,duration:l};return t._trackedCalls.push(d),a}:this._makePropertyWrapper(i)}}_makePropertyWrapper(e){const t=["_context","_trackedCalls","_tracking"];if(t.indexOf(e)!==-1)return;const i=this._context;this.__defineGetter__(e,()=>i[e]),this.__defineSetter__(e,r=>{i[e]=r})}startFrame(){this._tracking=!0,this._trackedCalls=[]}endFrame(){const e="Rendering";k.log(e,"Frame rendering results:"),k.log(e,`Context calls: ${this._trackedCalls.length}`);const t={};this._trackedCalls.forEach(({functionName:r,duration:s})=>{t[r]=t[r]||{totalDuration:0,calls:0},t[r].totalDuration+=s,t[r].calls++});let i=[];for(const r in t){const s=t[r];s.averageDuration=s.totalDuration/s.calls,i.push({functionName:r,data:s})}i.sort((r,s)=>s.data.totalDuration-r.data.totalDuration),i=i.slice(0,3),i.forEach(r=>{k.log(e,`${r.functionName}: ${r.data.calls} calls, ${r.data.totalDuration.toFixed(2)}ms`)})}}var ds=_u;const yu={defaults:(e,...t)=>{const i={};for(const r in e)i[r]=e[r];for(let r=0;r<t.length;r++){const s=t[r];for(const o in s)typeof i[o]=="undefined"&&(i[o]=s[o])}return i},extend:(e,...t)=>{const i={};for(const r in e)i[r]=e[r];for(let r=0;r<t.length;r++){const s=t[r];for(const o in s)i[o]=s[o]}return i}};var wl=yu;class bu extends Pe{constructor(e,t,i={}){super();this._options=wl.defaults(i,{pixelRatio:1,transparent:!1,clearColor:O.BLACK}),this.setMaxListeners(0),this._width=e||800,this._height=t||600,this._dimensions=new B(this._width,this._height),this._maxTextureSize=null,this._pixelRatio=this._options.pixelRatio,this._clearColor=this._options.transparent?O.TRANSPARENT:this._options.clearColor||O.BLACK}setCanvas(e){const t=this._canvas;this._canvas=e,t!==e&&(this._createContext(),this._onBeforeContext(),this._setupContext()),this.resizeTo(new B(this._width,this._height))}getCanvas(){return this._canvas}_onBeforeContext(){}resizeTo(e,t=!0){this._width=e.x*this._pixelRatio,this._height=e.y*this._pixelRatio,t&&(this._canvas.width=this._width,this._canvas.height=this._height,this._canvas.style&&(this._canvas.style.width=`${this._width/this._pixelRatio}px`,this._canvas.style.height=`${this._height/this._pixelRatio}px`)),this._dimensions=e.clone()}_createContext(){k.warn(this.constructor.name,"`_createContext` is abstract and not implemented in inherited class")}_setupContext(){k.warn(this.constructor.name,"`_setupContext` is abstract and not implemented in inherited class")}render(e){k.warn(this.constructor.name,"`render` is abstract and not implemented in inherited class")}getMaxDimensions(){return null}getContext(){return this._context}getWidth(){return this._dimensions.x}getHeight(){return this._dimensions.y}getDimensions(){return this._dimensions}getPixelRatio(){return this._pixelRatio}setPixelRatio(e){this._pixelRatio=e,this._defaultRenderTarget&&this._defaultRenderTarget.setPixelRatio(e)}getMaxTextureSize(){return this._maxTextureSize}getFilterManager(){return this._filterManager}setFilterManager(e){this._filterManager=e}static isSupported(){return!0}isOfType(e){return this._type===e}dispose(){k.warn(this.constructor.name,"`dispose` is abstract and not implemented in inherited class")}}var cs=bu;const{RendererType:xu}=me;class ps extends cs{constructor(...e){super(...e);this._type=xu.CANVAS,this.setCanvas(this._options.canvas||this._createCanvas())}_createCanvas(){return S.createCanvas()}_createContext(){const e=this._canvas;let t=e.getContext("2d");return this._options.debug&&(t=new ds(t)),this.id=t.id=ps.contextId++,this._context=t,t.renderer=this,this.emit("context",t),t}_setupContext(){const e=this._context;"imageSmoothingEnabled"in e?e.imageSmoothingEnabled=!0:["moz","webkit","ms"].forEach(t=>{e[t]&&(e[t]=!0)}),this._defaultRenderTarget=new Ut(this._width,this._height,this._pixelRatio,this._canvas,this._context),this.setRenderTarget(this._defaultRenderTarget),this._filterManager=new Yi(this)}render(e){const t=this._renderTarget.getContext(),i=e.getParent();e.setParent(this._fakeObject),e.updateTransform(),e.setParent(i),t.setTransform(1,0,0,1,0,0),t.globalAlpha=1;const{width:r,height:s}=this._canvas;t.clearRect(0,0,r,s),this._clearColor.a!==0&&(t.save(),t.fillStyle=this._clearColor.toRGBA(),t.fillRect(0,0,r,s),t.restore()),this.renderDisplayObject(e,this._renderTarget)}renderDisplayObject(e,t){const i=this._renderTarget;this._filterManager.setFilterStack(t.getFilterStack()),this.setRenderTarget(t),e.renderCanvas(this),this.setRenderTarget(i)}getCurrentRenderTarget(){return this._renderTarget}setRenderTarget(e){this._renderTarget=e}getContext(){return this._renderTarget.getContext()}dispose(){this._filterManager.dispose()}}ps.contextId=0;ps.type="Canvas2D";var $o=ps;class ii{constructor(e,t,i){this.width=e,this.height=t,this.data=i}static fromNodeCanvasImage(e){if(!process.env.REACT_APP_BROWSER){const{Canvas:t}=require("canvas"),i=new t(e.width,e.height),r=i.getContext("2d");r.drawImage(e,0,0);const s=r.getImageData(0,0,e.width,e.height);return new ii(e.width,e.height,s.data)}}}const jt=Cr(require("stats.js"));class en{constructor(e){this._context=e,this._domAvailable=typeof document!="undefined",this._hookIntoContext(),this._textures={},this._framebuffers={},this._programs={},this._shaders={},this._buffers={},this._boundTexture=null,this._id=0,this._enums={},this._setupStats(),this._createEnumMap(),this._updateMemoryStats=this._updateMemoryStats.bind(this),this._updateMemoryStats()}_createEnumMap(){for(const e in this._context){const t=this._context[e];typeof t=="number"&&(this._enums[t]=e)}}_enumValueToString(e){const t=this._enums[e];return typeof t=="undefined"?e:t}_setupStats(){if(!this._domAvailable)return;this._stats=new jt.default,this._stats.showPanel(3),this._memPanel=this._stats.addPanel(new jt.default.Panel("MB [WebGL]","#43ADEB","#282828")),this._texPanel=this._stats.addPanel(new jt.default.Panel("Textures","#43ADEB","#282828")),this._bufPanel=this._stats.addPanel(new jt.default.Panel("Buffers","#43ADEB","#282828")),this._fboPanel=this._stats.addPanel(new jt.default.Panel("FBOs","#43ADEB","#282828")),this._prgPanel=this._stats.addPanel(new jt.default.Panel("Programs","#43ADEB","#282828")),this._shdPanel=this._stats.addPanel(new jt.default.Panel("Shaders","#43ADEB","#282828"))}_updatePanel(e){if(!this._domAvailable)return;this._stats.begin();switch(e){case"tex":this._texPanel.update(this.getTexturesCount(),50);break;case"buf":this._bufPanel.update(this.getBuffersCount(),50);break;case"fbo":this._fboPanel.update(this.getFBOCount(),50);break;case"prg":this._prgPanel.update(this.getProgramCount(),50);break;case"shd":this._shdPanel.update(this.getShaderCount(),50);break}this._stats.end()}getTexturesCount(){return Object.keys(this._textures).length}getBuffersCount(){return Object.keys(this._buffers).length}getFBOCount(){return Object.keys(this._framebuffers).length}getProgramCount(){return Object.keys(this._programs).length}getShaderCount(){return Object.keys(this._shaders).length}_updateMemoryStats(){if(!this._domAvailable)return;const e=this._getMemoryUsage()/1e3/1e3;this._memPanel.update(e,400),setTimeout(this._updateMemoryStats,1e3)}_getMemoryUsage(){let e=0;for(const t in this._textures)e+=this._textures[t].memory;for(const t in this._buffers)e+=this._buffers[t].memory;return e}_hookIntoContext(){for(const e in this._context){const t=this._context[e];typeof t=="function"?this[e]=function(...i){const r=this._context[e];return this._trackGLCall(r,e,i)}:this._makePropertyWrapper(e)}}_makePropertyWrapper(e){const t=["_context"];if(t.indexOf(e)!==-1)return;const i=this._context;this.__defineGetter__(e,()=>i[e]),this.__defineSetter__(e,r=>{i[e]=r})}_trackGLCall(e,t,i){const r=["texImage2D","bindTexture","createTexture","deleteTexture","createBuffer","bindBuffer","bufferData","deleteBuffer","createFramebuffer","deleteFramebuffer","createProgram","deleteProgram","createShader","deleteShader"];let s;r.indexOf(t)!==-1?s=this[`_${t}`](i):s=e.apply(this._context,i);const o=this._context.getError();if(o!==0){let n=i.join(", ");n.length>100&&(n=`${n.substr(0,100)}...`),console.error(new Error(`WebGL Error ${this._enumValueToString(o)} in ${t}(${n})`))}return s}_createProgram(){const e=this._context.createProgram();return e._wmmId=this._id++,this._programs[e._wmmId]=e,this._updatePanel("prg"),e}_deleteProgram([e]){if(!e||!this._programs[e._wmmId])return;delete this._programs[e._wmmId],this._context.deleteProgram(e),this._updatePanel("prg")}_createShader([e]){const t=this._context.createShader(e);return t._wmmId=this._id++,this._shaders[t._wmmId]=t,this._updatePanel("shd"),t}_deleteShader([e]){if(!e||!this._shaders[e._wmmId])return;delete this._shaders[e._wmmId],this._context.deleteShader(e),this._updatePanel("shd")}_createFramebuffer(){const e=this._context.createFramebuffer();return e._wmmId=this._id++,this._framebuffers[e._wmmId]=e,this._updatePanel("fbo"),e}_deleteFramebuffer([e]){if(!e||!this._framebuffers[e._wmmId])return;delete this._framebuffers[e._wmmId],this._context.deleteFramebuffer(e),this._updatePanel("fbo")}_createBuffer(){const e=this._context.createBuffer();return e._wmmId=this._id++,this._buffers[e._wmmId]={buffer:e,memory:0},this._updatePanel("buf"),e}_bindBuffer([e,t]){this._context.bindBuffer(e,t),this._boundBuffer=t._wmmId}_bufferData([e,t,i]){this._context.bufferData(e,t,i);let r;typeof t=="number"?r=t:"byteLength"in t?r=t.byteLength:"length"in t&&(r=t.length),this._buffers[this._boundBuffer].memory=r}_deleteBuffer([e]){if(!e||!this._buffers[e._wmmId])return;delete this._buffers[e._wmmId],this._context.deleteBuffer(e),this._updatePanel("buf")}_createTexture(){const e=this._context.createTexture();return e._wmmId=this._id++,this._textures[e._wmmId]={texture:e,memory:0},this._updatePanel("tex"),e}_deleteTexture([e]){if(!e||!this._textures[e._wmmId])return;delete this._textures[e._wmmId],this._context.deleteTexture(e),this._updatePanel("tex")}_bindTexture([e,t]){this._context.bindTexture(e,t),this._boundTexture=t._wmmId}_texImage2D(e){let[,,t,i,r,s,,,o]=e;typeof o=="undefined"&&(o=s),this._context.texImage2D.apply(this._context,e);const n=this._calculateByteCountForTexture(t,i,r,o);this._textures[this._boundTexture].memory=n}_calculateByteCountForTexture(e,t,i,r){if(r!==null)if("width"in r)t=r.width,i=r.height;else return r.length;let s=1;switch(e){case this._context.ALPHA:s=1;break;case this._context.RGB:s=3;break;case this._context.RGBA:s=4;break}return t*i*s}}class vu{constructor(e){this._renderer=e,this._onContextChange=this._onContextChange.bind(this),this._renderer.on("context",this._onContextChange)}_onContextChange(){}start(){}stop(){this.flush()}flush(){}dispose(){this._renderer.off("context",this._onContextChange),this._renderer=null}}var us=vu;class wu extends us{constructor(...e){super(...e);this._maxBatchSize=ti,this._vertices=new ArrayBuffer(ti*4*St),this._positions=new Float32Array(this._vertices),this._colors=new Uint32Array(this._vertices),this._indices=new Uint16Array(ti*6);for(let t=0,i=0;t<ti*6;t+=6,i+=4)this._indices[t+0]=i+0,this._indices[t+1]=i+1,this._indices[t+2]=i+2,this._indices[t+3]=i+0,this._indices[t+4]=i+2,this._indices[t+5]=i+3;this._shaders=[],this._sprites=[],this._currentBatchSize=0,this._onContextChange()}render(e){const t=e.getTexture(),i=t.getFrame(),r=t.getBaseTexture();this._currentBatchSize>=this._maxBatchSize&&this.flush();const s=t.getUVs();if(!s)return;const o=this._currentBatchSize*St;this._addVertexCoordinates(e,o,i),this._addTextureUVs(e,o,s),this._addColors(e,o),this._sprites[this._currentBatchSize]=e,this._currentBatchSize++}_addColors(e,t){const i=this._colors,r=e.getTint(),s=(r>>16)+(r&65280)+((r&255)<<16)+(e.getWorldAlpha()*255<<24);i[t+4]=i[t+9]=i[t+14]=i[t+19]=s}_addTextureUVs(e,t,i){const r=this._positions;let s=i.getUVsAt(0);r[t+2]=s.x,r[t+3]=s.y,s=i.getUVsAt(1),r[t+7]=s.x,r[t+8]=s.y,s=i.getUVsAt(2),r[t+12]=s.x,r[t+13]=s.y,s=i.getUVsAt(3),r[t+17]=s.x,r[t+18]=s.y}_addVertexCoordinates(e,t,i){const r=this._positions,s=e.getWorldTransform(),o=e.getAnchor(),n=s.rectangleToCoordinates(i,o),a=5;for(let l=0;l<4;l++)r[t+l*a]=n[l].x,r[t+l*a+1]=n[l].y}_onContextChange(){const e=this._renderer.getContext();this._shader=this._renderer.shaders.default,this._vertexBuffer&&(this._vertexBuffer=null),this._indexBuffer&&(this._indexBuffer=null),this._vertexBuffer=e.createBuffer(),this._indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this._indices,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this._vertices,e.DYNAMIC_DRAW)}start(){this._shader.setupBuffers(this._vertexBuffer,this._indexBuffer)}flush(){const e=this._renderer,t=e.getContext();if(this._currentBatchSize===0)return;if(this._currentBatchSize>ti*.5)t.bufferSubData(t.ARRAY_BUFFER,0,this._vertices);else{const u=this._positions.subarray(0,this._currentBatchSize*St);t.bufferSubData(t.ARRAY_BUFFER,0,u)}let i=0,r=null,s=null,o=null,n=null,a=!1,l=!1,d=null,p=0;for(let u=0,c=this._currentBatchSize;u<c;u++){if(d=this._sprites[u],s=d.getTexture().getBaseTexture(),n=d.getShader()||this._shader,a=o!==n,l=r!==s,(l||a)&&(this._renderBatch(r,i,p),p=u,i=0,r=s,a)){o=n,e.setShader(o);const m=e.getCurrentRenderTarget(),x=m.getProjectionMatrix().toArray();o.setUniform("u_projMatrix",x),o.syncUniforms(),t.activeTexture(t.TEXTURE0)}i++}this._renderBatch(r,i,p),this._currentBatchSize=0,this._sprites=[]}_renderBatch(e,t,i){if(t===0)return;const r=this._renderer,s=r.getContext();let o=e.getGLTextureForRenderer(r);o||(o=r.getOrCreateGLTexture(e)),e.isDirty()&&(r.updateTexture(e),e.setDirty(!1)),s.activeTexture(s.TEXTURE0+e.getGLUnit()),s.bindTexture(s.TEXTURE_2D,o);const n=t*6,a=i*6*2;s.drawElements(s.TRIANGLES,n,s.UNSIGNED_SHORT,a)}dispose(){const e=this._renderer,t=e.getContext();for(const i in this._sprites)i.dispose();this._vertexBuffer&&(t.deleteBuffer(this._vertexBuffer),this._vertexBuffer=null),this._indexBuffer&&(t.deleteBuffer(this._indexBuffer),this._indexBuffer=null),this._vertices=null,this._positions=null,this._colors=null,this._indices=null,super.dispose()}}var Sl=wu;const{RendererType:Su}=me;class ms extends cs{constructor(...e){super(...e);this._type=Su.WEBGL,this._fakeObject=new Vi,this._onContextLost=this._onContextLost.bind(this),this._onContextRestored=this._onContextRestored.bind(this),this.setCanvas(this._options.canvas||S.createCanvas()),this._cachedBlitCanvas=S.createCanvas(),this.shaders=this._initShaders(),this.renderers=this._initRenderers()}_onContextLost(e){e.preventDefault(),k.warn(this.constructor.name,"WebGL context has been lost - trying to restore.")}_onContextCreationError(e){e.preventDefault(),k.warn(this.constructor.name,`Failed to create WebGL context: ${e.statusMessage||"Unknown error"}`)}_onContextRestored(){k.warn(this.constructor.name,"WebGL context has been restored. Clearing all textures."),this._createContext(),this._setupContext(),this.emit("context-restored")}_onBeforeContext(){this._filterManager&&this._filterManager.dispose(),this._filterManager=new Xi(this),this._currentObjectRenderer=new us(this)}setShader(e){this._currentShader=e,this._context.useProgram(e.getProgram()),this._setAttributesForShader(e)}setCanvas(e){this._canvas&&this._removeContextEventListeners(),super.setCanvas(e),this._canvas.addEventListener&&this._addContextEventListeners()}_addContextEventListeners(){this._canvas.addEventListener("webglcontextlost",this._onContextLost),this._canvas.addEventListener("webglcontextrestored",this._onContextRestored),this._canvas.addEventListener("webglcontextcreationerror",this._onContextCreationError)}_removeContextEventListeners(){this._canvas.removeEventListener("webglcontextlost",this._onContextLost),this._canvas.removeEventListener("webglcontextrestored",this._onContextRestored),this._canvas.removeEventListener("webglcontextcreationerror",this._onContextCreationError)}_setAttributesForShader(e){const t=this._context,i=e.getAttributes(),r=e.getAttributeLocations();i.forEach(s=>{const o=r[s];t.enableVertexAttribArray(o)})}_initShaders(){return{default:new Rt(this)}}_initRenderers(){return{sprite:new Sl(this)}}_createContext(){const e=this._canvas;let t=null;const i={preserveDrawingBuffer:!0};if(process.env.REACT_APP_BROWSER&&(t=e.getContext("webgl",i)||e.getContext("experimental-webgl",i)),!process.env.REACT_APP_BROWSER){const r=require("gl");t=r(e.width,e.height,i)}if(typeof window!="undefined"&&window.WebGLDebugUtils&&this._options.debug){const r=(s,o)=>{console.error(`gl.${s}(${window.WebGLDebugUtils.glFunctionArgsToString(s,o)})`)};t=window.WebGLDebugUtils.makeDebugContext(t,null,r)}return this._options.debug&&(t=new ds(t),t=new en(t)),this.id=t.id=ms.contextId++,this._context=t,t.renderer=this,this._maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.emit("context",t),t}_setupContext(){const e=this._context;e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),this._defaultRenderTarget=new Kt(this,this._width,this._height,this._pixelRatio,!0),this.setRenderTarget(this._defaultRenderTarget),this._getMaxPrecision()}_getMaxPrecision(){const e=this._context,t=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT);this._maxFloatPrecision=t.precision!==0?"highp":"mediump";const i=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_INT);this._maxIntPrecision=i.rangeMax!==0?"highp":"lowp"}resizeTo(e,t=!0){super.resizeTo(e,t),this._currentRenderTarget&&this._currentRenderTarget.resizeTo(e),process.env.REACT_APP_BROWSER||this._context.resize(e.x,e.y)}setRenderTarget(e=this._defaultRenderTarget){this._currentRenderTarget=e,this._currentRenderTarget.activate()}setObjectRenderer(e){this._currentObjectRenderer.stop(),this._currentObjectRenderer=e,this._currentObjectRenderer.start()}render(e){this.setRenderTarget(this._defaultRenderTarget),this._defaultRenderTarget.clear(this._clearColor);const t=e.getParent();e.setParent(this._fakeObject),e.updateTransform(),e.setParent(t),this.renderDisplayObject(e,this._defaultRenderTarget)}renderDisplayObject(e,t){this.setRenderTarget(t),this._filterManager.setFilterStack(t.getFilterStack()),e.renderWebGL(this),this._currentObjectRenderer.flush()}clear(){const e=this._context;e.clearColor.apply(e,this._clearColor.toGLColor()),e.clear(e.COLOR_BUFFER_BIT)}save(){return{renderTarget:this._currentRenderTarget,objectRenderer:this._currentObjectRenderer,filterStack:this._filterManager.getFilterStack()}}restore(e){this.setRenderTarget(e.renderTarget),this._filterManager.setFilterStack(e.filterStack),this._currentObjectRenderer=e.objectRenderer}getOrCreateGLTexture(e){const t=this._context;let i=e.getGLTextureForRenderer(this);return i||(i=t.createTexture(),e.setGLTextureForRenderer(i,this)),i}updateTexture(e,t=!0){let i=e.getSource();const r=!!i,s=this._context,o=e.getGLUnit(),n=this.getOrCreateGLTexture(e);if(s.activeTexture(s.TEXTURE0+o),s.bindTexture(s.TEXTURE_2D,n),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),t&&r){if(!process.env.REACT_APP_BROWSER){const a=require("canvas"),l=typeof a!="undefined"?a.Image:void 0;(i instanceof l||i instanceof a.Canvas)&&(i=ii.fromNodeCanvasImage(i)),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,i.width,i.height,0,s.RGBA,s.UNSIGNED_BYTE,i.data)}if(process.env.REACT_APP_BROWSER)if(i instanceof ii)s.texImage2D(s.TEXTURE_2D,0,s.RGBA,i.width,i.height,0,s.RGBA,s.UNSIGNED_BYTE,i.data);else{const a=S.convertHtmlImageToRGBACanvas(i,this._cachedBlitCanvas);s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,a)}}e.isMipMappingEnabled()?s.generateMipmap(s.TEXTURE_2D):(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,e.getGLRepeat(s,"x")),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,e.getGLRepeat(s,"y"))),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,e.getGLFilter(s,"min")),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,e.getGLFilter(s,"mag")),s.activeTexture(s.TEXTURE0)}getMaxDimensions(){let e=this.maxTextureDimensions;if(e===void 0){if(!process.env.REACT_APP_BROWSER){const t=this._context;e=t.getParameter(t.MAX_TEXTURE_SIZE)}if(process.env.REACT_APP_BROWSER){const t=S.createCanvas(),i=t.getContext("webgl")||t.getContext("experimental-webgl");if(!i)e=null;else{const r=i.getParameter(i.MAX_TEXTURE_SIZE),s=i.getExtension("WEBGL_lose_context");s&&s.loseContext(),e=r}}this.maxTextureDimensions=e}return e}getCurrentRenderTarget(){return this._currentRenderTarget}getCurrentObjectRenderer(){return this._currentObjectRenderer}static isSupported(){if(process.env.REACT_APP_BROWSER){const e=S.createCanvas();e.addEventListener("webglcontextcreationerror",this.prototype._onContextCreationError);const t=e.getContext("webgl")||e.getContext("experimental-webgl");let i=!!t;if(i){const r=ut.determineGPUName(t),s=ut.isGPUBlacklisted(r);i&=!s}return e.removeEventListener("webglcontextcreationerror",this.prototype._onContextCreationError),i}return!0}getMaxFloatPrecision(){return this._maxFloatPrecision}getMaxIntPrecision(){return this._maxIntPrecision}dispose(){this._filterManager.dispose(),this._currentObjectRenderer.dispose(),this._defaultRenderTarget.dispose();for(const i in this.shaders)this.shaders[i].dispose(),delete this.shaders[i];this._removeContextEventListeners();const e=this._context,t=e.getExtension("WEBGL_lose_context");t&&t.loseContext()}}ms.contextId=0;ms.type="WebGL";var fs=ms;var Tl={TextureShader:Rt};const Qi={EXPORT:"export",CLOSE:"close",OPERATION_CREATED:"operation:created",OPERATION_UPDATED:"operation:updated",OPERATION_REMOVED:"operation:removed",EDITOR_READY:"editor:ready",WINDOW_RESIZE:"window:resize",ZOOM_DONE:"editor:zoom_done",HISTORY_UNDO:"history:undo",HISTORY_UPDATED:"history:update",FEATURES_DISABLED:"editor:features:disabled",FEATURES_ENABLED:"editor:features:enabled",FEATURES_UPDATED:"editor:features:updated",TRANSFORM_REAPPLY_RATIO:"transform:reapply_ratio"};var bt={DEFAULTS:{FILTERS:[{identifier:"imgly_filters_duotone",defaultName:"DuoTone",assetFileName:"duotone",filters:[{identifier:"imgly_duotone_desert",defaultName:"Desert",lightColor:"#e1de9a",darkColor:"#cb2129"},{identifier:"imgly_duotone_peach",defaultName:"Peach",lightColor:"#e9abb8",darkColor:"#0040ff"},{identifier:"imgly_duotone_clash",defaultName:"Clash",lightColor:"#f41a0f",darkColor:"#23007c"},{identifier:"imgly_duotone_plum",defaultName:"Plum",lightColor:"#74d7ff",darkColor:"#23007c"},{identifier:"imgly_duotone_breezy",defaultName:"Breezy",lightColor:"#68fdff",darkColor:"#c20000"},{identifier:"imgly_duotone_deepblue",defaultName:"Deep Blue",lightColor:"#2de9eb",darkColor:"#58007c"},{identifier:"imgly_duotone_frog",defaultName:"Frog",lightColor:"#5bff60",darkColor:"#7f23a9"},{identifier:"imgly_duotone_sunset",defaultName:"Sunset",lightColor:"#f8ea46",darkColor:"#c400be"}]},{identifier:"imgly_filters_bw",assetFileName:"b&w",defaultName:"Black & White",filters:[{identifier:"imgly_lut_ad1920",defaultName:"1920 A.D.",lutImage:"filters/imgly_lut_ad1920_5_5_128.png"},{identifier:"imgly_lut_bw",defaultName:"Greyed",lutImage:"filters/imgly_lut_bw_5_5_128.png"},{identifier:"imgly_lut_x400",defaultName:"Dusty",lutImage:"filters/imgly_lut_dusty_5_5_128.png"},{identifier:"imgly_lut_litho",defaultName:"Litho",lutImage:"filters/imgly_lut_litho_5_5_128.png"},{identifier:"imgly_lut_sepiahigh",defaultName:"Sepia",lutImage:"filters/imgly_lut_sepia_5_5_128.png"},{identifier:"imgly_lut_plate",defaultName:"Weathered",lutImage:"filters/imgly_lut_weathered_5_5_128.png"},{identifier:"imgly_lut_sin",defaultName:"Hard Stuff",lutImage:"filters/imgly_lut_hard_stuff_8_8_512.png",resolution:512,horizontalTileCount:8,verticalTileCount:8}]},{identifier:"imgly_filters_retro",assetFileName:"vintage",defaultName:"Vintage",filters:[{identifier:"imgly_lut_blues",defaultName:"Polaroid",lutImage:"filters/imgly_lut_polaroid_5_5_128.png"},{identifier:"imgly_lut_front",defaultName:"Sunny 70s",lutImage:"filters/imgly_lut_sunny_70s_8_8_512.png",resolution:512,horizontalTileCount:8,verticalTileCount:8},{identifier:"imgly_lut_texas",defaultName:"Oldtimer",lutImage:"filters/imgly_lut_oldtimer_8_8_512.png",resolution:512,horizontalTileCount:8,verticalTileCount:8},{identifier:"imgly_lut_celsius",defaultName:"Inferno",lutImage:"filters/imgly_lut_inferno_8_8_512.png",resolution:512,horizontalTileCount:8,verticalTileCount:8},{identifier:"imgly_lut_cool",defaultName:"Snappy",lutImage:"filters/imgly_lut_snappy_5_5_128.png"}]},{identifier:"imgly_filters_analog",assetFileName:"smooth",defaultName:"Smooth",filters:[{identifier:"imgly_lut_chest",defaultName:"Chestnut",lutImage:"filters/imgly_lut_chestnut_8_8_512.png",resolution:512,horizontalTileCount:8,verticalTileCount:8},{identifier:"imgly_lut_winter",defaultName:"Softly",lutImage:"filters/imgly_lut_softly_5_5_128.png"},{identifier:"imgly_lut_kdynamic",defaultName:"Pebble",lutImage:"filters/imgly_lut_pebble_5_5_128.png"},{identifier:"imgly_lut_fall",defaultName:"Moss",lutImage:"filters/imgly_lut_moss_5_5_128.png"},{identifier:"imgly_lut_lenin",defaultName:"Lemon",lutImage:"filters/imgly_lut_lemon_5_5_128.png"},{identifier:"imgly_lut_pola669",defaultName:"Green Gap",lutImage:"filters/imgly_lut_green_gap_5_5_128.png"}]},{identifier:"imgly_filters_winter",assetFileName:"cold",defaultName:"Cold",filters:[{identifier:"imgly_lut_elder",defaultName:"Colla",lutImage:"filters/imgly_lut_colla_5_5_128.png"},{identifier:"imgly_lut_orchid",defaultName:"Solanus",lutImage:"filters/imgly_lut_solanus_5_5_128.png"},{identifier:"imgly_lut_bleached",defaultName:"Kalmen",lutImage:"filters/imgly_lut_kalmen_5_5_128.png"},{identifier:"imgly_lut_bleachedblue",defaultName:"Joran",lutImage:"filters/imgly_lut_joran_5_5_128.png"},{identifier:"imgly_lut_breeze",defaultName:"Levante",lutImage:"filters/imgly_lut_levante_5_5_128.png"},{identifier:"imgly_lut_blueshadows",defaultName:"Zephyr",lutImage:"filters/imgly_lut_zephyr_5_5_128.png"}]},{identifier:"imgly_filters_summer",assetFileName:"warm",defaultName:"Warm",filters:[{identifier:"imgly_lut_sunset",defaultName:"Golden",lutImage:"filters/imgly_lut_golden_5_5_128.png"},{identifier:"imgly_lut_eighties",defaultName:"Low Fire",lutImage:"filters/imgly_lut_low_fire_5_5_128.png"},{identifier:"imgly_lut_evening",defaultName:"Sunrise",lutImage:"filters/imgly_lut_sunrise_5_5_128.png"},{identifier:"imgly_lut_k2",defaultName:"Flat Black",lutImage:"filters/imgly_lut_flat_black_8_8_512.png",resolution:512,horizontalTileCount:8,verticalTileCount:8},{identifier:"imgly_lut_nogreen",defaultName:"Pumpkin",lutImage:"filters/imgly_lut_pumpkin_5_5_128.png"}]},{identifier:"imgly_filters_legacy",defaultName:"Legacy",assetFileName:"legacy",filters:[{identifier:"imgly_lut_ancient",defaultName:"Ancient",lutImage:"filters/imgly_lut_ancient_5_5_128.png"},{identifier:"imgly_lut_cottoncandy",defaultName:"Candy",lutImage:"filters/imgly_lut_cottoncandy_5_5_128.png"},{identifier:"imgly_lut_classic",defaultName:"Classic",lutImage:"filters/imgly_lut_classic_5_5_128.png"},{identifier:"imgly_lut_colorful",defaultName:"Colorful",lutImage:"filters/imgly_lut_colorful_5_5_128.png"},{identifier:"imgly_lut_creamy",defaultName:"Creamy",lutImage:"filters/imgly_lut_creamy_5_5_128.png"},{identifier:"imgly_lut_fixie",defaultName:"Fixie",lutImage:"filters/imgly_lut_fixie_8_8_512.png",resolution:512,horizontalTileCount:8,verticalTileCount:8},{identifier:"imgly_lut_food",defaultName:"Food",lutImage:"filters/imgly_lut_food_5_5_128.png"},{identifier:"imgly_lut_fridge",defaultName:"Fridge",lutImage:"filters/imgly_lut_fridge_8_8_512.png",resolution:512,horizontalTileCount:8,verticalTileCount:8},{identifier:"imgly_lut_glam",defaultName:"Glam",lutImage:"filters/imgly_lut_glam_5_5_128.png"},{identifier:"imgly_lut_gobblin",defaultName:"Gobblin",lutImage:"filters/imgly_lut_gobblin_5_5_128.png"},{identifier:"imgly_lut_highcontrast",defaultName:"Hicon",lutImage:"filters/imgly_lut_highcontrast_5_5_128.png"},{identifier:"imgly_lut_highcarb",defaultName:"High Carb",lutImage:"filters/imgly_lut_highcarb_5_5_128.png"},{identifier:"imgly_lut_k1",defaultName:"K1",lutImage:"filters/imgly_lut_k1_5_5_128.png"},{identifier:"imgly_lut_k6",defaultName:"K6",lutImage:"filters/imgly_lut_k6_5_5_128.png"},{identifier:"imgly_lut_keen",defaultName:"Keen",lutImage:"filters/imgly_lut_keen_5_5_128.png"},{identifier:"imgly_lut_lomo",defaultName:"Lomo",lutImage:"filters/imgly_lut_lomo_8_8_512.png",resolution:512,horizontalTileCount:8,verticalTileCount:8},{identifier:"imgly_lut_lomo100",defaultName:"Lomo 100",lutImage:"filters/imgly_lut_lomo100_5_5_128.png"},{identifier:"imgly_lut_lucid",defaultName:"Lucid",lutImage:"filters/imgly_lut_lucid_5_5_128.png"},{identifier:"imgly_lut_mellow",defaultName:"Mellow",lutImage:"filters/imgly_lut_mellow_8_8_512.png",resolution:512,horizontalTileCount:8,verticalTileCount:8},{identifier:"imgly_lut_neat",defaultName:"Neat",lutImage:"filters/imgly_lut_neat_5_5_128.png"},{identifier:"imgly_lut_pale",defaultName:"Pale",lutImage:"filters/imgly_lut_pale_5_5_128.png"},{identifier:"imgly_lut_pitched",defaultName:"Pitched",lutImage:"filters/imgly_lut_pitched_5_5_128.png"},{identifier:"imgly_lut_polasx",defaultName:"Pola SX",lutImage:"filters/imgly_lut_polasx_5_5_128.png"},{identifier:"imgly_lut_pro400",defaultName:"Pro 400",lutImage:"filters/imgly_lut_pro400_5_5_128.png"},{identifier:"imgly_lut_quozi",defaultName:"Quozi",lutImage:"filters/imgly_lut_quozi_5_5_128.png"},{identifier:"imgly_lut_settled",defaultName:"Settled",lutImage:"filters/imgly_lut_settled_5_5_128.png"},{identifier:"imgly_lut_seventies",defaultName:"Seventies",lutImage:"filters/imgly_lut_seventies_5_5_128.png"},{identifier:"imgly_lut_soft",defaultName:"Soft",lutImage:"filters/imgly_lut_soft_5_5_128.png"},{identifier:"imgly_lut_steel",defaultName:"Steel",lutImage:"filters/imgly_lut_steel_5_5_128.png"},{identifier:"imgly_lut_summer",defaultName:"Summer",lutImage:"filters/imgly_lut_summer_5_5_128.png"},{identifier:"imgly_lut_tender",defaultName:"Tender",lutImage:"filters/imgly_lut_tender_5_5_128.png"},{identifier:"imgly_lut_twilight",defaultName:"Twilight",lutImage:"filters/imgly_lut_twilight_5_5_128.png"}]}],OVERLAYS:[{identifier:"imgly_overlay_golden",defaultName:"Golden",image:"overlays/imgly_overlay_golden.jpg",thumbnail:"overlays/imgly_overlay_golden_thumb.jpg",blendMode:"lighten"},{identifier:"imgly_overlay_bokeh",defaultName:"Bokeh",image:"overlays/imgly_overlay_bokeh.jpg",thumbnail:"overlays/imgly_overlay_bokeh_thumb.jpg",blendMode:"lighten"},{identifier:"imgly_overlay_hearts",defaultName:"Hearts",image:"overlays/imgly_overlay_hearts.jpg",thumbnail:"overlays/imgly_overlay_hearts_thumb.jpg",blendMode:"screen"},{identifier:"imgly_overlay_lightleak1",defaultName:"Light Leak",image:"overlays/imgly_overlay_lightleak1.jpg",thumbnail:"overlays/imgly_overlay_lightleak1_thumb.jpg",blendMode:"screen"},{identifier:"imgly_overlay_lightleak2",defaultName:"Light Leak 2",image:"overlays/imgly_overlay_lightleak2.jpg",thumbnail:"overlays/imgly_overlay_lightleak2_thumb.jpg",blendMode:"lighten"},{identifier:"imgly_overlay_rain",defaultName:"Rain",image:"overlays/imgly_overlay_rain.jpg",thumbnail:"overlays/imgly_overlay_rain_thumb.jpg",blendMode:"overlay"},{identifier:"imgly_overlay_wood",defaultName:"Wood",image:"overlays/imgly_overlay_wood.jpg",thumbnail:"overlays/imgly_overlay_wood_thumb.jpg",blendMode:"multiply"},{identifier:"imgly_overlay_mosaic",defaultName:"Mosaic",image:"overlays/imgly_overlay_mosaic.jpg",thumbnail:"overlays/imgly_overlay_mosaic_thumb.jpg",blendMode:"multiply"},{identifier:"imgly_overlay_chop",defaultName:"Chop",image:"overlays/imgly_overlay_chop.jpg",thumbnail:"overlays/imgly_overlay_chop_thumb.jpg",blendMode:"multiply"},{identifier:"imgly_overlay_vintage",defaultName:"Vintage",image:"overlays/imgly_overlay_vintage.jpg",thumbnail:"overlays/imgly_overlay_vintage_thumb.jpg",blendMode:"darken"},{identifier:"imgly_overlay_metal",defaultName:"Metal",image:"overlays/imgly_overlay_metal.jpg",thumbnail:"overlays/imgly_overlay_metal_thumb.jpg",blendMode:"overlay"},{identifier:"imgly_overlay_paper",defaultName:"Paper",image:"overlays/imgly_overlay_paper.jpg",thumbnail:"overlays/imgly_overlay_paper_thumb.jpg",blendMode:"multiply"},{identifier:"imgly_overlay_painting",defaultName:"Painting",image:"overlays/imgly_overlay_painting.jpg",thumbnail:"overlays/imgly_overlay_painting_thumb.jpg",blendMode:"overlay"},{identifier:"imgly_overlay_grain",defaultName:"Grain",image:"overlays/imgly_overlay_grain.jpg",thumbnail:"overlays/imgly_overlay_grain_thumb.jpg",blendMode:"overlay"},{identifier:"imgly_overlay_clouds",defaultName:"Clouds",image:"overlays/imgly_overlay_clouds.jpg",thumbnail:"overlays/imgly_overlay_clouds_thumb.jpg",blendMode:"softLight"},{identifier:"imgly_overlay_wall1",defaultName:"Wall",image:"overlays/imgly_overlay_wall1.jpg",thumbnail:"overlays/imgly_overlay_wall1_thumb.jpg",blendMode:"lighten"},{identifier:"imgly_overlay_wall2",defaultName:"Wall 2",image:"overlays/imgly_overlay_wall2.jpg",thumbnail:"overlays/imgly_overlay_wall2_thumb.jpg",blendMode:"overlay"}],FRAME_CATEGORIES:[{identifier:"imgly_frame_generic",defaultName:"Generic",metaData:{backgroundImage:"frames/generic.png"},frames:[{identifier:"imgly_frame_dia",defaultName:"Dia",layoutMode:"horizontal-inside",thumbnail:"frames/imgly_frame_dia/imgly_frame_dia_thumb.png",imageGroups:{top:{mid:{image:"frames/imgly_frame_dia/imgly_frame_dia_top.png",mode:"repeat"}},left:{start:"frames/imgly_frame_dia/imgly_frame_dia_top_corner_left.png",mid:"frames/imgly_frame_dia/imgly_frame_dia_left.png",end:"frames/imgly_frame_dia/imgly_frame_dia_bottom_corner_left.png"},right:{start:"frames/imgly_frame_dia/imgly_frame_dia_top_corner_right.png",mid:"frames/imgly_frame_dia/imgly_frame_dia_right.png",end:"frames/imgly_frame_dia/imgly_frame_dia_bottom_corner_right.png"},bottom:{mid:{image:"frames/imgly_frame_dia/imgly_frame_dia_bottom.png",mode:"repeat"}}}},{identifier:"imgly_frame_art_decor",defaultName:"Art Decor",tintable:!0,layoutMode:"horizontal-inside",thumbnail:"frames/imgly_frame_art_decor/imgly_frame_art_decor_thumb.png",imageGroups:{top:{start:"frames/imgly_frame_art_decor/imgly_frame_art_decor_top_corner_left.png",mid:{image:"frames/imgly_frame_art_decor/imgly_frame_art_decor_top.png",mode:"stretch"},end:"frames/imgly_frame_art_decor/imgly_frame_art_decor_top_corner_right.png"},left:{mid:{image:"frames/imgly_frame_art_decor/imgly_frame_art_decor_left.png",mode:"stretch"}},right:{mid:{image:"frames/imgly_frame_art_decor/imgly_frame_art_decor_right.png",mode:"stretch"}},bottom:{start:"frames/imgly_frame_art_decor/imgly_frame_art_decor_bottom_corner_left.png",mid:{image:"frames/imgly_frame_art_decor/imgly_frame_art_decor_bottom.png",mode:"stretch"},end:"frames/imgly_frame_art_decor/imgly_frame_art_decor_bottom_corner_right.png"}}},{identifier:"imgly_frame_black_passepartout",defaultName:"Black Passepartout",layoutMode:"horizontal-inside",thumbnail:"frames/imgly_frame_black_passepartout/imgly_frame_black_passepartout_thumb.png",imageGroups:{top:{start:"frames/imgly_frame_black_passepartout/imgly_frame_black_passepartout_top_corner_left.png",mid:{image:"frames/imgly_frame_black_passepartout/imgly_frame_black_passepartout_top.png",mode:"stretch"},end:"frames/imgly_frame_black_passepartout/imgly_frame_black_passepartout_top_corner_right.png"},left:{mid:{image:"frames/imgly_frame_black_passepartout/imgly_frame_black_passepartout_left.png",mode:"stretch"}},right:{mid:{image:"frames/imgly_frame_black_passepartout/imgly_frame_black_passepartout_right.png",mode:"stretch"}},bottom:{start:"frames/imgly_frame_black_passepartout/imgly_frame_black_passepartout_bottom_corner_left.png",mid:{image:"frames/imgly_frame_black_passepartout/imgly_frame_black_passepartout_bottom.png",mode:"stretch"},end:"frames/imgly_frame_black_passepartout/imgly_frame_black_passepartout_bottom_corner_right.png"}}},{identifier:"imgly_frame_lowpoly_shadow",defaultName:"Low Poly",layoutMode:"horizontal-inside",thumbnail:"frames/imgly_frame_lowpoly_shadow/imgly_frame_lowpoly_shadow_thumb.png",imageGroups:{top:{start:"frames/imgly_frame_lowpoly_shadow/imgly_frame_lowpoly_shadow_top_corner_left.png",mid:{image:"frames/imgly_frame_lowpoly_shadow/imgly_frame_lowpoly_shadow_top.png",mode:"stretch"},end:"frames/imgly_frame_lowpoly_shadow/imgly_frame_lowpoly_shadow_top_corner_right.png"},left:{mid:{image:"frames/imgly_frame_lowpoly_shadow/imgly_frame_lowpoly_shadow_left.png",mode:"stretch"}},right:{mid:{image:"frames/imgly_frame_lowpoly_shadow/imgly_frame_lowpoly_shadow_right.png",mode:"stretch"}},bottom:{start:"frames/imgly_frame_lowpoly_shadow/imgly_frame_lowpoly_shadow_bottom_corner_left.png",mid:{image:"frames/imgly_frame_lowpoly_shadow/imgly_frame_lowpoly_shadow_bottom.png",mode:"stretch"},end:"frames/imgly_frame_lowpoly_shadow/imgly_frame_lowpoly_shadow_bottom_corner_right.png"}}},{identifier:"imgly_frame_wood_passepartout",defaultName:"Wood Passepartout",layoutMode:"horizontal-inside",thumbnail:"frames/imgly_frame_wood_passepartout/imgly_frame_wood_passepartout_thumb.png",imageGroups:{top:{start:"frames/imgly_frame_wood_passepartout/imgly_frame_wood_passepartout_top_corner_left.png",mid:{image:"frames/imgly_frame_wood_passepartout/imgly_frame_wood_passepartout_top.png",mode:"stretch"},end:"frames/imgly_frame_wood_passepartout/imgly_frame_wood_passepartout_top_corner_right.png"},left:{mid:{image:"frames/imgly_frame_wood_passepartout/imgly_frame_wood_passepartout_left.png",mode:"stretch"}},right:{mid:{image:"frames/imgly_frame_wood_passepartout/imgly_frame_wood_passepartout_right.png",mode:"stretch"}},bottom:{start:"frames/imgly_frame_wood_passepartout/imgly_frame_wood_passepartout_bottom_corner_left.png",mid:{image:"frames/imgly_frame_wood_passepartout/imgly_frame_wood_passepartout_bottom.png",mode:"stretch"},end:"frames/imgly_frame_wood_passepartout/imgly_frame_wood_passepartout_bottom_corner_right.png"}}}]}],STICKER_CATEGORIES:[{identifier:"imgly_sticker_emoticons",defaultName:"Emoticons",metaData:{backgroundImage:"stickers/emoticons/background.png"},stickers:[{identifier:"imgly_sticker_emoticons_alien",defaultName:"Alien",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_alien.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_alien.png"],width:62,height:58},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_alien.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_alien.png"],width:1e3,height:935}}},{identifier:"imgly_sticker_emoticons_angel",defaultName:"Angel",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_angel.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_angel.png"],width:62,height:64},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_angel.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_angel.png"]}}},{identifier:"imgly_sticker_emoticons_angry",defaultName:"Angry",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_angry.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_angry.png"],width:62,height:62},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_angry.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_angry.png"]}}},{identifier:"imgly_sticker_emoticons_anxious",defaultName:"Anxious",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_anxious.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_anxious.png"],width:62,height:58},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_anxious.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_anxious.png"]}}},{identifier:"imgly_sticker_emoticons_asleep",defaultName:"Asleep",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_asleep.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_asleep.png"],width:62,height:58},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_asleep.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_asleep.png"]}}},{identifier:"imgly_sticker_emoticons_attention",defaultName:"Attention",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_attention.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_attention.png"],width:62,height:60},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_attention.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_attention.png"]}}},{identifier:"imgly_sticker_emoticons_baby_chicken",defaultName:"Baby Chicken",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_baby_chicken.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_baby_chicken.png"],width:61,height:42},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_baby_chicken.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_baby_chicken.png"]}}},{identifier:"imgly_sticker_emoticons_batman",defaultName:"Batman",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_batman.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_batman.png"],width:62,height:58},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_batman.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_batman.png"]}}},{identifier:"imgly_sticker_emoticons_beer",defaultName:"Beer",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_beer.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_beer.png"],width:62,height:59},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_beer.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_beer.png"]}}},{identifier:"imgly_sticker_emoticons_blush",defaultName:"Blush",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_blush.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_blush.png"],width:62,height:58},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_blush.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_blush.png"]}}},{identifier:"imgly_sticker_emoticons_boxer",defaultName:"Boxer",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_boxer.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_boxer.png"],width:62,height:62},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_boxer.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_boxer.png"]}}},{identifier:"imgly_sticker_emoticons_business",defaultName:"Business",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_business.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_business.png"],width:60,height:63},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_business.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_business.png"]}}},{identifier:"imgly_sticker_emoticons_chicken",defaultName:"Chicken",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_chicken.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_chicken.png"],width:63,height:55},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_chicken.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_chicken.png"]}}},{identifier:"imgly_sticker_emoticons_cool",defaultName:"Cool",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_cool.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_cool.png"],width:62,height:58},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_cool.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_cool.png"]}}},{identifier:"imgly_sticker_emoticons_cry",defaultName:"Cry",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_cry.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_cry.png"],width:62,height:58},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_cry.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_cry.png"]}}},{identifier:"imgly_sticker_emoticons_deceased",defaultName:"Deceased",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_deceased.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_deceased.png"],width:62,height:58},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_deceased.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_deceased.png"]}}},{identifier:"imgly_sticker_emoticons_devil",defaultName:"Devil",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_devil.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_devil.png"],width:62,height:58},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_devil.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_devil.png"]}}},{identifier:"imgly_sticker_emoticons_duckface",defaultName:"Duckface",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_duckface.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_duckface.png"],width:62,height:58},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_duckface.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_duckface.png"]}}},{identifier:"imgly_sticker_emoticons_furious",defaultName:"Furious",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_furious.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_furious.png"],width:62,height:61},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_furious.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_furious.png"]}}},{identifier:"imgly_sticker_emoticons_grin",defaultName:"Grin",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_grin.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_grin.png"],width:62,height:58},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_grin.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_grin.png"]}}},{identifier:"imgly_sticker_emoticons_guitar",defaultName:"Guitar",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_guitar.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_guitar.png"],width:64,height:60},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_guitar.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_guitar.png"]}}},{identifier:"imgly_sticker_emoticons_harry_potter",defaultName:"Harry Potter",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_harry_potter.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_harry_potter.png"],width:64,height:62},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_harry_potter.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_harry_potter.png"]}}},{identifier:"imgly_sticker_emoticons_hippie",defaultName:"Hippie",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_hippie.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_hippie.png"],width:62,height:62},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_hippie.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_hippie.png"]}}},{identifier:"imgly_sticker_emoticons_hitman",defaultName:"Hitman",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_hitman.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_hitman.png"],width:64,height:60},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_hitman.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_hitman.png"]}}},{identifier:"imgly_sticker_emoticons_humourous",defaultName:"Humourous",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_humourous.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_humourous.png"],width:64,height:64},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_humourous.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_humourous.png"]}}},{identifier:"imgly_sticker_emoticons_idea",defaultName:"Idea",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_idea.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_idea.png"],width:64,height:62},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_idea.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_idea.png"]}}},{identifier:"imgly_sticker_emoticons_impatient",defaultName:"Impatient",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_impatient.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_impatient.png"],width:62,height:58},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_impatient.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_impatient.png"]}}},{identifier:"imgly_sticker_emoticons_kiss",defaultName:"Kiss",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_kiss.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_kiss.png"],width:62,height:58},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_kiss.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_kiss.png"]}}},{identifier:"imgly_sticker_emoticons_kisses",defaultName:"Kisses",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_kisses.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_kisses.png"],width:62,height:58},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_kisses.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_kisses.png"]}}},{identifier:"imgly_sticker_emoticons_laugh",defaultName:"Laugh",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_laugh.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_laugh.png"],width:62,height:58},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_laugh.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_laugh.png"]}}},{identifier:"imgly_sticker_emoticons_loud_cry",defaultName:"Loud Cry",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_loud_cry.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_loud_cry.png"],width:64,height:58},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_loud_cry.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_loud_cry.png"]}}},{identifier:"imgly_sticker_emoticons_loving",defaultName:"Loving",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_loving.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_loving.png"],width:62,height:58},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_loving.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_loving.png"]}}},{identifier:"imgly_sticker_emoticons_masked",defaultName:"Masked",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_masked.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_masked.png"],width:62,height:62},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_masked.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_masked.png"]}}},{identifier:"imgly_sticker_emoticons_music",defaultName:"Music",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_music.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_music.png"],width:62,height:54},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_music.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_music.png"]}}},{identifier:"imgly_sticker_emoticons_nerd",defaultName:"Nerd",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_nerd.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_nerd.png"]},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_nerd.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_nerd.png"]}}},{identifier:"imgly_sticker_emoticons_ninja",defaultName:"Ninja",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_ninja.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_ninja.png"],width:62,height:58},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_ninja.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_ninja.png"]}}},{identifier:"imgly_sticker_emoticons_not_speaking_to_you",defaultName:"Not Speaking To You",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_not_speaking_to_you.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_not_speaking_to_you.png"],width:62,height:58},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_not_speaking_to_you.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_not_speaking_to_you.png"]}}},{identifier:"imgly_sticker_emoticons_pig",defaultName:"Pig",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_pig.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_pig.png"],width:63,height:41},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_pig.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_pig.png"]}}},{identifier:"imgly_sticker_emoticons_pumpkin",defaultName:"Pumpkin",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_pumpkin.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_pumpkin.png"],width:62,height:60},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_pumpkin.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_pumpkin.png"]}}},{identifier:"imgly_sticker_emoticons_question",defaultName:"Question",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_question.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_question.png"],width:62,height:62},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_question.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_question.png"]}}},{identifier:"imgly_sticker_emoticons_rabbit",defaultName:"Rabbit",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_rabbit.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_rabbit.png"],width:65,height:47},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_rabbit.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_rabbit.png"]}}},{identifier:"imgly_sticker_emoticons_sad",defaultName:"Sad",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_sad.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_sad.png"]},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_sad.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_sad.png"]}}},{identifier:"imgly_sticker_emoticons_sick",defaultName:"Sick",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_sick.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_sick.png"],width:62,height:58},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_sick.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_sick.png"]}}},{identifier:"imgly_sticker_emoticons_skateboard",defaultName:"Skateboard",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_skateboard.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_skateboard.png"],width:62,height:64},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_skateboard.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_skateboard.png"]}}},{identifier:"imgly_sticker_emoticons_skull",defaultName:"Skull",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_skull.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_skull.png"],width:62,height:62},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_skull.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_skull.png"]}}},{identifier:"imgly_sticker_emoticons_sleepy",defaultName:"Sleepy",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_sleepy.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_sleepy.png"],width:62,height:60},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_sleepy.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_sleepy.png"]}}},{identifier:"imgly_sticker_emoticons_smile",defaultName:"Smile",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_smile.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_smile.png"],width:62,height:58},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_smile.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_smile.png"]}}},{identifier:"imgly_sticker_emoticons_smoking",defaultName:"Smoking",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_smoking.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_smoking.png"],width:62,height:58},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_smoking.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_smoking.png"]}}},{identifier:"imgly_sticker_emoticons_sobbing",defaultName:"Sobbing",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_sobbing.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_sobbing.png"],width:62,height:59},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_sobbing.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_sobbing.png"]}}},{identifier:"imgly_sticker_emoticons_star",defaultName:"Star",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_star.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_star.png"],width:64,height:64},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_star.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_star.png"]}}},{identifier:"imgly_sticker_emoticons_steaming_furious",defaultName:"Steaming Furious",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_steaming_furious.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_steaming_furious.png"],width:62,height:58},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_steaming_furious.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_steaming_furious.png"]}}},{identifier:"imgly_sticker_emoticons_sunbathing",defaultName:"Sunbathing",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_sunbathing.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_sunbathing.png"],width:62,height:58},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_sunbathing.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_sunbathing.png"]}}},{identifier:"imgly_sticker_emoticons_tired",defaultName:"Tired",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_tired.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_tired.png"],width:62,height:60},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_tired.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_tired.png"]}}},{identifier:"imgly_sticker_emoticons_tongue_out_wink",defaultName:"Tongue Out Wink",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_tongue_out_wink.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_tongue_out_wink.png"],width:62,height:58},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_tongue_out_wink.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_tongue_out_wink.png"]}}},{identifier:"imgly_sticker_emoticons_wave",defaultName:"Wave",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_wave.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_wave.png"],width:62,height:60},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_wave.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_wave.png"]}}},{identifier:"imgly_sticker_emoticons_wide_grin",defaultName:"Wide Grin",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_wide_grin.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_wide_grin.png"],width:62,height:58},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_wide_grin.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_wide_grin.png"]}}},{identifier:"imgly_sticker_emoticons_wink",defaultName:"Wink",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_wink.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_wink.png"],width:62,height:58},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_wink.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_wink.png"]}}},{identifier:"imgly_sticker_emoticons_wrestler",defaultName:"Wrestler",images:{mediaThumb:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_wrestler.svg","stickers/emoticons/stickers/thumbs/imgly_sticker_emoticons_wrestler.png"],width:62,height:60},mediaBase:{uris:["stickers/emoticons/stickers/imgly_sticker_emoticons_wrestler.svg","stickers/emoticons/stickers/base/imgly_sticker_emoticons_wrestler.png"]}}}]},{identifier:"imgly_sticker_shapes",defaultName:"Shapes",metaData:{backgroundImage:"stickers/shapes/background.png"},stickers:[{identifier:"imgly_sticker_shapes_arrow_02",defaultName:"Arrow 1",tintMode:"solid",images:{mediaThumb:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_arrow_02.svg","stickers/shapes/stickers/thumbs/imgly_sticker_shapes_arrow_02.png"],width:2e3,height:1236},mediaBase:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_arrow_02.svg","stickers/shapes/stickers/base/imgly_sticker_shapes_arrow_02.png"],width:2e3,height:1236}}},{identifier:"imgly_sticker_shapes_arrow_03",defaultName:"Arrow 2",tintMode:"solid",images:{mediaThumb:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_arrow_03.svg","stickers/shapes/stickers/thumbs/imgly_sticker_shapes_arrow_03.png"],width:2e3,height:2e3},mediaBase:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_arrow_03.svg","stickers/shapes/stickers/base/imgly_sticker_shapes_arrow_03.png"],width:2e3,height:2e3}}},{identifier:"imgly_sticker_shapes_badge_01",defaultName:"Badge 1",tintMode:"solid",images:{mediaThumb:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_01.svg","stickers/shapes/stickers/thumbs/imgly_sticker_shapes_badge_01.png"],width:2e3,height:2e3},mediaBase:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_01.svg","stickers/shapes/stickers/base/imgly_sticker_shapes_badge_01.png"],width:2e3,height:2e3}}},{identifier:"imgly_sticker_shapes_badge_04",defaultName:"Badge 2",tintMode:"solid",images:{mediaThumb:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_04.svg","stickers/shapes/stickers/thumbs/imgly_sticker_shapes_badge_04.png"],width:2e3,height:1589},mediaBase:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_04.svg","stickers/shapes/stickers/base/imgly_sticker_shapes_badge_04.png"],width:2e3,height:1589}}},{identifier:"imgly_sticker_shapes_badge_06",defaultName:"Badge 3",tintMode:"solid",images:{mediaThumb:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_06.svg","stickers/shapes/stickers/thumbs/imgly_sticker_shapes_badge_06.png"],width:2e3,height:1733},mediaBase:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_06.svg","stickers/shapes/stickers/base/imgly_sticker_shapes_badge_06.png"],width:2e3,height:1733}}},{identifier:"imgly_sticker_shapes_badge_08",defaultName:"Badge 4",tintMode:"solid",images:{mediaThumb:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_08.svg","stickers/shapes/stickers/thumbs/imgly_sticker_shapes_badge_08.png"],width:2e3,height:2e3},mediaBase:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_08.svg","stickers/shapes/stickers/base/imgly_sticker_shapes_badge_08.png"],width:2e3,height:2e3}}},{identifier:"imgly_sticker_shapes_badge_11",defaultName:"Badge 5",tintMode:"solid",images:{mediaThumb:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_11.svg","stickers/shapes/stickers/thumbs/imgly_sticker_shapes_badge_11.png"],width:2e3,height:2e3},mediaBase:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_11.svg","stickers/shapes/stickers/base/imgly_sticker_shapes_badge_11.png"],width:2e3,height:2e3}}},{identifier:"imgly_sticker_shapes_badge_12",defaultName:"Badge 6",tintMode:"solid",images:{mediaThumb:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_12.svg","stickers/shapes/stickers/thumbs/imgly_sticker_shapes_badge_12.png"],width:2001,height:1903},mediaBase:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_12.svg","stickers/shapes/stickers/base/imgly_sticker_shapes_badge_12.png"],width:2001,height:1903}}},{identifier:"imgly_sticker_shapes_badge_13",defaultName:"Badge 7",tintMode:"solid",images:{mediaThumb:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_13.svg","stickers/shapes/stickers/thumbs/imgly_sticker_shapes_badge_13.png"],width:2e3,height:1718},mediaBase:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_13.svg","stickers/shapes/stickers/base/imgly_sticker_shapes_badge_13.png"],width:2e3,height:1718}}},{identifier:"imgly_sticker_shapes_badge_15",defaultName:"Badge 8",tintMode:"solid",images:{mediaThumb:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_15.svg","stickers/shapes/stickers/thumbs/imgly_sticker_shapes_badge_15.png"],width:1618,height:2e3},mediaBase:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_15.svg","stickers/shapes/stickers/base/imgly_sticker_shapes_badge_15.png"],width:1618,height:2e3}}},{identifier:"imgly_sticker_shapes_badge_18",defaultName:"Badge 9",tintMode:"solid",images:{mediaThumb:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_18.svg","stickers/shapes/stickers/thumbs/imgly_sticker_shapes_badge_18.png"],width:1198,height:2e3},mediaBase:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_18.svg","stickers/shapes/stickers/base/imgly_sticker_shapes_badge_18.png"],width:1198,height:2e3}}},{identifier:"imgly_sticker_shapes_badge_19",defaultName:"Badge 10",tintMode:"solid",images:{mediaThumb:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_19.svg","stickers/shapes/stickers/thumbs/imgly_sticker_shapes_badge_19.png"],width:2127,height:481},mediaBase:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_19.svg","stickers/shapes/stickers/base/imgly_sticker_shapes_badge_19.png"],width:2127,height:481}}},{identifier:"imgly_sticker_shapes_badge_20",defaultName:"Badge 11",tintMode:"solid",images:{mediaThumb:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_20.svg","stickers/shapes/stickers/thumbs/imgly_sticker_shapes_badge_20.png"],width:2e3,height:1404},mediaBase:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_20.svg","stickers/shapes/stickers/base/imgly_sticker_shapes_badge_20.png"],width:2e3,height:1404}}},{identifier:"imgly_sticker_shapes_badge_28",defaultName:"Badge 12",tintMode:"solid",images:{mediaThumb:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_28.svg","stickers/shapes/stickers/thumbs/imgly_sticker_shapes_badge_28.png"],width:2e3,height:2e3},mediaBase:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_28.svg","stickers/shapes/stickers/base/imgly_sticker_shapes_badge_28.png"],width:2e3,height:2e3}}},{identifier:"imgly_sticker_shapes_badge_32",defaultName:"Badge 13",tintMode:"solid",images:{mediaThumb:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_32.svg","stickers/shapes/stickers/thumbs/imgly_sticker_shapes_badge_32.png"],width:1960,height:2e3},mediaBase:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_32.svg","stickers/shapes/stickers/base/imgly_sticker_shapes_badge_32.png"],width:1960,height:2e3}}},{identifier:"imgly_sticker_shapes_badge_35",defaultName:"Badge 14",tintMode:"solid",images:{mediaThumb:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_35.svg","stickers/shapes/stickers/thumbs/imgly_sticker_shapes_badge_35.png"],width:2e3,height:2002},mediaBase:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_35.svg","stickers/shapes/stickers/base/imgly_sticker_shapes_badge_35.png"],width:2e3,height:2002}}},{identifier:"imgly_sticker_shapes_badge_36",defaultName:"Badge 15",tintMode:"solid",images:{mediaThumb:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_36.svg","stickers/shapes/stickers/thumbs/imgly_sticker_shapes_badge_36.png"],width:2e3,height:1668},mediaBase:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_badge_36.svg","stickers/shapes/stickers/base/imgly_sticker_shapes_badge_36.png"],width:2e3,height:1668}}},{identifier:"imgly_sticker_shapes_spray_01",defaultName:"Spray 1",tintMode:"solid",images:{mediaThumb:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_spray_01.svg","stickers/shapes/stickers/thumbs/imgly_sticker_shapes_spray_01.png"],width:1912,height:2039},mediaBase:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_spray_01.svg","stickers/shapes/stickers/base/imgly_sticker_shapes_spray_01.png"],width:1912,height:2039}}},{identifier:"imgly_sticker_shapes_spray_03",defaultName:"Spray 2",tintMode:"solid",images:{mediaThumb:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_spray_03.svg","stickers/shapes/stickers/thumbs/imgly_sticker_shapes_spray_03.png"],width:1681,height:1779},mediaBase:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_spray_03.svg","stickers/shapes/stickers/base/imgly_sticker_shapes_spray_03.png"],width:1681,height:1779}}},{identifier:"imgly_sticker_shapes_spray_04",defaultName:"Spray 3",tintMode:"solid",images:{mediaThumb:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_spray_04.svg","stickers/shapes/stickers/thumbs/imgly_sticker_shapes_spray_04.png"],width:1407,height:2248},mediaBase:{uris:["stickers/shapes/stickers/imgly_sticker_shapes_spray_04.svg","stickers/shapes/stickers/base/imgly_sticker_shapes_spray_04.png"],width:1407,height:2248}}}]}]}};let tn={};process.env.REACT_APP_BROWSER&&(tn=window.navigator);var Wt,Tu=244837814094590,Rl=(Tu&16777215)==15715070;function C(e,t,i){e!=null&&(typeof e=="number"?this.fromNumber(e,t,i):t==null&&typeof e!="string"?this.fromString(e,256):this.fromString(e,t))}function $(){return new C(null)}function Ru(e,t,i,r,s,o){for(;--o>=0;){var n=t*this[e++]+i[r]+s;s=Math.floor(n/67108864),i[r++]=n&67108863}return s}function Eu(e,t,i,r,s,o){for(var n=t&32767,a=t>>15;--o>=0;){var l=this[e]&32767,d=this[e++]>>15,p=a*l+d*n;l=n*l+((p&32767)<<15)+i[r]+(s&1073741823),s=(l>>>30)+(p>>>15)+a*d+(s>>>30),i[r++]=l&1073741823}return s}function Ou(e,t,i,r,s,o){for(var n=t&16383,a=t>>14;--o>=0;){var l=this[e]&16383,d=this[e++]>>14,p=a*l+d*n;l=n*l+((p&16383)<<14)+i[r]+s,s=(l>>28)+(p>>14)+a*d,i[r++]=l&268435455}return s}Rl&&tn.appName=="Microsoft Internet Explorer"?(C.prototype.am=Eu,Wt=30):Rl&&tn.appName!="Netscape"?(C.prototype.am=Ru,Wt=26):(C.prototype.am=Ou,Wt=28);C.prototype.DB=Wt;C.prototype.DM=(1<<Wt)-1;C.prototype.DV=1<<Wt;var rn=52;C.prototype.FV=Math.pow(2,rn);C.prototype.F1=rn-Wt;C.prototype.F2=2*Wt-rn;var Cu="0123456789abcdefghijklmnopqrstuvwxyz",gs=new Array,Zi,nt;Zi="0".charCodeAt(0);for(nt=0;nt<=9;++nt)gs[Zi++]=nt;Zi="a".charCodeAt(0);for(nt=10;nt<36;++nt)gs[Zi++]=nt;Zi="A".charCodeAt(0);for(nt=10;nt<36;++nt)gs[Zi++]=nt;function El(e){return Cu.charAt(e)}function Ol(e,t){var i=gs[e.charCodeAt(t)];return i==null?-1:i}function ku(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s}function Du(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0}function Vt(e){var t=$();return t.fromInt(e),t}function Pu(e,t){var i;if(t==16)i=4;else if(t==8)i=3;else if(t==256)i=8;else if(t==2)i=1;else if(t==32)i=5;else if(t==4)i=2;else{this.fromRadix(e,t);return}this.t=0,this.s=0;for(var r=e.length,s=!1,o=0;--r>=0;){var n=i==8?e[r]&255:Ol(e,r);if(n<0){e.charAt(r)=="-"&&(s=!0);continue}s=!1,o==0?this[this.t++]=n:o+i>this.DB?(this[this.t-1]|=(n&(1<<this.DB-o)-1)<<o,this[this.t++]=n>>this.DB-o):this[this.t-1]|=n<<o,o+=i,o>=this.DB&&(o-=this.DB)}i==8&&(e[0]&128)!=0&&(this.s=-1,o>0&&(this[this.t-1]|=(1<<this.DB-o)-1<<o)),this.clamp(),s&&C.ZERO.subTo(this,this)}function Fu(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t}function Au(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(e==16)t=4;else if(e==8)t=3;else if(e==2)t=1;else if(e==32)t=5;else if(e==4)t=2;else return this.toRadix(e);var i=(1<<t)-1,r,s=!1,o="",n=this.t,a=this.DB-n*this.DB%t;if(n-- >0)for(a<this.DB&&(r=this[n]>>a)>0&&(s=!0,o=El(r));n>=0;)a<t?(r=(this[n]&(1<<a)-1)<<t-a,r|=this[--n]>>(a+=this.DB-t)):(r=this[n]>>(a-=t)&i,a<=0&&(a+=this.DB,--n)),r>0&&(s=!0),s&&(o+=El(r));return s?o:"0"}function Iu(){var e=$();return C.ZERO.subTo(this,e),e}function Bu(){return this.s<0?this.negate():this}function Mu(e){var t=this.s-e.s;if(t!=0)return t;var i=this.t;if(t=i-e.t,t!=0)return this.s<0?-t:t;for(;--i>=0;)if((t=this[i]-e[i])!=0)return t;return 0}function _s(e){var t=1,i;return(i=e>>>16)!=0&&(e=i,t+=16),(i=e>>8)!=0&&(e=i,t+=8),(i=e>>4)!=0&&(e=i,t+=4),(i=e>>2)!=0&&(e=i,t+=2),(i=e>>1)!=0&&(e=i,t+=1),t}function Lu(){return this.t<=0?0:this.DB*(this.t-1)+_s(this[this.t-1]^this.s&this.DM)}function Nu(e,t){var i;for(i=this.t-1;i>=0;--i)t[i+e]=this[i];for(i=e-1;i>=0;--i)t[i]=0;t.t=this.t+e,t.s=this.s}function zu(e,t){for(var i=e;i<this.t;++i)t[i-e]=this[i];t.t=Math.max(this.t-e,0),t.s=this.s}function Gu(e,t){var i=e%this.DB,r=this.DB-i,s=(1<<r)-1,o=Math.floor(e/this.DB),n=this.s<<i&this.DM,a;for(a=this.t-1;a>=0;--a)t[a+o+1]=this[a]>>r|n,n=(this[a]&s)<<i;for(a=o-1;a>=0;--a)t[a]=0;t[o]=n,t.t=this.t+o+1,t.s=this.s,t.clamp()}function Uu(e,t){t.s=this.s;var i=Math.floor(e/this.DB);if(i>=this.t){t.t=0;return}var r=e%this.DB,s=this.DB-r,o=(1<<r)-1;t[0]=this[i]>>r;for(var n=i+1;n<this.t;++n)t[n-i-1]|=(this[n]&o)<<s,t[n-i]=this[n]>>r;r>0&&(t[this.t-i-1]|=(this.s&o)<<s),t.t=this.t-i,t.clamp()}function Ku(e,t){for(var i=0,r=0,s=Math.min(e.t,this.t);i<s;)r+=this[i]-e[i],t[i++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r-=e.s;i<this.t;)r+=this[i],t[i++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;i<e.t;)r-=e[i],t[i++]=r&this.DM,r>>=this.DB;r-=e.s}t.s=r<0?-1:0,r<-1?t[i++]=this.DV+r:r>0&&(t[i++]=r),t.t=i,t.clamp()}function ju(e,t){var i=this.abs(),r=e.abs(),s=i.t;for(t.t=s+r.t;--s>=0;)t[s]=0;for(s=0;s<r.t;++s)t[s+i.t]=i.am(0,r[s],t,s,0,i.t);t.s=0,t.clamp(),this.s!=e.s&&C.ZERO.subTo(t,t)}function Wu(e){for(var t=this.abs(),i=e.t=2*t.t;--i>=0;)e[i]=0;for(i=0;i<t.t-1;++i){var r=t.am(i,t[i],e,2*i,0,1);(e[i+t.t]+=t.am(i+1,2*t[i],e,2*i+1,r,t.t-i-1))>=t.DV&&(e[i+t.t]-=t.DV,e[i+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(i,t[i],e,2*i,0,1)),e.s=0,e.clamp()}function Vu(e,t,i){var r=e.abs();if(r.t<=0)return;var s=this.abs();if(s.t<r.t){t!=null&&t.fromInt(0),i!=null&&this.copyTo(i);return}i==null&&(i=$());var o=$(),n=this.s,a=e.s,l=this.DB-_s(r[r.t-1]);l>0?(r.lShiftTo(l,o),s.lShiftTo(l,i)):(r.copyTo(o),s.copyTo(i));var d=o.t,p=o[d-1];if(p==0)return;var u=p*(1<<this.F1)+(d>1?o[d-2]>>this.F2:0),c=this.FV/u,m=(1<<this.F1)/u,x=1<<this.F2,_=i.t,f=_-d,y=t==null?$():t;for(o.dlShiftTo(f,y),i.compareTo(y)>=0&&(i[i.t++]=1,i.subTo(y,i)),C.ONE.dlShiftTo(d,y),y.subTo(o,o);o.t<d;)o[o.t++]=0;for(;--f>=0;){var b=i[--_]==p?this.DM:Math.floor(i[_]*c+(i[_-1]+x)*m);if((i[_]+=o.am(0,b,i,f,0,d))<b)for(o.dlShiftTo(f,y),i.subTo(y,i);i[_]<--b;)i.subTo(y,i)}t!=null&&(i.drShiftTo(d,t),n!=a&&C.ZERO.subTo(t,t)),i.t=d,i.clamp(),l>0&&i.rShiftTo(l,i),n<0&&C.ZERO.subTo(i,i)}function Hu(e){var t=$();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(C.ZERO)>0&&e.subTo(t,t),t}function ri(e){this.m=e}function qu(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e}function Yu(e){return e}function Xu(e){e.divRemTo(this.m,null,e)}function Qu(e,t,i){e.multiplyTo(t,i),this.reduce(i)}function Zu(e,t){e.squareTo(t),this.reduce(t)}ri.prototype.convert=qu;ri.prototype.revert=Yu;ri.prototype.reduce=Xu;ri.prototype.mulTo=Qu;ri.prototype.sqrTo=Zu;function Ju(){if(this.t<1)return 0;var e=this[0];if((e&1)==0)return 0;var t=e&3;return t=t*(2-(e&15)*t)&15,t=t*(2-(e&255)*t)&255,t=t*(2-((e&65535)*t&65535))&65535,t=t*(2-e*t%this.DV)%this.DV,t>0?this.DV-t:-t}function si(e){this.m=e,this.mp=e.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function $u(e){var t=$();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(C.ZERO)>0&&this.m.subTo(t,t),t}function em(e){var t=$();return e.copyTo(t),this.reduce(t),t}function tm(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var i=e[t]&32767,r=i*this.mpl+((i*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(i=t+this.m.t,e[i]+=this.m.am(0,r,e,t,0,this.m.t);e[i]>=e.DV;)e[i]-=e.DV,e[++i]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)}function im(e,t){e.squareTo(t),this.reduce(t)}function rm(e,t,i){e.multiplyTo(t,i),this.reduce(i)}si.prototype.convert=$u;si.prototype.revert=em;si.prototype.reduce=tm;si.prototype.mulTo=rm;si.prototype.sqrTo=im;function sm(){return(this.t>0?this[0]&1:this.s)==0}function om(e,t){if(e>4294967295||e<1)return C.ONE;var i=$(),r=$(),s=t.convert(this),o=_s(e)-1;for(s.copyTo(i);--o>=0;)if(t.sqrTo(i,r),(e&1<<o)>0)t.mulTo(r,s,i);else{var n=i;i=r,r=n}return t.revert(i)}function nm(e,t){var i;return e<256||t.isEven()?i=new ri(t):i=new si(t),this.exp(e,i)}C.prototype.copyTo=ku;C.prototype.fromInt=Du;C.prototype.fromString=Pu;C.prototype.clamp=Fu;C.prototype.dlShiftTo=Nu;C.prototype.drShiftTo=zu;C.prototype.lShiftTo=Gu;C.prototype.rShiftTo=Uu;C.prototype.subTo=Ku;C.prototype.multiplyTo=ju;C.prototype.squareTo=Wu;C.prototype.divRemTo=Vu;C.prototype.invDigit=Ju;C.prototype.isEven=sm;C.prototype.exp=om;C.prototype.toString=Au;C.prototype.negate=Iu;C.prototype.abs=Bu;C.prototype.compareTo=Mu;C.prototype.bitLength=Lu;C.prototype.mod=Hu;C.prototype.modPowInt=nm;C.ZERO=Vt(0);C.ONE=Vt(1);function am(){var e=$();return this.copyTo(e),e}function lm(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function hm(){return this.t==0?this.s:this[0]<<24>>24}function dm(){return this.t==0?this.s:this[0]<<16>>16}function cm(e){return Math.floor(Math.LN2*this.DB/Math.log(e))}function pm(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function um(e){if(e==null&&(e=10),this.signum()==0||e<2||e>36)return"0";var t=this.chunkSize(e),i=Math.pow(e,t),r=Vt(i),s=$(),o=$(),n="";for(this.divRemTo(r,s,o);s.signum()>0;)n=(i+o.intValue()).toString(e).substr(1)+n,s.divRemTo(r,s,o);return o.intValue().toString(e)+n}function mm(e,t){this.fromInt(0),t==null&&(t=10);for(var i=this.chunkSize(t),r=Math.pow(t,i),s=!1,o=0,n=0,a=0;a<e.length;++a){var l=Ol(e,a);if(l<0){e.charAt(a)=="-"&&this.signum()==0&&(s=!0);continue}n=t*n+l,++o>=i&&(this.dMultiply(r),this.dAddOffset(n,0),o=0,n=0)}o>0&&(this.dMultiply(Math.pow(t,o)),this.dAddOffset(n,0)),s&&C.ZERO.subTo(this,this)}function fm(e,t,i){if(typeof t=="number")if(e<2)this.fromInt(1);else for(this.fromNumber(e,i),this.testBit(e-1)||this.bitwiseTo(C.ONE.shiftLeft(e-1),sn,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(C.ONE.shiftLeft(e-1),this);else{var r=new Array,s=e&7;r.length=(e>>3)+1,t.nextBytes(r),s>0?r[0]&=(1<<s)-1:r[0]=0,this.fromString(r,256)}}function gm(){var e=this.t,t=new Array;t[0]=this.s;var i=this.DB-e*this.DB%8,r,s=0;if(e-- >0)for(i<this.DB&&(r=this[e]>>i)!=(this.s&this.DM)>>i&&(t[s++]=r|this.s<<this.DB-i);e>=0;)i<8?(r=(this[e]&(1<<i)-1)<<8-i,r|=this[--e]>>(i+=this.DB-8)):(r=this[e]>>(i-=8)&255,i<=0&&(i+=this.DB,--e)),(r&128)!=0&&(r|=-256),s==0&&(this.s&128)!=(r&128)&&++s,(s>0||r!=this.s)&&(t[s++]=r);return t}function _m(e){return this.compareTo(e)==0}function ym(e){return this.compareTo(e)<0?this:e}function bm(e){return this.compareTo(e)>0?this:e}function xm(e,t,i){var r,s,o=Math.min(e.t,this.t);for(r=0;r<o;++r)i[r]=t(this[r],e[r]);if(e.t<this.t){for(s=e.s&this.DM,r=o;r<this.t;++r)i[r]=t(this[r],s);i.t=this.t}else{for(s=this.s&this.DM,r=o;r<e.t;++r)i[r]=t(s,e[r]);i.t=e.t}i.s=t(this.s,e.s),i.clamp()}function vm(e,t){return e&t}function wm(e){var t=$();return this.bitwiseTo(e,vm,t),t}function sn(e,t){return e|t}function Sm(e){var t=$();return this.bitwiseTo(e,sn,t),t}function Cl(e,t){return e^t}function Tm(e){var t=$();return this.bitwiseTo(e,Cl,t),t}function kl(e,t){return e&~t}function Rm(e){var t=$();return this.bitwiseTo(e,kl,t),t}function Em(){for(var e=$(),t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e}function Om(e){var t=$();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t}function Cm(e){var t=$();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t}function km(e){if(e==0)return-1;var t=0;return(e&65535)==0&&(e>>=16,t+=16),(e&255)==0&&(e>>=8,t+=8),(e&15)==0&&(e>>=4,t+=4),(e&3)==0&&(e>>=2,t+=2),(e&1)==0&&++t,t}function Dm(){for(var e=0;e<this.t;++e)if(this[e]!=0)return e*this.DB+km(this[e]);return this.s<0?this.t*this.DB:-1}function Pm(e){for(var t=0;e!=0;)e&=e-1,++t;return t}function Fm(){for(var e=0,t=this.s&this.DM,i=0;i<this.t;++i)e+=Pm(this[i]^t);return e}function Am(e){var t=Math.floor(e/this.DB);return t>=this.t?this.s!=0:(this[t]&1<<e%this.DB)!=0}function Im(e,t){var i=C.ONE.shiftLeft(e);return this.bitwiseTo(i,t,i),i}function Bm(e){return this.changeBit(e,sn)}function Mm(e){return this.changeBit(e,kl)}function Lm(e){return this.changeBit(e,Cl)}function Nm(e,t){for(var i=0,r=0,s=Math.min(e.t,this.t);i<s;)r+=this[i]+e[i],t[i++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r+=e.s;i<this.t;)r+=this[i],t[i++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;i<e.t;)r+=e[i],t[i++]=r&this.DM,r>>=this.DB;r+=e.s}t.s=r<0?-1:0,r>0?t[i++]=r:r<-1&&(t[i++]=this.DV+r),t.t=i,t.clamp()}function zm(e){var t=$();return this.addTo(e,t),t}function Gm(e){var t=$();return this.subTo(e,t),t}function Um(e){var t=$();return this.multiplyTo(e,t),t}function Km(){var e=$();return this.squareTo(e),e}function jm(e){var t=$();return this.divRemTo(e,t,null),t}function Wm(e){var t=$();return this.divRemTo(e,null,t),t}function Vm(e){var t=$(),i=$();return this.divRemTo(e,t,i),new Array(t,i)}function Hm(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()}function qm(e,t){if(e==0)return;for(;this.t<=t;)this[this.t++]=0;for(this[t]+=e;this[t]>=this.DV;)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}function Ir(){}function Dl(e){return e}function Ym(e,t,i){e.multiplyTo(t,i)}function Xm(e,t){e.squareTo(t)}Ir.prototype.convert=Dl;Ir.prototype.revert=Dl;Ir.prototype.mulTo=Ym;Ir.prototype.sqrTo=Xm;function Qm(e){return this.exp(e,new Ir)}function Zm(e,t,i){var r=Math.min(this.t+e.t,t);for(i.s=0,i.t=r;r>0;)i[--r]=0;var s;for(s=i.t-this.t;r<s;++r)i[r+this.t]=this.am(0,e[r],i,r,0,this.t);for(s=Math.min(e.t,t);r<s;++r)this.am(0,e[r],i,r,0,t-r);i.clamp()}function Jm(e,t,i){--t;var r=i.t=this.t+e.t-t;for(i.s=0;--r>=0;)i[r]=0;for(r=Math.max(t-this.t,0);r<e.t;++r)i[this.t+r-t]=this.am(t-r,e[r],i,0,0,this.t+r-t);i.clamp(),i.drShiftTo(1,i)}function Ji(e){this.r2=$(),this.q3=$(),C.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}function $m(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=$();return e.copyTo(t),this.reduce(t),t}function ef(e){return e}function tf(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)}function rf(e,t){e.squareTo(t),this.reduce(t)}function sf(e,t,i){e.multiplyTo(t,i),this.reduce(i)}Ji.prototype.convert=$m;Ji.prototype.revert=ef;Ji.prototype.reduce=tf;Ji.prototype.mulTo=sf;Ji.prototype.sqrTo=rf;function of(e,t){var i=e.bitLength(),r,s=Vt(1),o;if(i<=0)return s;i<18?r=1:i<48?r=3:i<144?r=4:i<768?r=5:r=6,i<8?o=new ri(t):t.isEven()?o=new Ji(t):o=new si(t);var n=new Array,a=3,l=r-1,d=(1<<r)-1;if(n[1]=o.convert(this),r>1){var p=$();for(o.sqrTo(n[1],p);a<=d;)n[a]=$(),o.mulTo(p,n[a-2],n[a]),a+=2}var u=e.t-1,c,m=!0,x=$(),_;for(i=_s(e[u])-1;u>=0;){for(i>=l?c=e[u]>>i-l&d:(c=(e[u]&(1<<i+1)-1)<<l-i,u>0&&(c|=e[u-1]>>this.DB+i-l)),a=r;(c&1)==0;)c>>=1,--a;if((i-=a)<0&&(i+=this.DB,--u),m)n[c].copyTo(s),m=!1;else{for(;a>1;)o.sqrTo(s,x),o.sqrTo(x,s),a-=2;a>0?o.sqrTo(s,x):(_=s,s=x,x=_),o.mulTo(x,n[c],s)}for(;u>=0&&(e[u]&1<<i)==0;)o.sqrTo(s,x),_=s,s=x,x=_,--i<0&&(i=this.DB-1,--u)}return o.revert(s)}function nf(e){var t=this.s<0?this.negate():this.clone(),i=e.s<0?e.negate():e.clone();if(t.compareTo(i)<0){var r=t;t=i,i=r}var s=t.getLowestSetBit(),o=i.getLowestSetBit();if(o<0)return t;for(s<o&&(o=s),o>0&&(t.rShiftTo(o,t),i.rShiftTo(o,i));t.signum()>0;)(s=t.getLowestSetBit())>0&&t.rShiftTo(s,t),(s=i.getLowestSetBit())>0&&i.rShiftTo(s,i),t.compareTo(i)>=0?(t.subTo(i,t),t.rShiftTo(1,t)):(i.subTo(t,i),i.rShiftTo(1,i));return o>0&&i.lShiftTo(o,i),i}function af(e){if(e<=0)return 0;var t=this.DV%e,i=this.s<0?e-1:0;if(this.t>0)if(t==0)i=this[0]%e;else for(var r=this.t-1;r>=0;--r)i=(t*i+this[r])%e;return i}function lf(e){var t=e.isEven();if(this.isEven()&&t||e.signum()==0)return C.ZERO;for(var i=e.clone(),r=this.clone(),s=Vt(1),o=Vt(0),n=Vt(0),a=Vt(1);i.signum()!=0;){for(;i.isEven();)i.rShiftTo(1,i),t?((!s.isEven()||!o.isEven())&&(s.addTo(this,s),o.subTo(e,o)),s.rShiftTo(1,s)):o.isEven()||o.subTo(e,o),o.rShiftTo(1,o);for(;r.isEven();)r.rShiftTo(1,r),t?((!n.isEven()||!a.isEven())&&(n.addTo(this,n),a.subTo(e,a)),n.rShiftTo(1,n)):a.isEven()||a.subTo(e,a),a.rShiftTo(1,a);i.compareTo(r)>=0?(i.subTo(r,i),t&&s.subTo(n,s),o.subTo(a,o)):(r.subTo(i,r),t&&n.subTo(s,n),a.subTo(o,a))}if(r.compareTo(C.ONE)!=0)return C.ZERO;if(a.compareTo(e)>=0)return a.subtract(e);if(a.signum()<0)a.addTo(e,a);else return a;return a.signum()<0?a.add(e):a}var Me=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],hf=(1<<26)/Me[Me.length-1];function df(e){var t,i=this.abs();if(i.t==1&&i[0]<=Me[Me.length-1]){for(t=0;t<Me.length;++t)if(i[0]==Me[t])return!0;return!1}if(i.isEven())return!1;for(t=1;t<Me.length;){for(var r=Me[t],s=t+1;s<Me.length&&r<hf;)r*=Me[s++];for(r=i.modInt(r);t<s;)if(r%Me[t++]==0)return!1}return i.millerRabin(e)}function cf(e){var t=this.subtract(C.ONE),i=t.getLowestSetBit();if(i<=0)return!1;var r=t.shiftRight(i);e=e+1>>1,e>Me.length&&(e=Me.length);for(var s=$(),o=0;o<e;++o){s.fromInt(Me[Math.floor(Math.random()*Me.length)]);var n=s.modPow(r,this);if(n.compareTo(C.ONE)!=0&&n.compareTo(t)!=0){for(var a=1;a++<i&&n.compareTo(t)!=0;)if(n=n.modPowInt(2,this),n.compareTo(C.ONE)==0)return!1;if(n.compareTo(t)!=0)return!1}}return!0}C.prototype.chunkSize=cm;C.prototype.toRadix=um;C.prototype.fromRadix=mm;C.prototype.fromNumber=fm;C.prototype.bitwiseTo=xm;C.prototype.changeBit=Im;C.prototype.addTo=Nm;C.prototype.dMultiply=Hm;C.prototype.dAddOffset=qm;C.prototype.multiplyLowerTo=Zm;C.prototype.multiplyUpperTo=Jm;C.prototype.modInt=af;C.prototype.millerRabin=cf;C.prototype.clone=am;C.prototype.intValue=lm;C.prototype.byteValue=hm;C.prototype.shortValue=dm;C.prototype.signum=pm;C.prototype.toByteArray=gm;C.prototype.equals=_m;C.prototype.min=ym;C.prototype.max=bm;C.prototype.and=wm;C.prototype.or=Sm;C.prototype.xor=Tm;C.prototype.andNot=Rm;C.prototype.not=Em;C.prototype.shiftLeft=Om;C.prototype.shiftRight=Cm;C.prototype.getLowestSetBit=Dm;C.prototype.bitCount=Fm;C.prototype.testBit=Am;C.prototype.setBit=Bm;C.prototype.clearBit=Mm;C.prototype.flipBit=Lm;C.prototype.add=zm;C.prototype.subtract=Gm;C.prototype.multiply=Um;C.prototype.divide=jm;C.prototype.remainder=Wm;C.prototype.divideAndRemainder=Vm;C.prototype.modPow=of;C.prototype.modInverse=lf;C.prototype.pow=Qm;C.prototype.gcd=nf;C.prototype.isProbablePrime=df;C.prototype.square=Km;var Pl=C;function Fl(e){var t=8,i=0;function r(f,y){var b=(f&65535)+(y&65535),g=(f>>16)+(y>>16)+(b>>16);return g<<16|b&65535}function s(f,y){return f>>>y|f<<32-y}function o(f,y){return f>>>y}function n(f,y,b){return f&y^~f&b}function a(f,y,b){return f&y^f&b^y&b}function l(f){return s(f,2)^s(f,13)^s(f,22)}function d(f){return s(f,6)^s(f,11)^s(f,25)}function p(f){return s(f,7)^s(f,18)^o(f,3)}function u(f){return s(f,17)^s(f,19)^o(f,10)}function c(f,y){var b=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),g=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),E=new Array(64),v,w,A,I,z,H,U,X,Q,re,Ae,Ge;f[y>>5]|=128<<24-y%32,f[(y+64>>9<<4)+15]=y;for(var Q=0;Q<f.length;Q+=16){v=g[0],w=g[1],A=g[2],I=g[3],z=g[4],H=g[5],U=g[6],X=g[7];for(var re=0;re<64;re++)re<16?E[re]=f[re+Q]:E[re]=r(r(r(u(E[re-2]),E[re-7]),p(E[re-15])),E[re-16]),Ae=r(r(r(r(X,d(z)),n(z,H,U)),b[re]),E[re]),Ge=r(l(v),a(v,w,A)),X=U,U=H,H=z,z=r(I,Ae),I=A,A=w,w=v,v=r(Ae,Ge);g[0]=r(v,g[0]),g[1]=r(w,g[1]),g[2]=r(A,g[2]),g[3]=r(I,g[3]),g[4]=r(z,g[4]),g[5]=r(H,g[5]),g[6]=r(U,g[6]),g[7]=r(X,g[7])}return g}function m(f){for(var y=Array(),b=(1<<t)-1,g=0;g<f.length*t;g+=t)y[g>>5]|=(f.charCodeAt(g/t)&b)<<24-g%32;return y}function x(f){f=f.replace(/\r\n/g,`
`);for(var y="",b=0;b<f.length;b++){var g=f.charCodeAt(b);g<128?y+=String.fromCharCode(g):g>127&&g<2048?(y+=String.fromCharCode(g>>6|192),y+=String.fromCharCode(g&63|128)):(y+=String.fromCharCode(g>>12|224),y+=String.fromCharCode(g>>6&63|128),y+=String.fromCharCode(g&63|128))}return y}function _(f){for(var y=i?"0123456789ABCDEF":"0123456789abcdef",b="",g=0;g<f.length*4;g++)b+=y.charAt(f[g>>2]>>(3-g%4)*8+4&15)+y.charAt(f[g>>2]>>(3-g%4)*8&15);return b}return e=x(e),_(c(m(e),e.length*t))}const pf=/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/g,uf=/^(0|[1-9]\d*)\.(0|[1-9]\d*)(\.(0|[1-9]\d*))?(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/g;class $i{get major(){return this._major}get minor(){return this._minor}get patch(){return this._patch}constructor(e,t=!1){const i=t?uf:pf,r=i.exec(e);i.lastIndex=0,this._major=r[1],this._minor=r[2],this._patch=r[3]||0}equals(e){return this._major===e._major&&this._minor===e._minor&&this._patch===e._patch}isMoreRecentThan(e){if(this._major<e.major)return!1;if(this._major>e.major)return!0;if(this._minor<e.minor)return!1;if(this._minor>e.minor)return!0;if(this._patch<=e.patch)return!1;if(this._patch>e.patch)return!0}}const Ce=e=>S.byteArrayToString(Ze.decode(e));function mf(e){return e.map(t=>`0${(t&255).toString(16)}`.slice(-2)).join("")}const ff="TDNSeVlXTnJQMkZ3YVV0bGVUMD0=",gf="ZW50ZXJwcmlzZV9saWNlbnNl",Al="YXBwX2lkZW50aWZpZXJz",_f="cGxhdGZvcm0=",Il="ZmVhdHVyZXM=",on="ZXhwaXJlc19hdA==",yf="ZG9tYWlucw==",bf="YXBpX3Rva2Vu",nn="c2lnbmF0dXJl",xf="dmVyc2lvbg==";class vf{constructor(e){this._version="2.4",this._l=typeof e=="string"?e.trim():e,this._e=this._parseBigInt("65537",10),this._n=this._parseBigInt("681984042382424091378806337544846672160292647422517223678775230983366046720611873368204040735766698395282492937192783016867164773742859209434481353888637963692711665138989982680829529436715362566735813634679619274059040232728883894511099669775400556584329435375723951309340934658571478665059403241851229195311069345899870108307225910988692123234379186643268583453907260879685992156955936561142314233983397819356937109343127504441076920088455337597736475086676246750168976219763398350254797168313954762459542746440628077261880980924552698138857743609502132632199713575442848784271304503226045319991689413234228439044522583790713890093165912455428688507463773064216328753265963237930998706891042679105987175588970202082466871461192706070321938250462103821558100761330890228135620208935801286878657384108721268761878694436895194628411397454202904351577771506916746612289964053490210990342857409030179406810634136188751670648983222653319056818302012063874664196648868156305696644664362171542503665321455971335955948698828939948786720193132672749776162913092000667953299803216404664087988046584107737900256954976744353601826341965438148646041640662195744770544094748295945844184507459808803114917301124088082458306086473490516969815873631",10),this._parseLicense()}v(){return this._sigValid()&&!this.isExp()}_jsonValid(){try{this._decLic=JSON.parse(this._l)}catch(e){return this._decLic={},!1}return!0}_hostnameValid(){if(typeof window=="undefined")return!0;if(!this._decLic[Ce(Al)].length)return!0;const{hostname:e}=window.location;let t=!1;return this._decLic[Ce(Al)].forEach(i=>{S.wildCardMatch(e,i)&&(t=!0)}),t}_platformValid(){const e=this._decLic[Ce(_f)],t=process.env.REACT_APP_BROWSER?"HTML5":"Server";return t===e}c(){return new Promise((e,t)=>{const i=this._validateError();i!==null&&t(i),e()})}validate(){const e=this._validateError();return!(e!==null)}_validateError(){const e=typeof this._l;if(e!=="string"||!this._jsonValid()){const t=new Error;return t.code="ELICINVFMT",t}if(!this._sigValid()){const t=new Error;return t.code="ELICINV",t}if(!this._hostnameValid()){const t=new Error;return t.code="ELICINVHOST",t}if(!this._platformValid()){const t=new Error;return t.code="ELICINVPLAT",t}if(this.isExp()){const t=new Error;return t.code="ELICEXP",t}return null}isToolAllowed(e){return this._includesFeature(e)}isWhiteLabel(){return this._includesFeature("whitelabel",new $i("2.4",!0))}areCustomAssetsAllowed(){return this._includesFeature("customassets",new $i("2.4",!0))}t(){if(this._decLic.enterprise_license)return Promise.resolve();if(this._includesFeature("noexporttracking",new $i("2.4",!0)))return Promise.resolve();const e=this._decLic[Ce(yf)][0]+Ce(Ce(ff))+this._decLic[Ce(bf)],t=new rt(e);return t.load()}isENT(){return this._decLic?this._decLic[Ce(gf)]:!1}_sigValid(){return this._verify(this._message,this._sig)}exp(){return!!this._decLic[Ce(on)]}dl(){return Math.ceil((this._expAt()-Date.now())/(60*60*24*1e3))}isExp(e=Date.now()){return this._decLic[Ce(on)]===null?!1:e>this._expAt()}_expAt(){return this._decLic[Ce(on)]*1e3}_verify(e,t){let i,r;r=this._encodeMessage(e),i=this._decodeSignature(t),i=i.substr(-64);const s=r===i;return s}_encodeMessage(e){const t=Fl(e);return t}_decodeSignature(e){let t;return e=Ze.decode(e),e=mf(e),e=this._parseBigInt(e,16),t=e.modPowInt(this._e,this._n),t=t.toString(16),t}_parseBigInt(e,t){return new Pl(e,t)}_parseLicense(){if(typeof this._l!="string")return;if(!this._jsonValid())return;this._sig=this._decLic[Ce(nn)]||"",delete this._decLic[Ce(nn)],this._sig=this._sig.replace(/[^A-Za-z0-9+/=]/g,""),this._message=this._l.replace(new RegExp(`,"${Ce(nn)}":"([^"]*)"`),"")}_includesFeature(e,t=new $i("1.0",!0)){const i=new $i(this._decLic[Ce(xf)],!0);return t.isMoreRecentThan(i)?!0:this._decLic[Ce(Il)]&&this._decLic[Ce(Il)].indexOf(e)!==-1}}class Bl{v(){return!0}c(){return Promise.resolve()}isToolAllowed(e){return!0}isWhiteLabel(){return!1}areCustomAssetsAllowed(){return!0}t(){return Promise.resolve()}isENT(){return!1}exp(){return!1}dl(){return 0}isExp(e=Date.now()){return!1}}var ys=vf;const oi=typeof window=="undefined"?global:window;let Et=oi.requestAnimationFrame,Ht=oi.cancelAnimationFrame,Ml=0;const bs=["ms","moz","webkit","o"];for(let e=0;e<bs.length&&!Et;++e)Et=oi[`${bs[e]}RequestAnimationFrame`],Ht=oi[`${bs[e]}CancelAnimationFrame`]||oi[`${bs[e]}CancelRequestAnimationFrame`];Et&&(Et=Et.bind(oi));Ht&&(Ht=Ht.bind(oi));Et||(Et=function(e,t){const i=new Date().getTime(),r=Math.max(0,16-(i-Ml)),s=setTimeout(function(){e(i+r)},r);return Ml=i+r,s});Ht||(Ht=function(e){clearTimeout(e)});class wf{constructor(e=new B(0,0),t=new B(1,1),i=new B(2,-1),r=new B(2,0)){this._p0=e.clone(),this._p1=t.clone(),this._p2=i.clone(),this._p3=r.clone(),this._segments=[],this._length=-1,this._sample=[]}set(e=new B(0,0),t=new B(1,1),i=new B(2,1),r=new B(2,0)){this._p0=e.clone(),this._p1=t.clone(),this._p2=i.clone(),this._p3=r.clone()}getLength(){return this._length}calculateSegments(e=100){let t=0,i=0;const r=[],s=1/e;let o=this._p0.clone();for(let n=1;n<=e;n++){const a=[];a.push({t,s:i,point:o}),t+=s,t=Math.min(t,1);const l=this.evalAt(t),d=l.clone().subtract(o);i+=d.len(),a.push({t,s:i,point:l}),r.push(a),o=l}return this._segments=r,this._length=i,i}evalAt(e){e=this.normalizeParameter(e);const t=this._p0.clone().multiply((1-e)**3),i=this._p1.clone().multiply(3*(1-e)*(1-e)*e),r=this._p2.clone().multiply(3*(1-e)*e*e),s=this._p3.clone().multiply(e*e*e);return t.add(i).add(r).add(s)}isInSegment(e,t){return e=this.normalizeArcLength(e),e>=t[0].s&&e<=t[1].s}getArcLengthSegment(e){e=this.normalizeArcLength(e);for(let t=0;t<this._segments.length;t++){const i=this._segments[t];if(this.isInSegment(e,i))return i}return null}normalizeArcLength(e){return Math.max(Math.min(this._length,e),0)}normalizeParameter(e){return Math.max(Math.min(1,e),0)}getParameterForArcLength(e){const t=this.normalizeArcLength(e),i=this.getArcLengthSegment(t);if(!i)return k.warn("CubicBezierCurve#getParameterForArcLength","Segment not found."),-1;const r=(t-i[1].s)/(i[0].s-i[1].s);return r*i[0].t+(1-r)*i[1].t}evalAtArcLength(e){return this.evalAt(this.getParameterForArcLength(e))}approximateAtArcLength(e){const t=this.normalizeArcLength(e),i=this.getArcLengthSegment(t);if(!i)return-1;const r=(t-i[1].s)/(i[0].s-i[1].s);return i[0].point.clone().multiply(r).add(i[1].point.clone().multiply(1-r))}parameterSample(e=100){const t=1/e,i=[];let r=0;for(let s=0;s<=e+1;s++)i.push(this.evalAt(r)),r+=t;return this._sample=i,[...i]}arcLengthApproxSample(e=100,t=!1,i=!1){const r=this._length/e,s=[];let o=0;for(let n=t?1:0;n<e+1;n++)s.push(this.approximateAtArcLength(o)),o+=r;return i&&s.pop(),this._sample=s,[...s]}}var an=wf;class Sf{constructor(e,t){this.min=e,this.max=t}getMin(){return this.min}getMax(){return this.max}getLength(){return this.max-this.min}contains(e){return this.min<=e&&e<=this.max}}var ln=Sf;class $e{constructor(e,t,i){this.x=e,this.y=t,this.z=i,typeof this.x=="undefined"&&(this.x=0),typeof this.y=="undefined"&&(this.y=0),typeof this.z=="undefined"&&(this.z=0)}set(e,t,i){return this.x=e,this.y=t,this.z=i,this}clone(){return new $e(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}clamp(e,t){const i=e!==null&&typeof e!="undefined",r=t!==null&&typeof t!="undefined";return!(e instanceof $e)&&i&&(e=new $e(e,e,e)),!(t instanceof $e)&&r&&(t=new $e(t,t,t)),i&&(this.x=Math.max(e.x,this.x),this.y=Math.max(e.y,this.y),this.z=Math.max(e.z,this.z)),r&&(this.x=Math.min(t.x,this.x),this.y=Math.min(t.y,this.y),this.z=Math.min(t.z,this.z)),this}divide(e){return e instanceof $e?(this.x/=e.x,this.y/=e.y,this.z/=e.z):(this.x/=e,this.y/=e,this.z/=e),this}subtract(e){return e instanceof $e?(this.x-=e.x,this.y-=e.y,this.z-=e.z):(this.x-=e,this.y-=e,this.z-=e),this}multiply(e){return e instanceof $e?(this.x*=e.x,this.y*=e.y,this.z*=e.z):(this.x*=e,this.y*=e,this.z*=e),this}add(e){return e instanceof $e?(this.x+=e.x,this.y+=e.y,this.z+=e.z):(this.x+=e,this.y+=e,this.z+=e),this}equals(e){return e instanceof $e?e.x===this.x&&e.y===this.y&&e.z===this.z:e===this.x&&e===this.y&&e===this.z}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}fract(){return this.x%=1,this.y%=1,this.z%=1,this}toInt(){return this.x|=0,this.y|=0,this.z|=0,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this}len(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}min(){return Math.min(Math.min(this.x,this.y),this.z)}max(){return Math.max(Math.max(this.x,this.y),this.z)}toObject(){return{x:this.x,y:this.y,z:this.z}}toString(){return`Vector3({ x: ${this.x}, y: ${this.y}, z: ${this.z} })`}roundDecimal(e){return this.x=parseFloat(this.x.toFixed(e)),this.y=parseFloat(this.y.toFixed(e)),this.z=parseFloat(this.z.toFixed(e)),this}static fromObject(e){return new $e(e.x,e.y,e.z)}static get NULL(){return new $e(0,0,0)}}var hn=$e;const P={};xe(P,{ColorMatrix:()=>Ar,CubicBezierCurve:()=>an,Matrix:()=>ot,Range:()=>ln,Rectangle:()=>fe,Vector2:()=>B,Vector3:()=>hn});const Br={};xe(Br,{Base64:()=>Ze,Color:()=>O,ColorMatrix:()=>Ar,Configurable:()=>G,Constants:()=>me,CubicBezierCurve:()=>an,Engine:()=>T,EventEmitter:()=>Pe,Events:()=>Qi,FreeLicenseChecker:()=>Bl,GLUtils:()=>ut,LicenseChecker:()=>ys,Log:()=>k,Matrix:()=>ot,Promise:()=>N,Range:()=>ln,Rectangle:()=>fe,Utils:()=>S,Vector2:()=>B,Vector3:()=>hn,cancelAnimationFrame:()=>Ht,requestAnimationFrame:()=>Et});Function.prototype.name===void 0&&Object.defineProperty!==void 0&&Object.defineProperty(Function.prototype,"name",{get(){const e=/function\s([^(]{1,})\(/,t=e.exec(this.toString());return t&&t.length>1?t[1].trim():""},set(e){}});class dn{constructor(){this._container=new T.Container,this._sprite=new T.Sprite,this._container.addChild(this._sprite)}render(e,t,i){const r=i.getDimensions(),s=this._getNextHighestPOT(r);this._renderTexture?this._renderTexture.resizeTo(s):this._renderTexture=new T.RenderTexture(e,s.x,s.y);const o=this._renderTexture.getDimensions();this._sprite.setTexture(i),this._sprite.updateTransform(),this._renderTexture.clear(),this._renderTexture.render(this._container),this._updateSprite(e,t,r,o)}_updateSprite(e,t,i,r){t.setTexture(this._renderTexture),this._renderTexture.setFrame(new fe(0,0,i.x,i.y))}_getNextHighestPOT(e){return new B(S.nextHighestPOT(e.x),S.nextHighestPOT(e.y))}getRenderTexture(){return this._renderTexture}dispose(){if(!this._renderTexture)return;this._renderTexture.dispose(),this._renderTexture=null}}class Tf extends as{constructor(e){super();this._onTextureUpdate=this._onTextureUpdate.bind(this),this._texture=e,this._shader=null,this._width=0,this._height=0,this._anchor=new B(0,0),this._canvasSmoothingEnabled=!0,this.setTexture(e)}_onTextureUpdate(){this._boundsNeedUpdate=!0,this._localBoundsNeedUpdate=!0}_renderWebGL(e){const t=e.save();this._smoothDownscaling&&(this._potRenderer||(this._potRenderer=new dn),this._potRenderer.render(e,this,this._texture)),e.restore(t),e.setObjectRenderer(e.renderers.sprite),e.renderers.sprite.render(this)}_renderCanvas(e){const t=this._worldTransform,i=this._texture.getFrame(),{width:r,height:s}=i,o=e.getCurrentRenderTarget().getPixelRatio(),n=this._anchor.x*-r|0,a=this._anchor.y*-s|0,l=e.getContext();l.setTransform(t.a,t.b,t.c,t.d,t.tx*o,t.ty*o),l.globalAlpha=this.getWorldAlpha();const d=this._texture.getBaseTexture(),p=d.getPixelRatio(),u=d.getSource();l.imageSmoothingEnabled=this._canvasSmoothingEnabled,e.beforeDraw&&e.beforeDraw(l),l.drawImage(u,0,0,(u.naturalWidth||r)*p,(u.naturalHeight||s)*p,n*o,a*o,r*o,s*o)}isAtPosition(e){const t=this._worldTransform.applyInverseToVector(e),i=this._texture.getFrame(),{width:r,height:s}=i,o=new B(-r,-s);o.multiply(this._anchor);const n=o.clone().add(r,s);return!(t.x<o.x||t.x>n.x||t.y<o.y||t.y>n.y)}getLocalBounds(){if(this._localBoundsNeedUpdate){const e=this._localBounds,t=this._texture.getFrame();e.x=-t.width*this._anchor.x,e.y=-t.height*this._anchor.y,e.width=t.width,e.height=t.height,this._localBoundsNeedUpdate=!1}return this._localBounds.clone()}getBounds(){if(this._boundsNeedUpdate){const e=this._bounds,t=this._texture.getFrame(),i=this._worldTransform,r=this._anchor,s=i.rectangleToCoordinates(t,r);let o=s[0].x,n=s[0].y,a=o,l=n;s.forEach(({x:d,y:p})=>{o=Math.min(o,d),n=Math.min(n,p),a=Math.max(a,d),l=Math.max(l,p)}),e.x=o,e.width=Math.abs(a-o),e.y=n,e.height=Math.abs(l-n),this._boundsNeedUpdate=!1}return this._bounds.clone()}getTexture(){return this._texture}clearTexture(e=!0){if(!this._texture)return;this._texture.off("update",this._onTextureUpdate),e&&this._texture.dispose(),this._texture=null,this._potRenderer&&(e&&this._potRenderer.dispose(),this._potRenderer=null)}setTexture(e){if(!e)return;this._texture&&this._texture.off("update",this._onTextureUpdate),this._potRenderer&&this._potRenderer.getRenderTexture().getBaseTexture().setDirty(!0),this._texture=e,e.getBaseTexture().isLoaded()&&this._onTextureUpdate(),e.on("update",this._onTextureUpdate)}getShader(){return this._shader}setShader(e){this._shader=e}getWidth(){return this._width}setWidth(e){this._scale.x=e/this._texture.getFrame().width,this._width=e,this._boundsNeedUpdate=!0,this._localBoundsNeedUpdate=!0}getHeight(){return this._height}setHeight(e){this._scale.y=e/this._texture.getFrame().height,this._height=e,this._boundsNeedUpdate=!0,this._localBoundsNeedUpdate=!0}getDimensions(){return new B(this._width,this._height)}getAnchor(){return this._anchor}setAnchor(e,t){e instanceof B?this._anchor.copy(e):this._anchor.set(e,t),this._boundsNeedUpdate=!0,this._localBoundsNeedUpdate=!0}isSmoothDownscaling(){return this._smoothDownscaling}setSmoothDownscaling(e){this._smoothDownscaling=e}dispose(e=!1,t=!1){this._texture&&this._texture.off("update",this._onTextureUpdate),(e||t)&&this._texture.dispose(t),this._potRenderer&&this._potRenderer.dispose()}}var Ll=Tf;class Rf{constructor(){this._uvs=[new B(0,0),new B(1,0),new B(1,1),new B(0,1)]}update(e,t){let i=this._uvs[0];i.x=e.x/t.width,i.y=e.y/t.height,i=this._uvs[1],i.x=(e.x+e.width)/t.width,i.y=e.y/t.height,i=this._uvs[2],i.x=(e.x+e.width)/t.width,i.y=(e.y+e.height)/t.height,i=this._uvs[3],i.x=e.x/t.width,i.y=(e.y+e.height)/t.height}getUVsAt(e){return this._uvs[e]}getUVs(){return this._uvs}}var Nl=Rf;class cn extends Pe{constructor(e,t){super();if(!(e instanceof Be))throw new Error("`baseTexture` should be an instance of BaseTexture");this._uvs=new Nl,this._frame=t?t.clone():null,this._frameLocked=!!t,this._onBaseTextureLoaded=this._onBaseTextureLoaded.bind(this),this._onBaseTextureUpdated=this._onBaseTextureUpdated.bind(this),this._frame||(this._frame=new fe(0,0,1,1)),this.setBaseTexture(e)}static fromImage(e){const t=new Be(e);return new cn(t)}static fromCanvas(e){const t=new Be(e);return new cn(t)}_onBaseTextureLoaded(){if(!this._frameLocked){const e=this._baseTexture.getFrame().clone();this.setFrame(e)}this._baseTexture.on("update",this._onBaseTextureUpdated)}_onBaseTextureUpdated(){const{width:e,height:t}=this._baseTexture.getFrame();this._frame.width=e,this._frame.height=t,this.emit("update")}_updateUVs(){this._uvs.update(this._frame,this._baseTexture.getFrame())}getBaseTexture(){return this._baseTexture}setBaseTexture(e){if(this._baseTexture=e,!this._baseTexture.isLoaded())this._baseTexture.once("loaded",this._onBaseTextureLoaded);else{const{width:t,height:i}=e.getFrame();this._frameLocked||(this._frame=new fe(0,0,t,i)),this._onBaseTextureLoaded()}}getFrame(){return this._frame}setFrame(e){this._frame=e,this._updateUVs()}getWidth(){return this._frame.width}getHeight(){return this._frame.height}getUVs(){return this._uvs}getDimensions(){return new B(this._frame.width,this._frame.height)}dispose(e=!0){e&&this._baseTexture.dispose()}}var xs=cn;const{RendererType:er}=me;class Ef extends xs{constructor(e,t=100,i=100,r=1){super(new Be,new fe(0,0,t,i));this._loaded=!0,this._width=t,this._height=i,this._pixelRatio=r,this._renderer=e,this._setupFilterManager(),this._setupBuffer(),this.setBaseTexture(this._renderTarget.getBaseTexture()),this._updateUVs()}_setupFilterManager(){this._filterManager&&this._filterManager.dispose(),this._renderer.isOfType(er.WEBGL)?this._filterManager=new Xi(this._renderer):this._renderer.isOfType(er.CANVAS)&&(this._filterManager=new Yi(this._renderer)),this._filterManager.resizeTo(new B(this._width,this._height))}_setupBuffer(){this._renderer.isOfType(er.WEBGL)?this._setupWebGLRenderTarget():this._renderer.isOfType(er.CANVAS)&&this._setupCanvasRenderTarget()}_setupWebGLRenderTarget(){this._renderTarget&&this._renderTarget.dispose(),this._renderTarget=new Kt(this._renderer,this._width,this._height,this._pixelRatio)}_setupCanvasRenderTarget(){this._renderTarget&&this._renderTarget.dispose(),this._renderTarget=new Ut(this._width,this._height,this._pixelRatio)}clear(e){this._renderTarget.clear(e)}resizeTo(e){if(this._width===e.x&&this._height===e.y)return;this._width=e.x,this._height=e.y,this._frame.width=e.x,this._frame.height=e.y,this._renderTarget.resizeTo(e),this._filterManager.resizeTo(e)}render(e){if(this._renderer.isOfType(er.WEBGL))this._renderWebGL(e);else if(this._renderer.isOfType(er.CANVAS))this._renderCanvas(e);else throw new Error(`RenderTexture does not support rendering via ${this._renderer.constructor.name}`)}_renderWebGL(e){this._renderTarget.activate(),e.getWorldTransform().reset(),e.getChildren().forEach(i=>{i.updateTransform()});const t=this._renderer.getFilterManager();this._renderer.setFilterManager(this._filterManager),this._renderer.renderDisplayObject(e,this._renderTarget),this._renderer.setFilterManager(t)}_renderCanvas(e){e.getWorldTransform().reset(),e.getChildren().forEach(i=>{i.updateTransform()});const t=this._renderer.getFilterManager();this._renderer.setFilterManager(this._filterManager),this._renderer.renderDisplayObject(e,this._renderTarget),this._renderer.setFilterManager(t)}getRenderTarget(){return this._renderTarget}dispose(){this._renderTarget.dispose(),this._filterManager.dispose(),super.dispose()}}var zl=Ef;const Of={WebGLRenderer:fs,CanvasRenderer:$o,WebGLFilterManager:Xi,CanvasFilterManager:Yi,DisplayObject:Vi,Container:as,BaseTexture:Be,Texture:xs,RenderTexture:zl,WebGLRenderTarget:Kt,CanvasRenderTarget:Ut,Sprite:Ll,Shaders:Tl,Shader:Hi,Filter:yt,Filters:Jo,PixelArrayImage:ii,autoDetectRenderer(e,t,i={}){return fs.isSupported()?new fs(e,t,i):new $o(e,t,i)}};var T=Of;class Cf{static current(){return process.env.ENV}static isTest(){return process.env.ENV==="test"}static isDevelopment(){return process.env.ENV==="development"}static isProduction(){return process.env.ENV==="production"||!this.isTest()&&!this.isDevelopment()}}var Gl=Cf;class kf{constructor(e){this._head=0,this._buf=e}peekInt8(){return this._buf[this._head]}peekInt16(e=!1){const t=this._buf[this._head],i=this._buf[this._head+1];return e?(i<<8)+t:(t<<8)+i}peekInt24(e=!1){const t=this._buf[this._head],i=this._buf[this._head+1],r=this._buf[this._head+2];return e?(r<<16)+(i<<8)+t:(t<<16)+(i<<8)+r}peekInt32(e=!1){const t=this._buf[this._head],i=this._buf[this._head+1],r=this._buf[this._head+2],s=this._buf[this._head+3];return e?(s<<32)+(r<<16)+(i<<8)+t:(t<<32)+(i<<16)+(r<<8)+s}writeInt8(e){this._buf[this._head]=e&255}writeInt16(e){this._buf[this._head]=e>>8,this._buf[this._head+1]=e&255}readInt8(){const e=this.peekInt8();return this._head+=1,e}readInt16(e=!1){const t=this.peekInt16(e);return this._head+=2,t}readInt24(e=!1){const t=this.peekInt24(e);return this._head+=3,t}readInt32(e=!1){const t=this.peekInt32(e);return this._head+=4,t}readString(e){let t="";for(let i=0;i<e;i++){const r=this.readInt8();t+=String.fromCharCode(r)}return t}getHead(){return this._head}setHead(e){this._head=e}}var ni=kf;const Df={SOI:65496,SOS:65498,APP0:65504,APP1:65505,JFIF:65504,EXIF:65505},Pf={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"};var tr={MARKERS:Df,EXIF_TAGS:Pf};const{invariant:pn}=S,{MARKERS:Ff,EXIF_TAGS:Ul}=tr;class Af{constructor(e){this._buf=e,this._stream=new ni(this._buf),this._stream.setHead(0),this._parse(),this._bigEndian=!1}isValid(){this._stream.setHead(0);const e=this._stream.readInt16();if(e!==Ff.EXIF)return!1;const t=this._stream.readInt16();if(!(t>0))return!1;const i=this._stream.readString(4);return!(i!=="Exif")}_parse(){if(!this.isValid())return;this._stream.setHead(10);const e=this._stream.getHead();this._bigEndian=!1;const t=this._stream.readInt16();t===18761?this._bigEndian=!1:t===19789?this._bigEndian=!0:pn(!1,"Invalid TIFF data: No endian type found"),pn(this._stream.readInt16(!this._bigEndian)===42,"Invalid TIFF data: No 0x002A");const i=this._stream.readInt32(!this._bigEndian);pn(i>=8,"Invalid TIFF data: First IFD offset < 8");const r=e+i,s=this._readTags(this._stream,e,r,this._bigEndian);this._tags=s.tags,this._tagData=s.tagData}getTags(){return this._tags}getTagData(){return this._tagData}setOrientation(e){if(this._tagData.Orientation){const{entryOffset:t}=this._tagData.Orientation;this._stream.setHead(t+8),this._stream.writeInt16(this._bigEndian?e:(e&255)<<8|e>>8&255)}}_readTags(e,t,i,r){e.setHead(i);const s=e.readInt16(!r),o={},n=[];for(let a=0;a<s;a++){const l=i+a*12+2;e.setHead(l);let d=e.readInt16(!r),p,u,c;if(Ul[d]){d=Ul[d],p=e.readInt16(!r),u=e.readInt32(!r),c=e.readInt32(!r)+t;let m=null;switch(p){case 1:case 7:if(u===1)m=e.readInt8(!r);else{m=[];for(let x=0;x<u;x++)m.push(e.readInt8(!r))}break;case 2:e.setHead(u>4?c:l+8),m=e.readString(u);break;case 3:if(e.setHead(u>2?c:l+8),u===1)m=e.readInt16(!r);else{m=[];for(let x=0;x<u;x++)m.push(e.readInt16(!r))}break;case 4:case 9:if(e.setHead(u>1?c:l+8),u===1)m=e.readInt32(!r);else{m=[];for(let x=0;x<u;x++)m.push(e.readInt32(!r))}break;case 5:case 10:if(e.setHead(c),u===1){const x=e.readInt32(!r),_=e.readInt32(!r);m=x/_}else{m=[];for(let x=0;x<u;x++){const _=e.readInt32(!r),f=e.readInt32(!r),y=_/f;m.push(y)}}break}o[d]=m,n[d]={value:m,numValues:u,entryOffset:l,valueOffset:c,type:p}}}return{tags:o,tagData:n}}getBuffer(){return this._buf}}var Kl=Af;const{MARKERS:If}=tr;class Bf{constructor(e){this._buf=e,this._stream=new ni(this._buf),this._stream.setHead(0)}isValid(){this._stream.setHead(0);const e=this._stream.readInt16();if(e!==If.APP0)return!1;const t=this._stream.readInt16();if(!(t>=16))return!1;const i=this._stream.readString(4),r=this._stream.readInt8();return i==="JFIF"?r===0:!1}setUnitDensity(e){this._stream.setHead(11),this._stream.writeInt8(e)}setDensityX(e){this._stream.setHead(12),this._stream.writeInt16(e)}setDensityY(e){this._stream.setHead(14),this._stream.writeInt16(e)}getUnitDensity(){return this._stream.setHead(11),this._stream.readInt8()}getDensityX(){return this._stream.setHead(12),this._stream.readInt16()}getDensityY(){return this._stream.setHead(14),this._stream.readInt16()}getBuffer(){return this._buf}}var un=Bf;const{invariant:c0}=S,{MARKERS:Mr}=tr,vs="data:image/jpeg;base64,",Mf=new RegExp(`^${vs}`,"i");class qt{constructor(e){this._buf=e,this._stream=new ni(this._buf),this._stream.setHead(0),this._segments=this._sliceIntoSegments(this._buf),this._exifData=new Kl(this._getMarkerBuffer(Mr.EXIF)),this._jfifData=new un(this._getMarkerBuffer(Mr.JFIF))}static toDataURL(e){return vs+Ze.encode(e)}static fromDataURL(e){const t=e.replace(vs,""),i=Ze.decode(t);return i}restoreSegmentsInArray(e){return e=this.restoreExifTagsToImageData(e),this.restoreJfifSegmentToImageData(e)}restoreSegments(e){let t=qt.fromDataURL(e);return t=this.restoreSegmentsInArray(t),qt.toDataURL(t)}restoreExifTagsToImageData(e){if(!this._exifData.isValid())return e;const t=this._sliceIntoSegments(e),i=t[1][0],r=e.slice(0,i),s=e.slice(i);let o=r.concat(this._exifData.getBuffer());return o=o.concat(s),o}restoreJfifSegmentToImageData(e){if(!this._jfifData.isValid())return e;const t=this._sliceIntoSegments(e),i=this._findSegment(Mr.JFIF,t);let r=[];if(i){const s=i[0],o=i[1],n=e.slice(0,s),a=e.slice(s,o),l=e.slice(o),d=new un(a);d.setDensityX(this._jfifData.getDensityX()),d.setDensityY(this._jfifData.getDensityY()),d.setUnitDensity(this._jfifData.getUnitDensity()),r=n.concat(a).concat(l)}else return e;return r}restoreExifTags(e){const t=qt.fromDataURL(e),i=this.restoreExifTagsToImageData(t);return qt.toDataURL(i)}restoreJfifSegment(e){if(!this._jfifData.isValid())return e;const t=qt.fromDataURL(e),i=this.restoreJfifSegmentToImageData(t);return qt.toDataURL(i)}setOrientation(e){return this._exifData.setOrientation(e)}static isJPEG(e){return Mf.test(e)}static bufferIsJPEG(e){return e[0]===255&&e[1]===216&&e[2]===255}static fromBase64String(e){const t=e.replace(vs,""),i=Ze.decode(t);return new qt(i)}_findSegment(e,t=this._segments){for(let i=0;i<t.length;i++){const r=t[i][0],s=t[i][1];this._stream.setHead(r);const o=this._stream.peekInt16();if(o===e)return[r,s]}return!1}_getLastSegment(e=this._segments){return e[e.length-1]}_getMarkerBuffer(e,t=this._segments){const i=this._findSegment(e,t);if(i){const r=i[0],s=i[1];return this._buf.slice(r,s)}return!1}_sliceIntoSegments(e){const t=new ni(e),i=[];for(;t.getHead()<e.length;){const r=t.readInt16();if(r===Mr.SOI)continue;if(r===Mr.SOS)break;if(r>=65280&&r<=65535){const s=t.readInt16(),o=t.getHead()+s-2;i.push([t.getHead()-4,o]),t.setHead(o)}else throw new Error(`Invalid marker: 0x${r.toString(16)}`)}return this._stream.setHead(0),i}getTags(){return this._exifData.getTags()}getTagData(){return this._exifData.getTagData()}dispose(){this._buf=[],this._segments=[]}}var ir=qt;class jl extends Pe{constructor(e=[]){super();this._onOperationUpdate=this._onOperationUpdate.bind(this),this._cacheEnabled=!0,this._stack=e,this._stack.forEach(t=>{t.on("update",this._onOperationUpdate)})}clear(){this.forEach(e=>this.remove(e)),this._stack=[]}hasChanges(){return this._stack.filter(e=>!!e).some(e=>e.hasChanges())}_onOperationUpdate(e,t){this.emit(Qi.OPERATION_UPDATED,e,t)}enableCache(){this._cacheEnabled=!0}disableCache(){this._cacheEnabled=!1}forEach(e){return this._stack.filter(t=>!!t).forEach(e)}render(e,t){const i=t,r=this._stack.filter(l=>!!l).filter(l=>l.getEnabled());r.reverse();const s=r.filter(l=>!l.isDirtyForRenderer(e.getRenderer()))[0],o=r.indexOf(s);r.reverse();let n=0;o!==-1&&(n=r.length-o-1);for(let l=0;l<n;l++)k.info(this.constructor.name,`Skipping ${r[l].constructor.name}`);let a=N.resolve(i);for(let l=n;l<r.length;l++){const d=r[l];let p,u;a=a.then(c=>d.render(c).then(m=>(p&&m!==p&&!this._cacheEnabled&&u.disposeRenderTextures(),p=m,u=d,m)))}return a.then(l=>{const d=!r.some(p=>p.isDirtyForRenderer(e.getRenderer()));return{outputTexture:l,renderDone:d}})}validateSettings(){return N.all(this._stack.filter(e=>!!e).map(e=>e.validateSettings()))}setAllToDirty(e=!1){this.forEach(t=>t.setDirty(!0,e))}updateDirtinessForRenderer(e){let t=!1;for(let i=0;i<this._stack.length;i++){const r=this._stack[i];if(!r)continue;r.isDirtyForRenderer(e)&&(t=!0),t&&r.setDirtyForRenderer(!0,e)}}push(e){this._stack.push(e),e.on("update",this._onOperationUpdate)}pop(){const e=this._stack.pop();e&&(e.off("update",this._onOperationUpdate),e.dispose())}unshift(e){this._stack.unshift(e),e.on("update",this._onOperationUpdate)}clone(){return new jl(this._stack.slice(0))}get(e){return this._stack[e]}getByIdentifier(e){return S.Array.find(this._stack,t=>t&&t.constructor.identifier===e)}getIndexByIdentifier(e){return S.Array.findIndex(this._stack,t=>t&&t.constructor.identifier===e)}moveToTop(e){const t=S.Array.findIndex(this._stack,r=>r&&r.constructor.identifier===e);if(t<0||t===this._stack.length-1)return;const i=this.getByIdentifier(e);this._stack.splice(t,1),this._stack[this._stack.length]=i}set(e,t){this._stack[e]&&(this._stack[e].off("update",this._onOperationUpdate),this._stack[e].dispose()),this._stack[e]=t,t.on("update",this._onOperationUpdate)}remove(e){const t=this._stack.indexOf(e);if(t===-1)return;this._stack[t]&&(this._stack[t].off("update",this._onOperationUpdate),this._stack[t].dispose()),this._stack.splice(t,1)}removeAt(e){this._stack[e]&&(this._stack[e].off("update",this._onOperationUpdate),this._stack[e].dispose()),delete this._stack[e]}getStack(){return this._stack}dispose(){this.forEach(e=>{e.dispose()})}}var ws=jl;const Wl=typeof window!="undefined"&&window.performance&&window.performance.now?window.performance.now.bind(window.performance):wi();class Lf{constructor(e,t){this._tag=e,this._name=t,this._start=Wl()}stop(){const e=Wl(),t=e-this._start,i=Math.round(1e3/t);k.info(this._tag,`${this._name} took ${t.toFixed(2)}ms (${i} FPS)`)}}var Ss=Lf;class Vl extends G{constructor(e,t={}){super(t,{enabled:{type:h.BOOLEAN,default:!0,serializable:!1}});this._sdk=e,this._cacheEnabled=!1,this._dirtiness={},this._sprite=new T.Sprite,this._container=new T.Container,this._container.addChild(this._sprite)}_onOptionsChange(){this.setDirty(!0)}render(e){if(!this.getEnabled())return k.info(this.constructor.name,"Disabled - skipping"),N.resolve(e);if(!this._renderTexture){const s=e.getDimensions().floor();this._renderTexture=new T.RenderTexture(this._sdk.getRenderer(),s.x,s.y)}const t=this._sdk.getRenderer();let i,r;if(k.canLog("info")&&(r=new Ss(this.constructor.name,"Rendering")),this.isDirtyForRenderer(t)){this._sprite.setTexture(e);const s=this.getNewDimensions(e.getDimensions()).floor();this._renderTexture.resizeTo(s),this._renderTexture.clear(),i=this._render(e).then((o=!1)=>(this.setDirtyForRenderer(o,t),this._renderTexture))}else k.info(this.constructor.name,"Rendering from cache"),i=N.resolve(this._renderTexture);return i.then(s=>(r&&r.stop(),s))}_render(e){let t;return this._sdk.getRenderer().isOfType(q.WEBGL)?t=this._renderWebGL.bind(this):t=this._renderCanvas.bind(this),t(e)}_renderWebGL(e){throw new Error("Operation#_renderWebGL is abstract and not implemented in inherited class.")}_renderCanvas(e){throw new Error("Operation#_renderCanvas is abstract and not implemented in inherited class.")}getNewDimensions(e){return e.clone()}onBeforeExport(){this.transform&&this._tempTransformChange&&this.transform(this._tempTransformChange),this._onBeforeExport()}onAfterExport(){this.transform&&this._tempInverseTransformChange&&this.transform(this._tempInverseTransformChange),this._onAfterExport()}_onBeforeExport(){}_onAfterExport(){}setTemporaryTransformChange(e,t){this._tempTransformChange=e,this._tempInverseTransformChange=t}reset(){this._dirty=!0,this._glslPrograms={}}isDirtyForRenderer(e){const t=this._dirtiness[e.id];return typeof t=="undefined"?!0:t}setDirtyForRenderer(e,t,i=!1){this._dirtiness[t.id]=e}setDirty(e,t=!1){for(const i in this._dirtiness)this.setDirtyForRenderer(e,{id:i},t)}getSDK(){return this._sdk}getInputDimensions(e=!0){let t=this._sdk.getInputDimensions();e&&t.multiply(this._sdk.getZoom()).floor();let i;return this._sdk.getOperationsStack().forEach(r=>{if(i)return;if(r===this){i=!0;return}t=r.getNewDimensions(t)}),t.floor()}clone(){const e=this.constructor;return new e(this._sdk,this.serializeOptions())}disposeRenderTextures(){this._renderTexture&&this._renderTexture.dispose(),this._renderTexture=null}dispose(){this.disposeRenderTextures(),this._sprite.dispose()}}Vl.identifier=null;var J=Vl;const{OptionType:Nf}=me;class mn extends J{getRotation(){let e=0;switch(this.getTags().Orientation){case 7:case 8:e=-90;break;case 3:case 4:e=-180;break;case 5:case 6:e=90;break}return e}_getFlipVertically(){const{Orientation:e}=this.getTags();return[5,7].indexOf(e)!==-1}_getFlipHorizontally(){const{Orientation:e}=this.getTags();return[2,4].indexOf(e)!==-1}_getFinalOptions(){return{rotation:this.getRotation(),flipVertically:this._getFlipVertically(),flipHorizontally:this._getFlipHorizontally()}}_render(e){const t=this._getFinalOptions(),i=t.rotation%360,r=i*(Math.PI/180);this._sprite.setScale(t.flipHorizontally?-1:1,t.flipVertically?-1:1),this._sprite.setRotation(r),this._sprite.setAnchor(.5,.5),this._sprite.updateTransform();const s=this._sprite.getBounds();return this._renderTexture.resizeTo(new B(s.width,s.height)),this._sprite.setPosition(this._renderTexture.getDimensions().divide(2)),this._renderTexture.render(this._container),N.resolve()}getNewDimensions(e){const t=this._getFinalOptions();return e=e.clone(),t.rotation%180&&e.flip(),e}applyTo(e){const t=this._getFinalOptions(),i=S.createCanvas();Math.abs(t.rotation%180)===90?(i.width=e.height,i.height=e.width):(i.width=e.width,i.height=e.height);const r=i.getContext("2d"),s=t.rotation*Math.PI/180,o=.5*(i.width-e.width),n=.5*(i.height-e.height);return r.translate(o,n),r.translate(.5*e.width,.5*e.height),r.rotate(s),r.translate(-.5*e.width,-.5*e.height),t.flipVertically&&(r.translate(0,e.height),r.scale(1,-1)),t.flipHorizontally&&(r.translate(e.width,0),r.scale(-1,1)),r.drawImage(e,0,0),i}}mn.identifier="exif-orientation";mn.prototype.availableOptions={tags:{type:Nf.OBJECT,default:{}}};var Hl=mn;const rr={};xe(rr,{ExifOrientationOperation:()=>Hl});class ql extends G{constructor(e,t={}){super(t);this._sdk=e}export(){const{imageFormat:e}=this._options,t=i=>i.renderDone?i:this._sdk.render().then(r=>t(r));return this.validateSettings().then(()=>this._prepareSDK().then(i=>t(i))).then(i=>{const{outputTexture:r,renderDone:s}=i,o=this._sdk.getRenderer();let n=o.getCanvas();return o.isOfType(q.WEBGL)&&(n=this._createCanvasFromTexture(r)),this._encodeImageFormat(n)}).then(i=>this._restoreExifMetadata(i,e)).then(i=>this._restoreSDK().then(()=>i))}_restoreExifMetadata(e,t,i){if(t===_t.JPEG){const r=this._sdk.getExif();if(r&&(process.env.REACT_APP_BROWSER&&(typeof e=="string"&&(e=r.restoreSegments(e))),!process.env.REACT_APP_BROWSER)){const{renderType:s}=this._options;s===Ie.BUFFER?e=Buffer.from(r.restoreSegmentsInArray([...e])):s===Ie.DATAURL&&typeof e=="string"&&(e=r.restoreSegments(e))}}return Promise.resolve(e)}_encodeAsDataURL(e,t,i){return S.isBrowser?Promise.resolve(e.toDataURL(t,i)):new Promise((r,s)=>{e.toDataURL(t,i,(o,n)=>{o?s(o):r(n)})})}_encodeAsHTMLImage(e,t,i){return this._encodeAsDataURL(e,t,i).then(r=>{const s=new Se;return s.src=r,Promise.resolve(s)})}_encodeAsBuffer(e,t,i){return process.env.REACT_APP_BROWSER?Promise.reject(new Error("Unsupported platform for RenderType")):t===_t.JPEG?Promise.resolve(e.toBuffer(t,{quality:i,progressive:!0,chromaSubsampling:!1})):t===_t.PNG?Promise.resolve(e.toBuffer(t,{quality:i})):t===_t.RAW?Promise.resolve(e.toBuffer(t)):Promise.reject(new Error(`Unsupported imageFormat: ${t}`))}_encodeAsMSBlob(e,t,i){return Promise.resolve(e.msToBlob())}_encodeAsBLOB(e,t,i){return new Promise((r,s)=>{e.toBlob(o=>{r(o)},t,i)})}_encodeImageFormat(e){const{imageFormat:t,quality:i}=this._options;let{renderType:r}=this._options;r===Ie.BLOB&&e.msToBlob&&!e.toBlob&&(r=Ie.MSBLOB);switch(r){case Ie.IMAGE:return this._encodeAsHTMLImage(e,t,i);case Ie.DATAURL:return this._encodeAsDataURL(e,t,i);case Ie.BUFFER:return this._encodeAsBuffer(e,t,i);case Ie.MSBLOB:return this._encodeAsMSBlob(e,t,i);case Ie.BLOB:return this._encodeAsBLOB(e,t,i)}return Promise.reject(new Error(`Unsupported RenderType: ${r}!`))}_prepareSDK(){const e=this._sdk.getRenderer();this._sdkSettings={dimensions:e.getDimensions().clone(),textureQuality:this._sdk.getTextureQuality(),pixelRatio:this._sdk.getPixelRatio(),renderMode:this._sdk.getRenderMode()},this._sdk.setRenderMode("export"),this._sdk.setTextureQuality(1);const t=e.isOfType(q.CANVAS);e.setPixelRatio(1),e.resizeTo(this._sdk.getFinalDimensions(),t),this._sdk.setAllOperationsToDirty(!0);const i=this._sdk.getOperationsStack();return i.forEach(r=>{r.disposeRenderTextures()}),i.disableCache(),this._sdk.render()}_restoreSDK(){const e=this._sdk.getOperationsStack();e.enableCache(),this._sdk.setRenderMode(this._sdkSettings.renderMode);const t=this._sdk.getRenderer(),i=t.isOfType(q.CANVAS);return t.setPixelRatio(this._sdkSettings.pixelRatio),t.resizeTo(this._sdkSettings.dimensions,i),this._sdk.setTextureQuality(this._sdkSettings.textureQuality),this._sdk.setAllOperationsToDirty(!0),this._sdk.render()}_createCanvasFromTexture(e){const t=this._sdk.getRenderer(),i=this._sdk.getFinalDimensions(),r=this._sdk.getRenderer().getContext(),s=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,s);const o=e.getBaseTexture().getGLTextureForRenderer(t);r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,o,0);const n=new Uint8Array(i.x*i.y*4);r.readPixels(0,0,i.x,i.y,r.RGBA,r.UNSIGNED_BYTE,n);const a=this._checkPixelsForTransparency(n);let l;if(a){const c=new T.Sprite(e);c.setFilters([new T.Filters.UnpremultiplyFilter]);const m=new T.Container;m.addChild(c),l=new T.RenderTexture(t,i.x,i.y),l.render(m);const x=l.getBaseTexture().getGLTextureForRenderer(t);r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,x,0),r.readPixels(0,0,i.x,i.y,r.RGBA,r.UNSIGNED_BYTE,n),t.setRenderTarget(),l.dispose()}const d=S.createCanvas();d.width=i.x,d.height=i.y;const p=d.getContext("2d"),u=p.createImageData(i.x,i.y);return u.data.set(n),p.putImageData(u,0,0),r.deleteFramebuffer(s),d}_checkPixelsForTransparency(e){const t=this._sdk.getFinalDimensions(),i=t.x*t.y*4;let r;for(let s=3;s<i;s+=4)if(r=e[s],r!==255)return!0;return!1}}ql.prototype.availableOptions={renderType:{type:h.STRING,available:S.values(Ie),default:Ie.IMAGE},imageFormat:{type:h.STRING,available:S.values(_t),default:_t.PNG},quality:{type:h.NUMBER,default:.8}};var Yl=ql;const se=e=>Lr.byteArrayToString(zf.decode(e)),{Rectangle:Gf,Constants:Uf,Engine:at,Utils:Lr,EventEmitter:Kf,Events:fn,Vector2:gn,Log:lt,Base64:zf,Color:jf}=Br,{RenderType:Wf,ImageFormat:Vf,RendererType:Xl}=Uf;class Hf extends Kf{constructor(e,t={}){super();if(this._onOperationUpdate=this._onOperationUpdate.bind(this),this._onContextRestored=this._onContextRestored.bind(this),this.version="4.25.0",this[se("VG04Z1lHRndhVXRsZVdBZ2IzQjBhVzl1SUdkcGRtVnU=")]=!0,this._preferredRenderer=e,this._options=Lr.defaults(t,{extensions:{},renderMode:"dynamic",versionCheck:!0,displayWelcomeMessage:!0,image:null,canvas:null,transparent:!1,clearColor:jf.TRANSPARENT,textureQuality:1,zoom:1,spriteScale:1,rotation:0,smoothDownscaling:!1,smoothUpscaling:!1,crossOrigin:"anonymous",logLevel:"warn",pixelRatio:typeof window!="undefined"&&window.devicePixelRatio||1}),this._options.smoothUpscaling&&(at.BaseTexture.DefaultMagFilter=at.BaseTexture.LinearFilter),this._options.extensions=Lr.defaults(this._options.extensions,{operations:[],controls:[],languages:[]}),lt.setLevel(this._options.logLevel),this[se("Wm5KbFpVeHBZMlZ1YzAxdlpHVT0=")]=!1,!this[se("X29wdGlvbnM=")][se("bGljZW5zZQ==")])this[se("Wm5KbFpVeHBZMlZ1YzAxdlpHVT0=")]=!0,this._l=new Br[se("RnJlZUxpY2Vuc2VDaGVja2Vy")];else{if(!this._v())return;const r=Br[se("TGljZW5zZUNoZWNrZXI=")];this._l=new r(this[se("X29wdGlvbnM=")][se("bGljZW5zZQ==")]),this._cv(!0).then(()=>{this._ct()}).catch(s=>{lt.error(se("TGljZW5zaW5n"),s.message)})}this._defaultRenderMode=this._options.renderMode,this._renderMode=this._options.renderMode,this._textureQuality=this._options.textureQuality,this._offset=new gn,this._zoom=this._options.zoom,this._spriteScale=this._options.spriteScale,this._rotation=this._options.rotation,this._operations={},this._operationsStack=null,this.setOperationsStack(new ws),this._container=new at.Container,this._sprite=new at.Sprite,this._container.addChild(this._sprite),this._inputTexture=this._options.inputTexture,this._currentInputTexture=null,this._currentTexture=null,this._resizedTexture=null,this._resizedContainer=new at.Container,this._resizedSprite=new at.Sprite,this._resizedContainer.addChild(this._resizedSprite),this._texturesToDispose=[],this.setSmoothDownscaling(this._options.smoothDownscaling),this._registerOperations(),this._initRenderer();const i=this._renderer.constructor.type;this._options.displayWelcomeMessage&&(process.env.REACT_APP_BROWSER||lt.log("Version:",`${this.version} (${i}) - https://www.photoeditorsdk.com`)),this[se("Wm5KbFpVeHBZMlZ1YzAxdlpHVT0=")]&&lt.log(se("VGhlIFBob3RvRWRpdG9yIFNESyBpcyBhIGNvbW1lcmNpYWwgcHJvZHVjdC4gQmVmb3JlIGJlaW5nIGFibGUgdG8gdXNlIGl0IHdpdGhvdXQgbGltaXRhdGlvbnMsIHlvdSBuZWVkIHRvIHVubG9jayB0aGUgU0RLIHdpdGggYSBsaWNlbnNlIGZpbGUuIFlvdSBjYW4gb2J0YWluIGEgdGltZS1saW1pdGVkIGV2YWx1YXRpb24gbGljZW5zZSBieSBzdGFydGluZyBhIHRyaWFsIGF0IGh0dHBzOi8vd3d3LnBob3RvZWRpdG9yc2RrLmNvbS91c2Vycy9uZXcgb3IgeW91IGNhbiBwdXJjaGFzZSBhIGxpY2Vuc2UgYnkgcmVxdWVzdGluZyBhIHF1b3RlIGF0IGh0dHBzOi8vd3d3LnBob3RvZWRpdG9yc2RrLmNvbS9wcmljaW5nLgoKQmVjYXVzZSB5b3UgZGlkIG5vdCBzcGVjaWZ5IGEgbGljZW5zZSBmaWxlIHlldCwgdGhlIFNESyB3aWxsIG5vdyBkaXNwbGF5IGEgd2F0ZXJtYXJrIGltYWdlIG9uIHRvcCBvZiBhbnkgcGhvdG9zIHlvdSBkaXNwbGF5IG9yIGV4cG9ydCB3aXRoIGl0LiBGb3IgaW5zdHJ1Y3Rpb25zIGZvciBob3cgdG8gdW5sb2NrIHRoZSBTREssIHBsZWFzZSB2aXNpdCBodHRwczovL2RvY3MucGhvdG9lZGl0b3JzZGsuY29tL2d1aWRlcy9odG1sNS92NC9pbnRyb2R1Y3Rpb24vZ2V0dGluZ19zdGFydGVkLg==")),this._options.image&&this.setImage(this._options.image,this._options.exif)}_v(){return this[se("X29wdGlvbnM=")][se("bGljZW5zZQ==")]?!0:(lt.error(se("TGljZW5zaW5n"),se("Tm8gYGxpY2Vuc2VgIG9wdGlvbiBnaXZlbi4=")),lt.error(se("TGljZW5zaW5n"),se("SW4gY2FzZSB5b3UgZG9uJ3QgaGF2ZSBhIGxpY2Vuc2UgeWV0LCBwbGVhc2UgY29udGFjdCBvdXIgc2FsZXMgc3RhZmYgYXQgc2FsZXNAcGhvdG9lZGl0b3JzZGsuY29tIHRvIG9idGFpbiBhIGxpY2Vuc2Ugb3IgbG9nIGluIHRvIHlvdXIgY3VzdG9tZXIgZGFzaGJvYXJkLg==")),!1)}_ct(){if(this._l.exp()){const e=this._l.isExp();e?lt.error(se("TGljZW5zaW5n"),se("WW91ciB0cmlhbCBsaWNlbnNlIGhhcyBleHBpcmVkLiBQbGVhc2UgY29udGFjdCB1cyBhdCBzYWxlc0BwaG90b2VkaXRvcnNkay5jb20gdG8gb2J0YWluIGEgbGljZW5zZS4=")):lt.warn(se("TGljZW5zaW5n"),se("WW91ciB0cmlhbCBsaWNlbnNlIHdpbGwgZXhwaXJlIGluICVkIGRheXMu").replace("%d",this._l.dl()))}}_cv(e=!1){return this._l.c().catch(t=>{this[se("VG04Z1lHRndhVXRsZVdBZ2IzQjBhVzl1SUdkcGRtVnU=")]=!1;let i=se("SW52YWxpZCBsaWNlbnNlLg==");throw e&&(t.code==="ELICEXP"?i=se("WW91ciB0cmlhbCBsaWNlbnNlIGhhcyBleHBpcmVkLiBQbGVhc2UgY29udGFjdCB1cyBhdCBzYWxlc0BwaG90b2VkaXRvcnNkay5jb20gdG8gb2J0YWluIGEgbGljZW5zZS4="):t.code==="ELICINVHOST"?i=`${se("VGhpcyBsaWNlbnNlIGlzIG5vdCB2YWxpZCBmb3IgdGhlIGhvc3RuYW1lIA==")+window.location.hostname}.`:t.code==="ELICINVPLAT"?i=se("VGhpcyBsaWNlbnNlIGlzIG5vdCB2YWxpZCBmb3IgdGhlIGN1cnJlbnQgcGxhdGZvcm0u"):t.code==="ELICINVFMT"?i=se("SW52YWxpZCBsaWNlbnNlIGZvcm1hdC4gUGxlYXNlIG1ha2Ugc3VyZSB5b3UncmUgcGFzc2luZyB5b3VyIGxpY2Vuc2UgYXMgYSBzdHJpbmcsIG5vdCBhcyBgJGZvcm1hdGAu").replace("$format",typeof this._options.license):t.code==="ELICINV"?i=se("SW52YWxpZCBsaWNlbnNlISBQbGVhc2UgY29udGFjdCBvdXIgc2FsZXMgc3RhZmYgYXQgc3VwcG9ydEBwaG90b2VkaXRvcnNkay5jb20gdG8gb2J0YWluIGEgbGljZW5zZSBvciBsb2cgaW4gdG8geW91ciBjdXN0b21lciBkYXNoYm9hcmQu"):i=se("SW4gY2FzZSB5b3UgZG9uJ3QgaGF2ZSBhIGxpY2Vuc2UgeWV0LCBwbGVhc2UgY29udGFjdCBvdXIgc2FsZXMgc3RhZmYgYXQgc2FsZXNAcGhvdG9lZGl0b3JzZGsuY29tIHRvIG9idGFpbiBhIGxpY2Vuc2Ugb3IgbG9nIGluIHRvIHlvdXIgY3VzdG9tZXIgZGFzaGJvYXJkLg==")),t.message=i,new Error(t)})}_t(){this._l.t()}_fl(){return this[se("Wm5KbFpVeHBZMlZ1YzAxdlpHVT0=")]}_onOperationUpdate(...e){this.emit(fn.OPERATION_UPDATED,...e)}_onContextRestored(){lt.warn(this.constructor.name,"Trying to re-render after WebGL context has been restored."),this.setAllOperationsToDirty(),this._operationsStack.forEach(e=>{e.disposeRenderTextures()}),this.render()}export(e=Wf.DATAURL,t=Vf.PNG,i=.8){return this._cv(!0).then(()=>{this.hasChanges()&&this._t(),this._operationsStack.forEach(s=>{s.onBeforeExport()});const r=new Yl(this,{renderType:e,imageFormat:t,quality:i});return r.export().then(s=>(this._operationsStack.forEach(o=>{o.onAfterExport()}),Promise.resolve(s)))})}render(e=!0){if(!this._inputTexture)throw new Error("You need to set an image before calling PhotoEditorSDK#render.");const t=this._renderer.getContext();t.startFrame&&t.startFrame();let i;lt.canLog("info")&&(i=new Ss("⚡⚡⚡","Frame rendering")),lt.info("⚡⚡⚡","Rendering starts");const r=this._operationsStack;return r.updateDirtinessForRenderer(this._renderer),this._prepareTexture().then(s=>{this._renderMode==="export"&&(s=this._inputTexture),this._currentTexture=s,this._sprite.setTexture(s),this._container.updateTransform()}).then(()=>r.validateSettings()).then(()=>((this._fl()||!this[se("VG04Z1lHRndhVXRsZVdBZ2IzQjBhVzl1SUdkcGRtVnU=")])&&(r.getByIdentifier("license-watermark")?r.moveToTop("license-watermark"):this.createOperation("license-watermark")),r.render(this,this._currentTexture))).then(s=>{const{outputTexture:o}=s;this._currentTexture=o,this._sprite.setTexture(this._currentTexture);switch(this._renderMode){case"dynamic":{const n=this._renderer.getDimensions().clone().divide(2).add(this._offset);this._container.setScale(this._zoom/this.getTextureScale(),this._zoom/this.getTextureScale()),this._container.setPosition(n),this._sprite.setAnchor(.5,.5),this._sprite.setScale(this._spriteScale,this._spriteScale),this._sprite.setRotation(this._rotation);break}case"export":this._container.setScale(1,1),this._container.setPosition(0,0),this._sprite.setAnchor(0,0),this._sprite.setPosition(0,0),this._sprite.setScale(this._spriteScale,this._spriteScale),this._sprite.setRotation(0);break;case"adapter":this._container.setScale(1,1),this._container.setPosition(0,0),this._sprite.setAnchor(0,0),this._sprite.setPosition(0,0),this._sprite.setScale(1,1),this._sprite.setRotation(0);break}return e&&this._renderer.render(this._container),s}).then(s=>(i&&i.stop(),t.endFrame&&t.endFrame(),this._disposeTextures(),s))}getTextureScale(){return Math.min(1,this._textureQuality*this._options.pixelRatio)}_prepareTexture(){return new Promise((e,t)=>{const i=this.getTextureScale();if(this._textureQuality===1)return e(this._inputTexture);const r=this.getInputDimensions().multiply(i).floor();let s;this._resizedTexture?this._resizedTexture.getDimensions().equals(r)||(this._resizedTexture.resizeTo(r),s=!0):(this._resizedTexture=new at.RenderTexture(this._renderer,r.x,r.y),s=!0),s&&(this._resizedSprite.setScale(i,i),this._resizedSprite.setTexture(this._inputTexture),this._resizedTexture.render(this._resizedContainer)),e(this._resizedTexture)})}_registerOperations(){this._operations={};for(const e in rr){const t=rr[e];this._operations[t.identifier]=t}this._operations=Lr.extend(this._operations,this._options.extensions.operations)}registerOperations(e){e.forEach(t=>{this._operations[t.identifier]=t})}setAllOperationsToDirty(e=!1){this._operationsStack.setAllToDirty(e)}createOperation(e,t={},i=!0){const r=this._operations[e];if(!r)throw new Error(`No operation with identifier \`${e}\` found.`);const s=new r(this,t);return i&&this.addOperation(s),s}addOperation(e){this._operationsStack.push(e)}removeOperation(e){this._operationsStack.remove(e)}getInputDimensions(){const e=this._inputTexture.getFrame();return new gn(e.width,e.height)}getFinalDimensions(e=!1){let t=this.getInputDimensions();const i=this._operationsStack;return i.forEach(r=>{if(!r.getEnabled())return;t=r.getNewDimensions(t)}),e&&t.multiply(this._spriteScale),t.floor()}getOutputDimensions(e=!1){return this.getFinalDimensions(e).clone().multiply(this._zoom).floor()}getOutputTextureDimensions(e=!1){const t=this.getTextureScale();let i=this.getInputDimensions().multiply(t).floor();return this._operationsStack.forEach(r=>{i=r.getNewDimensions(i)}),i}getCrossOrigin(){return Lr.getCrossOrigin(this._options.crossOrigin||"Anonymous")}_initRenderer(){const e={canvas:this._options.canvas,pixelRatio:this._options.pixelRatio,debug:this._options.debug,transparent:this._options.transparent,clearColor:this._options.clearColor};let t,i;if(this._renderMode!=="export"&&this._options.canvas){const{canvas:r}=this._options;t=r.width,i=r.height}else if(this._inputTexture){const r=this.getFinalDimensions();t=r.x,i=r.y}else t=1,i=1;switch(this._preferredRenderer){case Xl.WEBGL:this._renderer=at.autoDetectRenderer(t,i,e),this._renderer.on("context-restored",this._onContextRestored);break;case Xl.CANVAS:this._renderer=new at.CanvasRenderer(t,i,e),this._renderer.on("context-restored",this._onContextRestored);break;default:lt.warn("PhotoEditorSDK",`PhotoEditorSDK Error: Renderer \`${this._preferredRenderer}\` not supported. Falling back to automatically detected renderer.`),this._renderer=at.autoDetectRenderer(t,i,e)}}resizeTo(e){this._renderer.resizeTo(e,!0)}reset(){this._operationsStack.clear()}parseExif(e){if(!e)return;let{src:t}=e,i=!1,r=null;if(process.env.REACT_APP_BROWSER)i=ir.isJPEG(t),r=t;else if(e instanceof Se&&e.rawSource){let s=e.rawSource;if(e.rawSource instanceof Buffer)t=e.rawSource.toString("base64");else{const o=e.rawSource.replace("data:image/jpeg;base64,","");s=Buffer.from(o,"base64"),t=e.rawSource}i=ir.bufferIsJPEG(s),i&&(r=t)}if(i){let s=null;try{s=ir.fromBase64String(r)}catch(o){}return s||void 0}}_handleExifOrientation(){const e=this._exif.getTags();if(e&&e.Orientation){const t=e.Orientation!==1&&e.Orientation!==2,i=[2,4,5,7].indexOf(e.Orientation)!==-1;if(t||i){if(typeof navigator=="undefined")this._exifOperation||(this._exifOperation=this.createOperation("exif-orientation")),this._exifOperation.setTags(e);else{const r=window&&window.navigator&&window.navigator.userAgent||"";(!!r.match(/msie|trident/i)||r.indexOf("Edge")!==-1||!CSS.supports("image-orientation","from-image"))&&(this._exifOperation||(this._exifOperation=this.createOperation("exif-orientation")),this._exifOperation.setTags(e))}this._exif.setOrientation(1)}}}correctExifOrientation(e){const t=this.parseExif(e);if(!t)return e;const i=t.getTags();if(i&&i.Orientation){const r=i.Orientation!==1&&i.Orientation!==2,s=[2,4,5,7].indexOf(i.Orientation)!==-1;if(r||s){if(typeof navigator=="undefined"){const o=this.createOperation("exif-orientation",{},!1);o.setTags(i),e=o.applyTo(e)}else{const o=window&&window.navigator&&window.navigator.userAgent||"";if(!!o.match(/msie|trident/i)||o.indexOf("Edge")!==-1||!CSS.supports("image-orientation","from-image")){const n=this.createOperation("exif-orientation",{},!1);n.setTags(i),e=n.applyTo(e)}}return t.setOrientation(1),i.Orientation=1,e}}return e}hasImage(){return this._image!==null&&typeof this._image!="undefined"}getImage(){return this._image}disposeTexture(e){this._texturesToDispose.push(e)}_disposeTextures(){for(let e=0;e<this._texturesToDispose.length;e++)this._texturesToDispose[e].dispose();this._texturesToDispose=[]}setImage(e,t=null,i=null){this._disposeTextures(),this._exifOperation&&(this.removeOperation(this._exifOperation),this._exifOperation=null),this._options.image=e,this._image=e,this._exif=t||this.parseExif(e),this._exif&&this._handleExifOrientation();const r=new at.BaseTexture(this._image),s=new Gf(0,0,this._image.naturalWidth||this._image.width,this._image.naturalHeight||this._image.height);i&&(s.width=i.x,s.height=i.y),this._resizedTexture&&this._resizedTexture.dispose(),this._resizedTexture=null,this._inputTexture&&this.disposeTexture(this._inputTexture.getBaseTexture()),this._inputTexture=new at.Texture(r,s),this._currentTexture=this._inputTexture,this._sprite.clearTexture(!1),this._sprite.setTexture(this._inputTexture),this.emit("new-image"),this.setAllOperationsToDirty(!0)}setInputTexture(e){this._inputTexture=e}getCanvas(){return this._renderer.getCanvas()}setCanvas(e){this._renderer.setCanvas(e)}getSprite(){return this._sprite}getContainer(){return this._container}getOperationsStack(){return this._operationsStack}setOperationsStack(e){this._operationsStack&&this._operationsStack.off(fn.OPERATION_UPDATED,this._onOperationUpdate),this._operationsStack=e,this._operationsStack.on(fn.OPERATION_UPDATED,this._onOperationUpdate)}getOperations(){return this._operations}getRenderer(){return this._renderer}getOffset(){return this._offset}setOffset(e,t){e instanceof gn?this._offset.copy(e):this._offset.set(e,t)}getRenderMode(){return this._renderMode}setRenderMode(e){this._renderMode=e}getZoom(){return this._zoom}setZoom(e){this._zoom=e,this._container.setScale(this._zoom,this._zoom),this._container.updateTransform()}getTextureQuality(){return this._renderMode==="export"?1:this._textureQuality}setTextureQuality(e){e!==this._textureQuality&&this.setAllOperationsToDirty(!0),this._textureQuality=Math.min(1,e),this._textureQuality===1&&this._resizedTexture&&(this._resizedTexture.dispose(),this._resizedTexture=null)}getSpriteScale(){return this._spriteScale}setSpriteScale(e){this._spriteScale=e,this._sprite.setScale(e,e),this._sprite.updateTransform()}getPixelRatio(){return this._options.pixelRatio}getExif(){return this._exif}getOptions(){return this._options}getInputTexture(){return this._inputTexture}setSmoothDownscaling(e){this._options.smoothDownscaling=e,this._sprite.setSmoothDownscaling(e),this._resizedSprite.setSmoothDownscaling(e)}setRotation(e){this._rotation=e}getRotation(){return this._rotation}hasChanges(){return this.getOperationsStack().hasChanges()}dispose(){this._operationsStack.dispose(),this._renderer.dispose(),this._exif&&this._exif.dispose(),this._resizedTexture&&this._resizedTexture.dispose()}}var pe=Hf;pe.version="4.25.0";pe.Math=P;pe.Operations=rr;pe.Engine=T;pe.Color=O;pe.LicenseChecker=ys;pe.Operation=J;pe.EventEmitter=Pe;pe.Utils=S;pe.Env=Gl;pe.OperationsStack=ws;pe.EXIF=ir;pe.Image=Se;pe.Promise=N;pe.Configurable=G;pe.Log=k;pe.Loaders=Uo;pe.RenderType=Ie;pe.ImageFormat=_t;pe.OptionType=h;pe.RendererType=q;pe.UniformType=D;pe.Base64=Ze;const qf={};pe.UI=qf;var F=pe;var Ql=`precision highp float;

varying vec2 v_texCoord;
uniform sampler2D u_image;

uniform float u_gamma;
uniform float u_shadows;
uniform float u_highlights;
uniform float u_whites;
uniform float u_blacks;

uniform mat4 u_colorMatrix;
uniform vec4 u_colorOffset;

const float EPSILON = 0.0000001;

float calculateLuminance(vec3 rgb) {
    // This is the luminance calculation part of the RGB to HSL formular.
    vec4 p = mix(
        vec4(rgb.gb, 0.0, -1.0 / 3.0),
        vec4(rgb.bg, -1.0, 2.0 / 3.0),
        vec4(rgb.g < rgb.b)
    );

    vec4 q = mix(
        vec4(rgb.r, p.yzx),
        vec4(p.xyw, rgb.r),
        vec4(rgb.r < p.x)
    );

    float croma = q.x - min(q.w, q.y);
    float luminance = q.x - croma * 0.5;
    return luminance;
}

vec3 map(vec3 x, float in_min, float in_max, float out_min, float out_max){
  return (x - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;
}

void main() {

  vec4 color = clamp(texture2D(u_image, v_texCoord), 0.0, 1.0);
  color.rgb /= max(color.a, EPSILON); // Revert premultiplied alpha

  // Apply gamma
  if (u_gamma != 1.0) {
    color.rgb = pow(color.rgb, vec3(1.0 / max(u_gamma, EPSILON)));
  }

  // Apply shadows and highlights
  float luminance = calculateLuminance(color.rgb);

  float shadow = u_shadows >= 0.0
    ? clamp(
          pow(luminance, 1.0 / (u_shadows + 1.0))
          + pow(luminance, 2.0 / (u_shadows + 1.0)) * -0.76
          - luminance
    , 0.0, max(u_shadows, 1.0))
    : -clamp(
          pow(luminance, 1.0 / (-u_shadows + 1.0))
          + pow(luminance, 2.0 / (-u_shadows + 1.0)) * -0.76
          - luminance
    , 0.0, max(-u_shadows, 1.0));

  float highlight = u_highlights < 0.0
    ? clamp(
          1.0
          - pow(1.0 - luminance, 1.0 / (1.0 - u_highlights))
          - pow(1.0 - luminance, 2.0 / (1.0 - u_highlights)) * -0.8
          - luminance
     , -1.0, 0.0)
    : -clamp(
          1.0
          - pow(1.0 - luminance, 1.0 / (1.0 + u_highlights))
          - pow(1.0 - luminance, 2.0 / (1.0 + u_highlights)) * -0.8
          - luminance
     , -1.0, 0.0);

  // Bright color need more contrast and dark color need more brightness.
  // This is to keep saturatation because the color information of a dark colors is lost.
  float shadowContrast   = shadow * luminance * luminance;
  float shadowBrightness = shadow - shadowContrast;

  float offset = luminance + shadowContrast + highlight;
  color.rgb = clamp(offset * ((color.rgb + shadowBrightness) / max(luminance, EPSILON)), 0.0, 1.0);
  
  // Apply Color Matrix
  color.rgb = clamp(color * u_colorMatrix + u_colorOffset, 0.0, 1.0).rgb;
  color.rgb = map(color.rgb, 0.0, 1.0, u_blacks / 2.0, 1.0 + u_whites / 2.0);
  color = clamp(color, 0.0, 1.0);
  color.rgb *= color.a; // Reset premultiplied alpha

  gl_FragColor = color;
}
`;const{ColorMatrix:Yf}=P,sr=1e-7;function _n(e,t,i,r,s){return(e-t)*(s-r)/(i-t)+r}const Xf=e=>{const t=Math.max(e.r,e.g,e.b),i=Math.min(e.r,e.g,e.b);return(t+i)/2};class Zl extends T.Filter{constructor(){super();this._fragmentSource=Ql}_applyCanvas(e,t,i,r=!1){const s=t.getCanvas(),o=t.getContext(),n=i.getContext(),a=o.getImageData(0,0,s.width,s.height),{colorMatrix:l,gamma:d,shadows:p,highlights:u,whites:c,blacks:m}=this._options,x=d!==1,_=p!==0||u!==0;let f=new O(0,0,0,0);for(let y=0;y<s.width*s.height;y++){const b=y*4;if(f.r=a.data[b]/255,f.g=a.data[b+1]/255,f.b=a.data[b+2]/255,x&&(f.r=Math.pow(f.r,1/Math.max(d,sr)),f.g=Math.pow(f.g,1/Math.max(d,sr)),f.b=Math.pow(f.b,1/Math.max(d,sr))),_){const g=Xf(f),E=p>=0?S.clamp(Math.pow(g,1/(p+1))+Math.pow(g,2/(p+1))*-.76-g,0,Math.max(p,1)):-S.clamp(Math.pow(g,1/(-p+1))+Math.pow(g,2/(-p+1))*-.76-g,0,Math.max(-p,1)),v=u<0?S.clamp(1-Math.pow(1-g,1/(1-u))-Math.pow(1-g,2/(1-u))*-.8-g,-1,0):-S.clamp(1-Math.pow(1-g,1/(1+u))-Math.pow(1-g,2/(1+u))*-.8-g,-1,0),w=E*g*g,A=E-w,I=g+w+v;f.r=S.clamp(I*((f.r+A)/Math.max(g,sr)),0,1),f.g=S.clamp(I*((f.g+A)/Math.max(g,sr)),0,1),f.b=S.clamp(I*((f.b+A)/Math.max(g,sr)),0,1)}f=l.apply(f).clamp(0,1),f.r=_n(f.r,0,1,m/2,1+c/2),f.g=_n(f.g,0,1,m/2,1+c/2),f.b=_n(f.b,0,1,m/2,1+c/2),a.data[b]=f.r*255,a.data[b+1]=f.g*255,a.data[b+2]=f.b*255}n.putImageData(a,0,0)}}Zl.prototype.availableOptions={gamma:{type:h.NUMBER,default:1,uniformType:D.FLOAT},shadows:{type:h.NUMBER,default:0,uniformType:D.FLOAT},highlights:{type:h.NUMBER,default:1,uniformType:D.FLOAT},whites:{type:h.NUMBER,default:0,uniformType:D.FLOAT},blacks:{type:h.NUMBER,default:0,uniformType:D.FLOAT},colorMatrix:{type:h.COLOR_MATRIX,default:new Yf,uniformType:D.MAT4},colorOffset:{type:h.ARRAY,default:[],uniformType:D.FLOAT4}};var Ts=Zl;var Jl=`precision mediump float;

// Input Image with config WRAP_S and WRAP_T: CLAMP_TO_EDGE
uniform sampler2D u_image;

// Size of one pixel == vec2(1.0 / u_image.width, 1.0 / u_image.height)
uniform vec2 u_pixelDimension;

// Range (-1.0 - 1.0)
uniform float u_clarity;

varying vec2 v_texCoord;

uniform mat4 u_colorMatrix;
uniform vec4 u_colorOffset;

const float EPSILON = 0.000001;

vec4 unpremultiply(vec4 col) {
    col.rgb /= max(col.a, EPSILON);
    return col;
}

void main() {
    vec4 color = texture2D(u_image, v_texCoord);
    color = unpremultiply(color);

    // L = Left, R = Right, C = Center, T = Top, B = Bottom
    vec4 colLB = texture2D(u_image, v_texCoord + vec2(-u_pixelDimension.x, -u_pixelDimension.y));
    vec4 colLC = texture2D(u_image, v_texCoord + vec2(-u_pixelDimension.x,                 0.0));
    vec4 colLT = texture2D(u_image, v_texCoord + vec2(-u_pixelDimension.x,  u_pixelDimension.y));

    vec4 colCL = texture2D(u_image, v_texCoord + vec2(                0.0, -u_pixelDimension.y));
    vec4 colCR = texture2D(u_image, v_texCoord + vec2(                0.0,  u_pixelDimension.y));
    
    vec4 colRB = texture2D(u_image, v_texCoord + vec2( u_pixelDimension.x, -u_pixelDimension.y));
    vec4 colRC = texture2D(u_image, v_texCoord + vec2( u_pixelDimension.x,                 0.0));
    vec4 colRT = texture2D(u_image, v_texCoord + vec2( u_pixelDimension.x,  u_pixelDimension.y));

    vec4 mergedColor = color;
    mergedColor.rgb += unpremultiply(colLB).rgb + unpremultiply(colLC).rgb + unpremultiply(colLT).rgb;
    mergedColor.rgb += unpremultiply(colCL).rgb + unpremultiply(colCR).rgb;
    mergedColor.rgb += unpremultiply(colRB).rgb + unpremultiply(colRC).rgb + unpremultiply(colRT).rgb;

    mergedColor /= 9.0;

    float grayValue = clamp(color.r * 0.3 + color.g * 0.59 + color.b * 0.1, 0.111111, 0.999999);
    // 1.0 and 0.0 result in white not black, therefore we clamp

    // Here we create a function that will map values below 0.1 to 0. Values above 0.2 will be mapped to 1,
    // and for values between 0.1 and 0.2 it will produce a gradient.
    // The funtion is mirror at 0.5, meaning values between 0.8 and 0.9 will result in a decending gradient.
    // And values above 0.9 will be mapped to 0.
    float frequenceFactor = min(smoothstep(1.0 - grayValue, 0.0, 0.11), smoothstep(grayValue, 0.0, 0.11));

    // here we apply the high pass filter. Its strength is determined by the uniform ,
    // and the frequence factor. That means the only the mid tones are affected by this filter.
    // Clarity input is ranging from -1 to 1. But we want to strengthen the effect.
    // Therefore we see this little magic number '3.7'.
    color.rgb = clamp(color + clamp((color - mergedColor) * u_clarity * 3.7 * frequenceFactor, 0.0, 10.0), 0.0, 1.0).rgb;

    // apply exposure but only to the mid tones.
    color.rgb = color.rgb * pow(2.0, u_clarity * 0.27 * frequenceFactor);

    // apply contrast and desaturation matrix
    color.rgb = clamp(color * u_colorMatrix + u_colorOffset, 0.0, 1.0).rgb;

    color.rgb *= color.a; // Premultiply alpha

    gl_FragColor = clamp(color, 0.0, 1.0);
}
`;const{Vector2:Qf,ColorMatrix:Zf}=P;class $l extends T.Filter{constructor(){super();this._fragmentSource=Jl}_applyCanvas(e,t,i,r=!1){const s=i.getContext(),o=t.getCanvas(),n=t.getContext(),{clarity:a}=this._options,{colorMatrix:l}=this._options,d=new O(this._options.colorOffset[0],this._options.colorOffset[1],this._options.colorOffset[2],this._options.colorOffset[3]),{width:p}=o,{height:u}=o,c=n.getImageData(0,0,p,u),m=s.createImageData(p,u);this.canvasShader(c,m,a,l,d),s.putImageData(m,0,0)}canvasShader(e,t,i,r,s){const o=(f,y,b)=>Math.min(Math.max(f,y),b),n=(f,y,b)=>{const g=o((b-f)/(y-f),0,1);return g*g*(3-2*g)},a=e.width*4,{length:l}=e.data,d=l-1,p=0,u=e.data,c=t.data,m=new O,x=255*9,_=f=>(f=f<p?p:f,f=f>d?d:f,u[f]);for(let f=0;f<l;f+=4){let y=_(f+0),b=_(f+1),g=_(f+2),E=_(f+3);const v=(y+_(f-4-a+0)+_(f-4+0)+_(f-4+a+0)+_(f-a+0)+_(f+a+0)+_(f+4-a+0)+_(f+4+0)+_(f+4+a))/x,w=(b+_(f-4-a+1)+_(f-4+1)+_(f-4+a+1)+_(f-a+1)+_(f+a+1)+_(f+4-a+1)+_(f+4+1)+_(f+4+a+1))/x,A=(g+_(f-4-a+2)+_(f-4+2)+_(f-4+a+2)+_(f-a+2)+_(f+a+2)+_(f+4-a+2)+_(f+4+2)+_(f+4+a+2))/x,I=(E+_(f-4-a+3)+_(f-4+3)+_(f-4+a+3)+_(f-a+3)+_(f+a+3)+_(f+4-a+3)+_(f+4+3)+_(f+4+a+3))/x;y/=255,b/=255,g/=255,E/=255;const z=o(y*.3+b*.59+g*.1,.111111,.999999),H=Math.min(n(1-z,0,.11),n(z,0,.11)),U=i*3.7*H,X=Math.pow(2,i*.27*H),Q=o(y+o((y-v)*U,0,10),0,1)*X,re=o(b+o((b-w)*U,0,10),0,1)*X,Ae=o(g+o((g-A)*U,0,10),0,1)*X,Ge=o(E+o((E-I)*U,0,10),0,1);m.set(Q,re,Ae,Ge);const oe=r.apply(m).clamp(0,1);c[f+0]=oe.r*255,c[f+1]=oe.g*255,c[f+2]=oe.b*255,c[f+3]=oe.a*255}}}$l.prototype.availableOptions={clarity:{type:h.NUMBER,default:0,uniformType:D.FLOAT},pixelDimension:{type:h.VECTOR2,default:new Qf(100,100),uniformType:D.FLOAT2},colorMatrix:{type:h.COLOR_MATRIX,default:new Zf,uniformType:D.MAT4},colorOffset:{type:h.ARRAY,default:[],uniformType:D.FLOAT4}};var eh=$l;var th=`varying vec2 v_texCoord;
uniform sampler2D u_image;
uniform vec2 u_pixelDimension;
uniform float u_sharpness;
 
const float EPSILON = 0.000001;
 
void main() {
    vec4 color = clamp(texture2D(u_image, v_texCoord), 0.0, 1.0);

    float factor        = mix(0.2, -1.0, float(u_sharpness > 0.0));
    vec4 sharpenedColor = mix(0.2,  5.0, float(u_sharpness > 0.0)) * color;
 
    sharpenedColor += factor * clamp(texture2D(u_image, v_texCoord + u_pixelDimension * vec2(-1.0,  0.0)), 0.0, 1.0);
    sharpenedColor += factor * clamp(texture2D(u_image, v_texCoord + u_pixelDimension * vec2( 0.0, -1.0)), 0.0, 1.0);
    sharpenedColor += factor * clamp(texture2D(u_image, v_texCoord + u_pixelDimension * vec2( 0.0,  1.0)), 0.0, 1.0);
    sharpenedColor += factor * clamp(texture2D(u_image, v_texCoord + u_pixelDimension * vec2( 1.0,  0.0)), 0.0, 1.0);
 
    color.rgb /= max(color.a, EPSILON); // unpremultiply
    sharpenedColor.rgb /= max(sharpenedColor.a, EPSILON); // unpremultiply
 
    sharpenedColor = clamp(sharpenedColor, 0.0, 1.0);
 
    color = clamp(mix(color, sharpenedColor, abs(u_sharpness)), 0.0, 1.0);
      
    gl_FragColor = vec4(color.rgb * color.a, color.a); // premultiply
}`;const{Vector2:Jf}=P;class ih extends T.Filter{constructor(){super();this._fragmentSource=th}_applyCanvas(e,t,i,r=!1){const s=i.getContext(),o=t.getCanvas(),n=t.getContext(),{sharpness:a}=this._options,{width:l}=o,{height:d}=o,p=n.getImageData(0,0,l,d),u=s.createImageData(l,d);this.canvasShader(p,u,a),s.putImageData(u,0,0)}canvasShader(e,t,i){const r=(g,E,v)=>Math.min(Math.max(g,E),v),s=1e-6,{width:o}=e,{height:n}=e,a=e.data,l=t.data,d=(g,E,v)=>g*(1-v)+E*v,p=g=>r(a[g]/255,0,1),u=(g,E)=>{const v=r(g,0,o-1),w=r(E,0,n-1);return 4*(v+o*w)},c=[],m=[],x=[-1,0,0,1],_=[0,-1,1,0],f=i>0?-1:.2,y=i>0?5:.2,b=Math.abs(i);for(let g=0;g<o;g++)for(let E=0;E<n;E++){const v=u(g,E);c[0]=p(v+0),c[1]=p(v+1),c[2]=p(v+2),c[3]=p(v+3),m[0]=y*c[0]*c[3],m[1]=y*c[1]*c[3],m[2]=y*c[2]*c[3],m[3]=y*c[3];for(let w=0;w<4;w++){const A=x[w],I=_[w],z=u(g+A,E+I),H=p(z+3);m[3]+=f*H;for(let U=0;U<3;U++)m[U]+=f*p(z+U)*H}for(let w=0;w<3;w++)m[w]/=Math.max(m[3],s),m[w]=r(m[w],0,1);m[3]=r(m[3],0,1);for(let w=0;w<4;w++)c[w]=r(d(c[w],m[w],b),0,1),l[v+w]=c[w]*255}}}ih.prototype.availableOptions={sharpness:{type:h.NUMBER,default:0,uniformType:D.FLOAT},pixelDimension:{type:h.VECTOR2,default:new Jf(100,100),uniformType:D.FLOAT2}};var rh=ih;var sh=`precision mediump float;

// Input Image with config WRAP_S and WRAP_T: CLAMP_TO_EDGE
uniform sampler2D u_image;

// Range (-1.0 - 1.0)
uniform float u_temperature;

const lowp vec3 warmFilter = vec3(0.93, 0.54, 0.0);

const mediump mat3 RGBtoYIQ = mat3(0.299, 0.587, 0.114, 0.596, -0.274, -0.322, 0.212, -0.523, 0.311);
const mediump mat3 YIQtoRGB = mat3(1.0, 0.956, 0.621, 1.0, -0.272, -0.647, 1.0, -1.105, 1.702);

const float EPSILON = 0.0000001;

varying vec2 v_texCoord;
void main() {
  float temperature = u_temperature;
  const float tint = 0.0;
  vec4 source = texture2D(u_image, v_texCoord);

  source.rgb /= max(source.a, EPSILON);   // Revert premultiplied alpha

  vec3 yiq = RGBtoYIQ * source.rgb;
  yiq.b = clamp(yiq.b + tint*0.5226*0.1, -0.5226, 0.5226);
  vec3 rgb = YIQtoRGB * yiq;

  vec3 processed = mix(
    (1.0 - 2.0 * (1.0 - rgb) * (1.0 - warmFilter)),
    (2.0 * rgb * warmFilter),
    vec3(rgb.r < 0.5, rgb.g < 0.5, rgb.b < 0.5)
  );

  vec4 color = vec4(mix(rgb, processed, temperature), source.a);

  color.rgb *= color.a;   // Premultiply alpha again

  gl_FragColor = color;
}
`;const{Vector3:Fw}=P;class oh extends T.Filter{constructor(){super();this._fragmentSource=sh}_applyCanvas(e,t,i,r=!1){const s=i.getContext(),o=t.getCanvas(),n=t.getContext(),{temperature:a}=this._options,{width:l}=o,{height:d}=o,p=n.getImageData(0,0,l,d),u=s.createImageData(l,d);this.canvasShader(p,u,a),s.putImageData(u,0,0)}canvasShader(e,t,i){const r=(f,y,b)=>Math.min(Math.max(f,y),b),s=(f,y,b)=>f*(1-b)+y*b,o=(f,y)=>{const b=f[0]*y[0]+f[3]*y[1]+f[6]*y[2],g=f[1]*y[0]+f[4]*y[1]+f[7]*y[2],E=f[2]*y[0]+f[5]*y[1]+f[8]*y[2];return[b,g,E]},{length:n}=e.data,a=n-1,l=0,d=e.data,p=t.data,u=f=>(f=f<l?l:f,f=f>a?a:f,d[f]),c=[.93,.54,0],m=[.299,.587,.114,.596,-.274,-.322,.212,-.523,.311],x=[1,.956,.621,1,-.272,-.647,1,-1.105,1.702],_=0;for(let f=0;f<n;f+=4){const y=u(f+0)/255,b=u(f+1)/255,g=u(f+2)/255,E=u(f+3)/255,v=[y,b,g],w=o(m,v);w.z=r(w.z+_*.5226*.1,-.5226,.5226);const A=o(x,w),I=[A[0]<.5?2*A[0]*c[0]:1-2*(1-A[0])*(1-c[0]),A[1]<.5?2*A[1]*c[1]:1-2*(1-A[1])*(1-c[1]),A[2]<.5?2*A[2]*c[2]:1-2*(1-A[2])*(1-c[2])];p[f+0]=s(A[0],I[0],i)*255,p[f+1]=s(A[1],I[1],i)*255,p[f+2]=s(A[2],I[2],i)*255,p[f+3]=E*255}}}oh.prototype.availableOptions={temperature:{type:h.NUMBER,default:0,uniformType:D.FLOAT}};var nh=oh;const{ColorMatrix:Yt}=P;class Rs extends J{constructor(...e){super(...e);this._clarityFilter=new eh,this._temperatureFilter=new nh,this._sharpnessFilter=new rh,this._filter=new Ts,this._sprite.setFilters([this._clarityFilter,this._temperatureFilter,this._filter])}_render(e){const t=e.getDimensions();t.x=1/t.x,t.y=1/t.y;const i=new Yt;i.multiply(Yt.createSaturationMatrix(-.3*this._options.clarity+1)),i.multiply(Yt.createContrastMatrix(.1*this._options.clarity+1)),this._clarityFilter.set({clarity:this._options.clarity,pixelDimension:t,colorMatrix:i,colorOffset:i.getOffsets()}),this._temperatureFilter.set({temperature:this._options.temperature}),this._sharpnessFilter.set({sharpness:this._options.sharpness,pixelDimension:t});const r=new Yt;r.multiply(Yt.createExposureMatrix(this._options.exposure)),r.multiply(Yt.createSaturationMatrix(this._options.saturation+1)),r.multiply(Yt.createContrastMatrix((this._options.contrast>0?this._options.contrast*2:this._options.contrast)+1)),r.multiply(Yt.createBrightnessMatrix(this._options.brightness)),this._filter.set({gamma:this._options.gamma,shadows:this._options.shadows,highlights:this._options.highlights,whites:this._options.whites,blacks:this._options.blacks,colorMatrix:r,colorOffset:r.getOffsets()});const s=[];return this._options.clarity!==0&&s.push(this._clarityFilter),this._options.sharpness!==0&&s.push(this._sharpnessFilter),this._options.temperature!==0&&s.push(this._temperatureFilter),s.push(this._filter),this._sprite.setFilters(s),this._renderTexture.render(this._container),N.resolve()}dispose(){super.dispose(),this._filter.dispose(),this._clarityFilter.dispose(),this._temperatureFilter.dispose(),this._sharpnessFilter.dispose()}}Rs.identifier="adjustments";Rs.prototype.availableOptions={brightness:{type:h.NUMBER,default:0,minValue:-1,midValue:0,maxValue:1},saturation:{type:h.NUMBER,default:0,minValue:-1,midValue:0,maxValue:1},contrast:{type:h.NUMBER,default:0,minValue:-1,midValue:0,maxValue:1},gamma:{type:h.NUMBER,default:1,minValue:.5,midValue:1,maxValue:2},exposure:{type:h.NUMBER,default:0,minValue:-1,midValue:0,maxValue:1},shadows:{type:h.NUMBER,default:0,minValue:-2,midValue:0,maxValue:2},highlights:{type:h.NUMBER,default:0,minValue:-1,midValue:0,maxValue:1},clarity:{type:h.NUMBER,default:0,minValue:-1,midValue:0,maxValue:1},whites:{type:h.NUMBER,default:0,minValue:-1,midValue:0,maxValue:1},blacks:{type:h.NUMBER,default:0,minValue:-1,midValue:0,maxValue:1},temperature:{type:h.NUMBER,default:0,minValue:-1,midValue:0,maxValue:1},sharpness:{type:h.NUMBER,default:0,minValue:-1,midValue:0,maxValue:1}};F.Operations.AdjustmentsOperation=Rs;var ah=Rs;var lh=`/*
 * Based on evanw's glfx.js tilt shift shader:
 * https://github.com/evanw/glfx.js/blob/master/src/filters/blur/tiltshift.js
 * @license
 */

uniform sampler2D u_image;
uniform float u_blurRadius;
uniform vec2 u_delta;
uniform vec2 u_texSize;
varying vec2 v_texCoord;

float random(vec2 co)
{
    highp float a = 12.9898;
    highp float b = 78.233;
    highp float c = 43758.5453;
    highp float dt = dot(co.xy,vec2(a,b));
    highp float sn = mod(dt, 3.14);
    return fract(sin(sn) * c);
}

void main() {
    vec4 color = vec4(0.0);
    float total = 0.0;

    float offset = random(gl_FragCoord.xy / u_texSize.xy);
    float radius = u_blurRadius;

    const float steps = 30.0;

    for (float t = -steps; t <= steps; t++) {
        float percent = (t + offset - 0.5) / steps;
        float weight = 1.0 - abs(percent);

        // Somehow \`sample\` is a keyword in headless-gl
        vec4 _sample = texture2D(u_image, v_texCoord + u_delta * percent * radius / u_texSize);

        color += _sample * weight;
        total += weight;
    }

    gl_FragColor = color / total;
}
`;const{Vector2:Es}=P;class hh extends T.Filter{constructor(...e){super(...e);this._fragmentSource=lh,this._lastBlurRadius=null,this._lastDimensions=new Es(0,0),this._blurredRenderTarget=new T.CanvasRenderTarget(100,100,1)}_applyCanvas(e,t,i,r=!1,s=null){if(this._options.blurQuality==="low"){this._renderLQBlur(e,t,i,r);return}const o=t.getCanvas(),n=t.getContext(),a=i.getContext();this._lastBlurRadius===this._options.blurRadius&&a.drawImage(o,0,0);const l=n.getImageData(0,0,o.width,o.height),d=a.getImageData(0,0,o.width,o.height);let p=this._options.blurRadius;const{delta:u}=this._options,c=30;for(let m=0;m<o.width;m++)for(let x=0;x<o.height;x++){const _=m+x*o.width,f=_*4;let y=0,b=0,g=0,E=0,v=0;s&&(p=s(m/o.width,x/o.height));const w=this._random(m,1-x/o.height);for(let A=-c;A<=c;A++){const I=(A+w-.5)/c,z=1-Math.abs(I),H=u.x*I*p,U=u.y*I*p,X=Math.max(Math.min(m+H,o.width-1),0),Q=Math.max(Math.min(x+U,o.height-1),0),re=(Math.round(Q)*o.width+Math.round(X))*4,Ae=l.data[re+3],Ge=Ae*l.data[re],oe=Ae*l.data[re+1],ee=Ae*l.data[re+2];y+=Ge*z,b+=oe*z,g+=ee*z,E+=Ae*z,v+=z}y/=v,b/=v,g/=v,E/=v,d.data[f]=y/E,d.data[f+1]=b/E,d.data[f+2]=g/E,d.data[f+3]=E}a.putImageData(d,0,0),this._lastDimensions.copy(new Es(o.width,o.height))}_renderLQBlur(e,t,i,r){const s=t.getDimensions(),o=!this._lastDimensions.equals(s);this._blurredRenderTarget.setPixelRatio(t.getPixelRatio()),this._blurredRenderTarget.resizeTo(t.getDimensions()),i.setPixelRatio(t.getPixelRatio()),i.resizeTo(t.getDimensions()),(this._lastBlurRadius!==this._options.blurRadius||o)&&(this._blurImage(t,this._blurredRenderTarget,this._options.blurRadius),this._lastBlurRadius=this._options.blurRadius);const n=i.getContext();n.drawImage(this._blurredRenderTarget.getCanvas(),0,0),this._lastDimensions.copy(s)}_random(e,t){const i=12.9898,r=78.233,s=43758.5453,o=e*i+t*r,n=o-3.14*Math.floor(o/3.14),a=Math.sin(n)*s;return a-Math.floor(a)}}hh.prototype.availableOptions={blurRadius:{type:h.NUMBER,default:30,uniformType:D.FLOAT},delta:{type:h.VECTOR2,default:new Es(1,1),uniformType:D.FLOAT2},texSize:{type:h.VECTOR2,default:new Es(100,100),uniformType:D.FLOAT2},blurQuality:{type:h.STRING,default:"low"}};var Ve=hh;const{Vector2:dh}=P;class Os extends J{constructor(...e){super(...e);this._lastBlurRadius=this._options.blurRadius;const t={blurQuality:{type:h.STRING}};this._horizontalFilter=new Ve({},t),this._verticalFilter=new Ve({},t),this._sprite.setFilters([this._horizontalFilter,this._verticalFilter]),this._horizontalFilter.setDelta(new dh(.5,.5)),this._verticalFilter.setDelta(new dh(-.5,.5)),this._filter=new Ve({},t)}_renderWebGL(e){return this._renderBlur(e)}_renderCanvas(e){return this._options.highQualityCanvasBlur?this._renderBlur(e):this._renderLQCanvasBlur(e)}_renderBlur(e){const t=e.getDimensions(),i=t.min(),{blurRadius:r}=this._options,s={blurRadius:r*i,texSize:t,blurQuality:"high"};return this._horizontalFilter.set(s),this._verticalFilter.set(s),this._renderTexture.render(this._container),N.resolve()}_renderLQCanvasBlur(e){const{blurRadius:t}=this._options,i=e.getDimensions();return this._filter.set({blurRadius:t,texSize:i,blurQuality:"low"}),this._sprite.setFilters([this._filter]),this._renderTexture.render(this._container),N.resolve()}transform(e){const t=this.getBlurRadius(),i=e.applyToRelativeSize(t);this.set({blurRadius:i},!1)}dispose(){super.dispose(),this._filter.dispose(),this._verticalFilter.dispose(),this._horizontalFilter.dispose()}hasChanges(){return!0}}Os.identifier="blur";Os.prototype.availableOptions={blurRadius:{type:h.NUMBER,default:.025},highQualityCanvasBlur:{type:h.BOOLEAN,default:!1}};F.Operations.BlurOperation=Os;var ch=Os;var ph=`varying vec2 v_texCoord;
uniform sampler2D u_image;
uniform sampler2D u_filteredImage;
uniform float u_intensity;

void main() {
  vec4 color0 = texture2D(u_image, v_texCoord);
  vec4 color1 = texture2D(u_filteredImage, v_texCoord);
  gl_FragColor = mix(color0, color1, u_intensity);
}
`;class uh extends T.Filter{constructor(){super();this._fragmentSource=ph}_applyCanvas(e,t,i,r=!1){const s=t.getCanvas(),o=i.getContext(),{filteredCanvas:n}=this._options;o.save(),o.globalAlpha=1-this._options.intensity,o.drawImage(s,0,0),o.globalAlpha=this._options.intensity,o.drawImage(n,0,0),o.restore()}}uh.prototype.availableOptions={filteredImage:{type:h.NUMBER,default:1,uniformType:D.INT},filteredCanvas:{type:h.OBJECT,default:null},intensity:{type:h.NUMBER,default:1,uniformType:D.FLOAT}};class $f{constructor(e=1){this._intensity=e,this._stack=[],this._dirtiness={},this._renderTextures={},this._container=new T.Container,this._sprite=new T.Sprite,this._container.addChild(this._sprite),this._blendFilter=new uh}push(e){this._stack.push(e)}clear(){this._stack=[]}render(e,t,i){if(this.isEmpty())return N.resolve();const r=e.getRenderer();this._sprite.setTexture(t);let s=this._renderTextures[r.id];if(!s){const a=e.getSprite().getTexture().getFrame();s=new T.RenderTexture(e.getRenderer(),a.width,a.height),this._renderTextures[r.id]=s}const o=i.getDimensions();s.resizeTo(o);const n=this.isDirtyForRenderer(r);if(n){this._stack.forEach(l=>{l.update(e)});const a=this._stack.map(l=>l.getFilter());this._sprite.setFilters(a),s.render(this._container),this.setDirtyForRenderer(!1,r)}if(this._blendFilter.setIntensity(this._intensity),r.isOfType(q.CANVAS))this._blendFilter.setFilteredCanvas(s.getRenderTarget().getCanvas());else if(r.isOfType(q.WEBGL)){const a=s.getBaseTexture();a.setGLUnit(this._blendFilter.getFilteredImage()),r.updateTexture(a,!1)}return this._sprite.setFilters([this._blendFilter]),i.clear(O.TRANSPARENT),i.render(this._container),n&&this.disposeRenderTextures(),N.resolve()}setIntensity(e){this._intensity=e}isEmpty(){return this._stack.length===0}isDirtyForRenderer(e){return e.id in this._dirtiness||(this._dirtiness[e.id]=!0),this._dirtiness[e.id]}setDirtyForRenderer(e,t){this._dirtiness[t.id]=e}setDirty(e){for(const t in this._dirtiness)this._dirtiness[t]=e}disposeRenderTextures(){for(const e in this._renderTextures)this._renderTextures[e].dispose(),delete this._renderTextures[e]}dispose(){this.disposeRenderTextures(),this._stack.forEach(e=>e.dispose()),this._stack=[],this._blendFilter.dispose(),this._sprite.dispose()}}var yn=$f;class Nr extends G{constructor(e={},t={}){super(e,R({intensity:{type:h.NUMBER,default:1,setter(i){return this._stack&&this._stack.setIntensity(i),i}},dirty:{type:h.BOOLEAN,default:!0}},t));this._stack=new yn(this._options.intensity)}render(e,t,i){return this._stack.render(e,t,i).then(r=>(this.setDirty(!1),r))}setDirtyForRenderer(e,t){this._stack.setDirtyForRenderer(e,t)}disposeRenderTextures(){this._stack.disposeRenderTextures()}dispose(){this._stack.dispose()}}Nr.identifier=null;Nr.isIdentity=!1;Nr.displayName=null;Nr.PrimitivesStack=yn;var M=Nr;var mh=`varying vec2 v_texCoord;
uniform sampler2D u_image;
uniform float u_brightness;

void main() {
  vec4 texColor = texture2D(u_image, v_texCoord);
  gl_FragColor = vec4((texColor.rgb + vec3(u_brightness) * texColor.a), texColor.a);;
}
`;class eg extends G{update(){}getFilter(){return this._filter}dispose(){this._filter&&(this._filter.dispose(),this._filter=null)}}var ae=eg;class bn extends T.Filter{constructor(){super();this._fragmentSource=mh}_applyCanvas(e,t,i,r=!1){const s=t.getCanvas(),o=t.getContext(),n=i.getContext(),a=o.getImageData(0,0,s.width,s.height);let{brightness:l}=this._options;if(l===0){n.putImageData(a,0,0);return}l*=255;for(let d=0;d<s.width*s.height;d++){const p=d*4;a.data[p]+=l,a.data[p+1]+=l,a.data[p+2]+=l}n.putImageData(a,0,0)}}bn.prototype.availableOptions={brightness:{type:h.NUMBER,default:0,uniformType:D.FLOAT}};class fh extends ae{constructor(...e){super(...e);this._filter=new bn}update(){this._filter.setBrightness(this._options.brightness)}}fh.prototype.availableOptions=bn.prototype.availableOptions;var ai=fh;var gh=`varying vec2 v_texCoord;
uniform sampler2D u_image;
uniform float u_contrast;

void main() {
  vec4 texColor = texture2D(u_image, v_texCoord);
  gl_FragColor = vec4(((texColor.rgb - vec3(0.5)) * u_contrast + vec3(0.5) * texColor.a), texColor.a);
}
`;class xn extends T.Filter{constructor(){super();this._fragmentSource=gh}_applyCanvas(e,t,i,r=!1){const s=t.getCanvas(),o=t.getContext(),n=i.getContext(),a=o.getImageData(0,0,s.width,s.height),{contrast:l}=this._options;if(l===1)return;for(let d=0;d<s.width*s.height;d++){const p=d*4;a.data[p]=(a.data[p]-127)*l+127,a.data[p+1]=(a.data[p+1]-127)*l+127,a.data[p+2]=(a.data[p+2]-127)*l+127}n.putImageData(a,0,0)}}xn.prototype.availableOptions={contrast:{type:h.NUMBER,default:1,uniformType:D.FLOAT}};class _h extends ae{constructor(...e){super(...e);this._filter=new xn}update(){this._filter.setContrast(this._options.contrast)}}_h.prototype.availableOptions=xn.prototype.availableOptions;var He=_h;var yh=`varying vec2 v_texCoord;
uniform sampler2D u_image;
uniform mat4 u_colorMatrix;
uniform vec4 u_colorMatrixOffset;

void main() {
  vec4 texColor = texture2D(u_image, v_texCoord);
  gl_FragColor = texColor * u_colorMatrix + u_colorMatrixOffset;
}
`;const{ColorMatrix:tg}=P;class vn extends T.Filter{constructor(){super();this._fragmentSource=yh}_applyCanvas(e,t,i,r=!1){const s=t.getCanvas(),o=t.getContext(),n=i.getContext(),a=o.getImageData(0,0,s.width,s.height),{colorMatrix:l}=this._options;let d=new O(0,0,0,0);for(let p=0;p<s.width*s.height;p++){const u=p*4;d.r=a.data[u]/255,d.g=a.data[u+1]/255,d.b=a.data[u+2]/255,d=l.apply(d),a.data[u]=d.r*255,a.data[u+1]=d.g*255,a.data[u+2]=d.b*255}n.putImageData(a,0,0)}}vn.prototype.availableOptions={colorMatrix:{type:h.COLOR_MATRIX,default:new tg,uniformType:D.MAT4},colorMatrixOffset:{type:h.ARRAY,default:[],uniformType:D.FLOAT4}};class bh extends ae{constructor(...e){super(...e);this._filter=new vn}update(){this._filter.setColorMatrix(this._options.colorMatrix)}}bh.prototype.availableOptions=vn.prototype.availableOptions;var Cs=bh;var xh=`varying vec2 v_texCoord;
uniform sampler2D u_image;
uniform float u_desaturation;

void main() {
  vec4 texColor = texture2D(u_image, v_texCoord);
  vec3 grayXfer = vec3(0.3, 0.59, 0.11);
  vec3 gray = vec3(dot(grayXfer, texColor.xyz));
  gl_FragColor = vec4(mix(texColor.xyz, gray, u_desaturation) * texColor.a, texColor.a);
}
`;class wn extends T.Filter{constructor(){super();this._fragmentSource=xh}_applyCanvas(e,t,i,r=!1){const s=t.getCanvas(),o=t.getContext(),n=i.getContext(),a=o.getImageData(0,0,s.width,s.height),l=[.3,.59,.11],{desaturation:d}=this._options;for(let p=0;p<s.width*s.height;p++){const u=p*4,c=l[0]*a.data[u]/255+l[1]*a.data[u+1]/255+l[2]*a.data[u+2]/255;a.data[u]+=(c*255-a.data[u])*d,a.data[u+1]+=(c*255-a.data[u+1])*d,a.data[u+2]+=(c*255-a.data[u+2])*d}n.putImageData(a,0,0)}}wn.prototype.availableOptions={desaturation:{type:h.NUMBER,default:1,uniformType:D.FLOAT}};class vh extends ae{constructor(...e){super(...e);this._filter=new wn}update(){this._filter.setDesaturation(this._options.desaturation)}}vh.prototype.availableOptions=wn.prototype.availableOptions;var xt=vh;var wh=`precision highp float;

uniform sampler2D u_image;
uniform vec4 u_lightColor;
uniform vec4 u_darkColor;
uniform float u_intensity;
varying vec2 v_texCoord;

const float EPSILON = 0.0000001;
const vec3 GRAYSCALE_WEIGHTS = vec3(0.2126, 0.7152, 0.0722);

vec4 duotoneKernel(vec4 sampledCol, vec4 light, vec4 dark, float intensity) {
  vec4 color = clamp(sampledCol, 0.0, 1.0);
  color.rgb /= max(color.a, EPSILON);
  color = clamp(color, 0.0, 1.0); // necessary to get rid of all extended sRGB issues with OpenGL ES
 
  // Apply intensity as "symmetric gamma"
  if (intensity > 0.0) {
    color.rgb = 1.0 - pow(1.0 - color.rgb, vec3(max(intensity + 1.0, EPSILON)));
  } else {
    color.rgb = pow(color.rgb, vec3(max(-intensity + 1.0, EPSILON)));
  }
 
  // Colorimetric (perceptual luminance-preserving) RGB to grayscale conversion
  // https://en.wikipedia.org/wiki/Grayscale#Colorimetric_(perceptual_luminance-preserving)_conversion_to_grayscale
  float luminance = dot(GRAYSCALE_WEIGHTS, color.rgb);
 
  // Apply DuoTone
  vec4 duotone = mix(dark, light, clamp(luminance, 0.0, 1.0));
  duotone.a *= color.a;
  
  duotone.rgb *= duotone.a;

  return duotone;
}

void main() {
  vec4 texColor = texture2D(u_image, v_texCoord);
  gl_FragColor = duotoneKernel(texColor, u_lightColor, u_darkColor, u_intensity);
}`;class Sn extends T.Filter{constructor(){super();this._fragmentSource=wh}_applyCanvas(e,t,i,r=!1){const s=t.getCanvas(),o=t.getContext(),n=i.getContext(),a=o.getImageData(0,0,s.width,s.height),{lightColor:l,darkColor:d,intensity:p}=this._options;for(let u=0;u<s.width*s.height;u++){const c=u*4,m=a.data[c]/255,x=a.data[c+1]/255,_=a.data[c+2]/255,f=a.data[c+3]/255,y=new O(m,x,_,f),b=this._duoToneKernel(y,l,d,p);a.data[c]=b.r*255,a.data[c+1]=b.g*255,a.data[c+2]=b.b*255,a.data[c+3]=b.a*255}n.putImageData(a,0,0)}_duoToneKernel(e,t,i,r){const s=1e-7;if(e.clone().clamp(0,1),r>0){const l=Math.max(r+1,s);e.r=1-Math.pow(1-e.r,l),e.g=1-Math.pow(1-e.g,l),e.b=1-Math.pow(1-e.b,l)}else{const l=Math.max(-r+1,s);e.r=Math.pow(e.r,l),e.g=Math.pow(e.g,l),e.b=Math.pow(e.b,l)}const o=.2126*e.r+.7152*e.g+.0722*e.b,n=Math.min(Math.max(o,0),1),a=i.clone().mix(t,n);return a.a*=e.a,a}}Sn.prototype.availableOptions={lightColor:{type:h.COLOR,default:O.RED,uniformType:D.FLOAT4},darkColor:{type:h.COLOR,default:O.BLACK,uniformType:D.FLOAT4},intensity:{type:h.NUMBER,default:.5,uniformType:D.FLOAT}};class Sh extends ae{constructor(...e){super(...e);this._filter=new Sn}update(){this._filter.setLightColor(this._options.lightColor),this._filter.setDarkColor(this._options.darkColor);const e=2*this._options.intensity-1;this._filter.setIntensity(e)}}Sh.prototype.availableOptions=Sn.prototype.availableOptions;var ks=Sh;var Th=`varying vec2 v_texCoord;
uniform sampler2D u_image;
uniform vec3 u_gamma;

void main() {
  vec4 texColor = texture2D(u_image, v_texCoord);
  vec3 rgb = vec3(texColor.r, texColor.g, texColor.b);
  rgb = pow(rgb, u_gamma);
  gl_FragColor = vec4(rgb * texColor.a, texColor.a);;
}
`;class Tn extends T.Filter{constructor(){super();this._fragmentSource=Th}_applyCanvas(e,t,i,r=!1){const s=t.getCanvas(),o=t.getContext(),n=i.getContext(),a=o.getImageData(0,0,s.width,s.height),{gamma:l}=this._options,d=new Float32Array(256);for(let c=0;c<256;c++)d[c]=255*Math.pow(c/255,l.r);const p=new Float32Array(256);for(let c=0;c<256;c++)p[c]=255*Math.pow(c/255,l.g);const u=new Float32Array(256);for(let c=0;c<256;c++)u[c]=255*Math.pow(c/255,l.b);for(let c=0;c<s.width*s.height;c++){const m=c*4;a.data[m]=d[a.data[m]],a.data[m+1]=p[a.data[m+1]],a.data[m+2]=u[a.data[m+2]]}n.putImageData(a,0,0)}}Tn.prototype.availableOptions={gamma:{type:h.COLOR,default:O.WHITE,uniformType:D.FLOAT3}};class Rh extends ae{constructor(...e){super(...e);this._filter=new Tn}update(){this._filter.setGamma(this._options.gamma)}}Rh.prototype.availableOptions=Tn.prototype.availableOptions;var Ds=Rh;var Eh=`varying vec2 v_texCoord;
uniform sampler2D u_image;

uniform vec3 u_color;

void main() {
  vec4 texColor = texture2D(u_image, v_texCoord);

  vec2 textureCoord = v_texCoord - vec2(0.5, 0.5);
  textureCoord /= 0.75;

  float d = 1.0 - dot(textureCoord, textureCoord);
  d = clamp(d, 0.2, 1.0);
  vec3 newColor = texColor.rgb * d * u_color.rgb;
  gl_FragColor = vec4(vec3(newColor) * texColor.a, texColor.a);
}
`;class Rn extends T.Filter{constructor(){super();this._fragmentSource=Eh}_applyCanvas(e,t,i,r=!1){const s=t.getCanvas(),o=t.getContext(),n=i.getContext(),a=o.getImageData(0,0,s.width,s.height),{color:l}=this._options;let d;for(let p=0;p<s.width;p++)for(let u=0;u<s.height;u++){const c=(s.width*u+p)*4,m=p/s.width,x=u/s.height,_=(m-.5)/.75,f=(x-.5)/.75,y=_*_,b=f*f;d=1-(y+b),d=Math.min(Math.max(d,.1),1),a.data[c]*=d*l.r,a.data[c+1]=a.data[c+1]*(d*l.g),a.data[c+2]=a.data[c+2]*(d*l.b),a.data[c+3]=255}n.putImageData(a,0,0)}}Rn.prototype.availableOptions={color:{type:h.COLOR,default:O.WHITE,uniformType:D.FLOAT3}};class Oh extends ae{constructor(...e){super(...e);this._filter=new Rn}update(){this._filter.setColor(this._options.color)}}Oh.prototype.availableOptions=Rn.prototype.availableOptions;var or=Oh;var Ch=`varying vec2 v_texCoord;
uniform sampler2D u_image;

void main() {
  vec4 texColor = texture2D(u_image, v_texCoord);
  texColor.b = texColor.g * 0.33;
  texColor.r = texColor.r * 0.6;
  texColor.b += texColor.r * 0.33;
  texColor.g = texColor.g * 0.7;
  gl_FragColor = texColor;
}
`;class ig extends T.Filter{constructor(){super();this._fragmentSource=Ch}_applyCanvas(e,t,i,r=!1){const s=t.getCanvas(),o=t.getContext(),n=i.getContext(),a=o.getImageData(0,0,s.width,s.height);for(let l=0;l<s.width;l++)for(let d=0;d<s.height;d++){const p=(s.width*d+l)*4;a.data[p+2]=a.data[p+1]*.33,a.data[p]*=.6,a.data[p+2]+=a.data[p]*.33,a.data[p+1]=a.data[p+1]*.7,a.data[p+3]=255}n.putImageData(a,0,0)}}class rg extends ae{constructor(...e){super(...e);this._filter=new ig}}var Ps=rg;var kh=`varying vec2 v_texCoord;
uniform sampler2D u_image;
vec3 W = vec3(0.2125, 0.7154, 0.0721);

void main() {
  vec4 texColor = texture2D(u_image, v_texCoord);
  float luminance = dot(texColor.rgb, W);
  gl_FragColor = vec4(vec3(luminance) * texColor.a, texColor.a);
}
`;class sg extends T.Filter{constructor(){super();this._fragmentSource=kh}_applyCanvas(e,t,i,r=!1){const s=t.getCanvas(),o=t.getContext(),n=i.getContext(),a=o.getImageData(0,0,s.width,s.height);for(let l=0;l<s.width;l++)for(let d=0;d<s.height;d++){const p=(s.width*d+l)*4,u=a.data[p]*.2125+a.data[p+1]*.7154+a.data[p+2]*.0721;a.data[p]=u,a.data[p+1]=u,a.data[p+2]=u}n.putImageData(a,0,0)}}class og extends ae{constructor(...e){super(...e);this._filter=new sg}}var nr=og;var Dh=`varying vec2 v_texCoord;
uniform sampler2D u_image;
uniform sampler2D u_lookupTable;

void main() {
  vec4 texColor = texture2D(u_image, v_texCoord);
  float r = texture2D(u_lookupTable, vec2(texColor.r, 0.0)).r;
  float g = texture2D(u_lookupTable, vec2(texColor.g, 0.0)).g;
  float b = texture2D(u_lookupTable, vec2(texColor.b, 0.0)).b;

  gl_FragColor = vec4(vec3(r, g, b) * texColor.a, texColor.a);
}
`;class Ph extends T.Filter{constructor(...e){super(...e);this._fragmentSource=Dh}_applyCanvas(e,t,i,r=!1){const s=t.getCanvas(),o=t.getContext(),n=i.getContext(),a=o.getImageData(0,0,s.width,s.height),l=this._options.lookupTableData;for(let d=0;d<s.width*s.height;d++){const p=d*4,u=a.data[p];a.data[p]=l[u*4];const c=a.data[p+1];a.data[p+1]=l[1+c*4];const m=a.data[p+2];a.data[p+2]=l[2+m*4]}n.putImageData(a,0,0)}}Ph.prototype.availableOptions={lookupTable:{type:h.NUMBER,default:1,uniformType:D.INT},lookupTableData:{type:h.ARRAY,default:[]}};class ng extends ae{constructor(...e){super(...e);this._filter=new Ph({lookupTable:this._options.textureGLUnit}),this._textures={},this._renderers={}}update(e){const t=e.getRenderer();t.isOfType(q.WEBGL)?this._updateWebGLTexture(e):t.isOfType(q.CANVAS)&&this._filter.setLookupTableData(this._options.data)}_updateWebGLTexture(e){if(typeof this._options.data=="undefined")throw new Error("LookupTable: No data specified.");const t=new Uint8Array(this._options.data),i=e.getRenderer(),{id:r}=i;this._renderers[r]=i,this._textures[r]||(this._textures[r]=new T.BaseTexture);const s=this._textures[r],o=new T.PixelArrayImage(256,1,t);s.setSource(o),s.setGLUnit(this._options.textureGLUnit),i.isOfType(q.WEBGL)&&i.updateTexture(s)}dispose(){super.dispose();for(const e in this._textures)this._textures[e].dispose(),delete this._textures[e];delete this._options.data}}var Fs=ng;var Fh=`/**
 * Based off of GPUImage's LookupFilter:
 * https://github.com/BradLarson/GPUImage/blob/master/framework/Source/GPUImageLookupFilter.m
 */

varying vec2 v_texCoord;
uniform sampler2D u_image;
uniform sampler2D u_lookupTable;

void main() {
  vec4 texColor = texture2D(u_image, v_texCoord);
  float blueColor = texColor.b * 63.0;

  vec2 quad1;
  quad1.y = floor(floor(blueColor) / 8.0);
  quad1.x = floor(blueColor) - (quad1.y * 8.0);

  vec2 quad2;
  quad2.y = floor(ceil(blueColor) / 8.0);
  quad2.x = ceil(blueColor) - (quad2.y * 8.0);

  vec2 texCoord1;
  texCoord1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * texColor.r);
  texCoord1.y = (quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * texColor.g);

  vec2 texCoord2;
  texCoord2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * texColor.r);
  texCoord2.y = (quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * texColor.g);

  vec4 newColor1 = texture2D(u_lookupTable, texCoord1);
  vec4 newColor2 = texture2D(u_lookupTable, texCoord2);

  vec4 newColor = mix(newColor1, newColor2, fract(blueColor));
  gl_FragColor = mix(texColor, vec4(newColor.rgb, texColor.w), texColor.a);
}
`;const{Vector2:Ah}=P,Ih=3;class Bh extends T.Filter{constructor(){super();this._precomputeQuads(),this._fragmentSource=Fh}_precomputeQuads(){this._quads=[];for(let e=0;e<256;e++){const t=e/255*63,i=new Ah;i.y=(t|0)*.125|0,i.x=(t|0)-i.y*8,this._quads.push(i)}}_applyCanvas(e,t,i,r=!1){const s=t.getCanvas(),o=t.getContext(),n=i.getContext(),a=this._options.lookupTableImage,l=this._createImageCanvas(a),d=l.getContext("2d"),p=o.getImageData(0,0,s.width,s.height),u=d.getImageData(0,0,a.width,a.height),c=new Ah;for(let m=0;m<s.width*s.height*4;m+=4){const x=p.data[m],_=p.data[m+1],f=p.data[m+2],y=p.data[m+3]/255,b=this._quads[f],g=64;c.x=b.x*g,c.y=b.y*g,c.x+=Math.floor(x/4),c.y+=Math.floor(_/4);const E=(a.width*c.y+c.x)*4|0;let v=u.data[E];v=x*(1-y)+v*y;let w=u.data[E+1];w=_*(1-y)+w*y;let A=u.data[E+2];A=f*(1-y)+A*y,p.data[m]=v,p.data[m+1]=w,p.data[m+2]=A}n.putImageData(p,0,0)}_createImageCanvas(e){const t=S.createCanvas();t.width=e.width,t.height=e.height;const i=t.getContext("2d");return i.drawImage(e,0,0),t}}Bh.prototype.availableOptions={lookupTable:{type:h.NUMBER,default:Ih,uniformType:D.INT},lookupTableImage:{type:h.IMAGE,uniformType:null}};class Mh extends ae{constructor(...e){super(...e);this._filter=new Bh,this._textures={}}update(e){const t=e.getRenderer();t.isOfType(q.WEBGL)?this._updateWebGLTexture(e):t.isOfType(q.CANVAS)&&this._filter.setLookupTableImage(this._options.image)}_updateWebGLTexture(e){const t=e.getRenderer(),{id:i}=t;this._textures[i]||(this._textures[i]=new T.BaseTexture);const r=this._textures[i];r.setSource(this._options.image),r.setGLUnit(Ih),t.updateTexture(r)}dispose(){super.dispose();for(const e in this._textures)delete this._textures[e]}}Mh.prototype.availableOptions={image:{type:h.IMAGE}};var As=Mh;var Lh=`varying vec2 v_texCoord;
uniform sampler2D u_image;
uniform float u_saturation;

const vec3 luminanceWeighting = vec3(0.2125, 0.7154, 0.0721);

void main() {
  vec4 texColor = texture2D(u_image, v_texCoord);
  float luminance = dot(texColor.rgb, luminanceWeighting);

  vec3 greyScaleColor = vec3(luminance);

  gl_FragColor = vec4(mix(greyScaleColor, texColor.rgb, u_saturation) * texColor.a, texColor.a);
}
`;class En extends T.Filter{constructor(){super();this._fragmentSource=Lh}_applyCanvas(e,t,i,r=!1){const s=t.getCanvas(),o=t.getContext(),n=i.getContext(),a=o.getImageData(0,0,s.width,s.height),{saturation:l}=this._options;for(let d=0;d<s.width;d++)for(let p=0;p<s.height;p++){const u=(s.width*p+d)*4,c=a.data[u]*.2125+a.data[u+1]*.7154+a.data[u+2]*.0721;a.data[u]=c*(1-l)+a.data[u]*l,a.data[u+1]=c*(1-l)+a.data[u+1]*l,a.data[u+2]=c*(1-l)+a.data[u+2]*l}n.putImageData(a,0,0)}}En.prototype.availableOptions={saturation:{type:h.NUMBER,default:0,uniformType:D.FLOAT}};class Nh extends ae{constructor(...e){super(...e);this._filter=new En}update(){this._filter.setSaturation(this._options.saturation)}}Nh.prototype.availableOptions=En.prototype.availableOptions;var qe=Nh;var zh=`varying vec2 v_texCoord;
uniform sampler2D u_image;
uniform vec3 u_color;

void main() {
  vec4 texColor = texture2D(u_image, v_texCoord);
  vec4 overlayVec4 = vec4(u_color, texColor.a);
  gl_FragColor = max(overlayVec4 * texColor.a, texColor);
}
`;class On extends T.Filter{constructor(){super();this._fragmentSource=zh}_applyCanvas(e,t,i,r=!1){const s=t.getCanvas(),o=t.getContext(),n=i.getContext(),a=o.getImageData(0,0,s.width,s.height);for(let l=0;l<s.width;l++)for(let d=0;d<s.height;d++){const p=(s.width*d+l)*4;a.data[p]=Math.max(this._options.color.r*255,a.data[p]),a.data[p+1]=Math.max(this._options.color.g*255,a.data[p+1]),a.data[p+2]=Math.max(this._options.color.b*255,a.data[p+2])}n.putImageData(a,0,0)}}On.prototype.availableOptions={color:{type:h.COLOR,default:O.WHITE,uniformType:D.FLOAT3}};class Gh extends ae{constructor(...e){super(...e);this._filter=new On}update(){this._filter.setColor(this._options.color)}}Gh.prototype.availableOptions=On.prototype.availableOptions;var Is=Gh;class Uh extends Fs{constructor(...e){super(...e);this._options.rgbControlPoints||(this._options.rgbControlPoints={red:this._options.controlPoints,green:this._options.controlPoints,blue:this._options.controlPoints}),this._updateLookupTable()}_updateLookupTable(){const e=this._calculateSplineCurve(this._options.rgbControlPoints.red),t=this._calculateSplineCurve(this._options.rgbControlPoints.green),i=this._calculateSplineCurve(this._options.rgbControlPoints.blue);this._options.data=this._buildLookupTable(e,t,i)}_buildLookupTable(e,t,i){const r=[];for(let s=0;s<256;s++)r.push(Math.min(Math.max(s+e[s],0),255)),r.push(Math.min(Math.max(s+t[s],0),255)),r.push(Math.min(Math.max(s+i[s],0),255)),r.push(255);return r}_calculateSplineCurve(e){e=e.sort(function(o,n){return o[0]>n[0]});const t=this._getSplineCurve(e),i=t[0];let r;if(i[0]>0)for(r=0;r<i[0];r++)t.unshift([0,0]);const s=[];for(r=0;r<t.length;r++){const o=t[r],n=[o[0],o[0]];let a=Math.sqrt(Math.pow(n[0]-o[0],2)+Math.pow(n[1]-o[1],2));n[1]>o[1]&&(a=-a),s.push(a)}return s}_getSplineCurve(e){const t=this._secondDerivative(e),i=t.length,r=[];let s;for(s=0;s<i;s++)r[s]=t[s];const o=[];for(s=0;s<i-1;s++){const n=e[s],a=e[s+1];for(let l=n[0];l<a[0];l++){const d=(l-n[0])/(a[0]-n[0]),p=1-d,u=d,c=a[0]-n[0];let m=p*n[1]+u*a[1]+c*c/6*((p*p*p-p)*r[s]+(u*u*u-u)*r[s+1]);m>255?m=255:m<0&&(m=0),o.push([l,m])}}return o.length===255&&o.push(e[e.length-1]),o}_secondDerivative(e){const t=e.length;if(t<=0||t===1)return null;const i=[],r=[];let s,o;for(i[0]=[0,1,0],s=1;s<t-1;s++){const a=e[s-1],l=e[s],d=e[s+1];i[s]=i[s]||[],i[s][0]=(l[0]-a[0])/6,i[s][1]=(d[0]-a[0])/3,i[s][2]=(d[0]-l[0])/6,r[s]=(d[1]-l[1])/(d[0]-l[0])-(l[1]-a[1])/(l[0]-a[0])}for(r[0]=0,r[t-1]=0,i[t-1]=[0,1,0],s=1;s<t;s++)o=i[1][0]/i[s-1][1],i[s][1]-=o*i[s-1][2],i[s][0]=0,r[s]-=o*r[s-1];for(s=t-2;s>0;s--)o=i[s][2]/i[s+1][1],i[s][1]-=o*i[s+1][0],i[s][2]=0,r[s]-=o*r[s+1];const n=[];for(s=0;s<t;s++)n[s]=r[s]/i[s][1];return n}}Uh.prototype.availableOptions={rgbControlPoints:{type:h.OBJECT},controlPoints:{type:h.ARRAY,default:[]},textureGLUnit:{type:h.NUMBER,default:1}};var j=Uh;var Kh=`varying vec2 v_texCoord;
uniform sampler2D u_image;

void main() {
  vec4 texColor = texture2D(u_image, v_texCoord);
  float gray = texColor.r * 0.3 + texColor.g * 0.3 + texColor.b * 0.3;
  gray -= 0.2;
  gray = clamp(gray, 0.0, 1.0);
  gray += 0.15;
  gray *= 1.4;
  gl_FragColor = vec4(vec3(gray) * texColor.a, texColor.a);
}
`;class ag extends T.Filter{constructor(){super();this._fragmentSource=Kh}_applyCanvas(e,t,i,r=!1){const s=t.getCanvas(),o=t.getContext(),n=i.getContext(),a=o.getImageData(0,0,s.width,s.height);for(let l=0;l<s.width;l++)for(let d=0;d<s.height;d++){const p=(s.width*d+l)*4;let u=a.data[p]/255*.3+a.data[p+1]/255*.3+a.data[p+2]/255*.3;u-=.2,u=Math.max(0,Math.min(1,u)),u+=.15,u*=1.4,u*=255,a.data[p]=u,a.data[p+1]=u,a.data[p+2]=u}n.putImageData(a,0,0)}}class lg extends ae{constructor(...e){super(...e);this._filter=new ag}}var Bs=lg;var jh=`precision highp float;

uniform sampler2D u_image;

uniform sampler2D u_lookupTable;

uniform float u_resolution;     // Texture-Resolution, must be power of 2: 64, 128, 256, 512, 1024, 2048, 4096
uniform float u_horizontalTileCount; // Horizontal Blue Tiles
uniform float u_verticalTileCount; // Vertical Blue Tiles

varying vec2 v_texCoord;

const float EPSILON = 0.000001;

// Try to get the exact pixel of the lut map image
vec3 lutColor(int texPosX, int texPosY) {
    return texture2D(u_lookupTable, (0.5 / u_resolution) + vec2(float(texPosX), float(texPosY)) / u_resolution).rgb;
}

vec3 bilinearInterpolate(vec3 cRfGf, vec3 cRfGc, vec3 cRcGf, vec3 cRcGc, float redFract, float greenFract) {
    return mix(mix(cRfGf, cRcGf, redFract), mix(cRfGc, cRcGc, redFract), greenFract);
}

void main() {
    vec4 inputColor = clamp(texture2D(u_image, v_texCoord.xy), 0.0, 1.0);

    vec3 sourceColor = vec3(inputColor.rgb / max(inputColor.a, EPSILON)); 

    vec3 ranges = vec3(
        floor(u_resolution / u_horizontalTileCount - 1.0),
        floor(u_resolution / u_verticalTileCount - 1.0),
        floor(u_horizontalTileCount * u_horizontalTileCount - 1.0)
    );
    
    vec3 tmp = sourceColor * ranges;
    ivec3 floors = ivec3(tmp);
    ivec3 ceils = ivec3(ceil(tmp));
    vec3 fracts = fract(tmp);

    // Map tile index to tile pixel pos.
    ivec2 pixelsPerTile = ivec2(
        u_resolution / u_horizontalTileCount, 
        u_resolution / u_verticalTileCount
      );

    ivec2 tileFloor; // Blue tile index
    tileFloor.y = floors.z / int(u_horizontalTileCount);
    tileFloor.x = (floors.z - (tileFloor.y * int(u_horizontalTileCount)));

    ivec2 tileCeil; // Blue tile index
    tileCeil.y = ceils.z / int(u_horizontalTileCount);
    tileCeil.x = (ceils.z - (tileCeil.y * int(u_horizontalTileCount)));
    
    tileFloor *= pixelsPerTile;
    tileCeil *= pixelsPerTile; 
    
    
    // Interpolate between red and green
    vec3 lutColorFB = bilinearInterpolate(
        lutColor(tileFloor.x + floors.x, tileFloor.y + floors.y),
        lutColor(tileFloor.x + floors.x, tileFloor.y + ceils.y),
        lutColor(tileFloor.x + ceils.x,  tileFloor.y + floors.y),
        lutColor(tileFloor.x + ceils.x,  tileFloor.y + ceils.y),
        fracts.x, fracts.y
    );
    vec3 lutColorCB = bilinearInterpolate(
        lutColor(tileCeil.x + floors.x, tileCeil.y + floors.y),
        lutColor(tileCeil.x + floors.x, tileCeil.y + ceils.y),
        lutColor(tileCeil.x + ceils.x,  tileCeil.y + floors.y),
        lutColor(tileCeil.x + ceils.x,  tileCeil.y + ceils.y),
        fracts.x, fracts.y
    );

    // Interpolate between the blue values
    vec3 interpolation = mix(lutColorFB, lutColorCB, fracts.z);

    // Round Color Values to prevent that for ex. 254.999999 is cutting to 254 instead of 255;
    interpolation = clamp(floor(interpolation * 255. + .5) / 255., 0.0, 1.0);

    gl_FragColor = vec4(interpolation.rgb * inputColor.a, inputColor.a);
}
`;const{Vector2:Ms,Vector3:Wh}=P,Vh=3;class Hh extends T.Filter{constructor(){super();this._precomputeQuads(),this._fragmentSource=jh}_precomputeQuads(){this._quads=[];for(let e=0;e<256;e++){const t=e/255*63,i=new Ms;i.y=(t|0)*.125|0,i.x=(t|0)-i.y*8,this._quads.push(i)}}_applyCanvas(e,t,i,r=!1){const{resolution:s,horizontalTileCount:o,verticalTileCount:n}=this._options,a=t.getCanvas(),l=t.getContext(),d=i.getContext(),p=this._options.lookupTableImage,u=this._createImageCanvas(p),c=u.getContext("2d");let m={width:128,height:128};s?m={width:s,height:s}:p.width&&p.height&&(m={width:p.width,height:p.height});const x=l.getImageData(0,0,a.width,a.height),_=c.getImageData(0,0,m.width,m.height),f=new Wh(m.width/o-1|0,m.height/n-1|0,o*n-1|0),y=new O,b=new O,g=new O,E=new O,v=new O,w=new O,A=new O,I=new O,z=new Ms,H=new Ms,U=(oe,ee,he,ne)=>{oe.r=ee.r*(1-ne)+he.r*ne,oe.g=ee.g*(1-ne)+he.g*ne,oe.b=ee.b*(1-ne)+he.b*ne},X=(oe,ee,he)=>{ee=.5+ee|0,he=.5+he|0;const ne=(he*m.width+ee)*4;oe.r=_.data[ne]/255,oe.g=_.data[ne+1]/255,oe.b=_.data[ne+2]/255,oe.a=_.data[ne+3]/255},Q=new O,re=new O,Ae=(oe,ee,he,ne,ct,te,ge)=>{U(Q,ee,ne,te),U(re,he,ct,te),U(oe,Q,re,ge)},Ge=new Ms(m.width,m.height).divide(o,n).floor();for(let oe=0;oe<a.width*a.height*4;oe+=4){y.set(x.data[oe]/255,x.data[oe+1]/255,x.data[oe+2]/255,x.data[oe+3]/255);const ee=new Wh(y.r*f.x,y.g*f.y,y.b*f.z),he=ee.clone().floor().toInt(),ne=ee.clone().ceil().toInt(),ct=ee.clone().fract();z.y=he.z/o|0,z.x=he.z-z.y*o|0,H.y=ne.z/o|0,H.x=ne.z-H.y*o|0,z.multiply(Ge),H.multiply(Ge),X(v,z.x+he.x,z.y+he.y),X(w,z.x+he.x,z.y+ne.y),X(A,z.x+ne.x,z.y+he.y),X(I,z.x+ne.x,z.y+ne.y),Ae(g,v,w,A,I,ct.x,ct.y),X(v,H.x+he.x,H.y+he.y),X(w,H.x+he.x,H.y+ne.y),X(A,H.x+ne.x,H.y+he.y),X(I,H.x+ne.x,H.y+ne.y),Ae(E,v,w,A,I,ct.x,ct.y),U(b,g,E,ct.z),x.data[oe]=Math.ceil(b.r*255),x.data[oe+1]=Math.ceil(b.g*255),x.data[oe+2]=Math.ceil(b.b*255)}d.putImageData(x,0,0)}_createImageCanvas(e){const t=S.createCanvas();t.width=e.width,t.height=e.height;const i=t.getContext("2d");return i.drawImage(e,0,0),t}}Hh.prototype.availableOptions={lookupTable:{type:h.NUMBER,default:Vh,uniformType:D.INT},lookupTableImage:{type:h.IMAGE,uniformType:null},resolution:{type:h.NUMBER,uniformType:D.FLOAT},horizontalTileCount:{type:h.NUMBER,default:5,uniformType:D.FLOAT},verticalTileCount:{type:h.NUMBER,default:5,uniformType:D.FLOAT}};class qh extends ae{constructor(...e){super(...e);this._filter=new Hh,this._textures={}}update(e){const t=e.getRenderer();t.isOfType(q.WEBGL)?this._updateWebGLTexture(e):t.isOfType(q.CANVAS)&&this._filter.setLookupTableImage(this._options.image);const{resolution:i,verticalTileCount:r,horizontalTileCount:s,image:o}=this._options;this._filter.set({resolution:i||o.width,verticalTileCount:r,horizontalTileCount:s})}_updateWebGLTexture(e){const t=e.getRenderer(),{id:i}=t;this._textures[i]||(this._textures[i]=new T.BaseTexture);const r=this._textures[i];r.setSource(this._options.image),r.setGLUnit(Vh),r.setMinFilter(T.BaseTexture.NearestFilter),t.updateTexture(r)}dispose(){super.dispose();for(const e in this._textures)delete this._textures[e]}}qh.prototype.availableOptions={image:{type:h.IMAGE},resolution:{type:h.NUMBER},horizontalTileCount:{type:h.NUMBER,default:5},verticalTileCount:{type:h.NUMBER,default:5}};var Ls=qh;const Cn={};xe(Cn,{Brightness:()=>ai,ColorMatrixPrimitive:()=>Cs,Contrast:()=>He,Desaturation:()=>xt,DuoTone:()=>ks,Gamma:()=>Ds,Glow:()=>or,Gobblin:()=>Ps,Grayscale:()=>nr,LookupTable:()=>Fs,LookupTableImage:()=>As,Saturation:()=>qe,SoftColorOverlay:()=>Is,ThreeDLookupTableImage:()=>Ls,ToneCurve:()=>j,X400:()=>Bs});class kn extends M{constructor(...e){super(...e);this._stack.push(new ai({brightness:0}))}render(e,t,i){return this._stack.isEmpty()&&this._stack.push(new ai({brightness:0})),super.render(e,t,i)}}kn.isIdentity=!0;kn.identifier="identity";var Ns=kn;class Yh extends M{constructor(...e){super(...e);this._stack.push(new He({contrast:.63})),this._stack.push(new ai({brightness:.12})),this._stack.push(new j({rgbControlPoints:{red:[[0,38],[94,94],[148,142],[175,187],[255,255]],green:[[0,0],[77,53],[171,190],[255,255]],blue:[[0,10],[48,85],[174,228],[255,255]]}}))}}Yh.identifier="a15";var Xh=Yh;class Qh extends M{constructor(...e){super(...e);this._stack.push(new xt({desaturation:.5})),this._stack.push(new j({rgbControlPoints:{red:[[0,0],[170,170],[212,219],[234,242],[255,255]],green:[[0,0],[170,168],[234,231],[255,255]],blue:[[0,0],[170,170],[212,208],[255,255]]}}))}}Qh.identifier="breeze";var Zh=Qh;class Jh extends M{constructor(...e){super(...e);this._stack.push(new nr)}}Jh.identifier="bw";var $h=Jh;class ed extends M{constructor(...e){super(...e);this._stack.push(new nr),this._stack.push(new He({contrast:1.5}))}}ed.identifier="bwhard";var td=ed;class id extends M{constructor(...e){super(...e);this._stack.push(new j({rgbControlPoints:{red:[[0,69],[55,110],[202,230],[255,255]],green:[[0,44],[89,93],[185,141],[255,189]],blue:[[0,76],[39,82],[218,138],[255,171]]}}))}}id.identifier="celsius";var rd=id;class sd extends M{constructor(...e){super(...e);this._stack.push(new j({rgbControlPoints:{red:[[0,0],[44,44],[124,143],[221,204],[255,255]],green:[[0,0],[130,127],[213,199],[255,255]],blue:[[0,0],[51,52],[219,204],[255,255]]}}))}}sd.identifier="chest";var od=sd;class Dn extends M{constructor(...e){super(...e,{intensity:{type:h.NUMBER,default:.5,required:!0,setter(t){return this._filterPrimitive&&(this._filterPrimitive.setIntensity(t),this._stack.setIntensity(1)),this._dirty=!0,t}}});this._filterPrimitive=new ks({lightColor:this._options.lightColor||O.WHITE,darkColor:this._options.darkColor||O.BLACK,intensity:this._options.intensity||.5}),this._stack.push(this._filterPrimitive)}}Dn.prototype.availableOptions={lightColor:{type:h.COLOR,default:O.WHITE,required:!0,setter(e){return this._filterPrimitive&&this._filterPrimitive.setLightColor(e),this.setDirty&&this.setDirty(!0),e}},darkColor:{type:h.COLOR,default:O.BLACK,required:!0,setter(e){return this._filterPrimitive&&this._filterPrimitive.setDarkColor(e),this.setDirty&&this.setDirty(!0),e}},intensity:{type:h.NUMBER,default:.5,required:!0}};Dn.identifier="duotone";var nd=Dn;class ad extends M{constructor(...e){super(...e);this._stack.push(new j({rgbControlPoints:{red:[[0,0],[44,28],[63,48],[128,132],[235,248],[255,255]],green:[[0,0],[20,10],[60,45],[190,209],[211,231],[255,255]],blue:[[0,31],[41,62],[150,142],[234,212],[255,224]]}}))}}ad.identifier="fixie";var ld=ad;class hd extends M{constructor(...e){super(...e);this._stack.push(new qe({saturation:1.35})),this._stack.push(new He({contrast:1.1}))}}hd.identifier="food";var dd=hd;class cd extends M{constructor(...e){super(...e);this._stack.push(new j({rgbControlPoints:{red:[[0,9],[21,11],[45,24],[255,220]],green:[[0,12],[21,21],[42,42],[150,150],[170,173],[255,210]],blue:[[0,28],[43,72],[128,185],[255,220]]}}))}}cd.identifier="fridge";var pd=cd;class ud extends M{constructor(...e){super(...e);this._stack.push(new j({rgbControlPoints:{red:[[0,65],[28,67],[67,113],[125,183],[187,217],[255,229]],green:[[0,52],[42,59],[104,134],[169,209],[255,240]],blue:[[0,52],[65,68],[93,104],[150,153],[255,198]]}}))}}ud.identifier="front";var md=ud;class fd extends M{constructor(...e){super(...e);this._stack.push(new He({contrast:1.1})),this._stack.push(new j({rgbControlPoints:{red:[[0,0],[94,74],[181,205],[255,255]],green:[[0,0],[127,127],[255,255]],blue:[[0,0],[102,73],[227,213],[255,255]]}}))}}fd.identifier="glam";var gd=fd;class _d extends M{constructor(...e){super(...e);this._stack.push(new Ps)}}_d.identifier="gobblin";var yd=_d;class bd extends M{constructor(...e){super(...e);this._stack.push(new j({controlPoints:[[0,0],[53,32],[91,80],[176,205],[255,255]]})),this._stack.push(new qe({saturation:.9}))}}bd.identifier="k1";var xd=bd;class vd extends M{constructor(...e){super(...e);this._stack.push(new j({controlPoints:[[0,0],[54,33],[77,82],[94,103],[122,126],[177,193],[229,232],[255,255]]})),this._stack.push(new Is({color:new O(40/255,40/255,40/255)}))}}vd.identifier="k2";var wd=vd;class Sd extends M{constructor(...e){super(...e);this._stack.push(new qe({saturation:.5}))}}Sd.identifier="k6";var Td=Sd;class Rd extends M{constructor(...e){super(...e);this._stack.push(new j({controlPoints:[[0,0],[17,27],[46,69],[90,112],[156,200],[203,243],[255,255]]})),this._stack.push(new qe({saturation:.7}))}}Rd.identifier="kdynamic";var Ed=Rd;class Od extends M{constructor(...e){super(...e);this._stack.push(new xt({desaturation:.4})),this._stack.push(new j({rgbControlPoints:{red:[[0,20],[40,20],[106,111],[129,153],[190,223],[255,255]],green:[[0,20],[40,20],[62,41],[106,108],[132,159],[203,237],[255,255]],blue:[[0,40],[40,40],[73,60],[133,160],[191,297],[203,237],[237,239],[255,255]]}}))}}Od.identifier="lenin";var Cd=Od;class kd extends M{constructor(...e){super(...e);this._stack.push(new j({controlPoints:[[0,0],[87,20],[131,156],[183,205],[255,200]]}))}}kd.identifier="lomo";var Dd=kd;class Pd extends M{constructor(...e){super(...e);this._stack.push(new j({rgbControlPoints:{red:[[0,0],[41,84],[87,134],[255,255]],green:[[0,0],[255,216]],blue:[[0,0],[255,131]]}}))}}Pd.identifier="mellow";var Fd=Pd;const{ColorMatrix:hg}=P;class Ad extends M{constructor(...e){super(...e);const t=new hg(.8158218291630716,0,0,0,-.01779810181190647,0,.8098360655737704,0,0,.0916393442622953,0,0,.4596336773932402,0,.12760574782432707,0,0,0,1,0);this._stack.push(new Cs({colorMatrix:t}));const i=new O(.8,.6,.9);this._stack.push(new Ds({gamma:i}))}}Ad.identifier="metal";var Id=Ad;class Bd extends M{constructor(...e){super(...e);this._stack.push(new j({rgbControlPoints:{red:[[0,40],[255,230]],green:[[0,10],[255,225]],blue:[[0,20],[255,181]]}})),this._stack.push(new or)}}Bd.identifier="morning";var Md=Bd;class Ld extends M{constructor(...e){super(...e);this._stack.push(new j({rgbControlPoints:{red:[[0,0],[115,130],[195,215],[255,255]],green:[[0,0],[148,153],[172,215],[255,255]],blue:[[0,46],[58,75],[178,205],[255,255]]},textureGLUnit:2})),this._stack.push(new j({controlPoints:[[0,0],[117,151],[189,217],[255,255]],textureGLUnit:3})),this._stack.push(new xt({desaturation:.65}))}}Ld.identifier="orchid";var Nd=Ld;class zd extends M{constructor(...e){super(...e);this._stack.push(new j({rgbControlPoints:{red:[[0,0],[94,74],[181,205],[255,255]],green:[[0,0],[34,34],[99,76],[176,190],[255,255]],blue:[[0,0],[102,73],[227,213],[255,255]]}})),this._stack.push(new qe({saturation:.8})),this._stack.push(new He({contrast:1.5}))}}zd.identifier="pola";var Gd=zd;class Ud extends M{constructor(...e){super(...e);this._stack.push(new j({rgbControlPoints:{red:[[0,0],[56,18],[196,209],[255,255]],green:[[0,38],[71,84],[255,255]],blue:[[0,0],[131,133],[204,211],[255,255]]}})),this._stack.push(new qe({saturation:.8})),this._stack.push(new He({contrast:1.5}))}}Ud.identifier="pola669";var Kd=Ud;class jd extends M{constructor(...e){super(...e);this._stack.push(new xt({desaturation:.65})),this._stack.push(new j({rgbControlPoints:{red:[[0,50],[40,78],[118,170],[181,211],[255,255]],green:[[0,27],[28,45],[109,157],[157,195],[179,208],[206,212],[255,240]],blue:[[0,50],[12,55],[46,103],[103,162],[194,182],[241,201],[255,219]]}}))}}jd.identifier="quozi";var Wd=jd;class Vd extends M{constructor(...e){super(...e);this._stack.push(new j({rgbControlPoints:{red:[[0,129],[75,153],[181,227],[255,255]],green:[[0,8],[111,85],[212,158],[255,226]],blue:[[0,5],[75,22],[193,90],[255,229]]}})),this._stack.push(new or)}}Vd.identifier="semired";var Hd=Vd;class qd extends M{constructor(...e){super(...e);this._stack.push(new j({rgbControlPoints:{red:[[0,0],[62,82],[141,154],[255,255]],green:[[0,39],[56,96],[192,176],[255,255]],blue:[[0,0],[174,99],[255,235]]},textureGLUnit:2})),this._stack.push(new j({controlPoints:[[0,0],[55,20],[158,191],[255,255]],textureGLUnit:3}))}}qd.identifier="sunny";var Yd=qd;class Xd extends M{constructor(...e){super(...e);this._stack.push(new j({rgbControlPoints:{red:[[0,72],[89,99],[176,212],[255,237]],green:[[0,49],[255,192]],blue:[[0,72],[255,151]]}}))}}Xd.identifier="texas";var Qd=Xd;class Zd extends M{constructor(...e){super(...e);this._stack.push(new Bs)}}Zd.identifier="x400";var Jd=Zd;class Pn extends M{constructor(...e){super(...e);this._lutPrimitive=new As({image:this._options.image}),this._stack.push(this._lutPrimitive)}}Pn.prototype.availableOptions={image:{type:h.IMAGE,required:!0,setter(e){return this._lutPrimitive&&this._lutPrimitive.setImage(e),this.setDirty(!0),e}}};Pn.identifier="lut";var $d=Pn;class Fn extends M{constructor(...e){super(...e);const{image:t,resolution:i,verticalTileCount:r,horizontalTileCount:s}=this._options;this._lutPrimitive=new Ls({image:t,resolution:i,verticalTileCount:r,horizontalTileCount:s}),this._stack.push(this._lutPrimitive)}}Fn.prototype.availableOptions={image:{type:h.IMAGE,required:!0,setter(e){return this._lutPrimitive&&this._lutPrimitive.setImage(e),this.setDirty(!0),e}},resolution:{type:h.NUMBER},horizontalTileCount:{type:h.NUMBER,default:5},verticalTileCount:{type:h.NUMBER,default:5}};Fn.identifier="3d-lut";var ec=Fn;const An={};xe(An,{A15Filter:()=>Xh,BWFilter:()=>$h,BWHardFilter:()=>td,BreezeFilter:()=>Zh,CelsiusFilter:()=>rd,ChestFilter:()=>od,DuoToneFilter:()=>nd,FixieFilter:()=>ld,FoodFilter:()=>dd,FridgeFilter:()=>pd,FrontFilter:()=>md,GlamFilter:()=>gd,GobblinFilter:()=>yd,IdentityFilter:()=>Ns,K1Filter:()=>xd,K2Filter:()=>wd,K6Filter:()=>Td,KDynamicFilter:()=>Ed,LUTFilter:()=>$d,LeninFilter:()=>Cd,LomoFilter:()=>Dd,MellowFilter:()=>Fd,MetalFilter:()=>Id,MorningFilter:()=>Md,OrchidFilter:()=>Nd,Pola669Filter:()=>Kd,PolaFilter:()=>Gd,QuoziFilter:()=>Wd,SemiredFilter:()=>Hd,SunnyFilter:()=>Yd,TexasFilter:()=>Qd,ThreeDLUTFilter:()=>ec,X400Filter:()=>Jd});class li extends J{_render(e){return this._selectedFilter.render(this._sdk,e,this._renderTexture)}render(e){return this._selectedFilter.getDirty()&&this.setDirty(!0),this.getEnabled()?super.render(e):(this.setDirtyForRenderer(!1,this._sdk.getRenderer()),N.resolve(e))}setDirtyForRenderer(e,t){super.setDirtyForRenderer(e,t),this._selectedFilter.setDirtyForRenderer(e,t)}disposeRenderTextures(){super.disposeRenderTextures(),this._selectedFilter&&this._selectedFilter.disposeRenderTextures()}dispose(){super.dispose(),this._selectedFilter&&this._selectedFilter.dispose()}restoreSnapshot(e){const t=R({},e);if(delete t.filter,e.filter){const i=e.filter.constructor;i.identifier==="3d-lut"?this.setFilter(new i({image:e.filter.getImage(),resolution:e.filter.getResolution(),horizontalTileCount:e.filter.getHorizontalTileCount(),verticalTileCount:e.filter.getVerticalTileCount()})):i.identifier==="duotone"?this.setFilter(new i({lightColor:e.filter.getLightColor(),darkColor:e.filter.getDarkColor(),intensity:e.filter.getIntensity()})):this.setFilter(new i)}this.set(t)}resetToDefaultFilterIntensity(){const e=this._selectedFilter&&this._selectedFilter.availableOptions,t=e&&e.intensity.default;this.setIntensity(t||1)}}li.identifier="filter";li.prototype.availableOptions={identifier:{type:h.STRING,default:"identity"},intensity:{type:h.NUMBER,default:1,setter(e){return this._selectedFilter&&this._selectedFilter.setIntensity(e),e}},filter:{type:h.OBJECT,default:new Ns,setter(e){return this._selectedFilter&&(this._selectedFilter.dispose(),this._selectedFilter=null),this._selectedFilter=e,typeof this._options.intensity!="undefined"&&this._selectedFilter.set({intensity:this._options.intensity}),e}}};li.FilterPrimitives=Cn;li.Filters=An;li.Filter=M;F.Operations.FilterOperation=li;var tc=li;const{Vector2:KE}=P;class zs extends J{constructor(...e){super(...e);this._flipContainer=new T.Container}_render(e){const{outputResolution:t,flipHorizontally:i,flipVertically:r}=this._options;if(i||r){const s=e.getDimensions();this._flipRenderTexture?this._flipRenderTexture.resizeTo(s):(this._flipRenderTexture=new T.RenderTexture(this._sdk.getRenderer(),s.x,s.y),this._flipSprite=new T.Sprite(this._flipRenderTexture),this._flipContainer.addChild(this._flipSprite));const o=i?-1:1,n=r?-1:1;this._flipSprite.setScale(o,n),this._flipSprite.setPivot(0,0),this._flipSprite.setPosition(s.x*(1-o)*.5,s.y*(1-n)*.5),this._flipRenderTexture.clear(),this._flipRenderTexture.render(this._container),this._renderTexture.render(this._flipContainer)}else this._renderTexture.render(this._container);return N.resolve()}}zs.identifier="flip";zs.prototype.availableOptions={flipHorizontally:{type:h.BOOLEAN,default:!1},flipVertically:{type:h.BOOLEAN,default:!1}};F.Operations.FlipOperation=zs;var ic=zs;const{Vector2:ar}=P;class zr extends J{constructor(...e){super(...e);this._colorOverlayFilter=new T.Filters.ColorOverlayFilter({color:this.getTintColor()}),this._frameContainer=new T.Container,this._resetSprites(),this._options.frame&&this._createSpritesForFrame(this._options.frame)}_resetSprites(){this._spriteGroups={top:{},left:{},right:{},bottom:{}},this._sprites=[],this._repeatSprites={top:[],left:[],right:[],bottom:[]}}_createSpritesForFrame(e){if(!e)return this._disposeSprites();const{imageGroups:t,layoutMode:i}=e;this._layoutMode=i||"horizontal-inside",this._disposeSprites(),["top","left","right","bottom"].forEach(r=>{if(typeof t[r]=="undefined")return;["start","mid","end"].forEach(s=>{if(typeof t[r][s]=="undefined")return;let o=t[r][s];"image"in o&&(o=o.image);const n=T.Texture.fromImage(o),a=new T.Sprite(n);this._spriteGroups[r][s]=a,this._sprites.push(a),this._frameContainer.addChild(a)})})}_render(e){const t=this._renderTexture.getDimensions();return this._options.frame&&(this._colorOverlayFilter.setColor(this.getTintColor()),this._updateSprites(e)),this._frameRenderTexture?this._frameRenderTexture.resizeTo(t):(this._frameRenderTexture=new T.RenderTexture(this._sdk.getRenderer(),t.x,t.y),this._frameSprite=new T.Sprite(this._frameRenderTexture),this._container.addChild(this._frameSprite)),this._frameSprite.setAlpha(this._options.alpha),this._options.frame&&this._options.frame.tintable?this._frameSprite.setFilters([this._colorOverlayFilter]):this._frameSprite.setFilters([]),this._frameRenderTexture.clear(),this._frameRenderTexture.render(this._frameContainer),this._renderTexture.render(this._container),N.resolve()}_updateSprites(e){const t=e.getDimensions();this._frameWidth=Math.ceil(e.getDimensions().min()*this._options.scale),this._updateHorizontalSpriteGroup(e,"top",0),this._updateHorizontalSpriteGroup(e,"bottom",t.y-this._frameWidth),this._updateVerticalSpriteGroup(e,"left",0),this._updateVerticalSpriteGroup(e,"right",t.x-this._frameWidth)}_updateHorizontalSpriteGroup(e,t,i=0){const r=e.getDimensions(),s=this._layoutMode==="vertical-inside",o=this._spriteGroups[t].start,n=this._spriteGroups[t].mid,a=this._spriteGroups[t].end;let l=0,d=0,p,u;if(o){p=o.getTexture().getDimensions(),u=p.y/p.x,l=Math.floor(this._frameWidth/u);const c=new ar(0,i);c.x=s?this._frameWidth:0,o.setPosition(c),o.setHeight(this._frameWidth),o.setWidth(l)}if(a){p=a.getTexture().getDimensions(),u=p.y/p.x,d=Math.floor(this._frameWidth*u);const c=new ar(r.x-d,i);c.x-=s?this._frameWidth:0,a.setPosition(c),a.setHeight(this._frameWidth),a.setWidth(d)}if(n){p=n.getTexture().getDimensions(),u=p.y/p.x;const c=new ar(l,i);let m=r.x-l-d;if(s&&(c.x+=this._frameWidth,m-=this._frameWidth*2),n.setPosition(c),n.setWidth(m),n.setHeight(this._frameWidth),process.env.REACT_APP_BROWSER||(n._canvasSmoothingEnabled=!1),this._options.frame.imageGroups[t].mid.mode==="repeat"){const x=this._frameWidth/u,_=Math.ceil(m/x);let f=0;if(_!==-1){let y=Math.round(m/_);n.setWidth(y),f+=y,this._ensureRepeatSpritesExist(_-1,t,n);for(let b=0;b<_-1;b++){y=Math.round((m-f)/(_-b-1));const g=this._repeatSprites[t][b],E=c.clone().add(f,0).floor();g.setPosition(E),g.setWidth(y),g.setHeight(this._frameWidth),f+=y}}}}}_ensureRepeatSpritesExist(e,t,i){i.getTexture().setMaxListeners(e+1);const r=this._repeatSprites[t].length;if(e>r){const s=e-r;for(let o=0;o<s;o++){const n=new T.Sprite(i.getTexture());this._repeatSprites[t].push(n),this._frameContainer.addChild(n),this._sprites.push(n)}}else if(e<r){const s=this._repeatSprites[t].splice(e);s.forEach(o=>{const n=this._sprites.indexOf(o);if(n===-1)return;this._sprites.splice(n,1),this._frameContainer.removeChild(o),o.dispose()})}}_updateVerticalSpriteGroup(e,t,i=0){const r=e.getDimensions(),s=this._layoutMode==="horizontal-inside",o=this._spriteGroups[t].start,n=this._spriteGroups[t].mid,a=this._spriteGroups[t].end;let l=0,d=0,p,u;if(o){p=o.getTexture().getDimensions(),u=p.y/p.x,l=Math.floor(this._frameWidth*u);const c=new ar(i,0);c.y=s?this._frameWidth:0,o.setPosition(c),o.setWidth(this._frameWidth),o.setHeight(l)}if(a){p=a.getTexture().getDimensions(),u=p.y/p.x,d=Math.floor(this._frameWidth*u);const c=new ar(i,r.y-d);c.y-=s?this._frameWidth:0,a.setPosition(c),a.setWidth(this._frameWidth),a.setHeight(d)}if(n){p=n.getTexture().getDimensions(),u=p.y/p.x;const c=new ar(i,l);let m=r.y-l-d;if(s&&(c.y+=this._frameWidth,m-=this._frameWidth*2),n.setPosition(c),n.setHeight(m),n.setWidth(this._frameWidth),process.env.REACT_APP_BROWSER||(n._canvasSmoothingEnabled=!1),this._options.frame.imageGroups[t].mid.mode==="repeat"){const x=this._frameWidth*u,_=Math.ceil(m/x);let f=0;if(_!==-1){let y=Math.round(m/_);n.setHeight(y),f+=y,this._ensureRepeatSpritesExist(_-1,t,n);for(let b=0;b<_-1;b++){y=Math.round((m-f)/(_-b-1));const g=this._repeatSprites[t][b],E=c.clone().add(0,f).floor();g.setPosition(E),g.setHeight(y),g.setWidth(this._frameWidth),f+=y}}}}}_disposeSprites(){this._sprites.forEach(e=>{this._frameContainer.removeChild(e),e.getTexture().dispose(),e.dispose()}),this._resetSprites()}dispose(){super.dispose(),this._disposeSprites(),this._colorOverlayFilter&&this._colorOverlayFilter.dispose(),this._frameRenderTexture&&this._frameRenderTexture.dispose()}static validateFrame(e){if(!e)return;const{imageGroups:t,layoutMode:i}=e;if(typeof e.identifier!="string")throw new Error("Frame needs a property `identifier` of type String.");if(typeof e.imageGroups!="object")throw new Error("Frame needs a property `imageGroups` of type Object.");const r=s=>{const{start:o,end:n,mid:a}=t[s];if(typeof t[s]=="undefined")return;if(typeof t[s]!="object")throw new Error(`Frame: \`imageGroups.${s}\` needs to be of type Object.`);if(typeof o!="undefined"&&!(o instanceof Se||typeof HTMLImageElement!="undefined"&&o instanceof HTMLImageElement))throw new Error(`Frame: \`imageGroups.${s}.start\` needs to be of type Image.`);if(typeof a!="undefined"&&!(o instanceof Se||typeof HTMLImageElement!="undefined"&&o instanceof HTMLImageElement)&&typeof a!="object")throw new Error(`Frame: \`imageGroups.${s}.mid\` needs to be of type Image or Object.`);if(typeof n!="undefined"&&!(n instanceof Se||typeof HTMLImageElement!="undefined"&&n instanceof HTMLImageElement))throw new Error(`Frame: \`imageGroups.${s}.end\` needs to be of type Image.`)};if(typeof i!="undefined"&&["vertical-inside","horizontal-inside"].indexOf(i)===-1)throw new Error("Frame: `layoutMode` must be one of vertical-inside, horizontal-inside");if(typeof tintable!="undefined"&&typeof tintable!="boolean")throw new Error("Frame: `tintable` needs to be of type Boolean.");r("top"),r("left"),r("right"),r("bottom")}}zr.identifier="frame";zr.prototype.availableOptions={frame:{type:h.OBJECT,validation:zr.validateFrame,setter(e,t){return t||this._createSpritesForFrame(e),e},default:null},alpha:{type:h.NUMBER,default:1},tintColor:{type:h.COLOR,default:new O(1,1,1,0)},scale:{type:h.NUMBER,default:.1}};F.Operations.FrameOperation=zr;var rc=zr;const dg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAMAAADDpiTIAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTM4IDc5LjE1OTgyNCwgMjAxNi8wOS8xNC0wMTowOTowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTcgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MDA4NDFGODc4N0ZCMTFFOEFCRjZEQ0E4MkRCQzYyNjIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MDA4NDFGODg4N0ZCMTFFOEFCRjZEQ0E4MkRCQzYyNjIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDowMDg0MUY4NTg3RkIxMUU4QUJGNkRDQTgyREJDNjI2MiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDowMDg0MUY4Njg3RkIxMUU4QUJGNkRDQTgyREJDNjI2MiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Ppk6b2UAAAASUExURQAAAP///8zMzDMzM2ZmZpmZmer1GSkAABunSURBVHja7F3rgt6mDlzr8v6v3O5ukqaJbQSS0GDjn+c0+9lomBkJEB8fD3tEPvbz5ocO3oPw6vgfx+aA9z56HBsBL37k+H50D8UrHz6OjYAd/42ANxvAjYC3G8BfD+0ReacB3AjYBmAj4IXPcfJQVVFQaFuQSgNYiwBW2uxTbADrEMDyA4p7RaLUABYhgP8D4i5H1xrAAgT8mvzbgWIYgLkI4D9VaGtAuQGYiAD5G4NbAxAEYAoCvmz/rkJAVQAmxoKvCGhrAIABSEeAXP/81oDiDDAfASx36NvFQAgDkIcA1kLh2U+HAKTMx1b4twlAyADTEMBUgLn9DAtAcDyYCo3HfroywAQEiFl2tgbgCEAYAuzh34lgUQaokheRnvBvE1BjAOiuNiATw79NQE0GyB9JCOgN/zYBJQIgd/+nIybcH/5tAgoEQO/hMYqAofBvDZgvANTOEAYWh1mPYwNgCQFgQ45Is8K/TcB0ARBTlaAPAY7wbxNQJgD3oevIz+3WX8+YYmtAlQDEIMAcfhI+p6WtAVUCcI8AEzWzPfyXvLQBME8A1F4ssiDA7P1Ibn5tV4PnCUBPubA9NcUafr79N9sEFArALY3flwOs4q/ceDPaGhD+aJev44Fk0Mr+ym2+2QCYIwDUSxg38iyD4T8FwK4EzHGA/BGFAKP3V7ZBZ5uAUgG4n9EyXPhTtmJtA2CGA6RBR89j5k+5g562CZggADJEG395dHaGf5uAIgfYrraoJRUQb/i3CUh/OkpAtoKQ9k1/5W6F2gBId4AmkqWGEZTOqp/domwTkOwA1fFvf8bHMv1NRb3tAqFKAFYEGKY/yShH7fWgXAcovn/+ObMNub+Mk9Q2AakOkLwAOgK83wZAnQNk91+IEf9tApAdYCsVCBD/XQoqcYAU8UdC9/XKdoHfbCs8gwAk5K9EiP82AX9NNSJhxiKATiNIEgPUF5qAX8NAGgMCiTp4I3nsv13gxTwg8usBhTVg0Azvf//35eUACGACCTx6SVnsf/mqLzQB5wEbBgEHUrTJCGog9l8JALo9QxVD2xQYoqjpf/7tGwBOIuDgo9eS2ttpu0CDzvYRgUaHSdOm//kffx0ALDJL5iJLNAHcAtRfttu1QHPBzSgGGt96gbOm/3aBvdWWthhwRvcdyWvtuAHQu+7awACl9F7RvKY+2wX2L7rdYCCFAD6MXWY2ACYB4AYDlDRROU0EZBeDx9oqnmIgiwDMjYZCoPWyNICP4cdy5D6KUTVJBLYLdADgz/oAZ3n1a6LShL+7ATAqBZrZf5OTROD1LlAO9/OjIpNKAGki8HoA0BHwfElBKgF8jJ4232nADAB80UAuAWSJwOvTgCgA5BXrGmql4QCglwOAhKJQoTPAKuED8B86fnvkt+f3//15ScDn97MQHAEMNh0acYGi9P1YtO/7UZUl8XAtgcxKWATgPnM8QwO/0SDLYIFvx9OJgfghoPjf0TQD9BMJqwHgj25c42KgU17X9UMBNGcGwjJ1II4aJZ7zvqO/xHFm14oDQBhYd0UOYCAnm4o5dzg7+L/DAAsDHZXQXgzwLM3q9IFTaH/6uGRkwT4M0DzO6vixoPzWQwEfCwOgBwNpFXXHr5VH/wEA+DDe0ZD3naOHT4uZH3OpabASbiBSmQlaw+8JRPThLMD4UkgLAzz1pVuvDRN+tIuJXIuhd5yauqTae/wIJ/xwFoCd3H05tDz5rW9GFin8cJsN2B26cxpIxrnYKQAr/HD7zSTgDaXA6lopgMHC/0gAaMFnim1sFS38cLuNAhokcInQWXRH4KY/3n7DgE3RFQpgoQD2Tf9f+3z+t//r/4+IdmwdgtxxHAAAquE5akwvGY770HaeH4jQFhoYHgC9weOie9hPA+yY/t+r9THx+cLCKRDgNhwHAKAK5nRDsNIZ+5yNGitcSeMHgFbBXK5toHbEXvM26axwHYEfAFQGc7rgHnPuTzK9XsmPA0DhV8q5DbTRf+bMv34/OAvgPxdV+JV8utamtujXMJQ+DwCVXzmY6CuX4ZMXAIC6ASCFb1+t+68DQO1XDnS4mze2uoAFcG8HKDY6ghv+Re6kcwOg9isZN/yLXEjl3g9S3GGnQwNmG/A1bqPxAqC6vYZZA+ZvxaQNACAKEISRRWw+5QVA+X0LBJT4N7mJnweA8iZ7Ajn9V0kCHwAAhpz+H8tcTC7hAKD6gUYY9VVuJXYCAKDHnmKew1pEARIAoABTDWDxbYWVwBwACBAA6kR3kSTQDQCpFzqGPIari1gAbwQB7t1UyBMYtIgF8AKgvtc+Qx7AWEYB4gGAkgUK2rCC3kKxOgAEswvHMgqwPAAwT+CuowCrA0AxD+CuowCLA4Ax47+QAiwOAELk/6UUYG0ABDYOf2cV6MO9HFwLAALtwLGQAiwNAFQCWEkBVgYAAxaAllOAlQGgmA5wLQVYGACwBLCUAngX9AsBQKgEsJQCrAsAVAe4mAJ493TVLQejpoBFXROrAFC2IWQpAgBWAO+23qotYbAO8LxtzQfw41NxLgIAbAq4mgIsCgBcAlhNARIAIEWjjEEADGpNJwJgwufiOsDFigABmXxJIQA2BTzdogZtAd2ZfAUAzveBQYymLKcArUz+99sRQAAA7ADXs4CnmP3tGgz6+woN+r5CI4ZAnpUCrlcE+BhrtvnzYo1/cTC/FMjA93DoakWAz/tfD9cznwGAHeDHsZACfM7ejquOeloxvzUFXMYCfoX+SHto+iRDGWV8C3h1k9E6AAB2gOAW8Cv2x5Rn9r3xKD4L1gJOjH02AGgxAqhXAD6/2zv1yUM9sgO8UCcpfLvJE3/CjEROAT+gGlUmG/0iAEATgMD0Kq1g/SkhgXaA9x1L50GAEW5MT4oJcgrYbFo9AwJVmj+JAhYmgAkQqOf9dF+GnALa1tT00byfTQHQDtB4hWXKtVVQUz9xYkKngOZF9WAIMGT0U6T5CQTwDQFeg/h/bglSVZHPPUKnm4Sun1c5wL5dNUFuUJOCLtcbAH/SDkt7K4FOmGIwS21aYZI1NvByG/SBaiNvAsi1AhwTehVmnw7RBB9IjyKAICtA3tAzx8xS1mwKwHaAg1PRbQWkatbPV2jkfWAOMZbpwPua9utVaYGPAvm02KkDhBD7CRyN7QDP4WnN0V06YL85O39fSmadDtsB8tXbMaXrAFVP/CkUwNAO8DwI329ng4BDB7Q98bl0HAidXBIJoAMCEjs3ZrH+JKGWZQnADoFhEiCM4GemgoydAkr7q00Q0Lifr7owK4kCsFPAJgF8h8li1sZGCokdU7h6xRTwhPYsENCoFyCo2aAJfxM7BTzHvOaQAD+cAlZ0gBeQZ00hAUJySPHTldZzgNfwNLjBfhKAooBwwX4QAVitgEa8RJlHCk4FV3SADXhqeE1AoLKk2KRdF3SALXgarID6x7xskoRyNjgBjDqetg70kQBUJhjq2lbcBybj/3QU5Qw1TQKX7lbcB2aEZzsf0GUpIE63sVNA8sGzqQMdMoDVmyZMuBWaADRl3g7+McKngKMOSBPNbt9XchgJCNZUiaFu6BSQYzZ2aJQXxKKAEPO2YjeI/iFvkoA+hwJo/t+YrHJDIy4xMoDllwNm74r9wMboqUkCsiAF+PUbeR+YBJ+FlAAZ4IdRAPI+MA4/Dd0iAYsMKBYFOBkc2QFyxjm/VjrAq1GAMxUEdoCccxi+RQLyKgoAPgp0GSj326nTCCxBATSDPkriH3EAhnxGAIwCODilgSCAy/jHoFNdCECjgOFU8GKdleufy3wtyp6IywgsQQHqnQeQD6dTjGX0GMw6DzI5rxd/ySZOYzjBKGDQy9Fy8dcJ88YEADQKGMrmZLn4R4/w3bZhHqAPAaMAehgBxM8wHfYaa1CAPIsABCf+eBTQvaazoAOMvhhOPVBDo4DuVd0FU8CvL2KM+ONRQO/x2WPVJ6otizP+eMsofT6QjuPdEFC31VCwgnCXD5Rj6ccPAfLXGuAooGdJgI7j1RAIiD/edvoOCtBj/cdjB0Pif2G80Sjg7IX4eMQzCgEOir+lcyHmkoAeD3mkNP4XA46fCvLxmGeg3RsHrjXBbaixpYJ0POhRros/3pY6kw+U41lPwDmo4bgtmQqef720n3N+kZyn455WLYs/3rZ6AwWMZ6+T4W6/q9d3ut/F23AHa5q2xPPG0ysfZgw43t+p27qED9QYzqqAu/VGqKL4412y0KAAX+JSkvbYaKAtA5QR/+VSQWfeUpT2mGiAR8s/zg9Yygd64VoGd0sHeBlL/70AFjQRuNkd5hfxOrizp+mnRNeT29oCeVDIb+Mr0x4e7veXGn9fJ9OpPjAieqWL4E0IaK/9D8GuFs6KLp6O4O/iygcPHO7Pjv8qIsAxlbzqtKcBAe2x/1HAFTQROJ/qQTlc+QrY/cFe7fiPw2CLJgIdK/4cxS/1LucMAXLMiP/VgIO1D4wCKUDl41YH1DYOofe+womAdR0tvNSEQAJqiv8E1S0UAckSgEapCcMJSFv+o00LnAhQGgF8oLSX1XsEyDEx/ldvUycCnEcAMCtgcvdlk+N/NeXq1gRy7s9FSQWbKKcjP/03vYwAU0B4qWn+Rw7tcJapU67MBkjmOMCcixtAAM99F7CbJYNeDGczZO8xJ+LZpKugFMAJ4/4BjwAteBWBpADN+OOKjgAtGfEqG8CZSgi0GVKr7V9rxMtsgGZOBaDNkAoS/8s3ITgKoKw/XqN3VGz/miNeZQRl+k6oIqwbEECV411mBClxMJAoIPaW+Iy8S6AogBP/eI3l5XL5b1kRBqIAyhz0Irnj6tFvkhDSzJBMxDMU2VXbv3J7pJM9QF3OI6jyXzwwaRRAaI63MAlXhDrkZKsmaEi/hKRU/TAIAmhiJbCWArjGfnFKP6PsYeE0AsBb/aAS2OEgIMMHMiDVXcNS5/8k0tBkpIKKmPNWpKbdfXcVZlQyaQ9tHxTBxH9OVcKUCmr4MANvhtWZcMNDQHQqaNC9MgqQeSJwb/8FSSGDU0HYlHeqCHBjmgsQQcamgibhqzsWN2nM22ePBGh+RKaCtsQX7lgcT4y/NP+b2UYgMhU0Oh+09gg0L/5s4UqIA/WZlS+0HjmhI25tPaE42UCYDzSnPnA9cubEX+1+SespgGO5D1sEdH78GwggqaYAiplcinZ7Tmrrvj5lV5SqUIwPvEgn0LqmZ/Zv7e08pyiFwYhU8BJFaF3T01r33ZX/LmLZ7HDL61DAZZzhbs+hHB94G//hytkkCPh5+uYvrHGXsibGXz3OeY4QuK3azR+Ao4CM+5yGL54w5E4zMoLUG0PgLtCa1RjFBHVL+YyESyiAfN8v4aWmVLhLSfytW0ezzYCPpxsyv+hdyiHx59Hhm00DHqvWRM+CF6nGlECNDs5aRE3FgMMbN+P7aB8YsbRrP0GQh4Fxnjb8S7RUMNCWSMyyZ8cmUkp6hn/MwB2rXaQaEv++z5OhfaS4T9aAg/nAyM1d+qT4Sx7nZvpALoz/aIdjyIfyOBch7THkf2MO9zE6wOm5d1LaI6Xxf4wOaHruneUDqTj+tuuwVyQApDbSd5wkxfF/BAQ0vNQ0zwdSefwfAIHs3BuBAm4ce4SsLQ0BmbQGk5QKOsATaWvWhQAl597ZqaBAxP9zuBZNCjk394agAHUt/z67LqDTlmGzKEBh4v8x2GkClQBW2R3Gw/Gfe9R8LQeIuSQgA++jARsA/Lnmcg5wpVSQxyelvDv+7e9HSwX7KaCRn+mrDQANglpWooBppzovf4cAnmETrMtTQNOaSeKbFXumADe3BgWMF4K/xiGCBHhaqhHHTjwObMaigDEvExokQo6/axov0TPCUQyK+R5Fjr9PyJ9BAS0j4DzSycj679VxtFSQxl6ntYdTw2kJJf7eCKL5QBl9nQYCHAmhQsffzeH6DAow9HiJFQDCiL9/bxfaQaFhCmgu1gySwHiZpS4FnMshKBTQPsyhYSOMEv8QBacFKIBd0XKQACMngEEenh9DAYY1e40YYRQDGMXeYD7QQwFtGeirCQi0AYwib7RUkFxf1SYBdo4MigGIs29gB4XE91kcd1uWQhuAwAQOTOi8b9Pcxm80g4wtAIHSDZYKipeQ2vs3TXgiaAEIVW6sJQF2f1lbBmh0iQlFAGJjBuYD1f9pAZ1/CVoAgllb8Smg89sMTV6UJ44waAq4EAVkdHqSKR57AQJAwzuHvIyBBK6tgEILQMKExVoSoJiXMZDAhRVgbAeYAE8sCpCg0pSl3ZuaLxHSBxMAmumlqA+0NHdQ4whjO0BCRFUoBYx9oYUE/rIC+i4HCGd7+PzUH0eO1x0EPB1r1ksBwSjg3+BT9L4+6oSArucAI/Sp3gfeBN83B03dHX5BgN+WAkKkgq3g+77S1unrBwT0bSlgufdlIdMBfM9n2ro8fUJgRQIIClJBKvg58e3dFzh86pxAQN+XAtb4QLZO/Cg9ctwC8NRVQNskgYh9SByGu/3BEED2GlX6Ghj3cf6cakcy86SngOkME3JDmjP0YeUOWpgAJmj01fCQMo9HXvyhD6x30LIEMMGl3zXEo08UcE/gP+d8bIc1zeM5fAKYUqprb6omEvkMLp/H/N/5/jnhKaW1XtAF7n0d4J92FGicAv6GgqllXVTwIy9r7YHAqwgA9bYsCr+13ewGUQhg2jZFekH0e9wgyirAtPV6rMbolHlTuwUC2ASQgk56+tTvgsCjukGE+8BVp74dAigEMHW3hr4l+AYIQBNAVoWK3xP8JgT4hQRQB4CK4N9DAKQKPHvDJtUYvtLZJgRMALO3bNP8ic+QLEvvJICJpQCqnvj3qAd+tVRw8stif/XNIAQwf8M+vyv2lzIrwASg838yKPQCF/tLzDMsNLPfjRIi37edBIFmH3EpSBgAnKv9uKFHt4Alp3blbDT4azf3IBDAAYBrAWvOa/Ed53xt+1I9u8VS9Wu3mCwHAFwLWNO5g32CyMsBAFYBis5ssw90jLuqZudZDAtYtUJB7wKAohJAWSv3cADoagRAqC82ZzKFA4CQASCoFrCudxv5KJHWAgCqBSxsV6dvAgCsAhQ27ZE3AQBVASrbdvGbAECYBFDauO9NAEAtApS27nwTAATTAtZ27nSWcpYCAKgC1LbvfhEAQBWguHGrs5anC60GgZaBi6/weBEAMBWgunPzewDAkEWA+t7tPhVfaEcIpgLU397wGgBAKgDA5Q1vAQCkAiDcW/0WACBWgQRgX63TBK4DAEAFEIST6m8BAKACXPVn+dgAeIUCEEavGmcpeBkAoCnAZfvK2W/lXA1cBQBoCiAwJ6vkHQAAUwDF6Van7wCAIinAXffi6W9F7wAAAa0EC9ThWueC/iIAYCAFUKiOtd6THYsAAEcBms3rdQPgyQrQbstG5S8kzqkFCACUJNB0d8Xc8fMGcA0AgCSBtq6Mc5FJrwAARBnQenXN1Ddzn+6lFQBwNvTTFcDemp/XBgDgtnCAJLDnEkuphaU+DwDlSWDfNbYz383N4EsAoDgJ7L7FmBfixhUAUKsAAzfZz0OnuPlnBQBIHcuyDHXb5HW4cQUAlCWBpmtrqdIG+tOjRQEgM6Jvmvxc2bYmQBwXAECBBWBj9A/i872BkyggID1aAACTLYA5+D/jXHiFkd8CrNAncGIS2BP87+n/+ZTZwABuXKFT6BQL8NlWvbO/vt4Q8ZxpFKAACwCAL641oa9+9+yP/NfdCv0Xq8j9G/Ia3LhAs2hp3nDzfb1RDxz4+yaF4Us1/hhoqqGAiF0SC9wX0BOi/12I8eP5N9I/nv+uzjicD0kbo1yhAN2/+jAATHrU8o4Vd4X0/yj+lkCGCz+xTaakQBvleQAQtPCfjnHFqnBI53T8HWEEzv5lFHBOjequBG8A3IWfu3LV6Rbwm6Ie1SqYVwj/VTikaGBINgDitf+eXKdfGSKet10IAIps/ZovqoXSaMMAPAAInfuLKEBssOX+t6atAGOmSqb6QIp5e/i1IF4k+le1gCwfyEHfAL8WJLW2j/3vmiMCGoRj+KUACVi5GQp+XzZ9Q8sEQoznH7REd4CBvRrzg39NAVJPANcYWOm2gO+NG9lAEM8Wk/OXQ3JGf+aGtA4AfgeC5gGB4wMTb6sljOAWuzn4DyD83NQTCQZJoOZwEYgray4MgL/BIPrfhqDWjiH93CnEEj5djxk+UOKczkMAcAGJkye7DiYzRCDQ7h5PBUDZWhjli0BubURfDgCvCeYEb2kgAO060ZJngjYALnwgJRMAfww1MjjWywLT7ZQkgCp0Yt3gK4IG3gWAjMWw5Iuk9P6Ps24A+ABAOSGKEoH25kN2ScG7koCcPJgz7bVp76EDAxsAARwoef7avPt41A5sAESIoKbJa8/m4yEM6MsAICkTlbNmV+/xg34MyMsAkLQpMutKUeqPWScGeAMgRAUpZX4N7jvtwcDbAJCzHHbdW5bjYWX6k9a84G0eMMcFStIA+zaef26o2gCw2GrvcpAmueyAoydNMXgfAML3hEiazdaQiN2LgbwOAMEu0FCK5zoC+PmXromANwBcAJBEn0WhinLhCN4HgEgXyJlOO+Hc0QkINgAco6Cp5VbKKdz+HwTv84BxLjD5VilNPHPyubv+vQCIMQGd+zA44C1jPfunMaTXLQVdDS0H0EgsAuacO+UXWoAIEzCw/YIiAPbKcE0BQBe1ju3C6yPbXbWb6wJ7hnZ0E6a6f2MTAIALNLA/uVOBWYeOtwb0Ti5L+PnDjYBZbQc2ADrX2MlG9OxMBeY1HnnpM3YBt8n7yW2SSDacbQcIaAJM4f/VjkU8ySBtB4hXCtLOgq+OpwKyHSCcCTAVfv7fjYlGEXBhIHbQkgGgzvD/2VyaR9eFaDtArFKQreyr1pnciqVsB1jkAtkRfmJzKBsImNBvZD92E2Bc9JFO48hbAAABIKPhv75boB8BWwBgTID5ZI10G7rrgtAWABQTYF7xlZGU7nJO0y4BQJgAc/h14IKWGwRsAYCoBJjDb6nsS8fuAN5ndwBMgNjv5hn9oSsEbAGoNQFHT/jt81KtCNDtAKsTQXtbhZ4Le40I2AJQDoAjI/x3P6VbAKBMQKD360fAFgAAExDo/Yy/JQ08bgEA0wCSYLTJ7X+wBQALADQ8IaWBANoCgG8CSFJ+Ta4NwBYAIBNAkoU32QKArwEkiYxzUX3aawDJj84M/0f/mcJtAEA0gGQ64rYATAEATQ1/JwK2AECYAIo14roFYKlEkLgAczsDRDEByjWsswUAQQNIefpv7oNgMIkgSQnqtgHA0ABKFWBD8rEzwEoN0Ozp10TANgB1GkAygX1bCNgCUKUBOmno7xGwM8CJAKAJvr8TAdsAlJgA5TLkbQNQ+Mg85TciYBuA2SaAtGTMeXcCwMgDykb8FAHbALy7CrENwLsRsOP/cgRsA/g+C7IN4EbANoAbAdsAbATs+L/2kW0ANwK2AXz1w4+L/z8CDADebzi4XHs84QAAAABJRU5ErkJggg==";var sc=dg;var oc=`uniform sampler2D u_image;
uniform sampler2D u_watermarkTex;

varying vec2 v_texCoord;


void main() {
  vec4 color = texture2D(u_image, v_texCoord);
  vec4 watermarkColor = texture2D(u_watermarkTex, v_texCoord);

  if (watermarkColor.r > 0.8) {
    gl_FragColor = mix(color, watermarkColor, 0.3);
  } else {
    gl_FragColor = color;
  }
}
`;class nc extends T.Filter{constructor(...e){super(...e);this._fragmentSource=oc}_applyWebGL(e,t,i,r=!1){const s=e.getContext(),{canvas:o}=s,n=this.getShaderForRenderer(e),a=t.getFrame(),l=this._watermarkCanvas;(!l||a.width!==l.width||a.height!==l.height)&&this._createWatermarkCanvas(a.width,a.height);const d=T.Texture.fromCanvas(this._watermarkCanvas),p=d.getBaseTexture();e.updateTexture(p),p.setGLUnit(1),e.setRenderTarget(i),r&&i.clear(),e.setShader(n);const u=e.getCurrentRenderTarget().getProjectionMatrix().toArray();n.setUniform("u_projMatrix",u),n.syncUniforms(),s.uniform1i(s.getUniformLocation(n.getProgram(),"u_watermarkTex"),1),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,t.getTexture()),s.activeTexture(s.TEXTURE1),s.bindTexture(s.TEXTURE_2D,p.getGLTextureForRenderer(e)),s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0),d.dispose()}_createWatermarkCanvas(e,t){const i=this._options.watermarkImage,r=S.createCanvas();r.width=e,r.height=t;const s=r.getContext("2d");let o,n,a,l,d;e>t?(o=e/i.width,a=(t-i.height*o)/2,n=0):(o=t/i.height,a=0,n=(e-i.width*o)/2),s.drawImage(i,0,0,i.width,i.height,n,a,i.width*o,i.height*o),this._watermarkCanvas=r,this._watermarkContext=s}_applyCanvas(e,t,i,r=!1){const s=t.getCanvas(),o=t.getContext(),n=i.getContext(),a=this._options.watermarkImage;this._createWatermarkCanvas(s.width,s.height);const l=o.getImageData(0,0,s.width,s.height),d=this._watermarkContext.getImageData(0,0,s.width,s.height),p=new O,u=new O,c=new O;for(let m=0;m<s.width*s.height*4;m+=4)p.set(l.data[m]/255,l.data[m+1]/255,l.data[m+2]/255,l.data[m+3]/255),u.set(d.data[m]/255,d.data[m+1]/255,d.data[m+2]/255,d.data[m+3]/255),u.r>.8?c.copy(p.clone().mix(u,.3)):c.copy(p),l.data[m]=c.r*255,l.data[m+1]=c.g*255,l.data[m+2]=c.b*255,l.data[m+3]=c.a*255;n.putImageData(l,0,0)}}nc.prototype.availableOptions={watermarkImage:{type:h.OBJECT,required:!0}};var ac=nc;class Gs extends J{constructor(...e){super(...e);this._applyWatermarkFilter=()=>(this._watermarkFilter||(this._watermarkFilter=new ac({watermarkImage:this._watermarkImage})),this._sprite.setFilters([this._watermarkFilter]),this._renderTexture.render(this._container),N.resolve());this._loadWatermarkImage=()=>this._watermarkImage?N.resolve():new N((e,t)=>{this._watermarkImage=new Se,this._watermarkImage.onload=e,this._watermarkImage.src=sc});this._watermarkFilter=null,this._watermarkImage=null}_render(e){return this._loadWatermarkImage().then(this._applyWatermarkFilter)}dispose(){this._watermarkFilter&&this._watermarkFilter.dispose(),super.dispose()}}Gs.identifier="license-watermark";Gs.prototype.availableOptions={};F.Operations.LicenseWatermarkOperation=Gs;var lc=Gs;var hc=`/*!
 * Based on evanw's glfx.js tilt shift shader:
 * https://github.com/evanw/glfx.js/blob/master/src/filters/blur/tiltshift.js
 */

uniform sampler2D u_image;
uniform float u_blurRadius;
uniform vec2 u_controlPoint1;
uniform vec2 u_controlPoint2;
uniform vec2 u_delta;
uniform vec2 u_texSize;
varying vec2 v_texCoord;

float random(vec2 co)
{
    highp float a = 12.9898;
    highp float b = 78.233;
    highp float c = 43758.5453;
    highp float dt = dot(co.xy,vec2(a,b));
    highp float sn = mod(dt, 3.14);
    return fract(sin(sn) * c);
}

void main() {
    vec4 color = vec4(0.0);
    float total = 0.0;

    vec2 vector = u_controlPoint2 - u_controlPoint1;
    float offset = random(gl_FragCoord.xy / u_texSize.xy);

    float radius = smoothstep(0.0, 1.0,
      abs(
        clamp(dot(v_texCoord - u_controlPoint1, vector) / dot(vector, vector), 0.0, 1.0)
      )
    ) * u_blurRadius;

    for (float t = -30.0; t <= 30.0; t++) {
      float percent = (t + offset - 0.5) / 30.0;
      float weight = 1.0 - abs(percent);
      vec4 _sample = texture2D(u_image, v_texCoord + u_delta * percent * radius / u_texSize);

      color += _sample * weight;
      total += weight;
    }

    gl_FragColor = color / total;
}
`;const{Vector2:Ot}=P;class dc extends T.Filter{constructor(...e){super(...e);this._fragmentSource=hc,this._lastBlurRadius=null,this._lastControlPoint1=new Ot,this._lastControlPoint2=new Ot,this._blurFilter=new Ve,this._blurredRenderTarget=new T.CanvasRenderTarget(100,100,1),this._maskRenderTarget=new T.CanvasRenderTarget(100,100,1)}_applyCanvas(e,t,i,r=!1){if(this._options.blurQuality==="low"){this._renderLQBlur(e,t,i,r);return}const s=t.getDimensions(),o=!i.getDimensions().equals(s),n=t.getBaseTexture().isDirty()||this._lastBlurRadius!==this._options.blurRadius||o;if(n){const a=new Ot(this._options.delta.x,this._options.delta.y);this._blurFilter.setDelta(a);const l={blurRadius:this._options.blurRadius,texSize:s},d=(x,_,f)=>Math.min(Math.max(x,_),f),p=(x,_,f)=>{const y=d((f-x)/(_-x),0,1);return y*y*(3-2*y)},u=this._options.controlPoint2.clone().subtract(this._options.controlPoint1.clone()),{blurRadius:c}=this._options,m=(x,_)=>p(0,1,Math.abs(d(new Ot(x,_).subtract(this._options.controlPoint1).dot(u)/u.dot(u),0,1)))*c;this._blurFilter.set(l),this._blurFilter._applyCanvas(e,t,i,r,m),this._lastBlurRadius=this._options.blurRadius}}_renderLQBlur(e,t,i,r=!1){const s=t.getDimensions(),o=!this._blurredRenderTarget.getDimensions().equals(s);this._blurredRenderTarget.setPixelRatio(t.getPixelRatio()),this._blurredRenderTarget.resizeTo(t.getDimensions()),this._maskRenderTarget.setPixelRatio(t.getPixelRatio()),this._maskRenderTarget.resizeTo(t.getDimensions());const n=!this._lastControlPoint1.equals(this._options.controlPoint1)||!this._lastControlPoint2.equals(this._options.controlPoint2)||o,a=t.getBaseTexture().isDirty()||this._lastBlurRadius!==this._options.blurRadius||o;n&&(this._renderMask(),this._lastControlPoint1=this._options.controlPoint1.clone(),this._lastControlPoint2=this._options.controlPoint2.clone()),a&&(this._blurImage(t,this._blurredRenderTarget,this._options.blurRadius),this._lastBlurRadius=this._options.blurRadius),this._applyMask(t,i)}_renderMask(){const e=this._maskRenderTarget.getCanvas(),t=this._maskRenderTarget.getContext(),i=new Ot(e.width,e.height),r=this._options.controlPoint1.clone().multiply(i),s=this._options.controlPoint2.clone().multiply(i),o=t.createLinearGradient(r.x,r.y,s.x,s.y);o.addColorStop(0,"#FFFFFF"),o.addColorStop(1,"#000000"),t.fillStyle=o,t.fillRect(0,0,e.width,e.height)}_applyMask(e,t){const i=t.getContext(),r=e.getCanvas(),s=e.getContext(),o=this._blurredRenderTarget.getContext(),n=this._maskRenderTarget.getContext(),a=s.getImageData(0,0,r.width,r.height),l=a.data,d=o.getImageData(0,0,r.width,r.height).data,p=n.getImageData(0,0,r.width,r.height).data;let u;for(let c=0;c<r.width*r.height*4;c+=4)u=p[c]/255,l[c]=u*l[c]+(1-u)*d[c],l[c+1]=u*l[c+1]+(1-u)*d[c+1],l[c+2]=u*l[c+2]+(1-u)*d[c+2];i.putImageData(a,0,0)}dispose(){super.dispose(),this._blurFilter.dispose(),this._blurredRenderTarget.dispose(),this._maskRenderTarget.dispose()}}dc.prototype.availableOptions={blurRadius:{type:h.NUMBER,default:30,uniformType:D.FLOAT},controlPoint1:{type:h.VECTOR2,default:new Ot(0,.5),uniformType:D.FLOAT2},controlPoint2:{type:h.VECTOR2,default:new Ot(1,.5),uniformType:D.FLOAT2},delta:{type:h.VECTOR2,default:new Ot(1,1),uniformType:D.FLOAT2},texSize:{type:h.VECTOR2,default:new Ot(100,100),uniformType:D.FLOAT2}};var Us=dc;const{Vector2:Ks}=P;class js extends J{constructor(...e){super(...e);this._lastBlurRadius=this._options.blurRadius,this._lastControlPoint1=this._options.controlPoint1.clone(),this._lastControlPoint2=this._options.controlPoint2.clone();const t={blurQuality:{type:h.STRING}};this._horizontalFilter=new Us({},t),this._verticalFilter=new Us({},t),this._sprite.setFilters([this._horizontalFilter,this._verticalFilter]),this._horizontalFilter.setDelta(new Ks(.5,.5)),this._verticalFilter.setDelta(new Ks(-.5,.5)),this._filter=new Us({},t)}rotate(e){const{controlPoint1:t}=this._options,{controlPoint2:i}=this._options;e===90?(t.flip(),t.x=1-t.x,i.flip(),i.x=1-i.x):e===-90&&(t.flip(),t.y=1-t.y,i.flip(),i.y=1-i.y),this.set({controlPoint1:t,controlPoint2:i})}flip(e){const{controlPoint1:t}=this._options,{controlPoint2:i}=this._options;switch(e){case"horizontal":t.x=1-t.x,i.x=1-i.x;break;case"vertical":t.y=1-t.y,i.y=1-i.y;break}this.set({controlPoint1:t,controlPoint2:i})}transform(e){const t={};["controlPoint1","controlPoint2"].forEach(i=>{const r=this.getOption(i);t[i]=e.applyToRelativePoint(r)}),["blurRadius"].forEach(i=>{const r=this.getOption(i);t[i]=e.applyToRelativeSize(r)}),this.set(t,!1)}_renderWebGL(e){return this._renderBlur(e)}_renderCanvas(e){return this._options.highQualityCanvasBlur?this._renderBlur(e):this._renderLQCanvasBlur(e)}_renderBlur(e){const t=e.getDimensions(),i=t.min(),{blurRadius:r,controlPoint1:s,controlPoint2:o}=this._options,n={blurRadius:r*i,controlPoint1:s.clone(),controlPoint2:o.clone(),texSize:t,blurQuality:"high"};return this._horizontalFilter.set(n),this._verticalFilter.set(n),this._renderTexture.render(this._container),N.resolve()}_renderLQCanvasBlur(e){const t=e.getDimensions(),{blurRadius:i,controlPoint1:r,controlPoint2:s}=this._options;return this._filter.set({blurRadius:i,controlPoint1:r.clone(),controlPoint2:s.clone(),texSize:t,blurQuality:"low"}),this._sprite.setFilters([this._filter]),this._renderTexture.render(this._container),N.resolve()}dispose(){super.dispose(),this._filter.dispose(),this._verticalFilter.dispose(),this._horizontalFilter.dispose()}hasChanges(){return!0}}js.identifier="linear-focus";js.prototype.availableOptions={controlPoint1:{type:h.VECTOR2,default:new Ks(0,.5)},controlPoint2:{type:h.VECTOR2,default:new Ks(1,.5)},blurRadius:{type:h.NUMBER,default:.025},highQualityCanvasBlur:{type:h.BOOLEAN,default:!1}};F.Operations.LinearFocusOperation=js;var cc=js;var pc=`/*
 * Based on evanw's glfx.js tilt shift shader:
 * https://github.com/evanw/glfx.js/blob/master/src/filters/blur/tiltshift.js
 * @license
 */

uniform sampler2D u_image;
uniform float u_blurRadius;
uniform float u_gradientSize;
uniform float u_size;
uniform vec2 u_start;
uniform vec2 u_end;
uniform vec2 u_delta;
uniform vec2 u_texSize;
varying vec2 v_texCoord;

float random(vec2 co)
{
    highp float a = 12.9898;
    highp float b = 78.233;
    highp float c = 43758.5453;
    highp float dt = dot(co.xy,vec2(a,b));
    highp float sn = mod(dt, 3.14);
    return fract(sin(sn) * c);
}

void main() {
    vec4 color = vec4(0.0);
    float total = 0.0;

    float offset = random(gl_FragCoord.xy / u_texSize.xy);

    vec2 normal = normalize(vec2(u_start.y - u_end.y, u_end.x - u_start.x));
    float radius = smoothstep(0.0, 1.0,
      (abs(
        dot(v_texCoord * u_texSize - u_start, normal)
      ) - u_size) / u_gradientSize
    ) * u_blurRadius;

    for (float t = -30.0; t <= 30.0; t++) {
        float percent = (t + offset - 0.5) / 30.0;
        float weight = 1.0 - abs(percent);
        vec4 _sample = texture2D(u_image, v_texCoord + u_delta * percent * radius / u_texSize);

        color += _sample * weight;
        total += weight;
    }

    gl_FragColor = color / total;
}
`;const{Vector2:Ct}=P;class uc extends T.Filter{constructor(...e){super(...e);this._fragmentSource=pc,this._lastBlurRadius=null,this._lastGradientRadius=null,this._lastStart=new Ct,this._lastEnd=new Ct,this._blurFilter=new Ve,this._blurredRenderTarget=new T.CanvasRenderTarget(100,100,1),this._maskRenderTarget=new T.CanvasRenderTarget(100,100,1)}_applyCanvas(e,t,i,r=!1){if(this._options.blurQuality==="low"){this._renderLQBlur(e,t,i,r);return}const s=t.getDimensions(),o=!i.getDimensions().equals(s),n=t.getBaseTexture().isDirty()||this._lastBlurRadius!==this._options.blurRadius||o;if(n){const a=new Ct(this._options.delta.x,this._options.delta.y);this._blurFilter.setDelta(a);const l={blurRadius:this._options.blurRadius,texSize:s},d=(g,E,v)=>Math.min(Math.max(g,E),v),p=(g,E,v)=>{const w=d((v-g)/(E-g),0,1);return w*w*(3-2*w)},{blurRadius:u,gradientSize:c,size:m,start:x,end:_,texSize:f}=this._options,y=new Ct(x.y-_.y,_.x-x.x);y.divide(y.len());const b=(g,E)=>p(0,1,(Math.abs(f.clone().multiply(g,E).subtract(x).dot(y))-m)/c)*u;this._blurFilter.set(l),this._blurFilter._applyCanvas(e,t,i,r,b),this._lastBlurRadius=this._options.blurRadius}}_renderLQBlur(e,t,i,r=!1){const s=t.getDimensions(),o=!this._blurredRenderTarget.getDimensions().equals(s);this._blurredRenderTarget.setPixelRatio(t.getPixelRatio()),this._blurredRenderTarget.resizeTo(t.getDimensions()),this._maskRenderTarget.setPixelRatio(t.getPixelRatio()),this._maskRenderTarget.resizeTo(t.getDimensions());const n=!this._lastStart.equals(this._options.start)||!this._lastEnd.equals(this._options.end)||this._lastGradientRadius!==this._options.size||o,a=t.getBaseTexture().isDirty()||this._lastBlurRadius!==this._options.blurRadius||o;n&&(this._renderMask(),this._lastStart=this._options.start.clone(),this._lastEnd=this._options.end.clone(),this._lastGradientRadius=this._options.size),a&&(this._blurImage(t,this._blurredRenderTarget,this._options.blurRadius),this._lastBlurRadius=this._options.blurRadius),this._applyMask(t,i)}_renderMask(){const e=this._maskRenderTarget.getCanvas(),t=this._maskRenderTarget.getContext(),i=this._maskRenderTarget.getPixelRatio(),r=new Ct(e.width,e.height),s=this._options.size*r.min()*i,o=this._options.gradientSize*r.min()*i,n=this._options.start.clone().multiply(r),a=this._options.end.clone().multiply(r),l=a.clone().subtract(n),d=n.clone().add(l.clone().divide(2)),p=l.len(),u=l.clone().divide(p),c=d.clone().add((s+o)*u.y,-(s+o)*u.x),m=d.clone().add(-(s+o)*u.y,(s+o)*u.x),x=t.createLinearGradient(c.x,c.y,m.x,m.y),_=m.clone().subtract(c).len();x.addColorStop(0,"#000000"),x.addColorStop(o/2/_,"#FFFFFF"),x.addColorStop(1-o/2/_,"#FFFFFF"),x.addColorStop(1,"#000000"),t.fillStyle=x,t.fillRect(0,0,e.width,e.height)}_applyMask(e,t){const i=t.getContext(),r=e.getCanvas(),s=e.getContext(),o=this._blurredRenderTarget.getContext(),n=this._maskRenderTarget.getContext(),a=s.getImageData(0,0,r.width,r.height),l=a.data,d=o.getImageData(0,0,r.width,r.height).data,p=n.getImageData(0,0,r.width,r.height).data;let u;for(let c=0;c<r.width*r.height*4;c+=4)u=p[c]/255,l[c]=u*l[c]+(1-u)*d[c],l[c+1]=u*l[c+1]+(1-u)*d[c+1],l[c+2]=u*l[c+2]+(1-u)*d[c+2];i.putImageData(a,0,0)}dispose(){super.dispose(),this._blurFilter.dispose()}}uc.prototype.availableOptions={blurRadius:{type:h.NUMBER,default:30,uniformType:D.FLOAT},size:{type:h.NUMBER,default:50,uniformType:D.FLOAT},gradientSize:{type:h.NUMBER,default:50,uniformType:D.FLOAT},start:{type:h.VECTOR2,default:new Ct(0,.5),uniformType:D.FLOAT2},end:{type:h.VECTOR2,default:new Ct(1,.5),uniformType:D.FLOAT2},delta:{type:h.VECTOR2,default:new Ct(1,1),uniformType:D.FLOAT2},texSize:{type:h.VECTOR2,default:new Ct(100,100),uniformType:D.FLOAT2}};var Ws=uc;const{Vector2:Vs}=P;class Hs extends J{constructor(...e){super(...e);this._lastBlurRadius=this._options.blurRadius,this._lastSize=this._options.size,this._lastGradientSize=this._options.gradientSize;const t={blurQuality:{type:h.STRING}};this._horizontalFilter=new Ws({},t),this._verticalFilter=new Ws({},t),this._sprite.setFilters([this._horizontalFilter,this._verticalFilter]),this._horizontalFilter.setDelta(new Vs(.5,.5)),this._verticalFilter.setDelta(new Vs(-.5,.5)),this._filter=new Ws({},t),this._renderBlur.bind(this)}rotate(e){const{start:t}=this._options,{end:i}=this._options;e===90?(t.flip(),t.x=1-t.x,i.flip(),i.x=1-i.x):e===-90&&(t.flip(),t.y=1-t.y,i.flip(),i.y=1-i.y),this.set({start:t,end:i})}flip(e){const{start:t}=this._options,{end:i}=this._options;switch(e){case"horizontal":t.x=1-t.x,i.x=1-i.x;break;case"vertical":t.y=1-t.y,i.y=1-i.y;break}this.set({start:t,end:i})}transform(e){const t={};["start","end"].forEach(i=>{const r=this.getOption(i);t[i]=e.applyToRelativePoint(r)}),["blurRadius","size","gradientSize"].forEach(i=>{const r=this.getOption(i);t[i]=e.applyToRelativeSize(r)}),this.set(t,!1)}_renderWebGL(e){return this._renderBlur(e)}_renderCanvas(e){return this._options.highQualityCanvasBlur?this._renderBlur(e):this._renderLQCanvasBlur(e)}_renderBlur(e){const t=e.getDimensions(),i=t.min(),r=this._options.start.clone(),s=this._options.end.clone(),{blurRadius:o,size:n,gradientSize:a}=this._options,l={blurRadius:o*i,size:n*i,gradientSize:a*i,start:r.clone().multiply(t),end:s.clone().multiply(t),texSize:t,blurQuality:"high"};return this._horizontalFilter.set(l),this._verticalFilter.set(l),this._renderTexture.render(this._container),N.resolve()}_renderLQCanvasBlur(e){const t=e.getDimensions(),{blurRadius:i,size:r,gradientSize:s,start:o,end:n}=this._options;return this._filter.set({blurRadius:i,gradientSize:s,size:r,start:o.clone(),end:n.clone(),texSize:t,blurQuality:"low"}),this._sprite.setFilters([this._filter]),this._renderTexture.render(this._container),N.resolve()}dispose(){super.dispose(),this._filter.dispose(),this._verticalFilter.dispose(),this._horizontalFilter.dispose()}hasChanges(){return!0}}Hs.identifier="mirrored-focus";Hs.prototype.availableOptions={start:{type:h.VECTOR2,default:new Vs(0,.5)},end:{type:h.VECTOR2,default:new Vs(1,.5)},blurRadius:{type:h.NUMBER,default:.025},size:{type:h.NUMBER,default:.1},gradientSize:{type:h.NUMBER,default:.1},highQualityCanvasBlur:{type:h.BOOLEAN,default:!1}};F.Operations.MirroredFocusOperation=Hs;var mc=Hs;const{Vector2:cg}=P;class qs extends J{_render(e){const t=this._options.rotation%360,i=t*(Math.PI/180),r=t===90||t===270,s=this._options.flipHorizontally!==this._options.flipVertically,o=r&&s?!this._options.flipVertically:this._options.flipVertically,n=r&&s?!this._options.flipHorizontally:this._options.flipHorizontally;this._sprite.setScale(n?-1:1,o?-1:1),this._sprite.setRotation(i),this._sprite.setAnchor(.5,.5),this._sprite.updateTransform();const a=this._sprite.getBounds();return this._renderTexture.resizeTo(new cg(a.width,a.height)),this._sprite.setPosition(this._renderTexture.getDimensions().divide(2).round()),this._renderTexture.render(this._container),N.resolve()}getNewDimensions(e){return e=e.clone(),this._options.rotation%180&&e.flip(),e}flip(e){const{rotation:t}=this._options;(t===90||t===270)&&(e==="vertical"?e="horizontal":e="vertical");switch(e){case"vertical":this.setFlipVertically(!this.getFlipVertically());break;case"horizontal":this.setFlipHorizontally(!this.getFlipHorizontally());break}}}qs.identifier="orientation";qs.prototype.availableOptions={rotation:{type:h.NUMBER,default:0,validation(e){if(e%90!==0)throw new Error("OrientationOperation: `rotation` has to be a multiple of 90.")},setter:e=>(e+360)%360},flipVertically:{type:h.BOOLEAN,default:!1},flipHorizontally:{type:h.BOOLEAN,default:!1}};F.Operations.OrientationOperation=qs;var fc=qs;const{Vector2:Ys}=P;class Xs extends J{constructor(...e){super(...e);this._flipContainer=new T.Container}_render(e){const{position:t,rotation:i,scale:r,pivot:s,outputResolution:o}=this._options,n=this._sdk.getTextureScale(),a=o.clone().multiply(n).ceil();return this._renderTexture.resizeTo(a),this._sprite.setRotation(i),this._sprite.setPosition(t),this._sprite.setPivot(s),this._sprite.setScale(r),this._renderTexture.render(this._container),N.resolve()}getNewDimensions(e){const t=this._sdk.getTextureScale();return this._options.outputResolution.clone().multiply(t).ceil()}}Xs.identifier="output";Xs.prototype.availableOptions={position:{type:h.VECTOR2,default:new Ys(0,0)},rotation:{type:h.NUMBER,default:0},scale:{type:h.VECTOR2,default:new Ys(1,1)},pivot:{type:h.VECTOR2,default:new Ys(0,0)},outputResolution:{type:h.VECTOR2,default:new Ys(100,100)}};F.Operations.OutputOperation=Xs;var gc=Xs;const{OverlayFilter:Qs}=T.Filters,{Vector2:_c}=P,pg=4;class Gr extends J{constructor(...e){super(...e);this._overlayTexture=T.Texture.fromImage(this._options.image),this._overlayContainer=new T.Container,this._overlaySprite=new T.Sprite,this._overlaySprite.setTexture(this._overlayTexture),this._overlaySprite.setAnchor(0,0),this._overlayContainer.addChild(this._overlaySprite),this._overlayFilter=new T.Filters.OverlayFilter({overlayImage:this._overlayTexture.getBaseTexture().getGLUnit(),overlayTexture:this._overlayTexture}),this._sprite.setFilters([this._overlayFilter]),this._renderedOverlaySprite=new T.Sprite,this._renderedOverlayContainer=new T.Container,this._renderedOverlayContainer.addChild(this._renderedOverlaySprite),this._overlayRendered=!1,this._lastInputDimensions=new _c(0,0)}setOption(e,t){if(super.setOption(e,t),e==="image"&&t&&this._sdk){const i=this._sdk.getRenderer(),r=this._overlayTexture.getBaseTexture();r.setSource(t),i.isOfType(q.WEBGL)&&i.updateTexture(r),this._overlayRendered=!1}}_render(e){const t=e.getDimensions(),{image:i,alpha:r,blendMode:s}=this._options;return i?((!this._overlayRendered||!this._lastInputDimensions.equals(t))&&(this._renderOverlayToRenderTexture(e),this._overlayRendered=!0,this._lastInputDimensions.copy(t)),this._overlayFilter.set({blendMode:s,overlayImage:this._overlayRenderTexture.getBaseTexture().getGLUnit(),overlayTexture:this._overlayRenderTexture,alpha:r}),this._sprite.setFilters([this._overlayFilter]),this._renderTexture.render(this._container),N.resolve()):(this._sprite.setFilters([]),this._renderTexture.render(this._container),N.resolve())}_renderOverlayToRenderTexture(e){const t=this._sdk.getRenderer(),i=e.getDimensions();this._overlayRenderTexture||(this._overlayRenderTexture=new T.RenderTexture(t,i.x,i.y),this._renderedOverlaySprite.setTexture(this._overlayRenderTexture));const{width:r,height:s}=this._options.image,o=S.resizeVectorToFill(new _c(r,s),i),{flipHorizontally:n,flipVertically:a}=this._options,l=n?-1:1,d=a?-1:1;this._overlaySprite.setWidth(o.x*l),this._overlaySprite.setHeight(o.y*d),this._overlaySprite.setPosition(i.x*(1-l)*.5,i.y*(1-d)*.5);const p=this._overlayRenderTexture.getBaseTexture();this._overlayRenderTexture.resizeTo(i),t.isOfType(q.WEBGL)&&(p.setGLUnit(pg),t.updateTexture(p,!1)),this._overlayRenderTexture.render(this._overlayContainer)}dispose(){super.dispose(),this._overlaySprite&&this._overlaySprite.dispose(),this._overlayRenderTexture&&this._renderedOverlaySprite.dispose(),this._overlayFilter&&this._overlayFilter.dispose(),this._overlayTexture&&this._overlayTexture.dispose(),this._overlayRenderTexture&&this._overlayRenderTexture.dispose(),this._renderedOverlaySprite&&this._renderedOverlaySprite.dispose()}}Gr.identifier="overlay";Gr.BLEND_MODES=Qs.BLEND_MODES;Gr.prototype.availableOptions={identifier:{type:h.STRING},image:{type:h.IMAGE},blendMode:{type:h.NUMBER,default:Qs.BLEND_MODES.MULTIPLY,available:Object.keys(Qs.BLEND_MODES).map(e=>Qs.BLEND_MODES[e])},alpha:{type:h.NUMBER,default:1},flipHorizontally:{type:h.BOOLEAN,default:!1},flipVertically:{type:h.BOOLEAN,default:!1}};F.Operations.OverlayOperation=Gr;var yc=Gr;var bc=`/*
 * Based on evanw's glfx.js tilt shift shader:
 * https://github.com/evanw/glfx.js/blob/master/src/filters/blur/tiltshift.js
 * @license
 */

uniform sampler2D u_image;
uniform float u_radius;
uniform float u_blurRadius;
uniform float u_gradientRadius;
uniform vec2 u_position;
uniform vec2 u_delta;
uniform vec2 u_texSize;
varying vec2 v_texCoord;

const float blurSteps = 30.0;
const float EPSILON = 0.000000001;

float random(vec2 co)
{
    highp float a = 12.9898;
    highp float b = 78.233;
    highp float c = 43758.5453;
    highp float dt = dot(co.xy,vec2(a,b));
    highp float sn = mod(dt, 3.14);
    return fract(sin(sn) * c);
}

void main() {
    vec4 color = vec4(0.0);
    float total = 0.0;

    vec2 coord = v_texCoord * u_texSize;
    vec2 diff = coord - u_position;
    float dist = sqrt(diff.x * diff.x + diff.y * diff.y);

    float blurPercentage = smoothstep( 
      0.0, 1.0,
      (abs(dist) - u_radius) / u_gradientRadius
    );

    float radius = blurPercentage * u_blurRadius;
    float offset = random(gl_FragCoord.xy / u_texSize.xy);

    for (float t = -blurSteps; t <= blurSteps; t++) {
        float percent = (t + offset - 0.5) / blurSteps;
        float weight = 1.0 - abs(percent);
        vec4 _sample = texture2D(u_image, v_texCoord + u_delta * percent * radius / u_texSize);

        color += _sample * weight;
        total += weight;
    }

    gl_FragColor = color / max(total, EPSILON);
}
`;const{Vector2:lr}=P;class xc extends T.Filter{constructor(...e){super(...e);this._fragmentSource=bc,this._lastBlurRadius=null,this._lastGradientRadius=null,this._lastPosition=new lr,this._blurFilter=new Ve,this._blurredRenderTarget=new T.CanvasRenderTarget(100,100,1),this._maskRenderTarget=new T.CanvasRenderTarget(100,100,1)}_applyCanvas(e,t,i,r=!1){if(this._options.blurQuality==="low"){this._renderLQBlur(e,t,i,r);return}const s=t.getDimensions(),o=!i.getDimensions().equals(s),{blurRadius:n,position:a,texSize:l,gradientRadius:d}=this._options,p=t.getBaseTexture().isDirty()||this._lastBlurRadius!==n||o;if(p){const u=new lr(this._options.delta.x,this._options.delta.y);this._blurFilter.setDelta(u);const c={blurRadius:n,texSize:s},m=(f,y,b)=>Math.min(Math.max(f,y),b),x=(f,y,b)=>{const g=m((b-f)/(y-f),0,1);return g*g*(3-2*g)},_=(f,y)=>x(0,1,(Math.abs(l.clone().multiply(f,y).subtract(a).len())-this._options.radius)/(d*2))*n;this._blurFilter.set(c),this._blurFilter._applyCanvas(e,t,i,r,_),this._lastBlurRadius=n}}_renderLQBlur(e,t,i,r=!1){const s=t.getDimensions(),o=!this._blurredRenderTarget.getDimensions().equals(s);this._blurredRenderTarget.setPixelRatio(t.getPixelRatio()),this._blurredRenderTarget.resizeTo(t.getDimensions()),this._maskRenderTarget.setPixelRatio(t.getPixelRatio()),this._maskRenderTarget.resizeTo(t.getDimensions());const n=!this._lastPosition.equals(this._options.position)||this._lastGradientRadius!==this._options.gradientRadius||o,a=t.getBaseTexture().isDirty()||this._lastBlurRadius!==this._options.blurRadius||o;n&&(this._renderMask(),this._lastPosition=this._options.position.clone(),this._lastGradientRadius=this._options.gradientRadius),a&&(this._blurImage(t,this._blurredRenderTarget,this._options.blurRadius),this._lastBlurRadius=this._options.blurRadius),this._applyMask(t,i)}_renderMask(){const e=this._maskRenderTarget.getCanvas(),t=this._maskRenderTarget.getContext(),i=new lr(e.width,e.height),r=this._maskRenderTarget.getPixelRatio(),s=this._options.position.clone().multiply(i);let{radius:o,gradientRadius:n}=this._options;o*=e.height,n*=e.height;const a=t.createRadialGradient(s.x,s.y,0,s.x,s.y,(o+n)*r);a.addColorStop(0,"#FFFFFF"),a.addColorStop(o/(o+n),"#FFFFFF"),a.addColorStop(1,"#000000"),t.fillStyle=a,t.fillRect(0,0,i.x,i.y)}_applyMask(e,t){const i=t.getContext(),r=e.getCanvas(),s=e.getContext(),o=this._blurredRenderTarget.getContext(),n=this._maskRenderTarget.getContext(),a=s.getImageData(0,0,r.width,r.height),l=a.data,d=o.getImageData(0,0,r.width,r.height).data,p=n.getImageData(0,0,r.width,r.height).data;let u;for(let c=0;c<r.width*r.height*4;c+=4)u=p[c]/255,l[c]=u*l[c]+(1-u)*d[c],l[c+1]=u*l[c+1]+(1-u)*d[c+1],l[c+2]=u*l[c+2]+(1-u)*d[c+2];i.putImageData(a,0,0)}dispose(){super.dispose(),this._blurFilter.dispose(),this._blurredRenderTarget.dispose(),this._maskRenderTarget.dispose()}}xc.prototype.availableOptions={blurRadius:{type:h.NUMBER,default:30,uniformType:D.FLOAT},radius:{type:h.NUMBER,default:50,uniformType:D.FLOAT},gradientRadius:{type:h.NUMBER,default:25,uniformType:D.FLOAT},position:{type:h.VECTOR2,default:new lr(.5,.5),uniformType:D.FLOAT2},delta:{type:h.VECTOR2,default:new lr(1,1),uniformType:D.FLOAT2},texSize:{type:h.VECTOR2,default:new lr(100,100),uniformType:D.FLOAT2}};var Zs=xc;const{Vector2:In}=P;class Js extends J{constructor(...e){super(...e);this._lastBlurRadius=this._options.blurRadius,this._lastGradientRadius=this._options.gradientRadius;const t={blurQuality:{type:h.STRING}};this._horizontalFilter=new Zs({},t),this._verticalFilter=new Zs({},t),this._sprite.setFilters([this._horizontalFilter,this._verticalFilter]),this._horizontalFilter.setDelta(new In(.5,.5)),this._verticalFilter.setDelta(new In(-.5,.5)),this._filter=new Zs({},t)}rotate(e){const{position:t}=this._options;e===90?(t.flip(),t.x=1-t.x):e===-90&&(t.flip(),t.y=1-t.y),this.set({position:t})}flip(e){const{position:t}=this._options;switch(e){case"horizontal":t.x=1-t.x;break;case"vertical":t.y=1-t.y;break}this.set({position:t})}transform(e){const t={},i=this.getPosition();t.position=e.applyToRelativePoint(i),["radius","blurRadius","gradientRadius"].forEach(r=>{const s=this.getOption(r);t[r]=e.applyToRelativeSize(s)}),this.set(t,!1)}_renderWebGL(e){return this._renderBlur(e)}_renderCanvas(e){return this._options.highQualityCanvasBlur?this._renderBlur(e):this._renderLQCanvasBlur(e)}_renderBlur(e){const t=e.getDimensions(),i=t.min(),{position:r,blurRadius:s,radius:o,gradientRadius:n}=this._options,a={blurRadius:s*i,radius:o*i,gradientRadius:n*i,position:r.clone().multiply(t),texSize:t,blurQuality:"high"};return this._horizontalFilter.set(a),this._verticalFilter.set(a),this._renderTexture.render(this._container),N.resolve()}_renderLQCanvasBlur(e){const{blurRadius:t,radius:i,gradientRadius:r,position:s}=this._options,o=e.getDimensions();return this._filter.set({blurRadius:t,radius:i,gradientRadius:r,position:s,texSize:o,blurQuality:"low"}),this._sprite.setFilters([this._filter]),this._renderTexture.render(this._container),N.resolve()}dispose(){super.dispose(),this._filter.dispose(),this._verticalFilter.dispose(),this._horizontalFilter.dispose()}hasChanges(){return!0}}Js.identifier="radial-focus";Js.prototype.availableOptions={position:{type:h.VECTOR2,default:new In(.5,.5)},radius:{type:h.NUMBER,default:.25},gradientRadius:{type:h.NUMBER,default:.125},blurRadius:{type:h.NUMBER,default:.025},highQualityCanvasBlur:{type:h.BOOLEAN,default:!1}};F.Operations.RadialFocusOperation=Js;var vc=Js;var wc=`varying vec2 v_texCoord;
uniform sampler2D u_image;
uniform sampler2D u_filterImage;
uniform sampler2D u_maskImage;

void main() {
  vec4 color0 = texture2D(u_image, v_texCoord);
  vec4 color1 = texture2D(u_filterImage, v_texCoord);
  vec4 mask = texture2D(u_maskImage, v_texCoord);
  gl_FragColor = mix(color0, color1, mask);
}
`;class Sc extends T.Filter{constructor(){super();this._fragmentSource=wc}_applyCanvas(e,t,i,r=!1){const s=t.getCanvas(),o=t.getContext(),n=i.getContext(),{maskCanvas:a,filterCanvas:l}=this._options,d=a.getContext("2d"),p=l.getContext("2d"),u=d.getImageData(0,0,s.width,s.height).data,c=o.getImageData(0,0,s.width,s.height),m=c.data,x=p.getImageData(0,0,s.width,s.height).data;let _;for(let f=0;f<s.width*s.height*4;f+=4)_=u[f]/255,m[f]=_*x[f]+(1-_)*m[f],m[f+1]=_*x[f+1]+(1-_)*m[f+1],m[f+2]=_*x[f+2]+(1-_)*m[f+2];n.putImageData(c,0,0)}}Sc.prototype.availableOptions={maskImage:{type:h.NUMBER,default:1,uniformType:D.INT},maskCanvas:{type:h.OBJECT,default:null},filterImage:{type:h.NUMBER,default:2,uniformType:D.INT},filterCanvas:{type:h.OBJECT,default:null}};var Tc=Sc;const{Vector2:$s}=P;class ug extends G{constructor(e,t){super(t);this._isDisposed=!1,this._operation=e,this._dirtiness={},this.id=S.getUUID(),this._renderTextures={},this._identitySprite=new T.Sprite,this._sprite=new T.Sprite,this._hitTestSprite=new T.Sprite,this._renderers=[]}applyScale(e){}applyRotation(e){const t=this._operation.getInputDimensions();let i=this.getRotation()*180/Math.PI;i+=e,this.setRotation(i*Math.PI/180);const r=(e+360)%360,s=r*Math.PI/180,o=Math.cos(s),n=Math.sin(s),a=this._options.position.clone().subtract(.5).multiply(t),l=new $s(a.x*o-a.y*n,a.x*n+a.y*o).divide(t.clone().flip());this.setPosition(new $s(.5,.5).add(l))}applyFlip(e){const t=this.getPosition().clone();switch(e){case"horizontal":t.x=1-this._options.position.x;break;case"vertical":t.y=1-this._options.position.y;break}this.setPosition(t)}applyTransform(e){const t={};t.rotation=e.applyToRotation(this.getRotation()),t.position=e.applyToRelativePoint(this.getPosition()),this._options.dimensions&&(t.dimensions=e.applyToDimensions(this.getDimensions())),this.set(t,!1)}getDisplayObject(){return this._sprite}getHitTestDisplayObject(){return this._sprite}_getTexture(){throw new Error("Sprite#_getTexture is abstract and not implemented in child class.")}_prepareRenderTexture(e){if(this._renderTexture)this._renderTexture.clear();else{const t=this._getTexture();this._renderTextureContainer=new T.Container,this._renderTextureSprite=new T.Sprite(t),this._renderTextureContainer.addChild(this._renderTextureSprite),this._renderTexture=this._getRenderTexture(e.getRenderer(),t.getDimensions())}}_rendersToRenderTexture(e){return e.getOptions().smoothDownscaling&&e.getRenderer().isOfType(q.WEBGL)}_optionEquals(e,t){return e==="type"?!0:super._optionEquals(e,t)}update(e,t){if(this._isDisposed)return;this._rendersToRenderTexture(e)&&(this._prepareRenderTexture(e),this._renderToRenderTexture(e)),this._updateSprite(t)}_updateSprite(e){const t=[this._sprite,this._hitTestSprite];t.forEach(i=>{if(!i.getTexture())return;i.setAnchor(this._options.anchor),i.setPosition(this._options.position.clone().multiply(e)),typeof this._options.alpha!="undefined"&&i.setAlpha(this._options.alpha);let{dimensions:r}=this._options;r&&(r=r.clone().multiply(this._operation.getSDK().getTextureScale()),i.setWidth(r.x),i.setHeight(r.y)),i.updateTransform();const s=i.getTexture().getFrame(),o=new $s(s.width,s.height);i.setPivot(this._options.pivot.clone().multiply(o)),i.setRotation(this._options.rotation),i.updateTransform()})}_renderToRenderTexture(e){const t=this._getTexture().getDimensions(),i=this._getRenderTexture(e.getRenderer(),t),r=t.clone();if(this._options.smoothDownscaling&&(r.x=S.nextHighestPOT(r.x),r.y=S.nextHighestPOT(r.y)),this._renderTexture.resizeTo(r),this._renderTexture.render(this._renderTextureContainer),this._options.smoothDownscaling){const s=r.clone().subtract(t.x,t.y).divide(r),o=i.getUVs().getUVs();o[0].x=o[3].x=0,o[1].x=o[2].x=1-s.x,o[0].y=o[1].y=0,o[2].y=o[3].y=1-s.y}this._sprite.setTexture(i)}isDirtyForRenderer(e){return e.id in this._dirtiness||(this._dirtiness[e.id]=!0),this._dirtiness[e.id]}setDirtyForRenderer(e,t){this._renderers[t.id]=t,this._dirtiness[t.id]=e}setDirty(e){for(const t in this._dirtiness)this.setDirtyForRenderer(e,this._renderers[t])}_getRenderTexture(e,t=new $s(100,100)){return this._renderTextures[e.id]||(this._renderTextures[e.id]=new T.RenderTexture(e,t.x,t.y,1)),this._renderTextures[e.id]}dispose(){this._isDisposed=!0;for(const e in this._renderTextures)this._renderTextures[e].dispose()}canBeDuplicated(){return!0}canBeDeleted(){return!0}canMaskCanvas(){return!1}canAdjustPadding(){return!1}canBeTakenToFront(){return!0}canBeFlippedHorizontally(){return!0}}var vt=ug;const{Vector2:mg}=P;class hi extends G{constructor(...e){super(...e);this._lastOptions={},this._lastInputDimensions=new mg(0,0),this._brush=null}getBrushImage(e){if(this._brush&&this.optionsEqual(this._lastOptions)&&e.equals(this._lastInputDimensions))return this._brush;const{image:t,size:i}=this._options;t.width=t.height=Math.ceil(i*e.min());const r=S.createCanvas();r.width=t.width,r.height=t.height;const s=r.getContext("2d");s.drawImage(t,0,0,r.width,r.height);const o=this._tintImageData(s.getImageData(0,0,r.width,r.height),r.width,r.height);return s.putImageData(o,0,0),this._lastOptions=this.serializeOptions(["size","color"]),this._brush=r,this._lastInputDimensions=e.clone(),r}_tintImageData(e){const{color:t}=this._options;for(let i=0;i<e.data.length;i+=4)e.data[i]+=(t.r*255-e.data[i])*t.a,e.data[i+1]+=(t.g*255-e.data[i+1])*t.a,e.data[i+2]+=(t.b*255-e.data[i+2])*t.a;return e}clone(){const e=this.constructor;return new e(this._options)}}hi.prototype.availableOptions={identifier:{type:h.STRING},image:{type:h.IMAGE},size:{type:h.NUMBER,default:.05},color:{type:h.COLOR,default:O.RED}};class hr extends hi{getBrushImage(e){if(this._brush&&this.optionsEqual(this._lastOptions)&&e.equals(this._lastInputDimensions))return this._brush;let{size:t,hardness:i,color:r}=this._options;const s=S.createCanvas();s.width=s.height=Math.ceil(t*e.min());const o=s.getContext("2d");if(r=r.clone(),r.a=1,s.width===1)o.fillStyle=r.toRGBA(),o.fillRect(0,0,1,1);else{const n=o.createRadialGradient(s.width/2,s.height/2,Math.min(s.width/2-1,s.width/2*i),s.width/2,s.height/2,s.width/2);n.addColorStop(0,r.toRGBA());const a=r.clone();a.a=0,n.addColorStop(1,a.toRGBA()),o.fillStyle=n,o.fillRect(0,0,s.width,s.height)}return this._lastOptions=this.serializeOptions(["size","color","hardness"]),this._brush=s,this._lastInputDimensions=e.clone(),s}}hr.identifier="imgly_brush_radial";hr.prototype.availableOptions=S.extend(hi.prototype.availableOptions,{hardness:{type:h.NUMBER,default:1}});const{Vector2:fg,CubicBezierCurve:gg}=P;class _g{constructor(e,t,i=3){this._path=e,this._drawnCanvases=[],this._position=t,this._smooth=i}getBezierCurve(e,t,i,r){if(!t)return null;let s,o;r?(s=(r.x-t.x)/this._smooth,o=(r.y-t.y)/this._smooth):(s=(i.x-t.x)/this._smooth,o=(i.y-t.y)/this._smooth);let n,a;e?(n=(i.x-e.x)/this._smooth,a=(i.y-e.y)/this._smooth):(n=(i.x-t.x)/this._smooth,a=(i.y-t.y)/this._smooth);const l=t.clone().add(n,a),d=i.clone().subtract(s,o);return new gg(t,l,d,i)}renderToCanvas(e,t,i,r,s,o=1){if(this._drawnCanvases.indexOf(t)!==-1)return;const n=new fg(t.width,t.height),a=t.getContext("2d"),l=this._position.clone().multiply(n),d=r?r.getPosition().clone().multiply(n):null,p=i?i.getPosition().clone().multiply(n):null,u=s?s.getPosition().clone().multiply(n):null,c=l.clone().subtract(d).len(),m=e.width/10,x=this.getBezierCurve(p,d,l,u);let _;if(!x)_=[l];else{x.calculateSegments(20);const f=x.getLength();_=x.arcLengthApproxSample(Math.ceil(f/m))}for(let f=0;f<_.length;f++){const y=_[f];let b=e.width*.5/(m*2);b*=1-o,b=1/(1+b),a.globalAlpha=b,a.drawImage(e,y.x-e.width/2,y.y-e.height/2,e.width,e.height)}a.globalAlpha=1,this._drawnCanvases.push(t)}setPosition(e){this._position=e}getPosition(){return this._position.clone()}setDirty(){this._drawnCanvases=[]}}var Rc=_g;class Ec extends G{constructor(e,t,i){super(t);this._operation=e,this._canvas=i||S.createCanvas(),this._context=this._canvas.getContext("2d")}serializeOption(e,t=!1){return e==="controlPoints"?this._options.controlPoints.map(i=>{const r=i.getPosition();return t?r.toObject():r.clone()}):super.serializeOption(e,t)}_optionEquals(e,t){if(e==="controlPoints"){const{controlPoints:i}=this._options;for(let r=0,s=i.length;r<s;r++)if(!i[r].getPosition().equals(t[r]))return!1;return!0}return super._optionEquals(e,t)}render(e){const{controlPoints:t,size:i}=this._options;if(t.length<2)return;const r=this.getBrush(),s=r&&r.getHardness?r.getHardness():1;S.ensureCanvasDimensions(this._canvas,e),(!this._brush||this._lastBrushSize!==i||!e.equals(this._brushInputDimensions))&&(this._brushInputDimensions=e.clone(),this._lastBrushSize=i);let o,n,a,l;for(let d=0;d<t.length;d++)o=t[d-2],n=t[d-1],a=t[d],l=t[d+1],a.renderToCanvas(this._options.brush.getBrushImage(e),this._canvas,o,n,l,s)}_createBrush(e){let{size:t,hardness:i,color:r}=this._options;const s=S.createCanvas();s.width=s.height=Math.ceil(t*e.min());const o=s.getContext("2d");if(r=r.clone(),r.a=1,s.width===1)o.fillStyle=r.toRGBA(),o.fillRect(0,0,1,1);else{const n=o.createRadialGradient(s.width/2,s.height/2,Math.min(s.width/2-1,s.width/2*i),s.width/2,s.height/2,s.width/2);n.addColorStop(0,r.toRGBA());const a=r.clone();a.a=0,n.addColorStop(1,a.toRGBA()),o.fillStyle=n,o.fillRect(0,0,s.width,s.height)}return s}addControlPoint(e){const t=new Rc(this,e);this._options.controlPoints.push(t),this.emit("update",this)}getCanvas(){return this._canvas}setCanvas(e){this._canvas=e,this._context=e.getContext("2d")}setDirty(){this._context.clearRect(0,0,this._canvas.width,this._canvas.height),this._options.controlPoints.forEach(e=>{e.setDirty()})}forEachControlPoint(e){this._options.controlPoints.forEach(e)}renderToCanvas(e){const t=e.getContext("2d");t.save(),t.globalAlpha=this._options.brush.getColor().a,t.drawImage(this._canvas,0,0),t.restore()}getCanvasDimensions(){return this._canvasDimensions}}Ec.prototype.availableOptions={id:{type:h.STRING,default:()=>S.getUUID()},brush:{type:h.OBJECT,required:!0},controlPoints:{type:h.ARRAY,default:[]},closed:{type:h.BOOLEAN,default:!1}};var Ur=Ec;const{Vector2:eo}=P;class dr extends vt{constructor(...e){super(...e);this._persistedPaths=[],this._outputCanvasDirty=!0,this._outputCanvas=S.createCanvas(),this._outputContext=this._outputCanvas.getContext("2d"),this._persistCanvas=S.createCanvas(),this._persistContext=this._persistCanvas.getContext("2d"),this._nextCanvas=S.createCanvas(),this._texture=T.Texture.fromCanvas(this._outputCanvas),this._sprite.setTexture(this._texture),this._onPathUpdate=this._onPathUpdate.bind(this)}applyFlip(e){this._options.paths.forEach(t=>{t.forEachControlPoint(i=>{const r=i.getPosition().clone();switch(e){case"horizontal":r.x=1-r.x;break;case"vertical":r.y=1-r.y;break}i.setPosition(r)}),t.setDirty(!0)}),this._reset()}applyRotation(e){this._options.paths.forEach(t=>{t.forEachControlPoint(i=>{const r=i.getPosition().clone();e===90?(r.flip(),r.x=1-r.x):e===-90&&(r.flip(),r.y=1-r.y),i.setPosition(r)}),t.setDirty(!0)}),this._reset()}applyTransform(e){let t=null;this._options.paths.forEach(i=>{i.forEachControlPoint(s=>{s.setPosition(e.applyToRelativePoint(s.getPosition()))});const r=i.getBrush();r!==t&&(r.setSize(e.applyToRelativeSize(r.getSize())),t=r),i.setDirty(!0)}),this._reset()}clearCanvas(){if(!this._outputCanvas)return;this._outputCanvasDirty=!0;const{width:e,height:t}=this._outputCanvas;this._outputContext.clearRect(0,0,e,t)}clearPersistCanvas(){if(!this._persistCanvas)return;const{width:e,height:t}=this._persistCanvas;this._persistContext.clearRect(0,0,e,t)}serializeOptions(e,t=!1){const i=super.serializeOptions(e,t);return e||(i.type="brush"),i}serializeOption(e,t=!1){return e==="paths"?this._options.paths.map(i=>i.serializeOptions(void 0,t)):super.serializeOption(e,t)}createPath(e){const t=new Ur(this._operation,{brush:e},this._nextCanvas);return t.on("update",this._onPathUpdate),this._options.paths.push(t),this.setDirty(!0),t}_onPathUpdate(){this._operation.setDirty(!0),this.setDirty(!0)}_onPathPersist(e){e.renderToCanvas(this._persistCanvas),this._nextCanvas=e.getCanvas();const t=this._nextCanvas.getContext("2d");t.clearRect(0,0,this._nextCanvas.width,this._nextCanvas.height),this._persistedPaths.push(e)}_getTexture(){return this._texture}setDirtyForRenderer(e,t,i=!1){super.setDirtyForRenderer(e,t,i),e&&i&&(this._persistedPaths=[],this.clearPersistCanvas(),this._options.paths.forEach(r=>{r.setDirty(!0)}))}setDirty(e,t=!1){for(const i in this._dirtiness)this.setDirtyForRenderer(e,this._renderers[i],t)}render(e){const t=this._operation.getSDK().getRenderer();if(!this.isDirtyForRenderer(t))return;S.ensureCanvasDimensions(this._outputCanvas,e),S.ensureCanvasDimensions(this._persistCanvas,e),this._options.paths.forEach(i=>{i.render(e),i.getClosed()&&this._persistedPaths.indexOf(i)===-1&&this._onPathPersist(i)}),this.clearCanvas(),this._outputContext.drawImage(this._persistCanvas,0,0),this._options.paths.forEach(i=>{i.getClosed()||i.renderToCanvas(this._outputCanvas)}),this.setDirtyForRenderer(!1,t)}update(e,t){t&&(S.ensureCanvasDimensions(this._outputCanvas,t),S.ensureCanvasDimensions(this._persistCanvas,t),this._texture.getBaseTexture().update()),this.render(t);const i=e.getRenderer();i.isOfType(q.WEBGL)&&i.updateTexture(this._texture.getBaseTexture()),super.update(e,t)}_reset(){this._persistedPaths=[],this._operation&&this._operation.setDirty(!0),this.setDirty(!0),this.clearCanvas(),this.clearPersistCanvas()}getCanvas(){return this._outputCanvas}_createRadialBrush(){return new hr}_getTempCanvas(){return this._nextCanvas}dispose(){super.dispose(),this._texture&&this._texture.getBaseTexture().dispose()}}dr.prototype.availableOptions={id:{type:h.STRING,default:()=>S.getUUID()},position:{type:h.VECTOR2,default:new eo(0,0)},scale:{type:h.VECTOR2,default:new eo(1,1)},anchor:{type:h.VECTOR2,default:new eo(0,0)},pivot:{type:h.VECTOR2,default:new eo(0,0)},rotation:{type:h.NUMBER,default:0},paths:{type:h.ARRAY,default:[],setter(e){return e=e.map(t=>{if(t instanceof Ur)return t;const{brush:i,closed:r}=t,s=new Ur(this._operation,{brush:i,closed:r},this._nextCanvas);return t.controlPoints.forEach(o=>{s.addControlPoint(o)}),s}),this._reset(),e}}};dr.type="brush";dr.Brush=hi;dr.Path=Ur;dr.Brushes={RadialBrush:hr};var di=dr;const{Vector2:Oc}=P;class to extends J{constructor(...e){super(...e);const t=this._sdk.getRenderer();this._lastBlurRadius=null,this._blurredRenderTexture=new T.RenderTexture(t,100,100,1),this._maskRenderTexture=new T.RenderTexture(t,100,100,1),this._brushSprite=new di(this),this._brushSpriteContainer=new T.Container;const i=this._brushSprite.getDisplayObject();if(this._brushSpriteContainer.addChild(i),this._outputSprite=new T.Sprite,this._outputContainer=new T.Container,this._outputContainer.addChild(this._outputSprite),this._maskFilter=new Tc,t.isOfType(q.WEBGL)){this._horizontalFilter=new Ve,this._verticalFilter=new Ve,this._sprite.setFilters([this._horizontalFilter,this._verticalFilter]),this._horizontalFilter.setDelta(new Oc(1,1)),this._verticalFilter.setDelta(new Oc(-1,1));let r=this._maskRenderTexture.getBaseTexture();r.setGLUnit(this._maskFilter.getMaskImage()),t.updateTexture(r,!1),r=this._blurredRenderTexture.getBaseTexture(),r.setGLUnit(this._maskFilter.getFilterImage()),t.updateTexture(r,!1)}else t.isOfType(q.CANVAS)&&(this._blurFilter=new Ve,this._sprite.setFilters([this._blurFilter]),this._maskFilter.setMaskCanvas(this._maskRenderTexture.getRenderTarget().getCanvas()),this._maskFilter.setFilterCanvas(this._blurredRenderTexture.getRenderTarget().getCanvas()));this._outputSprite.setFilters([this._maskFilter])}flip(e){this._brushSprite.applyFlip(e),this.setDirty(!0,!0),this._lastBlurRadius=null}rotate(e){this._brushSprite.applyRotation(e),this.setDirty(!0,!0),this._lastBlurRadius=null}transform(e,t){this._brushSprite.applyTransform(e,t),this.setDirty(!0,!0),this._lastBlurRadius=null}_render(e){return this._renderBlur(e),this._renderMask(e),this._outputSprite.setTexture(e),this._renderTexture.render(this._outputContainer),N.resolve()}_renderMask(e){const t=e.getDimensions(),i=this._maskRenderTexture.getDimensions();i.equals(t)||this._maskRenderTexture.resizeTo(t),this._brushSprite.update(this._sdk,t),this._maskRenderTexture.clear(O.BLACK),this._maskRenderTexture.render(this._brushSpriteContainer);const r=this._sdk.getRenderer();r.isOfType(q.WEBGL)&&r.updateTexture(this._maskRenderTexture.getBaseTexture(),!1)}_renderBlur(e){const t=e.getDimensions(),i=this._blurredRenderTexture.getDimensions();i.equals(t)||this._blurredRenderTexture.resizeTo(t);const{blurRadius:r}=this._options;if(this._lastBlurRadius!==r||!i.equals(t)){const o=this._sdk.getRenderer();let n;if(o.isOfType(q.WEBGL)){const a=t.min();n={blurRadius:r*a,texSize:t},this._horizontalFilter.set(n),this._verticalFilter.set(n)}else o.isOfType(q.CANVAS)&&(n={blurRadius:r},this._blurFilter.set(n));this._blurredRenderTexture.render(this._container),this._lastBlurRadius=r}const s=this._sdk.getRenderer();s.isOfType(q.WEBGL)&&s.updateTexture(this._blurredRenderTexture.getBaseTexture(),!1)}getBrush(){return this._brushSprite}createPath(e,t=1){const i=new di.Brushes.RadialBrush({size:e,hardness:t,color:O.WHITE}),r=this._brushSprite.createPath(i);return this._options.paths.push(r),this.setDirty(!0),r}setDirtyForRenderer(e,t,i){super.setDirtyForRenderer(e,t,i),this._brushSprite.setDirtyForRenderer(e,t,i)}dispose(){super.dispose();const e=this._sdk.getRenderer();e.isOfType(q.WEBGL)?(this._verticalFilter.dispose(),this._horizontalFilter.dispose()):this._blurFilter.dispose(),this._brushSprite.dispose(),this._maskFilter.dispose(),this._blurredRenderTexture.dispose(),this._maskRenderTexture.dispose()}hasChanges(){return!0}}to.identifier="selective-blur";to.prototype.availableOptions={blurRadius:{type:h.NUMBER,default:.05},paths:{type:h.ARRAY,default:[],setter(e){return this._brushSprite&&this._brushSprite.setPaths(e),e}}};F.Operations.SelectiveBlurOperation=to;var Cc=to;const{Vector2:ci,ColorMatrix:io}=P;class Bn extends vt{constructor(...e){super(...e);const{image:t}=this._options,i=t.src||t.filePath||t.toDataUrl&&t.toDataURL();this._isSVG=i&&!!i.match(/\w+\.svg(?=\?|$)/i),this._isSVG&&(this._canvas=S.createCanvas(),this._context=this._canvas.getContext("2d"),this._options.smoothDownscaling=!1),t&&this._onImageUpdate(),this._tintFilter=new T.Filters.TintFilter,this._adjustmentsFilter=new Ts,this._lastRenderedDimensions=ci.NULL,this._lastRenderedInputDimensions=ci.NULL,this._onOptionsChange=this._onOptionsChange.bind(this),this._options.adjustments.on("update",this._onOptionsChange)}applyScale(e){this.setDimensions(this.getDimensions().multiply(e))}serializeOptions(e,t=!1){const i=super.serializeOptions(e,t);return e||(i.type="sticker"),i}_rendersToRenderTexture(e){const t=this._options.smoothDownscaling&&!this._isSVG&&e.getRenderer().isOfType(q.WEBGL);return t||this._hasAdjustments()||this._options.tintMode!=="none"}_getTexture(){return this._inputTexture}update(e,t){const{dimensions:i,image:r}=this._options;i.equals(ci.NULL)&&i.set(r.width,r.height),this._sprite.setSmoothDownscaling(this._isSVG?!1:this.getSmoothDownscaling());const s=!this._lastRenderedInputDimensions.equals(t)||!this._lastRenderedDimensions.equals(i)||this._lastRenderedImage!==r;if(s&&this._isSVG&&e.getRenderer().isOfType(q.WEBGL)){r.width=Math.round(i.x),r.height=Math.round(i.y);const n=4096,a=r.width/r.height;r.width>n&&(r.width=n,r.height=Math.round(r.width/a)),r.height>n&&(r.height=n,r.width=Math.round(r.height*a)),this._canvas.width=r.width,this._canvas.height=r.height,this._context.clearRect(0,0,r.width,r.height),this._context.drawImage(r,0,0,r.width,r.height),this._inputTexture.getBaseTexture().update()}this._rendersToRenderTexture(e)&&this._prepareRenderTexture(e);const o=[];if(this._rendersToRenderTexture(e)){if(this._hasAdjustments()){o.push(this._adjustmentsFilter);const{adjustments:n}=this._options,a=new io;a.multiply(io.createBrightnessMatrix(n.getBrightness())),a.multiply(io.createSaturationMatrix(n.getSaturation())),a.multiply(io.createContrastMatrix(n.getContrast())),this._adjustmentsFilter.set({colorMatrix:a})}this._options.tintMode&&this._options.tintMode!=="none"&&(o.push(this._tintFilter),this._tintFilter.set({mode:T.Filters.TintFilter.MODES[this._options.tintMode.toUpperCase()],color:this._options.tintColor}),this._sprite.getTexture()&&this._sprite.getTexture()._baseTexture&&this._sprite.getTexture()._baseTexture.setDirty(!0)),this._renderTextureSprite.setFilters(o)}this._rendersToRenderTexture(e)?this._renderToRenderTexture(e):this._sprite.setTexture(this._inputTexture),this._updateSprite(t),this._applyFlip(),this._lastRenderedDimensions.copy(i),this._lastRenderedInputDimensions.copy(t),this._lastRenderedImage=r}_applyFlip(){const e=this._sprite.getScale(),{flipHorizontally:t,flipVertically:i}=this._options;(t&&e.x>0||!t&&e.x<0)&&(e.x*=-1),(i&&e.y>0||!i&&e.y<0)&&(e.y*=-1),this._sprite.setScale(e)}applyFlip(e){super.applyFlip(e);const t={rotation:this._options.rotation},i=t.rotation/Math.PI*180,r=i*-1;t.rotation=r*Math.PI/180;switch(e){case"horizontal":t.flipHorizontally=!this._options.flipHorizontally,this.set(t);break;case"vertical":t.flipVertically=!this._options.flipVertically,this.set(t);break}}_hasAdjustments(){const{adjustments:e}=this._options;return e.getBrightness()!==0||e.getSaturation()!==1||e.getContrast()!==1}_onImageUpdate(){let e=this._options.image;const t=this._operation.getSDK().getRenderer();this._isSVG&&t.isOfType(q.WEBGL)&&(e=this._canvas),this._inputTexture&&(this._inputTexture.dispose(),this._inputTexture=null),this._inputTexture=T.Texture.fromImage(e),this._identitySprite.setTexture(this._inputTexture),this._sprite.setTexture(this._inputTexture),this._renderTexture&&(this._renderTextureSprite.setTexture(this._inputTexture),this._renderTexture.resizeTo(this._inputTexture.getDimensions())),this.setDirty(!0)}scalesUniformly(){return this._options.resizeMode==="keepAspect"}setOption(e,t,i=!0){super.setOption(e,t,i),e==="image"&&this._identitySprite&&this._onImageUpdate()}_onOptionsChange(){const e=this._dirtiness;for(const t in e)e[t]=!0}dispose(){super.dispose(),this._inputTexture&&(this._inputTexture.dispose(),this._inputTexture=null),this._tintFilter.dispose(),this._adjustmentsFilter.dispose(),this._options.adjustments.off("updated",this._onOptionsChange)}}Bn.prototype.availableOptions={id:{type:h.STRING,default:()=>S.getUUID()},identifier:{type:h.STRING,default:""},image:{type:h.IMAGE,required:!0},position:{type:h.VECTOR2,default:ci.NULL},dimensions:{type:h.VECTOR2,default:ci.NULL},anchor:{type:h.VECTOR2,default:new ci(0,0)},pivot:{type:h.VECTOR2,default:new ci(.5,.5)},rotation:{type:h.NUMBER,default:0},flipHorizontally:{type:h.BOOLEAN,default:!1},flipVertically:{type:h.BOOLEAN,default:!1},smoothDownscaling:{type:h.BOOLEAN,default:!1},tintColor:{type:h.COLOR,default:O.WHITE},tintMode:{type:h.STRING,default:"none",available:["none","solid","colorized"]},resizeMode:{type:h.STRING,default:"keepAspect",available:["keepAspect","unrestricted"]},alpha:{type:h.NUMBER,default:1},adjustments:{type:h.CONFIGURABLE,structure:{brightness:{type:h.NUMBER,default:0},saturation:{type:h.NUMBER,default:1},contrast:{type:h.NUMBER,default:1}}}};Bn.type="sticker";var ro=Bn;class W{constructor(e){this._seed=e===void 0?W.TimeSeed():e}seed(e){this._seed=e===void 0?W.TimeSeed():e}next(){let e=this._seed|0;const t=e/W.SEED_DIVIDER|0,i=e%W.SEED_DIVIDER|0;return e=W.SEED_LOW_MULTIPLY*i-W.SEED_HIGH_MULTIPLY*t,e<=0&&(e+=W.MAX),e===-1&&(e=W.MAX-1),this._seed=e,e}nextInRange(e,t){return t===void 0&&(t=e,e=0),e+this.next()%(t-e+1)}nextBool(e=1,t=1){return this.nextInRange(e+t-1)>=e}static TimeSeed(){return Date.now()}pickNext(e){return Array.isArray(e)?e[this.next()%e.length]:null}}W.MAX=2147483647,W.SEED_DIVIDER=127773,W.SEED_LOW_MULTIPLY=16807,W.SEED_HIGH_MULTIPLY=2836;const{Rectangle:yg}=P;class _e{constructor(e=0,t=0){this.width=e,this.height=t}set(e,t){this.width=e,this.height=t}aspect(){return this.width/this.height}rectangle(e,t){return new yg(e,t,this.width,this.height)}clone(){return new _e(this.width,this.height)}scale(e,t){return t===void 0&&(t=e),this.width*=e,this.height*=t,this}copy(e){return this.width=e.width,this.height=e.height,this}fitInWidthWithOther(e,t=new _e){return this.copy(_e.fitTwoInWidth(e,this,t)[0]),this}static fitTwoInWidth(e,t,i){const r=t.width*i.height+t.height*i.width,s=i.height*e/r,o=t.width*s,n=t.height*s;return[new _e(o,n),new _e(e-o,n)]}}const kc=Cr(require("p-map"));class Dc extends G{loadImages(e){return _i(this,null,function*(){return kc.default(e,t=>_i(this,null,function*(){return this.addImage(t.path,t.fullPath,t.image)}))})}addImage(e,t,i,r="anonymous"){const s=this.getImages();return i?(s[e]={fullPath:t,image:i},Promise.resolve({fullPath:t,image:i})):new Promise((o,n)=>{i=new Se,i.onload=()=>{s[e]={fullPath:t,image:i},o({fullPath:t,image:i})},i.crossOrigin=S.getCrossOriginValue(r),i.onerror=n,i.src=t})}getImage(e){const t=this.getImages(),i=t[e];return i?i.image:null}getVariation(e){return this.getFonts()[e]}addFont(e,t){const i=this.getFonts();return i[e]=t,t}}Dc.prototype.availableOptions={images:{type:h.OBJECT,default:{}},fonts:{type:h.OBJECT,default:{}}};const ie=new Dc;class Ye extends G{constructor(e){super(e);const t=ie.getVariation(this.getFontIdentifier());t||k.warn(`TextDesignFont: Unable to find font '${this._fontIdentifier}'`),this.set({fontVariation:t}),this._metrics=null,this._canvas=S.createCanvas(),this._context=this._canvas.getContext("2d"),this._isDirty=!0}_onOptionsChange(){this._isDirty=!0}setOption(e,t,i=!0,r=!1){super.setOption(e,t,i,r),e==="fontIdentifier"&&!r&&this.updateFontVariation()}updateFontVariation(){const e=ie.getVariation(this.getFontIdentifier());return e||k.warn(`TextDesignFont: Unable to find font '${this._fontIdentifier}'`),this.setFontVariation(e),e}setOptions(e={}){this._options=R(R({},this._options),e),this._isDirty=!0}_applyTextOptions(e=this._context,t={}){const{fontSize:i,fontVariation:r,lineHeight:s,textColor:o,alignment:n}=R(R({},this._options),t),{fontStyle:a,fontWeight:l,fontFamily:d}=r.serializeOptions();process.env.REACT_APP_BROWSER||(e.font=`${a} ${l} ${i}px ${d}`),process.env.REACT_APP_BROWSER&&(e.font=`${a} ${l} ${i}px / ${s} ${d}`),e.fillStyle=o,e.textBaseline="alphabetic",e.textAlign=n||"left"}getTextMetrics(){return(!this._metrics||this._isDirty)&&this._calculateTextMetrics(),R({},this._metrics)}getSizeValue(){return(!this._metrics||this._isDirty)&&this._calculateTextMetrics(),new _e(this._metrics.width,this._metrics.height)}fitWidth(e){const t=this.getFontVariation();if(!t){k.warn("TextDesignFont#fitText: missing font variation");return}this._applyTextOptions(this._context,{fontSize:50});const i=this._context.measureText(this.getText()).width,r=e/i,s=Math.floor(r*50);return this.setFontSize(s),this._calculateTextMetrics(),this.getTextMetrics()}fitHeight(e){const t=this.getFontVariation();if(!t){k.warn("TextDesignFont#fitText: missing font variation");return}const i=this._calculateTextMetrics({fontSize:50}).height,r=e/i,s=Math.floor(r*50);return this.setFontSize(s),this._calculateTextMetrics(),this.getTextMetrics()}_calculateTextMetrics(e={}){const t=this._canvas,i=this._context,r=R(R({},this._options),e),s=this.getText();this._applyTextOptions(i,r);const o=Math.ceil(i.measureText(s).width),n=Math.floor(o+r.fontSize*2),a=Math.floor(r.fontSize*3);t.width=n,t.height=a;const l=Math.floor(r.fontSize),d=Math.floor(a*(3/5));this._applyTextOptions(i,r),i.fillText(s,l,d);const p=i.getImageData(0,0,t.width,t.height).data,u=xg(p,n,a,d,this._options.excludeAccents),c=bg(p,n,a,d,this._options.excludeAccents),m=o,x=u+c;return this._metrics={width:m,height:x,ascender:u,descender:c},this._isDirty=!1,R({},this._metrics)}draw(e=this._context,t=0,i=0,r,s=!1){e.save(),(!this._metrics||this._isDirty)&&this._calculateTextMetrics(),this._applyTextOptions(e,r),e.fillText(this.getText(),t,i+this._metrics.ascender),s&&(wg(e,t,i,this._metrics.width,this._metrics.height),vg(e,i+this._metrics.ascender,t,t+this._metrics.width)),e.restore()}}const Sg=(e,t,i,r)=>{const s=i*(r*4)+t*4,o={r:e[s],g:e[s+1],b:e[s+2],a:e[s+3]};return o},Tg=e=>e.a<=254,Pc=(e,t,i)=>{let r=!0;for(let s=0;s<i;s++){const o=Sg(e,s,t,i);if(!Tg(o)){r=!1;break}}return r},bg=(e,t,i,r,s=!1)=>{let o=0;for(let n=r+1;n<i;n++)if(!Pc(e,n,t))o=n-r+1;else if(s)break;return o},xg=(e,t,i,r,s=!1)=>{let o=0;for(let n=r-1;n>=0;n--)if(!Pc(e,n,t))o=r-n;else if(s)break;return o},Rg=(e,t,i,r,s)=>{e.beginPath(),e.moveTo(t,i),e.lineTo(r,s),e.stroke()},vg=(e,t,i,r,s="red")=>{e.save(),e.strokeStyle=s,Rg(e,i,t,r,t),e.restore()},wg=(e,t,i,r,s,o="blue")=>{e.save(),e.strokeStyle=o,e.strokeRect(t,i,r,s),e.restore()};Ye.prototype.availableOptions={text:{type:h.STRING,default:""},fontIdentifier:{type:h.STRING,default:"imgly_font_open_sans_bold"},fontVariation:{type:h.OBJECT,default:null},lineHeight:{type:h.NUMBER,default:1},fontSize:{type:h.NUMBER,default:22},textColor:{type:h.STRING,default:"black"},strokeStyle:{type:h.STRING,default:"black"},outlineWidth:{type:h.NUMBER,default:0},textBaseline:{type:h.STRING,default:"alphabetic"},excludeAccents:{type:h.BOOLEAN,default:!1}};class Xe extends G{}Xe.prototype.availableOptions={text:{type:h.STRING,default:""},frame:{type:h.OBJECT,default:null},font:{type:h.OBJECT,default:null}};class mt extends G{}mt.prototype.availableOptions={tintColor:{type:h.COLOR,default:O.BLACK},textColor:{type:h.COLOR,default:O.BLACK},alignment:{type:h.STRING,default:"left",available:["left","center","right"]},lineSpacing:{type:h.NUMBER,default:1},fontIdentifier:{type:h.STRING,default:"imgly_font_open_sans_bold"}};const{Rectangle:Eg}=P;class et extends G{constructor(e){super(e);this.setSize(new _e(this.getWidth(),0)),this.serverImageSmoothingFix=!1}_getFrame(){const e=this.getSize();return new Eg(0,0,e.width,e.height)}_getTextFrame(){return this._getFrame()}_getTextFrameForElement(e){return e.getFrame().clone()}_calculateLayoutElements(){k.warn("TextDesignRow is an abstract class.")}_getLayoutElements(){return this._options.elements.length<=0&&this.layout(),this.getElements()}_fontSize(e){return k.warn("TextDesignRow#_fontSize not implemented. @TODO: Is it necessary?"),0}layout(){return this.setElements(this._calculateLayoutElements()),this}textFrame(e,t){return e.getFrame().clone()}willRender(e){}didRender(e){}render(e){e.save(),this._getLayoutElements().forEach(t=>{const{text:i,frame:r,font:s}=t.serializeOptions(),o=this.getAttributes();s.draw(e,r.x,r.y,{textColor:o.getTextColor().toRGBA(),alignment:o.getAlignment()})}),e.restore()}}et.prototype.availableOptions={words:{type:h.OBJECT,default:null},width:{type:h.NUMBER,default:100},attributes:{type:h.CONFIGURABLE,default:new mt},shearingAngle:{type:h.NUMBER,default:0},elements:{type:h.ARRAY,default:[]},size:{type:h.OBJECT,default:null}};const{Rectangle:Og}=P;class tt extends et{_calculateLayoutElements(){if(this.getWords().size()<=0)return[];const{orientation:e,width:t,size:i,relativeRowOffset:r,attributes:s}=this.serializeOptions(),{fontIdentifier:o}=s,n=this.getWords().joined(3),a=e===tt.Orientations.Left?[n[0],n[1],n[2]]:[n[1],n[2],n[0]],l=S.Array.range(0,2).map(U=>new Ye({text:a[U],fontIdentifier:o,fontSize:60})),d=l.map(U=>U.getSizeValue()),p=d[0].width>d[1].width?0:1,u=(p+1)%2;l[u].fitWidth(d[p].width),d[u]=l[u].getSizeValue();const c=(d[u].height+d[p].height)/(1-r),m=new Ye({text:a[2],fontIdentifier:o});m.fitHeight(c);const x=m.getSizeValue().width,_=d[p].width,f=t/(x+_),y=f*x,b=f*_,g=f*c,E=r*g;i.set(t,g);const v=S.Array.range(0,3).map(U=>new Ye({text:a[U],fontIdentifier:o}));v[0].fitWidth(b),v[1].fitWidth(b),v[2].fitWidth(y);const w=e===tt.Orientations.Left?0:y,A=e===tt.Orientations.Left?b:0,I=[w,w,A],z=[0,v[0].getSizeValue().height+E,0],H=v.map((U,X)=>new Og(I[X],z[X],U.getSizeValue().width,U.getSizeValue().height));return v.map((U,X)=>new Xe({text:a[X],font:v[X],frame:H[X]}))}}tt.Orientations={Right:"RIGHT",Left:"LEFT"};tt.prototype.availableOptions=R(R({},et.prototype.availableOptions),{orientation:{type:h.STRING,default:tt.Orientations.Left,available:[tt.Orientations.Right,tt.Orientations.Left]},relativeRowOffset:{type:h.NUMBER,default:.05}});const{Rectangle:Cg}=P;class V{constructor(e=0,t=0,i=0,r=0){this.top=e,this.left=t,this.bottom=i,this.right=r}multiply(e){this.top*=e,this.left*=e,this.bottom*=e,this.right*=e}toObject(){return R({},this)}equals(e,t=0){return Math.abs(e.top-this.top)<=t&&Math.abs(e.left-this.left)<=t&&Math.abs(e.bottom-this.bottom)<=t&&Math.abs(e.right-this.right)<=t}scale(e=1,t){return t===void 0&&(t=e),this.top*=t,this.bottom*=t,this.left*=e,this.right*=e,this}clone(){return new V(this.top,this.left,this.bottom,this.right)}applyToRectangle(e){return new Cg(e.x+this.left,e.y+this.top,e.width-this.left-this.right,e.height-this.top-this.bottom)}static get ZERO(){return new V(0,0,0,0)}}class ye extends et{_calculateLayoutElements(){const{attributes:e,imageInsets:t,size:i,width:r}=this.serializeOptions(),s=this.getWords().joined(1)[0]||"",{fontIdentifier:o}=e,n=new Ye({text:s,fontIdentifier:o});n.fitWidth(this._getTextFrame().width);const a=n.getTextMetrics().height+t.top+t.bottom;i.height=a;const l=this._getTextFrame(),d=new Xe({text:s,frame:l,font:n});return[d]}}ye.prototype.availableOptions=R(R({},et.prototype.availableOptions),{imageInsets:{type:h.OBJECT,default:new V}});const{Rectangle:kt,Vector2:Fe}=P,Mn=(e,t,i,r)=>{e.drawImage(t,i.x,i.y,i.width,i.height,r.x,r.y,r.width,r.height)},ht=(e,t,i,r="source-over",s=!1)=>{e.save(),e.fillStyle=i.toRGBA(),e.globalCompositeOperation=r,e.fillRect(t.x,t.y,t.width,t.height),s&&(e.strokeStyle=i.toRGBA(),e.strokeWith=1,e.strokeRect(t.x,t.y,t.width,t.height)),e.restore()},so=(e,t,i,r,s="source-over",o=!1)=>{e.save(),e.fillStyle=r.toRGBA(),e.globalCompositeOperation=s,i=Math.min(Math.max(i,0),Math.min(t.height,t.width)*.5);const n=t.x,a=t.x+t.width,l=t.y,d=t.y+t.height;e.beginPath(),e.moveTo(n+i,l),e.arcTo(a,l,a,d,i),e.arcTo(a,d,n,d,i),e.arcTo(n,d,n,l,i),e.arcTo(n,l,a,l,i),e.closePath(),e.fill(),o&&e.stroke(),e.restore()},cr=(e,t,i,r=4)=>{e.save(),e.strokeStyle=i.toRGBA(),e.lineWidth=r,e.strokeRect(t.x,t.y,t.width,t.height),e.restore()},Ln=(e,t,i,r="source-over")=>{e.save();const s=t.height/2,o=t.y+s;let n=t.x+s;const a=t.x+t.width;for(e.fillStyle=i.toRGBA(),e.globalCompositeOperation=r;n<a;)e.beginPath(),e.arc(n,o,s,0,2*Math.PI),e.fill(),n+=s*4;e.restore()},Fc=(e,t)=>{const i=t.applyToRectangle(e),{x:r,y:s,width:o,height:n}=e,a=[kt.FromDiagonalPoints(new Fe(0,0),new Fe(i.x,i.y)),kt.FromDiagonalPoints(new Fe(0,i.y+i.height),new Fe(i.x,n)),kt.FromDiagonalPoints(new Fe(i.x+i.width,i.y+i.height),new Fe(o,n)),kt.FromDiagonalPoints(new Fe(i.x+i.width,0),new Fe(o,i.y))].map(d=>d.translate(r,s)),l=[kt.FromDiagonalPoints(new Fe(i.x,0),new Fe(i.x+i.width,i.y)),kt.FromDiagonalPoints(new Fe(0,i.y),new Fe(i.x,i.y+i.height)),kt.FromDiagonalPoints(new Fe(i.x,i.y+i.height),new Fe(i.x+i.width,n)),kt.FromDiagonalPoints(new Fe(i.x+i.width,i.y),new Fe(o,i.y+i.height))].map(d=>d.translate(r,s));return{corners:a,bars:l,center:i}},Ac=(e,t,i,r)=>{const s=t.naturalWidth||t.width,o=t.naturalHeight||t.height,n=Fc(new kt(0,0,s,o),r),a=Fc(i,r);Mn(e,t,n.center,a.center),S.Array.zip(n.corners,a.corners).forEach(([l,d])=>Mn(e,t,l,d)),S.Array.zip(n.bars,a.bars).forEach(([l,d])=>Mn(e,t,l,d))},Dt=(e,t,i,r,s="source-atop")=>{if(e.save(),r&&(e.globalAlpha=r.a),e.drawImage(t,i.x,i.y,i.width,i.height),r&&(e.globalAlpha=1),r){const o=r.clone();o.a=1,ht(e,i,o,s)}e.restore()};class Xt extends ye{_getTextColor(){return this.getAutoAdjustTextColor()&&!this.getIsMasked()?this.getBackgroundColor().equals(O.WHITE)?O.BLACK:O.WHITE:this.getAttributes().getTextColor().clone()}_getTextFrame(){return this.getImageInsets().applyToRectangle(this._getFrame())}_getTextFrameForElement(e){const t=super._getTextFrameForElement(e),i=this.getImageInsets();return(this.getIsMasked()||this.getIsUsedInInvertedLayout())&&(t.y-=i.top),t}willRender(e){process.env.REACT_APP_BROWSER||this.serverImageSmoothingFix&&(e.imageSmoothingEnabled=!0);const t=this.getAttributes();t.setTextColor(this._getTextColor());const i=this.getImage();if(i){const r=this.getCapInsets(),s=this._getFrame();r&&!r.equals(V.ZERO)?Ac(e,i,s,r):e.drawImage(i,s.x,s.y,s.width,s.height),ht(e,s,this.getBackgroundColor(),"source-atop",!0)}(this.getIsMasked()||this.getIsUsedInInvertedLayout())&&i&&(e.save(),e.globalCompositeOperation="destination-out")}didRender(e){super.didRender(e),(this.getIsMasked()||this.getIsUsedInInvertedLayout())&&e.restore()}}Xt.prototype.availableOptions=R(R({},ye.prototype.availableOptions),{image:{type:h.IMAGE,default:null},capInsets:{type:h.OBJECT,default:new V},backgroundColor:{type:h.COLOR,default:O.WHITE},autoAdjustTextColor:{type:h.BOOLEAN,default:!0},isMasked:{type:h.BOOLEAN,default:!0},isUsedInInvertedLayout:{type:h.BOOLEAN,default:!1}});class ft extends G{insetsForWidth(e){return this.getRelativeInsets().clone().scale(e)}static get Small(){return new ft({imagePath:"text-design/images/imgly_text_design_asset_banderole_small.png",fontIdentifier:"imgly_font_campton_bold",relativeInsets:new V(.05,.2,.05,.2)})}static get Rectangle(){return new ft({imagePath:"text-design/images/imgly_text_design_asset_black_background.png",fontIdentifier:"imgly_font_campton_bold",relativeInsets:new V(.05,.05,.05,.05),needsImageSmoothingFix:!0})}static get Celebrate1(){return new ft({imagePath:"text-design/images/imgly_text_design_asset_celebrate_01.png",fontIdentifier:"imgly_font_rasa_500",relativeInsets:new V(.05,.2,.05,.2)})}static get Celebrate2(){return new ft({imagePath:"text-design/images/imgly_text_design_asset_celebrate_02.png",fontIdentifier:"imgly_font_rasa_500",relativeInsets:new V(.05,.2,.05,.2)})}}ft.prototype.availableOptions={image:{type:h.IMAGE,default:null},imagePath:{type:h.STRING,default:null},relativeInsets:{type:h.OBJECT,default:new V},fontIdentifier:{type:h.STRING,default:"imgly_font_open_sans_bold"},needsImageSmoothingFix:{type:h.BOOLEAN,default:!1}};class Nn extends G{getSize(){const e=this.getRows(),t=this.getWidth(),i=e.length-1;let r=e.reduce((o,n)=>o+n.getSize().height,0);r+=(i+1)*this.getRelativeLineSpacing()*t;const s=this.getRelativeInsets().clone().scale(t);return r+=s.top+s.bottom,new _e(t,r)}}Nn.prototype.availableOptions={text:{type:h.STRING,default:""},lines:{type:h.ARRAY,default:[]},relativeInsets:{type:h.OBJECT,default:new V},relativeLineSpacing:{type:h.NUMBER,default:0},rows:{type:h.OBJECT,default:[]},background:{type:h.OBJECT,default:null},width:{type:h.NUMBER,default:0}};class Le{constructor(e){this.words=[],e&&this.splitIntoWords(e)}splitIntoWords(e){return this.words=e.match(/\S+/g)||[],[...this.words]}get(){return[...this.words]}getWord(e){return this.words[e]}set(e){return this.words=[...e],this}slice(e,t){return Le.fromWords(this.words.slice(e,t))}getLowerCase(){return this.words.map(e=>e.toLowerCase())}getUpperCase(){return this.words.map(e=>e.toUpperCase())}size(){return this.words.length}countNumberOfCharacters(){return this.words.reduce((e,t)=>e+t.length,0)}joined(e){const t=this.size(),i=Math.floor(t/e),r=t%e;let s=0,o=0;return S.Array.range(0,e).map(n=>{s=o;const a=i+(n<r?1:0);return o=Math.min(s+a,t),S.Array.range(s,o).reduce((l,d)=>l+(d===s?"":" ")+this.words[d],"")})}static fromWords(e){const t=new Le;return t.words=[...e],t}}const kg=10,Dg=4,Pg=.4;class Re extends G{constructor(e){super(e);this._relativeInsets=new V,this._background=null,this._fontRandomizer=new W(0),this._lineNumberRandomizer=new W(0),this._wordsPerLineRandomizer=new W(0),this._seedPool=[this._fontRandomizer,this._lineNumberRandomizer,this._wordsPerLineRandomizer]}seed(e){this._seedPool.forEach(t=>t.seed(e))}getImagePaths(){return[]}onImagesLoaded(){}getMaximumNumberOfTries(){return kg}getMinLineCountOfRandom(){return Dg}getRandomAdditionalLinePercentage(){return Pg}_fontForRow(e,t){return this._fontRandomizer.pickNext(this.getFontIdentifiers())}_modifiedText(e){return e.replace(`
`," ").replace("	"," ")}_minimumNumberOfLines(e){return Math.ceil(Math.sqrt(e.size()))}_maximumNumberOfLines(e){return e.size()}_calculatedNumberOfLines(e){let t=this._minimumNumberOfLines(e);if(e.size()>=this.getMinLineCountOfRandom()){const i=Math.floor(Math.max(1,t*this.getRandomAdditionalLinePercentage()));t+=this._lineNumberRandomizer.nextInRange(0,i)}return Math.min(t,this._maximumNumberOfLines(e))}_randomizedNumberOfWordsPerLine(e,t){if(e>t)return k.warn("TextDesign#_randomizedNumberOfWordsPerLine: Invalid number of lines"),t;const i=S.Array.repeat(1,e);return S.Array.range(e,t).forEach(r=>{const s=this._wordsPerLineRandomizer.nextInRange(0,e-1);i[s]+=1}),i}_textLines(e){const t=new Le(e),i=this._calculatedNumberOfLines(t),r=this._randomizedNumberOfWordsPerLine(i,t.size());return r.reduce((s,o)=>({index:s.index+o,lines:[...s.lines,t.slice(s.index,Math.min(s.index+o,t.size()))]}),{index:0,lines:[]}).lines}_validTextLines(e){let t=this._textLines(e),i=0;do if(i=S.Array.findIndex(t,r=>r.countNumberOfCharacters()<3),i>=0){const r=t[i-1],s=t[i+1],o=r?r.countNumberOfCharacters():Number.MAX_SAFE_INTEGER,n=s?s.countNumberOfCharacters():Number.MAX_SAFE_INTEGER;o<n&&r?(r.words=[...r.words,...t[i].words],t=[...t.slice(0,i),...t.slice(i+1)]):s&&(s.words=[...t[i].words,...s.words],t=[...t.slice(0,i),...t.slice(i+1)])}while(i>-1&&t.length>1);return t}_modifiedLines(e){return e}_getBackground(){return this._background}generateLayoutData(e,t){const i=this._modifiedText(e),r=this._modifiedLines(this._validTextLines(i)),s=t*(1-this._relativeInsets.left-this._relativeInsets.right),o=this._layoutRows(r,s);return new Nn({text:i,relativeInsets:this._relativeInsets.clone(),relativeLineSpacing:this.getRelativeLineSpacing(),background:this._background||this._getBackground(),lines:r,rows:o,width:t})}_layoutRows(e,t){return e.map((i,r)=>this._randomLayoutRow(i,r,t,new mt({fontIdentifier:this._fontForRow(r,i)})).layout())}_randomLayoutRow(e,t,i,r){return new ye({words:e,width:i,attributes:r})}}Re.defaultFontIdentifiers=[],Re.identifier="textdesign";Re.prototype.availableOptions={fontIdentifiers:{type:h.ARRAY,default:[]},relativeLineSpacing:{type:h.NUMBER,default:0}};class ke extends Re{constructor(...e){super(...e);this.getImagePaths=()=>{const e=this.getBanderoles();return e&&e.map(t=>t.getImagePath())||[]};this.onImagesLoaded=()=>{const e=this.getBanderoles();e&&e.forEach(t=>{const i=ie.getImage(t.getImagePath());if(!i){k.warn(`TextDesignBlocks#onImagesLoaded: Image not found '${t.getImagePath()}'`);return}t.setImage(i)})};this._rowTypeLessThan3WordsRandomizer=new W(0),this._rowTypeMoreThan3WordsRandomizer=new W(0),this._banderolesRandomizer=new W(0),this._seedPool=[...this._seedPool,this._rowTypeLessThan3WordsRandomizer,this._rowTypeMoreThan3WordsRandomizer,this._banderolesRandomizer]}_modifiedText(e){return super._modifiedText(e).toUpperCase()}generateLayoutData(e,t){return this._options.hasMaskedText=!1,super.generateLayoutData(e,t)}_randomLayoutRow(e,t,i,r){if(e.size()<3){const o=this._rowTypeLessThan3WordsRandomizer.nextInRange(0,2)===0;return this._layoutRow(e,i,r,o)}const s=this._rowTypeMoreThan3WordsRandomizer.nextInRange(0,3);switch(s){case 0:return new tt({words:e,width:i,attributes:r,orientation:tt.Orientations.Left});case 1:return new tt({words:e,width:i,attributes:r,orientation:tt.Orientations.Right});case 2:return this._layoutRow(e,i,r,!0);case 3:return new ye({words:e,width:i,attributes:r});default:throw new Error(`TextDesignBlocks#_randomLayoutRow: Invalid randomValue generated: ${s}.`)}}_layoutRow(e,t,i,r){if(this.getHasMaskedText()&&(r=!1),r){this.setHasMaskedText(!0);const s=this._banderolesRandomizer.pickNext(this.getBanderoles()),o=new Xt({words:e,width:t,attributes:new mt({alignment:"left",fontIdentifier:s.getFontIdentifier()}),image:s.getImage(),imageInsets:s.insetsForWidth(t),capInsets:null,backgroundColor:O.WHITE});return s.getNeedsImageSmoothingFix()&&(o.serverImageSmoothingFix=!0),o}return new ye({words:e,width:t,attributes:i})}}ke.defaultFontIdentifiers=["imgly_font_campton_bold"],ke.identifier="imgly_text_design_blocks",ke.defaultBanderoles=[ft.Rectangle,ft.Small];ke.prototype.availableOptions=R(R({},Re.prototype.availableOptions),{fontIdentifiers:{type:h.ARRAY,default:ke.defaultFontIdentifiers},relativeLineSpacing:{type:h.NUMBER,default:.025/3},hasMaskedText:{type:h.BOOLEAN,default:!1},banderoles:{type:h.ARRAY,default:ke.defaultBanderoles}});class pr extends ke{constructor(...e){super(...e);this._exclusiveFont=null}generateLayoutData(e,t){return this._exclusiveFont=this._fontRandomizer.pickNext(this.getFontIdentifiers()),super.generateLayoutData(e,t)}_fontForRow(e,t){return this._exclusiveFont||super._fontForRow(e,t)}_layoutRow(e,t,i,r){return new ye({words:e,width:t,attributes:i})}}pr.defaultFontIdentifiers=["imgly_font_ostrich_sans_heavy","imgly_font_ostrich_sans_bold","imgly_font_ostrich_sans_black"],pr.identifier="imgly_text_design_blocks_condensed";pr.prototype.availableOptions=R(R({},ke.prototype.availableOptions),{fontIdentifiers:{type:h.ARRAY,default:pr.defaultFontIdentifiers}});const{Rectangle:Kr}=P;class Te extends et{constructor(...e){super(...e);this.setSize(new _e(this.getWidth(),this.getHeight()))}_calculateLayoutElements(){return[new Xe({frame:this._getTextFrame()})]}render(e){const t=this._getFrame(),i=this.getType(),r=this.getAttributes(),s=r.getTextColor(),o=t.height/3;let n=new Kr(t.x,t.y,t.width,o),a=new Kr(t.x,t.y+o*2,t.width,o);switch(i){case Te.FormType.Rect:ht(e,t,s);break;case Te.FormType.DoubleRect:ht(e,n,s),ht(e,a,s);break;case Te.FormType.DoubleRectFirstPunctuated:Ln(e,n,s),ht(e,a,s);break;case Te.FormType.DoubleRectSecondPunctuated:ht(e,n,s),Ln(e,a,s);break;case Te.FormType.LongLine:{const l=t.height/2,d=new Kr(t.x,t.y,t.width,l);so(e,d,d.height*.5,s);break}case Te.FormType.LongAndShortLine:{const l=t.height*.2,d=l*.75;n=new Kr(t.x,t.y+l,t.width,l);const p=t.x+t.width*.25,u=t.y+t.height-d;a=new Kr(p,u,t.width*.5,d),so(e,n,n.height*.5,s),so(e,a,a.height*.5,s);break}default:break}}}Te.FormType={Rect:"RECT",DoubleRect:"DOUBLE_RECT",DoubleRectFirstPunctuated:"DOUBLE_RECT_FIRST_PUNCTUATED",DoubleRectSecondPunctuated:"DOUBLE_RECT_SECOND_PUNCTUATED",LongLine:"LONG_LINE",LongAndShortLine:"LONG_AND_SHORT_LINE"};Te.prototype.availableOptions=R(R({},et.prototype.availableOptions),{height:{type:h.NUMBER,default:100},type:{type:h.STRING,default:Te.FormType.Rect,available:S.values(Te.FormType)}});class Pt extends ke{_layoutRow(e,t,i,r){return new ye({words:e,width:t,attributes:i})}_layoutRows(e,t){const i=super._layoutRows(e,t),r=.032*t,s=.08*t,o=new Te({width:t,height:r,type:Te.FormType.LongLine,shearingAngle:0}).layout(),n=new Te({width:t,height:s,type:Te.FormType.LongAndShortLine,shearingAngle:0}).layout();return[o,...i,n]}}Pt.defaultFontIdentifiers=["imgly_font_sue_ellen_francisco"],Pt.identifier="imgly_text_design_blocks_light";Pt.prototype.availableOptions=R(R({},ke.prototype.availableOptions),{fontIdentifiers:{type:h.ARRAY,default:Pt.defaultFontIdentifiers}});class ur extends Pt{_layoutRows(e,t){return e.map((i,r)=>this._randomLayoutRow(i,r,t,new mt({fontIdentifier:this._fontForRow(r,i)})).layout())}_layoutRow(e,t,i,r){return new ye({words:e,width:t,attributes:i})}}ur.defaultFontIdentifiers=["imgly_font_sue_ellen_francisco"],ur.identifier="imgly_text_design_blocks_light-v3_1_0";ur.prototype.availableOptions=R(R({},Pt.prototype.availableOptions),{fontIdentifiers:{type:h.ARRAY,default:ur.defaultFontIdentifiers}});const{Rectangle:Fg}=P;class gt extends ye{getImageSize(){const e=this.getLeftImage(),t=this.getRightImage(),i=this.getWords(),r=this.getAttributes(),s=r.getFontIdentifier(),o=e?new _e(e.width,e.height):new _e,n=i.joined(1)[0];if(!n)return o;const a=new Ye({text:n,fontIdentifier:s,fontSize:50}),l=a.getSizeValue(),d=t?2:1;o.scale(d,1);const p=o.clone().fitInWidthWithOther(this._getFrame().width,l);return p.scale(1/d,1),p}_getTextFrame(){const e=super._getTextFrame().clone(),t=this.getImageSize(),i=this.getRightImage(),r=this.getImagePosition();return i?(e.x+=t.width,e.width-=2*t.width):r===gt.ImagePosition.Left&&(e.x+=t.width),e}_calculateLayoutElements(){const e=super._calculateLayoutElements(),t=this._getFrame(),i=this.getRightImage(),r=this.getImageSize(),s=this.getImagePosition(),o=this._getTextFrame(),n=this.getAttributes(),a=n.getFontIdentifier(),l=new Ye({text:"stickerClock",fontIdentifier:a});l.fitWidth(this._getTextFrame().width);const d=new Fg().set(t.x,t.y,r.width,r.height);if(!i&&s===gt.ImagePosition.Right&&(d.x+=o.width),e.push(new Xe({text:"stickerClock",frame:d,font:l})),i){const p=e[0];if(p){const u=d.clone();u.translate(p.getFrame().width+u.width,0),e.push(new Xe({text:"stickerClock",frame:u,font:l}))}}return e}render(e){const t=this._getLayoutElements(),i=this.getAttributes(),r=i.getTextColor(),s=this.getLeftImage(),o=this.getRightImage(),n=t[0],a=t[1],{font:l}=n.serializeOptions(),d=this._getTextFrameForElement(n);if(l.draw(e,d.x,d.y,{textColor:i.getTextColor().toRGBA(),alignment:i.getAlignment()}),s){const p=a.getFrame();e.drawImage(s,p.x,p.y,p.width,p.height),ht(e,p,r,"source-atop")}if(t.length>2){const p=t[2],u=p.getFrame().clone();e.drawImage(o,u.x,u.y,u.width,u.height),ht(e,u,r,"source-atop")}}}gt.ImagePosition={Left:"LEFT",right:"RIGHT"};gt.prototype.availableOptions=R(R({},ye.prototype.availableOptions),{leftImage:{type:h.IMAGE,default:null},rightImage:{type:h.IMAGE,default:null},imagePosition:{type:h.STRING,default:gt.ImagePosition.Left,available:[gt.ImagePosition.Left,gt.ImagePosition.Right]}});class Ne extends ke{_fontForRow(e,t){const i=this.getFontIdentifiers();return i[e%i.length]}_minimumNumberOfLines(e){return Math.max(Math.floor(super._minimumNumberOfLines(e)*.7),1)}_maximumNumberOfLines(e){return Math.max(Math.floor(e.countNumberOfCharacters()/5),1)}_randomLayoutRow(e,t,i,r){return this._createSingleRow(Ne.RowType.Single,e,i,r)}_createSingleRow(e,t,i,r){const s=r.getFontIdentifier(),o=s==="imgly_font_amberlight"||s==="imgly_font_handycheera_regular"?new Le().set(t.getLowerCase()):t;switch(e){case Ne.RowType.Single:return new ye({words:o,width:i,attributes:r});case Ne.RowType.SingleImage:return new gt({words:o,width:i,attributes:r});default:return k.warn(`TextDesignCelebrate#_createSingleRow: Invalid row type '${e}'`),null}}}Ne.defaultFontIdentifiers=["imgly_font_handycheera_regular","imgly_font_rasa_regular"],Ne.defaultBanderoles=[ft.Celebrate1,ft.Celebrate2],Ne.identifier="imgly_text_design_celebrate",Ne.RowType={Single:"SINGLE",SingleImage:"SINGLE_IMAGE"};Ne.prototype.availableOptions=R(R({},ke.prototype.availableOptions),{relativeLineSpacing:{type:h.NUMBER,default:.01875},fontIdentifiers:{type:h.ARRAY,default:Ne.defaultFontIdentifiers},banderoles:{type:h.ARRAY,default:Ne.defaultBanderoles}});class Ee extends et{constructor(...e){super(...e);this.setSize(new _e(this.getWidth(),this.getHeight()))}_getImageFrame(){const e=this._getTextFrame().clone(),t=this.getImage();if(this.getDrawingModeAspectFit()&&t){const i=Math.min(e.width/t.width,e.height/t.height),r=t.width*i,s=t.height*i;e.x+=(e.width-r)/2,e.y+=(e.height-s)/2,e.width=r,e.height=s}return e}_calculateLayoutElements(){return[new Xe({text:"",frame:this._getImageFrame(),font:new Ye})]}render(e){const t=this.getImage(),i=this._getImageFrame(),r=this.getAttributes(),s=r.getTextColor();Dt(e,t,i,s)}}Ee.RowImages={decorative1:"text-design/images/imgly_text_design_asset_decorative_01.png",decorative2:"text-design/images/imgly_text_design_asset_decorative_02.png",decorative3:"text-design/images/imgly_text_design_asset_decorative_05.png",decorative4:"text-design/images/imgly_text_design_asset_decorative_06.png",celebrate1:"text-design/images/imgly_text_design_asset_celebrate_03.png",celebrate2:"text-design/images/imgly_text_design_asset_celebrate_04.png",celebrate3:"text-design/images/imgly_text_design_asset_celebrate_05.png"};Ee.prototype.availableOptions=R(R({},et.prototype.availableOptions),{words:{type:h.OBJECT,default:new Le},height:{type:h.NUMBER,default:0},image:{type:h.IMAGE,default:null},imagePath:{type:h.STRING,default:Ee.RowImages.decorative1},drawingModeAspectFit:{type:h.BOOLEAN,default:!1},attributes:{type:h.CONFIGURABLE,default:new mt}});class mr extends Ne{constructor(...e){super(...e);this.getImagePaths=()=>{const e=this.getBanderoles();return[...e&&e.map(t=>t.getImagePath())||[],...this._celebrateTypes]};this.onImagesLoaded=()=>{const e=this.getBanderoles();e&&e.forEach(t=>{const i=ie.getImage(t.getImagePath());if(!i){k.warn(`TextDesignBlocks#onImagesLoaded: Image not found '${t.getImagePath()}'`);return}t.setImage(i)})};this._celebrateTypes=[Ee.RowImages.celebrate1,Ee.RowImages.celebrate2,Ee.RowImages.celebrate3],this._exclusiveFont=null,this._typeRandomizer=new W(0),this._useMaskedRandomizer=new W(0),this._seedPool.push(this._typeRandomizer),this._seedPool.push(this._useMaskedRandomizer)}_fontForRow(e,t){const i=this.getFontIdentifiers();return i[e%(i.length-1)]}_layoutRows(e,t){const i=this._typeRandomizer.pickNext(this._celebrateTypes),r=ie.getImage(i);r||k.warn(`TextDesignCelebrateSimple#_layoutRows: Image not fount '${i}'`);const s=new Ee({width:t,height:t*.5,drawingModeAspectFit:!0,image:r}).layout(),o=super._layoutRows(e,t);return[s,...o]}_randomLayoutRow(e,t,i,r){const s=e.countNumberOfCharacters(),o=13,n=4;s<n&&r.setFontIdentifier("imgly_font_rasa_regular");const a=this._useMaskedRandomizer.nextBool(2,1);return s<o&&a&&!this.getHasMaskedText()?this._layoutRow(e,i,r,!0):super._randomLayoutRow(e,t,i,r)}}mr.identifier="imgly_text_design_celebrate_simple",mr.defaultFontIdentifiers=["imgly_font_amberlight","imgly_font_rasa_regular","imgly_font_rasa_500"];mr.prototype.availableOptions=R(R({},Ne.prototype.availableOptions),{fontIdentifiers:{type:h.ARRAY,default:mr.defaultFontIdentifiers}});class fr extends G{render(e,t,i,r,s){k.warn("TextDesignBackground#render: Abstract class")}}fr.prototype.availableOptions={};const{Rectangle:oo}=P;class Ft extends fr{getImagePaths(){const{topImagePath:e,bottomImagePath:t,leftImagePath:i,rightImagePath:r}=this._options;return[e,t,i,r].filter(s=>s!=="")}render(e,t,i,r,s){const o=i.clone().scale(t.width),n=t.rectangle(0,0),a=ie.getImage(this.getTopImagePath()),l=ie.getImage(this.getLeftImagePath()),d=ie.getImage(this.getRightImagePath()),p=ie.getImage(this.getBottomImagePath());if(a){const u=a.width/a.height,c=o.top*this.getTopImageFillRate(),m=c*u,x=n.width/2,_=x-m/2,f=new oo(_,0,m,c);Dt(e,a,f,r)}if(p){const u=p.width/p.height,c=o.bottom*this.getBottomImageFillRate(),m=c*u,x=n.width/2,_=x-m/2,f=new oo(_,n.height-c,m,c);Dt(e,p,f,r)}if(l){const u=l.width/l.height,c=o.left*this.getLeftImageFillRate(),m=c/u,x=n.height/2,_=x-m/2,f=new oo(0,_,c,m);Dt(e,l,f,r)}if(d){const u=d.width/d.height,c=o.right*this.getRightImageFillRate(),m=c/u,x=n.height/2,_=x-m/2,f=new oo(n.width-c,_,c,m);Dt(e,d,f,r)}}}Ft.prototype.availableOptions={topImagePath:{type:h.STRING,default:""},leftImagePath:{type:h.STRING,default:""},bottomImagePath:{type:h.STRING,default:""},rightImagePath:{type:h.STRING,default:""},topImageFillRate:{type:h.NUMBER,default:1},leftImageFillRate:{type:h.NUMBER,default:1},bottomImageFillRate:{type:h.NUMBER,default:1},rightImageFillRate:{type:h.NUMBER,default:1}};Ft.Backgrounds=[new Ft({topImagePath:"text-design/images/imgly_xib_image_text_design_equal_width_background1_1.png",leftImagePath:"text-design/images/imgly_xib_image_text_design_equal_width_background1_2.png",rightImagePath:"text-design/images/imgly_xib_image_text_design_equal_width_background1_2.png",bottomImagePath:"text-design/images/imgly_xib_image_text_design_equal_width_background1_3.png",topImageFillRate:.8,leftImageFillRate:.6,rightImageFillRate:.6,bottomImageFillRate:.8}),new Ft({leftImagePath:"text-design/images/imgly_xib_image_text_design_equal_width_background2_1.png",rightImagePath:"text-design/images/imgly_xib_image_text_design_equal_width_background2_1.png",bottomImagePath:"text-design/images/imgly_xib_image_text_design_equal_width_background2_2.png",leftImageFillRate:.6,rightImageFillRate:.6,bottomImageFillRate:.6}),new Ft({topImagePath:"text-design/images/imgly_xib_image_text_design_equal_width_background3_1.png",bottomImagePath:"text-design/images/imgly_xib_image_text_design_equal_width_background3_2.png",topImageFillRate:.6,bottomImageFillRate:.6}),new Ft({topImagePath:"text-design/images/imgly_xib_image_text_design_equal_width_background4_1.png",leftImagePath:"text-design/images/imgly_xib_image_text_design_equal_width_background4_3.png",rightImagePath:"text-design/images/imgly_xib_image_text_design_equal_width_background4_3.png",bottomImagePath:"text-design/images/imgly_xib_image_text_design_equal_width_background4_2.png",topImageFillRate:.1,leftImageFillRate:.6,rightImageFillRate:.6,bottomImageFillRate:.6})];class At extends Re{constructor(...e){super(...e);this._relativeInsets=new V(.1,.1,.1,.1),this._alreadyContainsARowWithScriptFont=!1,this._backgroundsRandomizer=new W(0),this._seedPool.push(this._backgroundsRandomizer)}getImagePaths(){return S.Array.flatten(Ft.Backgrounds.map(e=>e.getImagePaths()))}_getBackground(){return this._backgroundsRandomizer.pickNext(Ft.Backgrounds)}generateLayoutData(e,t){return this._alreadyContainsARowWithScriptFont=!1,this._background=this._getBackground(),super.generateLayoutData(e,t)}_modifiedText(e){return super._modifiedText(e).toUpperCase()}_fontForRow(e,t){let i=super._fontForRow(e,t);return i==="imgly_font_petit_formal_script"&&(this._alreadyContainsARowWithScriptFont&&(i="imgly_font_bungee_inline"),this._alreadyContainsARowWithScriptFont=!0),i}_randomLayoutRow(e,t,i,r){const s=r.getFontIdentifier()==="imgly_font_petit_formal_script";return new ye({words:s?new Le().set(e.getLowerCase()):e,width:i,attributes:r})}}At.identifier="imgly_text_design_equal_width",At.defaultFontIdentifiers=["imgly_font_ultra","imgly_font_bungee_inline","imgly_font_petit_formal_script"];At.prototype.availableOptions=R(R({},Re.prototype.availableOptions),{fontIdentifiers:{type:h.ARRAY,default:At.defaultFontIdentifiers},relativeLineSpacing:{type:h.NUMBER,default:.025}});class gr extends At{constructor(...e){super(...e);this._relativeInsets=new V}_getBackground(){return null}}gr.defaultFontIdentifiers=["imgly_font_ultra"],gr.identifier="imgly_text_design_equal_width_fat";gr.prototype.availableOptions=R(R({},At.prototype.availableOptions),{fontIdentifiers:{type:h.ARRAY,default:gr.defaultFontIdentifiers}});class K extends G{insetsForWidth(e){const t=this.getRelativeInsets().clone();return t.scale(e)}}K.prototype.availableOptions={imagePath:{type:h.STRING,default:""},minimumHeightRatio:{type:h.NUMBER,default:0},sizeToFitContent:{type:h.BOOLEAN,default:!0},capInsets:{type:h.OBJECT,default:new V},relativeInsets:{type:h.OBJECT,default:new V}};K.Box=new K({imagePath:"text-design/images/imgly_text_design_asset_black_background.png",relativeInsets:new V(.1,.1,.1,.1)});K.Badge1=new K({imagePath:"text-design/images/imgly_text_design_asset_badge1.png",relativeInsets:new V(.3,.18,.2,.18)});K.Badge2=new K({imagePath:"text-design/images/imgly_text_design_asset_badge2.png",relativeInsets:new V(.3,.18,.2,.18)});K.Badge3=new K({imagePath:"text-design/images/imgly_text_design_asset_badge3.png",relativeInsets:new V(.3,.18,.2,.18)});K.Badge4=new K({imagePath:"text-design/images/imgly_text_design_asset_badge4.png",relativeInsets:new V(.3,.18,.2,.18)});K.SpeechBubble1=new K({imagePath:"text-design/images/imgly_text_design_asset_speech_bubble_small2.png",relativeInsets:new V(.04,.07,.12,.07),capInsets:new V(19*3,57*3,41*3,17*3)});K.SpeechBubble2=new K({imagePath:"text-design/images/imgly_text_design_asset_speech_bubble3.png",relativeInsets:new V(.04,.07,.12,.07),capInsets:new V(2*3,35*3,29*3,5*3)});K.SpeechBubble3=new K({imagePath:"text-design/images/imgly_text_design_asset_speech_bubble_small.png",relativeInsets:new V(.165664675,.2,.165664675,.2),minimumHeightRatio:.7});K.SpeechBubble4=new K({imagePath:"text-design/images/imgly_text_design_asset_speech_bubble4.png",relativeInsets:new V(.124800224,.2,.291200523,.2),minimumHeightRatio:.7});K.SpeechBubble5=new K({imagePath:"text-design/images/imgly_text_design_asset_speech_bubble5.png",relativeInsets:new V(.114892823,.27,.15984926,.27)});K.Watercolor1=new K({imagePath:"text-design/images/imgly_text_design_asset_watercolor_01.png",minimumHeightRatio:.7,relativeInsets:new V(.2,.25,.2,.25)});K.Watercolor2=new K({imagePath:"text-design/images/imgly_text_design_asset_watercolor_02.png",minimumHeightRatio:.7,relativeInsets:new V(.08,.25,.3,.25)});K.Watercolor3=new K({imagePath:"text-design/images/imgly_text_design_asset_watercolor_03.png",minimumHeightRatio:.7,relativeInsets:new V(.1,.2,.15,.2)});class Ag{constructor(e){this._context=e,this._lastFontStyle={}}getLines(){let e=[],t=[];const i=this._lines.length;for(let r=0;r<i;r++){const s=this._lines[r],o=this._buildWords(s),n=o.length;for(let a=0;a<n;a++){const l=o[a],d=t.concat(l).join("").replace(/\s+$/i,""),p=this._getWidth(d);if(p>this._maxWidth){t.length>0&&(e.push(t.join("")),t=[l]);const u=l.replace(/\s+$/i,"");if(this._getWidth(u)>this._maxWidth){const c=this._splitWord(l);e=e.concat(c.lines),c.rest&&(t=[c.rest])}}else t.push(l)}e.push(t.join("")),t=[]}return e.map(r=>this._trimLine(r,this._context.textAlign))}_trimLine(e,t){return e}_buildWords(e){const t=[];let i="";const r=e.length;for(let s=0;s<r;s++){const o=e[s];i+=o,(o===" "||o==="-"||s===r-1)&&(t.push(i),i="")}return t}_splitWord(e){const t={lines:[],rest:null},i=e.length;let r=[];for(let s=0;s<i;s++){const o=e[s];this._getWidth(r.concat(o).join(""))>this._maxWidth?(r.length>0&&t.lines.push(r.join("")),r=[o]):r.push(o),s===i-1&&r.length>0&&(t.rest=r.join(""))}return t}_fontStyleChanged(){return this._context.font!==this._lastFontStyle?(this._lastFontStyle=this._context.font,!0):!1}_getWidth(e){return this._context.measureText(e).width}setText(e){this._text=e,this._lines=e.split(`
`)}setMaxWidth(e){this._maxWidth=e}}var no=Ag;const{Vector2:zn}=P;class Ig{constructor(e,t){this._text=e,this._operation=t,this._textOptions={},this.rotation=0,this._createCanvas(),this._createTexture()}_createCanvas(){this._canvas=S.createCanvas(),this._context=this._canvas.getContext("2d"),this._textSplitter=new no(this._context),this._finalCanvas=S.createCanvas(),this._finalContext=this._finalCanvas.getContext("2d")}_createTexture(){this._texture=T.Texture.fromCanvas(this._canvas),this._finalTexture=T.Texture.fromCanvas(this._finalCanvas)}_applyTextOptions(e,t){t.font=`${this._text.getFontStyle()} ${this._text.getFontWeight()} ${e.fontSize}px "${this._text.getFontFamily()}"`,this._text.getTextMetrics()?t.textBaseline="alphabetic":t.textBaseline="top",t.textAlign=this._text.getAlignment(),t.fillStyle=this._text.getColor().toRGBA(),t.strokeStyle=this._text.getOutlineColor().toRGBA();const i=this._text.getOutlineWidth();i>0&&(t.lineWidth=i)}_buildOutputLines(e){return this._textSplitter.setText(this._text.getText()),this._textSplitter.setMaxWidth(e),this._textSplitter.getLines().map(t=>t.replace(/\s+$/i,""))}_renderTextLine(e,t,i){const r=this._text.getAlignment(),s=new zn(0,t);switch(r){case"left":s.x=i;break;case"center":s.x=this._canvas.width/2;break;case"right":s.x=this._canvas.width-i;break}this._context.save(),this._context.translate(s.x,s.y),this._context.fillText(e,0,0),this._context.restore();const o=this._text.getOutlineWidth();o>0&&(this._context.miterLimit=2,this._context.strokeText(e,s.x,s.y))}update(e,t){const i=this.calculateFontStyles(e,t);if(i){const{dimensions:r,lines:s}=this._calculateText(e,i,t);this._renderText(e,r,s,i,t),this._updateFinalTexture()}}_updateFinalTexture(){const{width:e,height:t}=this._canvas,{rotation:i}=this,r=Math.cos(i),s=Math.sin(i),o=new zn(Math.abs(e*r)+Math.abs(t*s),Math.abs(e*s)+Math.abs(t*r));this._finalCanvas.width=o.x,this._finalCanvas.height=o.y,this._finalContext.save(),this._finalContext.translate(this._finalCanvas.width/2,this._finalCanvas.height/2),this._finalContext.rotate(i),this._finalContext.drawImage(this._canvas,-e/2,-t/2),this._finalContext.restore()}_renderText(e,t,i,r,s){this._canvas.width=t.x,this._canvas.height=t.y,this._text.getMaxHeight()&&(this._canvas.height=Math.min(this._text.getMaxHeight()*s.y,this._canvas.height)),this._context=this._canvas.getContext("2d"),this._context.fillStyle=this._text.getBackgroundColor().toRGBA(),this._context.fillRect(0,0,t.x,t.y),this._applyTextOptions(r,this._context);const o=this._padding(s),n=this._text.getTextMetrics(),a=this._text.getFontSize()*s.y,l=1/n.unitsPerEm*a,d=n.ascender*l;for(let p=0;p<i.length;p++){const u=i[p];this._renderTextLine(u,r.topPadding+r.lineHeight*p+o+d,o)}}calculateFontStyles(e,t){const i=this._text.getFontFamily(),r=this._text.getFontSize()*t.y,s=this._text.getAbsoluteTextHeight(t),o=s*this._text.getLineHeight(),n=s*(this._text.getLineHeight()-1)/2,a={fontFamily:i,fontSize:r,lineHeight:o,topPadding:n};return(this._textOptions.fontFamily!==i||this._textOptions.fontSize!==r||this._textOptions.lineHeight!==o)&&(this._textOptions=a),a}_calculateText(e,t,i){const r=this._text.getMaxWidth()*i.x;this._applyTextOptions(t,this._context);const s=new zn;let o=this._text.getText().split(`
`);typeof r!="undefined"&&(s.x=r,o=this._buildOutputLines(r));for(let l=0;l<o.length;l++){const d=o[l];s.x=Math.max(s.x,this._context.measureText(d).width)}const{lineHeight:n}=t;s.y=o.length*n;const a=this._padding(i);return s.y+=a*2,s.x+=a*2,{dimensions:s,lines:o}}_padding(e){const t=this._text.getAbsoluteTextHeight(e),i=.2;return t*i}getTexture(){return this._texture}getFinalTexture(){return this._finalTexture}getDimensions(e,t){const i=this.calculateFontStyles(e,t),{dimensions:r}=this._calculateText(e,i,t);return r}dispose(){this._measurementElement&&document.body.removeChild(this._measurementElement),this._texture&&(this._texture.dispose(),this._texture=null),this._finalTexture&&(this._finalTexture.dispose(),this._finalTexture=null)}}var Ic=Ig;const{Vector2:Bc}=P;class ao extends G{constructor(e){super(e);this._textOptions={},this._createCanvas()}_createCanvas(){this._canvas=S.createCanvas(),this._context=this._canvas.getContext("2d"),this._textSplitter=new no(this._context),this._finalCanvas=S.createCanvas(),this._finalContext=this._finalCanvas.getContext("2d"),this.updateFontVariation()}setOption(e,t,i=!0,r=!1){super.setOption(e,t,i,r),e==="fontIdentifier"&&!r&&this.updateFontVariation()}updateFontVariation(){const e=ie.getVariation(this.getFontIdentifier());return e||k.warn(`TextDesignFont: Unable to find font '${this._fontIdentifier}'`),this.setFontVariation(e),e}_applyTextOptions(e={},t=this._context){const{fontSize:i,fontVariation:r,lineHeight:s,textColor:o,alignment:n}=R(R({},this._options),e),{fontStyle:a,fontWeight:l,fontFamily:d}=r.serializeOptions();t.font=`${a} ${l} ${i}px "${d}"`,t.fillStyle=o,t.textBaseline="top",t.textAlign=n||"left"}_buildOutputLines(e){return this._textSplitter.setText(this.getText()),this._textSplitter.setMaxWidth(e),this._textSplitter.getLines()}_renderTextLine(e,t){const i=this.getAlignment(),r=new Bc(0,t);switch(i){case"center":r.x=this._canvas.width/2;break;case"right":r.x=this._canvas.width;break}this._context.fillText(e,r.x,r.y)}update(){const e=this.calculateFontStyles();if(e){const{dimensions:t,lines:i}=this._calculateText(e);this._dimensions=t,this._renderText(t,i,e)}}draw(e,t=0,i=0){this.update(),e.drawImage(this._canvas,t,i,this._dimensions.x,this._dimensions.y)}_renderText(e,t,i){this._canvas.width=e.x,this._canvas.height=e.y,this._context=this._canvas.getContext("2d"),this._applyTextOptions(i,this._context);for(let r=0;r<t.length;r++){const s=t[r];this._renderTextLine(s,i.topPadding+i.lineHeight*r)}}getFontFamily(){const e=this.getFontVariation();return e.getFontFamily()}calculateFontStyles(){const e=this.getFontFamily(),t=this.getFontSize(),i=this.getAbsoluteTextHeight(),r=i*this.getLineHeight(),s=i*(this.getLineHeight()-1)/2,o={fontFamily:e,fontSize:t,textHeight:i,lineHeight:r,topPadding:s};return this._textOptions=R({},o),o}getTextMetrics(){const e=this.getFontVariation();return e.getTextMetrics()}getAbsoluteTextHeight(){const e=this.getFontSize(),t=this.getTextMetrics();if(t){const i=1/t.unitsPerEm*e,r=t.ascender*i,s=t.descender*i;return r+Math.abs(s)}return e*this.getLineHeight()*1.1}_calculateText(e){this._applyTextOptions(e,this._context);const t=new Bc;let i=this.getText().split(`
`),r;if(typeof r!="undefined")t.x=r,i=this._buildOutputLines(r);else for(let o=0;o<i.length;o++){const n=i[o];t.x=Math.max(t.x,this._context.measureText(n).width)}const{lineHeight:s}=e;return t.y=i.length*s,{dimensions:t,lines:i}}getDimensions(){const e=this.calculateFontStyles(),{dimensions:t}=this._calculateText(e);return t}fitMaxHeight(){this.update();const e=this.getDimensions(),t=this.getText().split(`
`),i=this.getMaxHeight()/e.y}fitMaxWidth(){const e=this.getDimensions().x,t=this.getMaxWidth()/e;this.setFontSize(this.getFontSize()*t),this._textOptions.fontSize=this.getFontSize()}fitInFrame(e){this.setMaxWidth(e.width),this.setMaxHeight(e.height),this.fitMaxWidth(),this.fitMaxHeight()}getSize(){const e=this.getDimensions();return new _e(e.x,e.y)}}ao.prototype.availableOptions={text:{type:h.STRING,default:""},fontIdentifier:{type:h.STRING,default:"imgly_font_open_sans_bold"},fontVariation:{type:h.OBJECT,default:null},lineHeight:{type:h.NUMBER,default:1},fontSize:{type:h.NUMBER,default:22},textColor:{type:h.STRING,default:"black"},strokeStyle:{type:h.STRING,default:"black"},outlineWidth:{type:h.NUMBER,default:0},textBaseline:{type:h.STRING,default:"alphabetic"},excludeAccents:{type:h.BOOLEAN,default:!0},maxWidth:{type:h.NUMBER,default:100},maxHeight:{type:h.NUMBER,default:0},alignment:{type:h.STRING,default:"left",available:["left","center","right"]}};class pi extends Xt{_calculateLayoutElements(){const e=this.getWords(),t=this._getTextFrame(),i=this.getAttributes(),r=i.getFontIdentifier(),s=this.getImageInsets(),o=new Ye({text:e.getWord(0),fontIdentifier:r});o.fitWidth(t.width);const n=new Xe({text:e.getWord(0),frame:t,font:o});n.setFrame(this._getTextFrameForElement(n));const a=this.getSize();return(this.getSizeToFitContent()||a.height<=1)&&(a.height=s.top+n.getFrame().height+s.bottom),a.height=Math.max(a.height,this.getMinimumHeight()),[n]}_getTextFrameForElement(e){const t=this.getWords(),i=t.getWord(0),r=this.getAttributes(),s=r.getFontIdentifier(),o=this.getImageInsets(),n=this.getImageInsets().applyToRectangle(this._getFrame()).scale(this.getTextScaleFactor()),a=new ao({text:i,fontIdentifier:s,alignment:r.getAlignment(),lineHeight:1});a.fitInFrame(n);const l=a.getSize();n.height=l.height;let d=l.height*this.getRowScaleFactor();this.getSizeToFitContent()&&(d+=o.top+o.bottom);const p=this._getFrame(),u=r.getAlignment();if(this.getCenteredVertically())n.y=p.height/2-d/2+o.top;else switch(u){case"left":n.y=p.height-d-o.bottom;break;case"center":n.y=p.height/2-d/2+d*this.getCenterOffset(),n.x=(p.width-n.width)/2;break;case"right":n.x=p.width-n.width-o.right;break;default:break}return n}render(e){e.save(),this._getLayoutElements().forEach(t=>{let{text:i,frame:r}=t.serializeOptions();const s=this.getAttributes(),o=s.getFontIdentifier(),n=new ao({text:i,fontIdentifier:o,alignment:s.getAlignment(),lineHeight:1,textColor:s.getTextColor().toRGBA()});r=this._getTextFrameForElement(t),n.fitInFrame(r),n.draw(e,r.x,r.y)}),e.restore()}}pi.prototype.availableOptions=R(R({},Xt.prototype.availableOptions),{centerOffset:{type:h.NUMBER,default:0},sizeToFitContent:{type:h.BOOLEAN,default:!1},textScaleFactor:{type:h.NUMBER,default:.95},rowScaleFactor:{type:h.NUMBER,default:1},minimumHeight:{type:h.NUMBER,default:0},centeredVertically:{type:h.BOOLEAN,default:!1}});class ce extends Re{constructor(...e){super(...e);this._rowType=K.Box,this._alignmentRandomizer=new W(0),this._isMaskedRandomizer=new W(0),this._seedPool.push(this._alignmentRandomizer),this._seedPool.push(this._isMaskedRandomizer)}getImagePaths(){return[K.Box.getImagePath()]}_modifiedText(e){return super._modifiedText(e).toLowerCase()}_modifiedLines(e){const t=new Le;return t.set([e.reduce((i,r)=>`${i}${i===""?"":`
`}${r.joined(1)[0]}`,"")]),[t]}_layoutRows(e,t){const i=super._layoutRows(e,t),r=i[0];if(r&&this.getSquareLayout()){const s=r.getSize();s.height=s.width}return i}getAlignment(){return this._alignmentRandomizer.pickNext(this.constructor.ValidAlignments||ce.ValidAlignments)}_randomLayoutRow(e,t,i,r){const s=this.getAlignment(),o=this._rowType,n=ie.getImage(o.getImagePath());r.setAlignment(s);const a=new pi({words:e,width:i,attributes:r,image:n,imageInsets:o.insetsForWidth(i),capInsets:o.getCapInsets(),backgroundColor:O.WHITE,centerOffset:0,textScaleFactor:.7,isMasked:this._isMaskedRandomizer.nextBool()});this._rowType===K.Box&&(a.serverImageSmoothingFix=!0);const l=a.getSize();return this.getSquareLayout()?l.height=l.width:l.height=Math.max(l.height,l.width*o.getMinimumHeightRatio()),a}}ce.defaultFontIdentifiers=["imgly_font_galano_grotesque_bold"],ce.Alignment={Left:"left",Center:"center",Right:"right"},ce.ValidAlignments=[ce.Alignment.Left,ce.Alignment.Center,ce.Alignment.Right],ce.identifier="imgly_text_design_masked";ce.prototype.availableOptions=R(R({},Re.prototype.availableOptions),{fontIdentifiers:{type:h.ARRAY,default:ce.defaultFontIdentifiers},squareLayout:{type:h.BOOLEAN,default:!0}});class ui extends ce{constructor(...e){super(...e);this._possibleRowTypes=[K.Badge1,K.Badge2,K.Badge3,K.Badge4],this._rowTypesRandomizer=new W(0),this._isMaskedRandomizer=new W(0),this._seedPool.push(this._rowTypesRandomizer),this._seedPool.push(this._isMaskedRandomizer)}getImagePaths(){return this._possibleRowTypes.map(e=>e.getImagePath())}_randomLayoutRow(e,t,i,r){this._rowType=this._rowTypesRandomizer.pickNext(this._possibleRowTypes),r.setLineSpacing(.9);const s=super._randomLayoutRow(e,t,i,r);return s.set({textScaleFactor:.9}),s}}ui.defaultFontIdentifiers=["imgly_font_campton_bold"],ui.identifier="imgly_text_design_masked_badge",ui.ValidAlignments=[ce.Alignment.Center];ui.prototype.availableOptions=R(R({},ce.prototype.availableOptions),{fontIdentifiers:{type:h.ARRAY,default:ui.defaultFontIdentifiers}});class dt extends ce{constructor(...e){super(...e);this._possibleRowTypes=[K.SpeechBubble1,K.SpeechBubble3],this._rowTypesRandomizer=new W(0),this._isMaskedRandomizer=new W(0),this._seedPool.push(this._rowTypesRandomizer),this._seedPool.push(this._isMaskedRandomizer)}getImagePaths(){return this._possibleRowTypes.map(e=>e.getImagePath())}_rowTypes(e){return this._possibleRowTypes}_randomLayoutRow(e,t,i,r){this._rowType=this._rowTypesRandomizer.pickNext(this._rowTypes(e)),r.setLineSpacing(.9);const s=super._randomLayoutRow(e,t,i,r);return s.set({textScaleFactor:1,minimumHeight:i*this._rowType.getMinimumHeightRatio(),sizeToFitContent:this._rowType.getSizeToFitContent(),centeredVertically:!0}),s}}dt.defaultFontIdentifiers=["imgly_font_roboto_black_italic","imgly_font_roboto_light_italic","imgly_font_roboto_black","imgly_font_roboto_light"],dt.identifier="imgly_text_design_masked_speech_bubble";dt.prototype.availableOptions=R(R({},ce.prototype.availableOptions),{fontIdentifiers:{type:h.ARRAY,default:dt.defaultFontIdentifiers},squareLayout:{type:h.BOOLEAN,default:!1},alignment:{type:h.STRING,default:"left",available:ce.ValidAlignments}});class _r extends dt{constructor(...e){super(...e);this._possibleRowTypes=[K.SpeechBubble2,K.SpeechBubble4,K.SpeechBubble2,K.SpeechBubble4,K.SpeechBubble5],this._possibleRowTypesForMin15=this._possibleRowTypes.slice(0,2),this._possibleRowTypesForMax14=this._possibleRowTypes.slice(2)}_rowTypes(e){return e.countNumberOfCharacters()<15?this._possibleRowTypesForMax14:this._possibleRowTypesForMin15}}_r.defaultFontIdentifiers=["imgly_font_permanent_marker"],_r.identifier="imgly_text_design_masked_speech_bubble_comic";_r.prototype.availableOptions=R(R({},dt.prototype.availableOptions),{fontIdentifiers:{type:h.ARRAY,default:_r.defaultFontIdentifiers}});class yr extends ce{_modifiedText(e){return super._modifiedText(e).toUpperCase()}_randomLayoutRow(e,t,i,r){const s=this._alignmentRandomizer.pickNext(ce.ValidAlignments);return r.setAlignment(s),new pi({words:e,width:i,attributes:r,image:null,backgroundColor:O.WHITE,centerOffset:0,sizeToFitContent:!0,isMasked:!1,autoAdjustTextColor:!1})}}yr.defaultFontIdentifiers=["imgly_font_abril_fatface_regular"],yr.identifier="imgly_text_design_multiline";yr.prototype.availableOptions=R(R({},ce.prototype.availableOptions),{fontIdentifiers:{type:h.ARRAY,default:yr.defaultFontIdentifiers}});const{Rectangle:Bg}=P;class Gn extends G{getContentFrame(){const e=this.getFrame().clone(),t=e.width*.1;return e.insetBy(t,t)}intersects(e){return this.getFrame().intersects(e.getFrame())}}Gn.prototype.availableOptions={frame:{type:h.OBJECT,default:new Bg}};const{Rectangle:Mc}=P;class wt extends fr{constructor(...e){super(...e);this._MAX_TRIES=1e3,this._PRECISION=1e3}render(e,t,i,r,s){const{imagePaths:o,relativeParticleSize:n}=this._options;if(o.length<=0)return;const a=t.width/t.height,l=new Mc(Math.round(i.left*this._PRECISION),Math.round(i.top*this._PRECISION*a),this._PRECISION,this._PRECISION);l.width-=l.x+Math.round(i.right*this._PRECISION),l.height-=l.y+Math.round(i.bottom*this._PRECISION*a);const d=[];let p=0,u=0;for(;p<this.getParticleCount()&&u<this._MAX_TRIES;){const c=n/2,m=Math.round(c*this._PRECISION),x=Math.round(c*this._PRECISION*a),_=Math.floor(this._PRECISION)-m,f=Math.floor(this._PRECISION)-x,y=s.nextInRange(m,_),b=s.nextInRange(x,f),g=new Mc(y-m,b-x,2*m,2*x);!g.intersects(l)&&!this.hasCollision(d,g)&&(d.push(new Gn({frame:g})),p+=1),u+=1}for(let c=0;c<d.length;c++){const m=d[c],x=s.pickNext(o),_=ie.getImage(x),f=s.nextInRange(140,230)/255,y=t.width/this._PRECISION,b=t.height/this._PRECISION,g=m.getContentFrame();g.x*=y,g.y*=b,g.width*=y,g.height*=b;const E=r.clone();E.a=f,Dt(e,_,g,E,"source-atop")}}hasCollision(e,t){for(let i=0;i<e.length;i++)if(t.intersects(e[i].getFrame()))return!0;return!1}}wt.prototype.availableOptions=R(R({},fr.prototype.availableOptions),{particleCount:{type:h.NUMBER,default:50},relativeParticleSize:{type:h.NUMBER,default:.08},imagePaths:{type:h.ARRAY,default:[]}});class jr extends wt{}jr.Images=["text-design/images/imgly_text_design_particle_brush_01.png","text-design/images/imgly_text_design_particle_brush_02.png","text-design/images/imgly_text_design_particle_brush_03.png","text-design/images/imgly_text_design_particle_brush_04.png","text-design/images/imgly_text_design_particle_brush_05.png","text-design/images/imgly_text_design_particle_brush_06.png","text-design/images/imgly_text_design_particle_brush_07.png","text-design/images/imgly_text_design_particle_brush_08.png","text-design/images/imgly_text_design_particle_brush_09.png","text-design/images/imgly_text_design_particle_brush_10.png"];jr.prototype.availableOptions=R(R({},wt.prototype.availableOptions),{imagePaths:{type:h.ARRAY,default:[...jr.Images]},relativeParticleSize:{type:h.NUMBER,default:.12}});class Wr extends wt{}Wr.Images=["text-design/images/imgly_text_design_particle_circle_01.png","text-design/images/imgly_text_design_particle_circle_02.png","text-design/images/imgly_text_design_particle_circle_03.png","text-design/images/imgly_text_design_particle_circle_04.png","text-design/images/imgly_text_design_particle_circle_05.png","text-design/images/imgly_text_design_particle_circle_06.png","text-design/images/imgly_text_design_particle_circle_07.png","text-design/images/imgly_text_design_particle_circle_08.png","text-design/images/imgly_text_design_particle_circle_09.png","text-design/images/imgly_text_design_particle_circle_10.png"];Wr.prototype.availableOptions=R(R({},wt.prototype.availableOptions),{imagePaths:{type:h.ARRAY,default:[...Wr.Images]},relativeParticleSize:{type:h.NUMBER,default:.12}});class Vr extends wt{}Vr.Images=["text-design/images/imgly_text_design_particle_triangle_01.png","text-design/images/imgly_text_design_particle_triangle_02.png","text-design/images/imgly_text_design_particle_triangle_03.png","text-design/images/imgly_text_design_particle_triangle_04.png","text-design/images/imgly_text_design_particle_triangle_05.png","text-design/images/imgly_text_design_particle_triangle_06.png","text-design/images/imgly_text_design_particle_triangle_07.png","text-design/images/imgly_text_design_particle_triangle_08.png","text-design/images/imgly_text_design_particle_triangle_09.png","text-design/images/imgly_text_design_particle_triangle_10.png"];Vr.prototype.availableOptions=R(R({},wt.prototype.availableOptions),{imagePaths:{type:h.ARRAY,default:[...Vr.Images]}});class ve extends Re{constructor(...e){super(...e);this._relativeInsets=new V(0,0,0,0),this._INVALID_FONTS_IF_LESS_THEN_5_CHARS=["imgly_font_montserrat_light"],this._INVALID_FONTS_IF_LESS_THEN_4_CHARS=["imgly_font_montserrat_light","imgly_font_wolesbro"],this._lineCount=0,this._decorativeRowCreated=!1,this._useImageRowRandomizer=new W(0),this._rowTypeRandomizer=new W(0),this._lineDecorativeTypeRandomizer=new W(0),this._seedPool.push(this._useImageRowRandomizer),this._seedPool.push(this._rowTypeRandomizer),this._seedPool.push(this._lineDecorativeTypeRandomizer)}getImagePaths(){return[...ve.DecoratorImages,...ve.RowImages]}_fontForRow(e,t){const i=t.countNumberOfCharacters();let r=this.getFontIdentifiers();return i<4?r=r.filter(s=>this._INVALID_FONTS_IF_LESS_THEN_4_CHARS.indexOf(s)<0):i<5&&(r=r.filter(s=>this._INVALID_FONTS_IF_LESS_THEN_5_CHARS.indexOf(s)<0)),r[e%r.length]}_modifiedText(e){return super._modifiedText(e).toUpperCase()}_modifiedLines(e){return this._lineCount=e.length,e}generateLayoutData(e,t){return this._decorativeRowCreated=!1,super.generateLayoutData(e,t)}_randomLayoutRow(e,t,i,r){const s=r.getFontIdentifier();let o=e;switch(s){case"imgly_font_wolesbro":o=new Le().set(e.getLowerCase());break;case"imgly_font_permanent_marker":o=new Le().set(e.getUpperCase());break;default:break}const n=this.getDecorativeRowsInTheMiddleOnly()&&(t===0||t===this._lineCount-1);if(this._useImageRowRandomizer.nextBool()||this._decorativeRowCreated||n)return new ye({words:o,width:i,attributes:r});this._decorativeRowCreated=!0;const[a,l]=this._randomDecoratorImages();return new gt({words:e,width:i,attributes:r,leftImage:a,rightImage:l})}_layoutRows(e,t){const i=super._layoutRows(e,t);if(!this.getDecorationsVisible())return i;const r=.0625*t,s=new Ee({width:t,height:r,image:ie.getImage(this._rowTypeRandomizer.pickNext(ve.RowImages))}).layout(),o=new Ee({width:t,height:r,image:ie.getImage(this._rowTypeRandomizer.pickNext(ve.RowImages))}).layout();return[s,...i,o]}_randomDecoratorImages(){return this._lineDecorativeTypeRandomizer.nextInRange(0,1)?ve.DecoratorImages.slice(0,2).map(e=>ie.getImage(e)):ve.DecoratorImages.slice(2).map(e=>ie.getImage(e))}}ve.defaultFontIdentifiers=["imgly_font_permanent_marker","imgly_font_wolesbro","imgly_font_wolesbro","imgly_font_montserrat_light"],ve.identifier="imgly_text_design_sunshine",ve.RowImages=[Ee.RowImages.decorative1,Ee.RowImages.decorative2,Ee.RowImages.decorative3,Ee.RowImages.decorative4],ve.DecoratorImages=["text-design/images/imgly_text_design_asset_decorative_03.png","text-design/images/imgly_text_design_asset_decorative_04.png","text-design/images/imgly_text_design_asset_decorative_07.png","text-design/images/imgly_text_design_asset_decorative_08.png"];ve.prototype.availableOptions=R(R({},Re.prototype.availableOptions),{fontIdentifiers:{type:h.ARRAY,default:ve.defaultFontIdentifiers},relativeLineSpacing:{type:h.NUMBER,default:.025/3*4},decorationsVisible:{type:h.BOOLEAN,default:!0},decorativeRowsInTheMiddleOnly:{type:h.BOOLEAN,default:!1}});class Qe extends ve{constructor(...e){super(...e);this._relativeInsets=new V(.3,.3,.3,.3),this._backgroundRandomizer=new W(0),this._decoTypeRandomizer=new W(0),this._seedPool.push(this._backgroundRandomizer),this._seedPool.push(this._decoTypeRandomizer)}getImagePaths(){return[...ve.RowImages,...S.Array.flatten(Qe.Backgrounds.map(e=>e.getImagePaths())),...Qe.DecoratorImages]}_getBackground(){return this._backgroundRandomizer.pickNext(Qe.Backgrounds)}_randomDecoratorImages(){switch(this._decoTypeRandomizer.nextInRange(0,2)){case 0:return Qe.DecoratorImages.slice(0,2).map(e=>ie.getImage(e));case 1:case 2:return Qe.DecoratorImages.slice(2).map(e=>ie.getImage(e));default:return k.warn("TextDesignParticles#_randomDecoratorImages: Number generated not in valid range."),Qe.DecoratorImages.slice(2).map(e=>ie.getImage(e))}}}Qe.defaultFontIdentifiers=["imgly_font_permanent_marker","imgly_font_wolesbro","imgly_font_wolesbro","imgly_font_montserrat_light"],Qe.identifier="imgly_text_design_particles",Qe.Backgrounds=[new jr,new Wr,new Vr],Qe.DecoratorImages=["text-design/images/imgly_text_design_particle_holder_01.png","text-design/images/imgly_text_design_particle_holder_02.png","text-design/images/imgly_text_design_particle_holder_03.png","text-design/images/imgly_text_design_particle_holder_04.png"];Qe.prototype.availableOptions=R(R({},ve.prototype.availableOptions),{fontIdentifiers:{type:h.ARRAY,default:Qe.defaultFontIdentifiers},decorationsVisible:{type:h.BOOLEAN,default:!1},decorativeRowsInTheMiddleOnly:{type:h.BOOLEAN,default:!0}});class br extends Re{constructor(...e){super(...e);this._relativeInsets=new V(.1,0,0,0),this._rowTypeRandomizer=new W(0),this._seedPool.push(this._rowTypeRandomizer)}_modifiedText(e){return super._modifiedText(e).toUpperCase()}_randomLayoutRow(e,t,i,r){const s=super._randomLayoutRow(e,t,i,r);return s.setShearingAngle(this.getShearingAngle()),s}_layoutRows(e,t){const i=super._layoutRows(e,t),r=S.values(Te.FormType),s=30,o=new Te({width:t,height:s,type:this._rowTypeRandomizer.pickNext(r),shearingAngle:this.getShearingAngle()}).layout(),n=new Te({width:t,height:s,type:this._rowTypeRandomizer.pickNext(r),shearingAngle:this.getShearingAngle()}).layout();return[o,...i,n]}}br.defaultFontIdentifiers=["imgly_font_campton_bold"],br.identifier="imgly_text_design_rotated";br.prototype.availableOptions=R(R({},Re.prototype.availableOptions),{fontIdentifiers:{type:h.ARRAY,default:br.defaultFontIdentifiers},relativeLineSpacing:{type:h.NUMBER,default:.025/3},shearingAngle:{type:h.NUMBER,default:-.1}});class Un extends ve{constructor(...e){super(...e);this._relativeInsets=new V(0,.3,0,.3)}_layoutRows(e,t){const i=super._layoutRows(e,t);if(!this.getDecorationsVisible())return i;const r=25,s=new Ee({width:t,height:r,image:ie.getImage(this._rowTypeRandomizer.pickNext(ve.RowImages))}).layout(),o=new Ee({width:t,height:r,image:ie.getImage(this._rowTypeRandomizer.pickNext(ve.RowImages))}).layout();return[s,...i,o]}}Un.identifier="imgly_text_design_sunshine-v3_1_0";class xr extends dt{constructor(...e){super(...e);this._possibleRowTypes=[K.Watercolor1,K.Watercolor2,K.Watercolor3]}}xr.defaultFontIdentifiers=["imgly_font_permanent_marker","imgly_font_wolesbro","imgly_font_wolesbro"],xr.identifier="imgly_text_design_watercolor";xr.prototype.availableOptions=R(R({},dt.prototype.availableOptions),{fontIdentifiers:{type:h.ARRAY,default:xr.defaultFontIdentifiers},alignment:{type:h.STRING,default:ce.Alignment.Center,available:ce.ValidAlignments}});const{Rectangle:Mg}=P,lo=1e3;class Lc{constructor(){this._layoutData=null,this._layout=null,this._text="",this._seed=0,this._debugMode=!1,this.randomizer=new W}createLayout(e,t,i){this._layout=e,this._text=t,this._seed=i,e.seed(i),this._layoutData=e.generateLayoutData(t,lo)}calculateAspect(){return this._layoutData?this._layoutData.getSize().aspect():(k.warn("TextDesignRenderer#calculateAspect: No layout data"),1)}draw(e,t,i,r){const s=this._layoutData;if(this._layoutData){const o=new _e(lo,lo/t.aspect()),n=t.width/lo,a=s.getRelativeInsets().clone().scale(o.width),l=s.getRelativeLineSpacing()*o.width;let d=a.top;e.save(),this.randomizer.seed(this._seed);const p=s.getBackground();p&&p.render(e,t,s.getRelativeInsets(),r?O.WHITE:i,this.randomizer),e.scale(n,n),s.getRows().forEach(u=>{e.save();const c=u.getAttributes();if(e.transform(1,u.getShearingAngle(),0,1,a.left,d),c.setTextColor(r?O.WHITE:i.clone()),c.setTintColor(r?O.WHITE:i.clone()),(u instanceof Xt||u instanceof pi)&&(u.setBackgroundColor(r?O.WHITE:i.clone()),u.setIsUsedInInvertedLayout(r)),this._debugMode&&(u._debugMode=!0),u.willRender(e),u.render(e),u.didRender(e),this._debugMode){const m=u._getFrame(),x=u._getTextFrame();cr(e,m,O.GREEN),cr(e,x,O.BLUE),u._getLayoutElements().forEach(_=>{const f=_.getFrame(),y=u._getTextFrameForElement(_);cr(e,f,new O(1,1,0)),cr(e,y,new O(0,1,1))})}d+=u.getSize().height+l,e.restore()}),this._debugMode&&cr(e,new Mg(0,0,o.width,o.height),O.RED),e.restore()}}}const{Vector2:Qt}=P;class Hr extends vt{constructor(e,t){super(e,t);this._isDisposed=!1,this._renderer=new Lc,this._canvas=S.createCanvas(),this._context=this._canvas.getContext("2d"),this._texture=T.Texture.fromCanvas(this._canvas),this._sprite.setTexture(this._texture),this._aspect=1,this._isLayoutDirty=!0,this.getSeed()<0&&this.setSeed(W.TimeSeed())}seed(e){this.setSeed(e||W.TimeSeed()),this._isLayoutDirty=!0}_updateLayout(){const e=this.getLayout();return e?(this._renderer.createLayout(e,this.getText(),this.getSeed()),this._aspect=this._renderer.calculateAspect(),this._isLayoutDirty=!1,!0):null}applyTransform(e){super.applyTransform(e);const t={};this._options.dimensions&&(t.width=e.applyToRelativeSize(this.getWidth())),this.set(t,!1)}applyFlip(e){super.applyFlip(e);let{rotation:t}=this._options;switch(e){case"horizontal":t+=(Math.PI-t)*2,this.setRotation(t);break;case"vertical":t+=(Math.PI/2-t)*2,this.setRotation(t);break}}update(e,t){const i=this._isLayoutDirty;if(this._isDisposed||i&&!this._updateLayout())return;const r=this.getWidth()*t.min()/e.getTextureScale(),s=r/this._aspect,o=new Qt(r,s),n=new Qt(Math.round(r*2),Math.round(s*2)).clamp(new Qt(1,1),new Qt(Infinity,Infinity)),a=e.getRenderer(),l=a.getMaxDimensions()||Infinity;n.x>l&&(n.x=l,n.y=Math.round(n.x/this._aspect)),n.y>l&&(n.y=l,n.x=Math.round(n.y*this._aspect));const d=S.ensureCanvasDimensions(this._canvas,n);(i||d)&&(this._context.clearRect(0,0,this._canvas.width,this._canvas.height),this._renderer.draw(this._context,new _e(n.x,n.y),this.getColor(),this.getInverted()),this.setDimensions(o),this._texture.getBaseTexture().update(),a.isOfType(q.WEBGL)&&a.updateTexture(this._texture.getBaseTexture())),super.update(e,t),this._applyFlip()}_applyFlip(){const e=this._sprite.getScale(),{flipHorizontally:t,flipVertically:i}=this._options;(t&&e.x>0||!t&&e.x<0)&&(e.x*=-1),(i&&e.y>0||!i&&e.y<0)&&(e.y*=-1),this._sprite.setScale(e)}_optionEquals(e,t){if(e==="layout"){const{layout:i}=this._options;return!i&&t||!t&&i||(!t.constructor||!i.constructor)?!1:!(i.constructor.identifier!==t.constructor.identifier)}return super._optionEquals(e,t)}serializeOptions(e,t=!1){if(e&&this.getPadding()<0){const r=e.indexOf("padding");r>-1&&e.splice(r,1)}const i=super.serializeOptions(e,t);return e||(i.type="textdesign"),i}_getTexture(){return this._texture}canBeFlippedHorizontally(){return!1}canBeDuplicated(){return!0}canMaskCanvas(){return!0}canAdjustPadding(){return!0}dispose(){this._isDisposed=!0,this._texture.dispose(),this._sprite.dispose()}}Hr.Layouts={TextDesignBlocks:ke,TextDesignBlocksCondensed:pr,TextDesignBlocksLight:Pt,TextDesignCelebrate:Ne,TextDesignCelebrateSimple:mr,TextDesignEqualWidth:At,TextDesignEqualWidthFat:gr,TextDesignMasked:ce,TextDesignMaskedBadge:ui,TextDesignMaskedSpeechBubble:dt,TextDesignMaskedSpeechBubbleComic:_r,TextDesignMultiline:yr,TextDesignWatercolor:xr,TextDesignSunshine:ve,TextDesignParticles:Qe,TextDesignRotated:br};Hr.LegacyLayouts={TextDesignBlocksLightV310:ur,TextDesignSunshineV310:Un};Hr.AssetManager=ie;Hr.prototype.availableOptions={id:{type:h.STRING,default:()=>S.getUUID()},position:{type:h.VECTOR2,default:new Qt(.5,.5)},dimensions:{type:h.VECTOR2,default:Qt.NULL},anchor:{type:h.VECTOR2,default:new Qt(0,0)},pivot:{type:h.VECTOR2,default:new Qt(.5,.5)},rotation:{type:h.NUMBER,default:0},flipHorizontally:{type:h.BOOLEAN,default:!1},flipVertically:{type:h.BOOLEAN,default:!1},layout:{type:h.OBJECT,default:null,setter(e){return this._isLayoutDirty=!0,e}},text:{type:h.STRING,default:"",setter(e){return this._isLayoutDirty=!0,e}},color:{type:h.COLOR,default:O.BLACK,setter(e){return this._isLayoutDirty=!0,e}},padding:{type:h.NUMBER,default:.01,minValue:.01},width:{type:h.NUMBER,default:.8},inverted:{type:h.BOOLEAN,default:!1,setter(e){return this._isLayoutDirty=!0,e}},seed:{type:h.NUMBER,default:-1}};var ho=Hr;const{Vector2:Kn}=P;class jn extends vt{constructor(...e){super(...e);this._textRenderer=new Ic(this,this._operation),this._textRenderer.rotation=this.getRotation(),this._sprite.setTexture(this._textRenderer.getFinalTexture()),this._hitTestSprite.setTexture(this._textRenderer.getTexture())}serializeOptions(e,t=!1){const i=super.serializeOptions(e,t);return e||(i.type="text"),i}getDOMStyle(e,t){const i=this.getFontSize()*t.y;return{fontWeight:this._options.fontWeight,fontSize:`${i}px`,fontStyle:this._options.fontStyle,fontFamily:this._options.fontFamily,lineHeight:`${this.getAbsoluteTextHeight(t)*this.getLineHeight()}px`,color:this._options.color.toRGBA(),backgroundColor:this._options.backgroundColor.toRGBA(),textAlign:this._options.alignment}}getAbsoluteTextHeight(e){const t=this.getFontSize()*e.y,i=this.getTextMetrics();if(i){const r=1/i.unitsPerEm*t,s=i.ascender*r,o=i.descender*r;return s+Math.abs(o)}return t*this.getLineHeight()*1.1}getDimensions(e,t){return this._textRenderer.getDimensions(e,t)}applyFlip(e){super.applyFlip(e);let{rotation:t}=this._options;switch(e){case"horizontal":t+=(Math.PI-t)*2,this.setRotation(t);break;case"vertical":t+=(Math.PI/2-t)*2,this.setRotation(t);break}}applyTransform(e){super.applyTransform(e),this.set({fontSize:e.scaleSize(this.getFontSize(),"y"),maxWidth:e.scaleSize(this.getMaxWidth(),"x")},!1)}applyRotation(e){super.applyRotation(e);const t=(e+360)%360,i=this._operation.getInputDimensions();(t===90||t===270)&&(this.setMaxWidth(this.getMaxWidth()/i.x*i.y),this.setFontSize(this.getFontSize()/i.y*i.x))}setOption(e,t){const{flipHorizontally:i,flipVertically:r}=this._options;if(e==="rotation"){let s=t;i&&(s=Math.PI*2-s),r&&(s=Math.PI*2-s),this._options.rotation=s,this._textRenderer&&(this._textRenderer.rotation=s),this._rotation=s,this.emit("update");return}super.setOption(e,t)}getOption(e){return e==="rotation"?this._rotation:super.getOption(e)}getHitTestDisplayObject(){return this._hitTestSprite}update(e,t){if(this._sprite.setVisible(this._options.visible),!this._options.visible)return;this._textRenderer.update(e,t);const i=this._textRenderer.getFinalTexture(),r=i.getBaseTexture();r.update();const s=e.getRenderer();s.isOfType(q.WEBGL)&&s.updateTexture(i.getBaseTexture()),super.update(e,t),this._sprite.setRotation(0),this._textRenderer.getTexture().getBaseTexture().update(),this._hitTestSprite.setRotation(this._rotation),this._hitTestSprite.updateTransform(),this._applyFlip()}_applyFlip(){const e=this._sprite.getScale(),{flipHorizontally:t,flipVertically:i}=this._options;(t&&e.x>0||!t&&e.x<0)&&(e.x*=-1,this.setRotation(this._rotation)),(i&&e.y>0||!i&&e.y<0)&&(e.y*=-1,this.setRotation(this._rotation)),this._sprite.setScale(e)}_getTexture(){return this._textRenderer.getFinalTexture()}dispose(){super.dispose(),this._textRenderer.dispose(),this._hitTestSprite.dispose(),this._sprite.dispose()}canBeFlippedHorizontally(){return!1}canAdjustPadding(){return!1}}jn.prototype.availableOptions={id:{type:h.STRING,default:()=>S.getUUID()},fontSize:{type:h.NUMBER,default:.1},characterSpacing:{type:h.NUMBER,default:0},lineHeight:{type:h.NUMBER,default:1.1},fontIdentifier:{type:h.STRING},fontFamily:{type:h.STRING,default:"Times New Roman"},fontWeight:{type:h.ALL,default:"normal"},fontStyle:{type:h.STRING,default:"normal"},textMetrics:{type:h.OBJECT,default:null},outlineWidth:{type:h.NUMBER,default:0},outlineColor:{type:h.COLOR,default:O.BLACK},alignment:{type:h.STRING,default:"left",available:["left","center","right"]},verticalAlignment:{type:h.STRING,default:"top",available:["top","center","bottom"]},color:{type:h.COLOR,default:new O(1,0,0,1)},backgroundColor:{type:h.COLOR,default:O.TRANSPARENT},position:{type:h.VECTOR2,default:new Kn(.5,.5)},anchor:{type:h.VECTOR2,default:new Kn(0,0)},pivot:{type:h.VECTOR2,default:new Kn(.5,.5)},rotation:{type:h.NUMBER,default:0},text:{type:h.STRING,required:!0},maxWidth:{type:h.NUMBER,default:.5},maxHeight:{type:h.NUMBER,default:0},visible:{type:h.BOOLEAN,default:!0},flipHorizontally:{type:h.BOOLEAN,default:!1},flipVertically:{type:h.BOOLEAN,default:!1}};jn.type="text";var co=jn;const{Vector2:Wn}=P;class Zt extends J{constructor(...e){super(...e);this.setSmoothDownscaling(this._sdk.getOptions().smoothDownscaling),this._onSpriteUpdate=this._onSpriteUpdate.bind(this),this._maskCanvas=S.createCanvas();const t=this._options.sprites.slice();t.forEach(i=>{this.removeSprite(i),this.addSprite(i)})}getSpritesOfType(e){return this._options.sprites.filter(t=>t instanceof e)}rotate(e){this._options.sprites.forEach(t=>{t.applyRotation(e)})}flip(e){this._options.sprites.forEach(t=>{t.applyFlip(e)})}_onSpriteUpdate(e,t){this.emit("update",this),this.setDirty(!0)}_applyRotation(e,t){this._options.sprites.forEach(i=>i.applyRotation(e,t))}transform(e){this._options.sprites.forEach(t=>t.applyTransform(e))}scale(e){this._options.sprites.forEach(t=>t.applyScale(e))}serializeOption(e,t=!1){return e==="sprites"?this._options.sprites.map(i=>i.serializeOptions(void 0,t)):super.serializeOption(e,t)}createSticker(e){return new ro(this,e)}createText(e){return new co(this,e)}createBrush(e){return new di(this,e)}createTextDesign(e){return new ho(this,e)}addSprite(e){this._options.sprites.push(e);const t=this.getSmoothDownscaling();e.setSmoothDownscaling&&e.setSmoothDownscaling(t),this._container.addChild(e.getDisplayObject()),this.setDirty(!0),e.on("update",this._onSpriteUpdate),this.emit("update",this,this._options.sprites)}removeSprite(e){const{sprites:t}=this._options,i=t.indexOf(e);return i!==-1?(e.off("update",this._onSpriteUpdate),this._container.removeChild(e.getDisplayObject()),t.splice(i,1),this.setDirty(!0),!0):!1}_getOrientatedStageSize(){const e=this._sdk.getSprite().getTexture().getFrame(),t=this._sdk.getOperationsStack().getByIdentifier("orientation");if(t){const r=t?t.getRotation():0,s=r===270||r===90;return s?new Wn(e.height,e.width):new Wn(e.width,e.height)}const i=this._sdk.getOperationsStack().getByIdentifier("output");return i?i.getOutputResolution():new Wn(e.width,e.height)}_render(e){const t=this._container,{sprites:i}=this._options,r=e.getDimensions().clone().floor();let s=new T.Container;return s.addChild(this._sprite),N.all(i.map(o=>o.validateSettings())).then(()=>{i.forEach(o=>o.update(this._sdk,r))}).then(()=>{this._renderTexture.clear(),i.forEach(o=>{o.getInverted&&o.getInverted()?(this._renderTexture.render(s),this._renderTexture.render(this._renderMaskedSprite(o.getDisplayObject(),o.getColor?o.getColor():O.WHITE,o.getPadding?o.getPadding():-1)),s=new T.Container):s.addChild(o.getDisplayObject())}),this._renderTexture.render(s),t.addChild(this._sprite),i.forEach(o=>t.addChild(o.getDisplayObject()))})}_renderMaskedSprite(e,t,i){const r=this._maskCanvas,s=e.getWorldTransform(),o=this._getOrientatedStageSize();S.ensureCanvasDimensions(r,o);const n=r.getContext("2d");if(n.clearRect(0,0,r.width,r.height),n.save(),n.fillStyle=t.toRGBA(),i<0)n.fillRect(0,0,o.x,o.y);else{const d=Math.abs(e.getWidth()/e.getScale().x),p=Math.abs(e.getHeight()/e.getScale().y),u=d*i;n.transform(s.a,s.b,s.c,s.d,s.tx,s.ty),n.fillRect(-u,-u,d+u*2,p+u*2)}n.restore(),n.save(),n.globalCompositeOperation="destination-out",e._renderCanvas({getCurrentRenderTarget:()=>({getPixelRatio:()=>1}),beforeDraw:d=>{const p=e.getWidth(),u=e.getHeight(),c=e.getScale(),m=c.x<0,x=c.y<0;d.translate(p,u),d.scale(m?-1:1,x?-1:1),d.translate(-p,-u)},getContext:()=>n}),n.restore();const a=new T.Container,l=new T.Sprite(T.Texture.fromCanvas(r));return a.addChild(l),a}takeSpriteToFront(e){const{sprites:t}=this._options,i=t.indexOf(e);if(i===-1)return;S.moveArrayItem(t,i,t.length-1);const r=e.getDisplayObject();this._container.removeChild(r),this._container.addChild(r),this.setDirty(!0)}getSpritesAtPosition(e,t){const i=[];this._options.sprites.forEach(d=>d.update(this._sdk,t));const r=this._sdk.getSprite(),s=r.getWorldTransform().applyInverseToVector(e),{width:o,height:n}=r.getTexture().getFrame(),a=r.getAnchor().clone().multiply(-o,-n);s.subtract(a);const l=this._options.sprites.slice(0).reverse();for(let d=0,p=l.length;d<p;d++){const u=l[d];u.getHitTestDisplayObject().isAtPosition(s)&&i.push(u)}return i}setDirtyForRenderer(e,t,i){super.setDirtyForRenderer(e,t,i),this._options.sprites.forEach(r=>{r.setDirtyForRenderer(e,t,i)})}dispose(){super.dispose(),this._options.sprites.forEach(e=>{e.dispose()})}}Zt.StickerSprite=ro;Zt.TextSprite=co;Zt.BrushSprite=di;Zt.TextDesignSprite=ho;Zt.identifier="sprite";Zt.prototype.availableOptions={sprites:{type:h.ARRAY,default:[],setter(e,t){if(e=e.map((i,r)=>{if(i instanceof vt)return i;const s=R({},i);delete s.type;switch(i.type){case"text":return new co(this,s);case"sticker":return new ro(this,s);case"brush":return new di(this,s);case"textdesign":return new ho(this,s);default:return k.error(this.constructor.name,`Invalid sprite type: ${i.type}`),null}}),!t){if(this._options.sprites){const i=this._options.sprites.slice();i.forEach(r=>{r.dispose(),this.removeSprite(r)})}e.forEach(i=>{this.addSprite(i)})}return e}},smoothDownscaling:{type:h.BOOLEAN,default:!1}};F.Operations.SpriteOperation=Zt;var Nc=Zt;const{Vector2:zc}=P;class Lg{constructor(e,t){this._options=t,this._oldOptions={start:e.getStart().clone(),end:e.getEnd().clone(),rotation:e.getRotation(),textureScale:e.getTextureScale()},this._inputDimensions=e.getInputDimensions(!1),this._rotationDelta=t.rotation-e.getRotation(),this._deltaCos=Math.cos(this._rotationDelta),this._deltaSin=Math.sin(this._rotationDelta),this._oldAbsoluteSize=this._oldOptions.end.clone().subtract(this._oldOptions.start).multiply(this._inputDimensions),this._newAbsoluteSize=t.end.clone().subtract(t.start).multiply(this._inputDimensions),this._absoluteStartDiff=this._oldOptions.start.clone().subtract(t.start).multiply(this._inputDimensions),this._scaleRatio=e.calculateScale(t.rotation)/e.calculateScale(),this._sizeFactor=this._newAbsoluteSize.clone().divide(this._oldAbsoluteSize),this._textureScaleFactor=this._options.textureScale/e.getTextureScale()}applyToRelativePoint(e){const t=this._oldOptions.start,i=this._oldOptions.end,r=t.clone().add(i.clone().subtract(t).divide(2)),s=r.multiply(this._inputDimensions),o=e.clone().multiply(this._oldAbsoluteSize).subtract(this._oldAbsoluteSize.clone().divide(2)),n=s.clone().add(o),a=n.clone().subtract(this._inputDimensions.clone().divide(2)),l=new zc(a.x*this._deltaCos-a.y*this._deltaSin,a.x*this._deltaSin+a.y*this._deltaCos),d=this._inputDimensions.clone().divide(2).add(l),p=this._options.start.clone().multiply(this._inputDimensions);return d.clone().subtract(p).divide(this._newAbsoluteSize)}applyToRelativeSize(e){return e*this._oldAbsoluteSize.min()/this._newAbsoluteSize.min()}applyToDimensions(e){return e=e.clone().multiply(this._scaleRatio),this._options.textureScale&&e.multiply(this._textureScaleFactor),e}scaleSize(e,t="y"){return e/this._sizeFactor[t]}applyToRotation(e){return(e+this._rotationDelta)%(Math.PI*2)}invert(){const e=this._options.start.clone(),t=this._options.end.clone(),i=this._inputDimensions,r=-this._rotationDelta,s=Math.cos(r),o=Math.sin(r),n=this._oldAbsoluteSize,a=this._newAbsoluteSize,l=e.clone().subtract(t).multiply(i),d=1/this._scaleRatio,p=new zc(1/this._sizeFactor.x,1/this._sizeFactor.y),u=1/this._textureScaleFactor,c=this._oldOptions;return this._oldOptions=this._options,this._options=c,this._inputDimensions=i,this._rotationDelta=r,this._deltaCos=s,this._deltaSin=o,this._oldAbsoluteSize=a,this._newAbsoluteSize=n,this._absoluteStartDiff=l,this._scaleRatio=d,this._sizeFactor=p,this._textureScaleFactor=u,this}}var Gc=Lg;const{Vector2:Vn}=P;class qr extends J{_render(e){this._sprite.setRotation(0);const t=e.getDimensions(),{start:i,end:r,rotation:s,textureScale:o}=this._options,n=r.clone().subtract(i),a=n.clone().divide(2),l=i.clone().add(a),d=this.calculateScale(),p=d*o,u=t.clone().multiply(p).multiply(a);return this._sprite.setAnchor(l),this._sprite.setRotation(s),this._sprite.setScale(p,p),this._sprite.setPosition(u),this._renderTexture.render(this._container),N.resolve()}calculateScale(e=this._options.rotation){const t=this.getInputDimensions(!1),i=new Vn(Math.abs(t.x*Math.cos(e))+Math.abs(t.y*Math.sin(e)),Math.abs(t.x*Math.sin(e))+Math.abs(t.y*Math.cos(e))),r=t.clone().subtract(i.clone()).divide(2).abs();let s=1;return r.y>r.x?s=r.y*2/t.y+1:s=r.x*2/t.x+1,s}getNewDimensions(e){const{start:t,end:i,textureScale:r}=this._options,s=this.calculateScale(),o=e.clone().multiply(r*s).multiply(i.clone().subtract(t));return o.round()}flip(e){const{start:t,end:i}=this._options,r=t.clone();e==="horizontal"?(t.set(1-i.x,t.y),i.set(1-r.x,i.y)):e==="vertical"&&(t.set(t.x,1-i.y),i.set(i.x,1-r.y))}rotate(e){const{start:t,end:i}=this._options,r=(e+360)%360,s=Math.floor(r/90);for(let o=0;o<s;o++){const n=t.clone();t.set(1-i.y,n.x),i.set(1-n.y,i.x)}}_onBeforeExport(){this._wasEnabledBeforeExport=this.getEnabled(),this.setEnabled(!0)}_onAfterExport(){this.setEnabled(this._wasEnabledBeforeExport,!0)}}qr.identifier="transform";qr.prototype.availableOptions={start:{type:h.VECTOR2,default:new Vn(0,0)},end:{type:h.VECTOR2,default:new Vn(1,1)},textureScale:{type:h.NUMBER,default:1},rotation:{type:h.NUMBER,default:0}};qr.TransformChange=Gc;F.Operations.TransformOperation=qr;var Uc=qr;const{Vector2:Ng}=P;class po extends J{constructor(...e){super(...e);this._watermarkSprite=new T.Sprite,this._watermarkSprite.setAnchor(.5,.5),this._container.addChild(this._watermarkSprite)}_render(e){this._watermarkTexture||(this._watermarkTexture=T.Texture.fromImage(this._options.image),this._watermarkSprite.setTexture(this._watermarkTexture));const t=e.getDimensions(),{width:i,height:r}=this._options.image,s=S.resizeVectorToFit(new Ng(i,r),t);return this._watermarkSprite.setPosition(t.clone().divide(2)),this._watermarkSprite.setWidth(s.x),this._watermarkSprite.setHeight(s.y),this._renderTexture.render(this._container),N.resolve()}dispose(){super.dispose(),this._watermarkSprite.dispose()}}po.identifier="watermark";po.prototype.availableOptions={image:{type:h.OBJECT,required:!0}};F.Operations.WatermarkOperation=po;var Kc=po;const zg=[ah,ch,tc,rc,lc,cc,mc,fc,yc,vc,Cc,Nc,Uc,Kc,gc,ic];F.AllOperations=zg;var jc=[{fontFamily:"Open Sans",variations:[{identifier:"imgly_font_open_sans_bold",fontWeight:"bold",provider:"file",filePath:"fonts/imgly_font_open_sans_bold.woff",default:!0,textMetrics:{unitsPerEm:2048,ascender:2189,descender:-600}}]},{fontFamily:"Aleo",variations:[{identifier:"imgly_font_aleo_bold",fontWeight:"bold",provider:"file",filePath:"fonts/imgly_font_aleo_bold.woff",textMetrics:{unitsPerEm:1e3,ascender:805,descender:-195}}]},{fontFamily:"Amatic SC",variations:[{identifier:"imgly_font_amaticsc",fontWeight:"normal",provider:"file",filePath:"fonts/imgly_font_amaticsc.woff",textMetrics:{unitsPerEm:1e3,ascender:1016,descender:-245}}]},{fontFamily:"Archivo",variations:[{identifier:"imgly_font_archivo_black",fontWeight:"normal",filePath:"fonts/imgly_font_archivo_black.woff",provider:"file",textMetrics:{unitsPerEm:1e3,ascender:878,descender:-210}}]},{fontFamily:"Bungee Inline",variations:[{identifier:"imgly_font_bungee_inline",fontWeight:"normal",fontStyle:"normal",filePath:"fonts/imgly_font_bungee_inline.woff",provider:"file",textMetrics:{unitsPerEm:1e3,ascender:860,descender:-140}}]},{fontFamily:"Campton Book",variations:[{identifier:"imgly_font_campton_bold",fontWeight:"bold",fontStyle:"normal",filePath:"fonts/imgly_font_campton_bold.woff",provider:"file",textMetrics:{unitsPerEm:1e3,ascender:770,descender:-294}}]},{fontFamily:"Carter",variations:[{identifier:"imgly_font_carter_one",fontWeight:"normal",fontStyle:"normal",filePath:"fonts/imgly_font_carter_one.woff",provider:"file",textMetrics:{unitsPerEm:2048,ascender:2264,descender:-890}}]},{fontFamily:"Codystar",variations:[{identifier:"imgly_font_codystar",fontWeight:"normal",fontStyle:"normal",filePath:"fonts/imgly_font_codystar.woff",provider:"file",textMetrics:{unitsPerEm:1024,ascender:953,descender:-255}}]},{fontFamily:"Fira Sans",variations:[{identifier:"imgly_font_fira_sans_regular",fontWeight:"normal",fontStyle:"normal",filePath:"fonts/imgly_font_fira_sans_regular.woff",provider:"file",textMetrics:{unitsPerEm:1e3,ascender:935,descender:-265}}]},{fontFamily:"Galano Grotesque",variations:[{identifier:"imgly_font_galano_grotesque_bold",fontWeight:"bold",fontStyle:"normal",filePath:"fonts/imgly_font_galano_grotesque_bold.woff",provider:"file",textMetrics:{unitsPerEm:1e3,ascender:800,descender:-200}}]},{fontFamily:"Krona One",variations:[{identifier:"imgly_font_krona_one",fontWeight:"normal",fontStyle:"normal",filePath:"fonts/imgly_font_krona_one.woff",provider:"file",textMetrics:{unitsPerEm:2048,ascender:2030,descender:-530}}]},{fontFamily:"Kumar One Outline",variations:[{identifier:"imgly_font_kumar_one_outline",fontWeight:"normal",fontStyle:"normal",filePath:"fonts/imgly_font_kumar_one_outline.woff",provider:"file",textMetrics:{unitsPerEm:1e3,ascender:1137,descender:-642}}]},{fontFamily:"Lobster",variations:[{identifier:"imgly_font_lobster",fontWeight:"normal",provider:"file",filePath:"fonts/imgly_font_lobster.woff",textMetrics:{unitsPerEm:1e3,ascender:1e3,descender:-250}}]},{fontFamily:"Molle",variations:[{identifier:"imgly_font_molle",fontWeight:"normal",fontStyle:"normal",filePath:"fonts/imgly_font_molle.woff",provider:"file",textMetrics:{unitsPerEm:2048,ascender:1852,descender:-701}}]},{fontFamily:"Monoton",variations:[{identifier:"imgly_font_monoton",fontWeight:"normal",fontStyle:"normal",filePath:"fonts/imgly_font_monoton.woff",provider:"file",textMetrics:{unitsPerEm:2048,ascender:2366,descender:-822}}]},{fontFamily:"Nixie One",variations:[{identifier:"imgly_font_nixie_one",fontWeight:"normal",fontStyle:"normal",filePath:"fonts/imgly_font_nixie_one.woff",provider:"file",textMetrics:{unitsPerEm:1e3,ascender:926,descender:-210}}]},{fontFamily:"Notable",variations:[{identifier:"imgly_font_notable",fontWeight:"normal",fontStyle:"normal",filePath:"fonts/imgly_font_notable.woff",provider:"file",textMetrics:{unitsPerEm:1e3,ascender:1143,descender:-157}}]},{fontFamily:"Ostrich",variations:[{identifier:"imgly_font_ostrich_sans_black",fontWeight:800,provider:"file",filePath:"fonts/imgly_font_ostrich_sans_black.woff",textMetrics:{unitsPerEm:1e3,ascender:950,descender:-250}},{identifier:"imgly_font_ostrich_sans_bold",fontWeight:"bold",provider:"file",filePath:"fonts/imgly_font_ostrich_sans_bold.woff",textMetrics:{unitsPerEm:1e3,ascender:950,descender:-250}}]},{fontFamily:"Oswald SemiBold",variations:[{identifier:"imgly_font_oswald_semi_bold",fontWeight:600,fontStyle:"normal",filePath:"fonts/imgly_font_oswald_semi_bold.woff",provider:"file",textMetrics:{unitsPerEm:1e3,ascender:1193,descender:-289}}]},{fontFamily:"Palanquin Dark SemiBold",variations:[{identifier:"imgly_font_palanquin_dark_semi_bold",fontWeight:"bold",fontStyle:"normal",filePath:"fonts/imgly_font_palanquin_dark_semi_bold.woff",provider:"file",textMetrics:{unitsPerEm:1e3,ascender:1320,descender:-491}}]},{fontFamily:"Poppins",variations:[{identifier:"imgly_font_poppins",fontWeight:"bold",fontStyle:"normal",filePath:"fonts/imgly_font_poppins.woff",provider:"file",textMetrics:{unitsPerEm:1e3,ascender:1050,descender:-350}}]},{fontFamily:"Permanent Marker",variations:[{identifier:"imgly_font_permanent_marker",fontWeight:"normal",fontStyle:"normal",filePath:"fonts/imgly_font_permanent_marker.woff",provider:"file",textMetrics:{unitsPerEm:1024,ascender:1136,descender:-325}}]},{fontFamily:"Roboto Black",variations:[{identifier:"imgly_font_roboto_black_italic",fontWeight:"normal",fontStyle:"italic",filePath:"fonts/imgly_font_roboto_black_italic.woff",provider:"file",textMetrics:{unitsPerEm:2048,ascender:1900,descender:-500}}]},{fontFamily:"Roboto Light",variations:[{identifier:"imgly_font_roboto_light_italic",fontWeight:"normal",fontStyle:"italic",filePath:"fonts/imgly_font_roboto_light_italic.woff",provider:"file",textMetrics:{unitsPerEm:2048,ascender:1900,descender:-500}}]},{fontFamily:"Sancreek",variations:[{identifier:"imgly_font_sancreek",fontWeight:"normal",fontStyle:"normal",filePath:"fonts/imgly_font_sancreek.woff",provider:"file",textMetrics:{unitsPerEm:2048,ascender:2104,descender:-738}}]},{fontFamily:"Stint Ultra Expanded",variations:[{identifier:"imgly_font_stint_ultra_expanded",fontWeight:"normal",fontStyle:"normal",filePath:"fonts/imgly_font_stint_ultra_expanded.woff",provider:"file",textMetrics:{unitsPerEm:2048,ascender:1853,descender:-483}}]},{fontFamily:"Trashhand",variations:[{identifier:"imgly_font_trash_hand",fontWeight:"normal",provider:"file",filePath:"fonts/imgly_font_trash_hand.woff",textMetrics:{unitsPerEm:1e3,ascender:759,descender:-304}}]},{fontFamily:"VT323",variations:[{identifier:"imgly_font_vt323",fontWeight:"normal",fontStyle:"normal",filePath:"fonts/imgly_font_vt323.woff",provider:"file",textMetrics:{unitsPerEm:1e3,ascender:800,descender:-200}}]},{fontFamily:"Yeseva One",variations:[{identifier:"imgly_font_yeseva_one",fontWeight:"normal",fontStyle:"normal",filePath:"fonts/imgly_font_yeseva_one.woff",provider:"file",textMetrics:{unitsPerEm:1e3,ascender:915,descender:-240}}]}];var Wc=[{fontFamily:"Open Sans",variations:[{identifier:"imgly_font_open_sans_bold",fontWeight:"bold",provider:"file",filePath:"fonts/imgly_font_open_sans_bold.woff",default:!0,textMetrics:{unitsPerEm:2048,ascender:2189,descender:-600}}]},{fontFamily:"Abril Fatface",variations:[{identifier:"imgly_font_abril_fatface_regular",fontWeight:"normal",fontStyle:"normal",provider:"file",filePath:"fonts/imgly_font_abril_fatface_regular.woff",textMetrics:{unitsPerEm:1e3,ascender:1058,descender:-291}}]},{fontFamily:"Amberlight",variations:[{identifier:"imgly_font_amberlight",fontWeight:"normal",fontStyle:"normal",provider:"file",filePath:"fonts/imgly_font_amberlight.woff",default:!0,textMetrics:{unitsPerEm:1e3,ascender:750,descender:-250}}]},{fontFamily:"Bungee Inline",variations:[{identifier:"imgly_font_bungee_inline",fontWeight:"normal",fontStyle:"normal",provider:"file",filePath:"fonts/imgly_font_bungee_inline.woff",default:!0,textMetrics:{unitsPerEm:1e3,ascender:860,descender:-140}}]},{fontFamily:"Campton Book",variations:[{identifier:"imgly_font_campton_bold",fontWeight:"bold",provider:"file",filePath:"fonts/imgly_font_campton_bold.woff",default:!0,textMetrics:{unitsPerEm:1e3,ascender:770,descender:-294}}]},{fontFamily:"Galano Grotesque",variations:[{identifier:"imgly_font_galano_grotesque_bold",fontWeight:"bold",fontStyle:"normal",provider:"file",filePath:"fonts/imgly_font_galano_grotesque_bold.woff",default:!0,textMetrics:{unitsPerEm:1e3,ascender:800,descender:-200}}]},{fontFamily:"Handycheera",variations:[{identifier:"imgly_font_handycheera_regular",fontWeight:"normal",fontStyle:"normal",provider:"file",filePath:"fonts/imgly_font_handycheera_regular.woff",default:!0,textMetrics:{unitsPerEm:2048,ascender:2199,descender:-808}}]},{fontFamily:"Montserrat Light",variations:[{identifier:"imgly_font_montserrat_light",fontWeight:"normal",fontStyle:"normal",provider:"file",filePath:"fonts/imgly_font_montserrat_light.woff",textMetrics:{unitsPerEm:1e3,ascender:968,descender:-251}}]},{fontFamily:"Ostrich",variations:[{identifier:"imgly_font_ostrich_sans_black",fontWeight:800,provider:"file",filePath:"fonts/imgly_font_ostrich_sans_black.woff",textMetrics:{unitsPerEm:1e3,ascender:950,descender:-250}},{identifier:"imgly_font_ostrich_sans_bold",fontWeight:"bold",provider:"file",filePath:"fonts/imgly_font_ostrich_sans_bold.woff",textMetrics:{unitsPerEm:1e3,ascender:950,descender:-250}},{identifier:"imgly_font_ostrich_sans_heavy",fontWeight:900,provider:"file",filePath:"fonts/imgly_font_ostrich_sans_heavy.woff",textMetrics:{unitsPerEm:1e3,ascender:674,descender:0}}]},{fontFamily:"Permanent Marker",variations:[{identifier:"imgly_font_permanent_marker",fontWeight:"normal",fontStyle:"normal",provider:"file",filePath:"fonts/imgly_font_permanent_marker.woff",textMetrics:{unitsPerEm:1024,ascender:1136,descender:-325}}]},{fontFamily:"Petit Formal Script",variations:[{identifier:"imgly_font_petit_formal_script",fontWeight:"normal",fontStyle:"normal",provider:"file",filePath:"fonts/imgly_font_petit_formal_script.woff",default:!0,textMetrics:{unitsPerEm:2048,ascender:2033,descender:-527}}]},{fontFamily:"Rasa",variations:[{identifier:"imgly_font_rasa_regular",fontWeight:"normal",fontStyle:"normal",provider:"file",filePath:"fonts/imgly_font_rasa_regular.woff",default:!0,textMetrics:{unitsPerEm:2750,ascender:2300,descender:-1050}},{identifier:"imgly_font_rasa_500",fontWeight:500,fontStyle:"normal",provider:"file",filePath:"fonts/imgly_font_rasa_500.woff",default:!0,textMetrics:{unitsPerEm:2750,ascender:2300,descender:-1050}}]},{fontFamily:"Roboto Black",variations:[{identifier:"imgly_font_roboto_black",fontWeight:"normal",fontStyle:"normal",filePath:"fonts/imgly_font_roboto_black.woff",provider:"file",textMetrics:{unitsPerEm:2048,ascender:1900,descender:-500}},{identifier:"imgly_font_roboto_black_italic",fontWeight:"normal",fontStyle:"italic",filePath:"fonts/imgly_font_roboto_black_italic.woff",provider:"file",textMetrics:{unitsPerEm:2048,ascender:1900,descender:-500}}]},{fontFamily:"Roboto Light",variations:[{identifier:"imgly_font_roboto_light",fontWeight:"normal",fontStyle:"normal",filePath:"fonts/imgly_font_roboto_light.woff",provider:"file",textMetrics:{unitsPerEm:2048,ascender:1900,descender:-500}},{identifier:"imgly_font_roboto_light_italic",fontWeight:"normal",fontStyle:"italic",filePath:"fonts/imgly_font_roboto_light_italic.woff",provider:"file",textMetrics:{unitsPerEm:2048,ascender:1900,descender:-500}}]},{fontFamily:"Sue Ellen Francisco",variations:[{identifier:"imgly_font_sue_ellen_francisco",fontWeight:"normal",fontStyle:"normal",filePath:"fonts/imgly_font_sue_ellen_francisco.woff",provider:"file",textMetrics:{unitsPerEm:1024,ascender:1362,descender:-634}}]},{fontFamily:"Ultra",variations:[{identifier:"imgly_font_ultra",fontWeight:"normal",fontStyle:"normal",provider:"file",filePath:"fonts/imgly_font_ultra.woff",default:!0,textMetrics:{unitsPerEm:2048,ascender:2066,descender:-561}}]},{fontFamily:"Wolesbro",variations:[{identifier:"imgly_font_wolesbro",fontWeight:"normal",fontStyle:"normal",provider:"file",filePath:"fonts/imgly_font_wolesbro.woff",textMetrics:{unitsPerEm:1e3,ascender:925,descender:-575}}]}];var Vc=[{identifier:"imgly_transforms_common",defaultName:"Common Ratios",ratios:[{identifier:"imgly_transform_common_custom",defaultName:"Custom",ratio:"*",selected:!0},{identifier:"imgly_transform_common_square",defaultName:"Square",ratio:1},{identifier:"imgly_transform_common_4-3",defaultName:"4:3",ratio:4/3},{identifier:"imgly_transform_common_16-9",defaultName:"16:9",ratio:16/9}]},{identifier:"imgly_transforms_facebook",defaultName:"Facebook",ratios:[{identifier:"imgly_transform_facebook_profile",defaultName:"Profile Pic",dimensions:{x:300,y:300},forceDimensions:!1,lockDimensions:!0},{identifier:"imgly_transform_facebook_ad",defaultName:"Ad",dimensions:{x:1200,y:627}},{identifier:"imgly_transform_facebook_post",defaultName:"Post",dimensions:{x:940,y:788}},{identifier:"imgly_transform_facebook_cover",defaultName:"Cover",dimensions:{x:851,y:315}}]}];const Hc=[];typeof F.Operations.SpriteOperation!="undefined"&&Hc.push(F.Operations.SpriteOperation.BrushSprite.Brushes.RadialBrush);var qc={TRANSFORM_RATIO_CATEGORIES:Vc,FONTS:jc,TEXT_DESIGN_FONTS:Wc,BRUSHES:Hc};const Gg=R(R({},Qi),{LOAD:"load",SAVE:"save",EDITOR_RESIZE:"editor:resize",ZOOM:"editor:zoom",ZOOM_CHANGED:"editor:zoom_changed",HISTORY_REDO:"history:redo",HISTORY_BEFORE_REDO:"history:before-redo",TEXT_SCALED:"editor:text:scaled",TRANSFORM_RESIZE:"transform:resize",TRANSFORM_AFTER_EDIT:"transform:after-edit",ADDED_STICKER:"sticker:added-sticker",SPRITES_DESELECTED:"editor:sprite:deselected-all",CANVAS_FOCUS:"canvas:focus"});var Yc=Gg;var Oe={EVENTS:Yc,DEFAULTS:qc};function Ug(){const{userAgent:e,appVersion:t}=navigator;return t.indexOf("MSIE")!==-1?t.match(/MSIE\s+?([0-9]+)/i)[1]:e.indexOf("Trident")!==-1?e.match(/rv:([0-9]+)/i)[1]:!1}var Xc={getIEVersion:Ug};const Kg=F.Utils,{Vector2:uo}=F.Math,jg={getInnerDimensionsForElement(e){const t=new uo(e.offsetWidth,e.offsetHeight),i=window.getComputedStyle(e,null);return t.x-=parseInt(i.getPropertyValue("padding-left"),10),t.x-=parseInt(i.getPropertyValue("padding-right"),10),t.y-=parseInt(i.getPropertyValue("padding-top"),10),t.y-=parseInt(i.getPropertyValue("padding-bottom"),10),t},getEventPosition(e){let t=e.clientX,i=e.clientY;if(e.type.indexOf("touch")!==-1){if(!e.touches.length)return;t=e.touches[0].clientX,i=e.touches[0].clientY}return new uo(t,i)},createTransparentPatternCanvas(){const e=document.createElement("canvas"),t=e.getContext("2d");return e.width=10,e.height=10,t.fillStyle="white",t.fillRect(0,0,e.width,e.height),t.fillStyle="#cccccc",t.fillRect(0,0,e.width/2,e.height/2),t.fillRect(e.width/2,e.height/2,e.width,e.height),e},supportsMSBlob(){const e=document.createElement("canvas");return typeof e.msToBlob!="undefined"},translate(e,t,i={}){let r=this.fetch(e,t);if(!r)return k.info("Utils#translate",`Unable to translate \`${t}\``),null;for(const s in i)r=r.replace(`\${${s}}`,i[s]);return r},fetch(e,t,i){t=t.replace(/\[(\w+)]/g,".$1"),t=t.replace(/^\./,"");const r=t.split(".");for(let s=0;s<r.length;s++){const o=r[s];if(e=e[o],!e)break}return typeof e=="undefined"?!1:e},isMobile(){const e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))},select(e,t,i=null){i||(i=s=>s);const r=[];return t.forEach(s=>{e.forEach(o=>{const n=i(o);n===s&&r.push(o)})}),r},getJSONP(e){const t=new rt(e);return t.load()},cloneCategories(e,t){return e.map(i=>(i=Kg.clone(i),i[t]=i[t].slice(0),i))},mergeCategories(e,t,i){e=this.cloneCategories(e,i);let r=null;return t.forEach(s=>{e.forEach(o=>{s.identifier===o.identifier&&(r=o)}),r?r[i]=r[i].concat(s[i]):e.push(s)}),e},wrapFiltersInCategories(e,t){return e.map(i=>{let r=i;return t in r||(r={identifier:`imgly_filters_wrapped-${i.identifier}`,displayFlat:!0,[t]:[i]}),r})},getStyleObject(e){const t=window.getComputedStyle(e),i={};for(const r in t){const s=t.getPropertyValue(r),o=r.replace(/-([a-z])/g,(n,a)=>a.toUpperCase());s!==""&&(i[o]=s)}return i},styleElement(e,t){for(const i in t)e.style[i]=t[i]},debounce(e,t,i){let r;return function(...s){const o=()=>{r=null,i||e.apply(this,s)},n=i&&!r;clearTimeout(r),r=setTimeout(o,t),n&&e.apply(this,s)}},getScrollbarWidth(){const e=document.createElement("div");e.style.visibility="hidden",e.style.width="100px",e.style.msOverflowStyle="scrollbar",document.body.appendChild(e);const t=e.offsetWidth;e.style.overflow="scroll";const i=document.createElement("div");i.style.width="100%",e.appendChild(i);const r=i.offsetWidth;return e.parentNode.removeChild(e),t-r},findIntegerFraction(e,t=100){let i=Number.MAX_VALUE,r=0,s=0,o=1,n=1;for(let a=0;a<t;a++){const l=o/n-e;if(l<0)o++;else if(l>0)n++;else return new uo(o,n);const d=Math.abs(o/n-e);d<i&&(i=d,r=o,s=n)}return new uo(r,s)},toFixed(e,t=2){const i=e.toFixed(t);return parseFloat(i)},capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)},flipObject(e){const t={};for(const i in e)t[e[i]]=i;return t},Browser:Xc};var ze=jg;const{Base64:mo}=F,{Color:le}=F,{ColorMatrix:GA}=F.Math,{EventEmitter:Hn}=F,{EXIF:UA}=F,{OptionType:KA}=F,{Promise:jA}=F,ue=F.Utils,{RenderType:Jt}=F,{ImageFormat:qn}=F,Y=F,{UniformType:WA}=F,{Vector2:Z}=F.Math,{Rectangle:VA}=F.Math,{Range:HA}=F.Math,qA=typeof window!="undefined"&&window.performance&&window.performance.now?window.performance.now.bind(window.performance):wi();class Wg{constructor(){this._assetsByGroupId={}}addAsset(e,t,i=!1){this._assetsByGroupId[e]?i?this._assetsByGroupId[e].unshift(t):this._assetsByGroupId[e].push(t):this._assetsByGroupId[e]=[t]}setAssets(e,t){this._assetsByGroupId[e]=t}getAssets(e){return this._assetsByGroupId[e]=this._assetsByGroupId[e]||[],this._assetsByGroupId[e]}}var fo=Wg;class go{static downloadDataURL(e,t="photoeditorsdk-export"){const i=this.createBlobURLFromDataURL(e),r=this.getExtensionFromDataURL(e),s=document.createElement("a");s.download=`${t}.${r}`,s.href=i,document.body.appendChild(s),s.click(),document.body.removeChild(s)}static downloadMSBlob(e,t="photoeditorsdk-export"){navigator.msSaveBlob&&navigator.msSaveBlob(e,`${t}.png`)}static getExtensionFromDataURL(e){const t=e.split(",")[0].split(":")[1].split(";")[0];return t.split("/").pop()}static createBlobURLFromDataURL(e){if(!window.Blob||!window.URL||!ArrayBuffer||!Uint8Array)return e;const t=mo.decode(e.split(",")[1]),i=e.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(t.length),s=new Uint8Array(r);for(let n=0;n<t.length;n++)s[n]=t[n];const o=new window.Blob([r],{type:i});return window.URL.createObjectURL(o)}}class Yn{constructor(e,t,i){this._sdk=e,this._options=t,this._download=i}export(){const e=this._getRenderType();return this._sdk.export(e,this._options.format,this._options.quality).then(t=>(this._download&&this._downloadData(e,t),t))}_downloadData(e,t){switch(e){case Jt.DATAURL:go.downloadDataURL(t,this._options.fileBasename);break;case Jt.MSBLOB:go.downloadMSBlob(t,this._options.fileBasename);break}}_getRenderType(){const e=this._options;return e.type!==Jt.IMAGE||!this._download?e.type:ze.supportsMSBlob()?Jt.MSBLOB:Jt.DATAURL}}class _o extends G{}_o.prototype.availableOptions={fontFamily:{type:h.STRING,required:!0},variations:{type:h.ARRAY,required:!0}};const Vg={100:"Extra Light",200:"Light",300:"Book",400:"Regular",500:"Medium",600:"Semibold",700:"Bold",800:"Black",900:"Extra Black",bold:"Bold",normal:"Regular"};class vr extends G{getLabel(){let e=Vg[this._options.fontWeight];switch(this._options.fontStyle){case"italic":e+=" Italic";break}return e}}vr.prototype.availableOptions={identifier:{type:h.STRING,required:!0},fontFamily:{type:h.STRING,required:!0},fontWeight:{type:h.ALL,default:400},fontStyle:{type:h.STRING,default:"normal"},textMetrics:{type:h.OBJECT,default:null},provider:{type:h.STRING,available:["google","file"]},filePath:{type:h.STRING},default:{type:h.BOOLEAN,default:!1},font:{type:h.OBJECT}};const Yr={imgly_font_bernier_regular:"imgly_font_sancreek",imgly_font_cheque_regular:"imgly_font_kumar_one_outline",imgly_font_gagalin_regular:"imgly_font_permanent_marker",imgly_font_hagin_caps_thin:"imgly_font_nixie_one",imgly_font_intro_inline:"imgly_font_bungee_inline",imgly_font_nexa_script:"imgly_font_molle",imgly_font_panton_blackitalic_caps:"imgly_font_roboto_black_italic",imgly_font_panton_lightitalic_caps:"imgly_font_roboto_light_italic",imgly_font_perfograma:"imgly_font_codystar",imgly_font_panton_black_caps:"imgly_font_roboto_black",imgly_font_panton_light_caps:"imgly_font_roboto_light",imgly_font_summer_font_light:"imgly_font_sue_ellen_francisco"},Xn=(e,t=!1)=>Yr[e]?(t&&console.warn(`Font ${e} was deprecated. Please use ${Yr[e]} instead.`),Yr[e]):e;class it{constructor(e,t){this._ui=e,this._options=t,this._fonts=[],this._variationsByIdentifier={},this._fontsByFontFamily={},this._initFonts()}_initFonts(){const{fonts:e,replaceFonts:t,availableVariations:i,isTextDesign:r}=this._options;let s=!0;process.env.REACT_APP_BROWSER&&(s=this._ui.getEditor().getSDK()._l.areCustomAssetsAllowed()),e&&s&&e.forEach(({variations:a},l)=>{a&&a.forEach((d,p)=>{if(Yr[d.identifier]){const u=Xn(d.identifier,!0);e[l].variations[p].identifier=u;const{fontFamily:c}=Oe.DEFAULTS.FONTS.find(m=>m.variations.some(x=>x.identifier===u));e[l].fontFamily=c}})});let o=r?Oe.DEFAULTS.TEXT_DESIGN_FONTS:Oe.DEFAULTS.FONTS;s&&(t?o=e:o=o.concat(e||[]));let n;o=o.map(a=>{const{fontFamily:l}=a;let{variations:d}=a;if(s&&i&&(d=d.filter(u=>i.indexOf(u.identifier)!==-1)),d.length===0)return null;const p=new _o({fontFamily:l});return d=d.map(u=>{const c=new vr(u);return c.setFontFamily(l),c.setFont(p),u.default&&!n&&(n=c),c.getTextMetrics()==null&&k.warn(`Missing font metrics for ${c.getIdentifier()}. The SDK will fall back to basic font rendering, which may lead to layout issues. Please provide font metrics for your custom fonts. See https://docs.photoeditorsdk.com/guides/html5/ for more details.`),this._variationsByIdentifier[c.getIdentifier()]=c,c}),p.setVariations(d),this._fontsByFontFamily[l]=p,p}).filter(a=>a),n||([n]=o[0].getVariations()),this._defaultVariation=n,this._fonts=o}getFonts(){return this._fonts}getFontByFontFamily(e){return this._fontsByFontFamily[e]}getVariationByIdentifier(e){return this._variationsByIdentifier[Xn(e)]}getVariationsByIdentifier(){return R({},this._variationsByIdentifier)}getDefaultVariation(){return this._defaultVariation}}const Hg=[{identifier:"imgly_font_open_sans_bold",fontFamily:"Open Sans",fontWeight:"bold",fontURI:"./fonts/imgly_font_open_sans_bold.woff",format:"woff",textMetrics:{unitsPerEm:2048,ascender:2189,descender:-600}},{identifier:"imgly_font_aleo_bold",fontFamily:"Aleo",fontWeight:"bold",fontURI:"./fonts/imgly_font_aleo_bold.woff",format:"woff",textMetrics:{unitsPerEm:1e3,ascender:805,descender:-195}},{identifier:"imgly_font_amaticsc",fontFamily:"Amatic SC",fontWeight:"normal",fontURI:"./fonts/imgly_font_amaticsc.woff",format:"woff",textMetrics:{unitsPerEm:1e3,ascender:1016,descender:-245}},{identifier:"imgly_font_archivo_black",fontFamily:"Archivo",fontWeight:"normal",fontURI:"./fonts/imgly_font_archivo_black.woff",format:"woff",textMetrics:{unitsPerEm:1e3,ascender:878,descender:-210}},{identifier:"imgly_font_bungee_inline",fontFamily:"Bungee Inline",fontWeight:"normal",fontStyle:"normal",fontURI:"./fonts/imgly_font_bungee_inline.woff",format:"woff",textMetrics:{unitsPerEm:1e3,ascender:860,descender:-140}},{identifier:"imgly_font_fira_sans_regular",fontFamily:"Fira Sans",fontWeight:"normal",fontStyle:"normal",fontURI:"./fonts/imgly_font_fira_sans_regular.woff",format:"woff",textMetrics:{unitsPerEm:1e3,ascender:935,descender:-265}},{identifier:"imgly_font_campton_bold",fontFamily:"Campton Book",fontWeight:"bold",fontStyle:"normal",fontURI:"./fonts/imgly_font_campton_bold.woff",format:"woff",textMetrics:{unitsPerEm:1e3,ascender:770,descender:-294}},{identifier:"imgly_font_carter_one",fontFamily:"Carter One",fontWeight:"normal",fontStyle:"normal",fontURI:"./fonts/imgly_font_carter_one.woff",format:"woff",textMetrics:{unitsPerEm:2048,ascender:2264,descender:-890}},{identifier:"imgly_font_codystar",fontFamily:"Codystar",fontWeight:"normal",fontStyle:"normal",fontURI:"./fonts/imgly_font_codystar.woff",format:"woff",textMetrics:{unitsPerEm:1024,ascender:953,descender:-255}},{identifier:"imgly_font_galano_grotesque_bold",fontFamily:"Galano Grotesque",fontWeight:"bold",fontStyle:"normal",fontURI:"./fonts/imgly_font_galano_grotesque_bold.woff",format:"woff",textMetrics:{unitsPerEm:1e3,ascender:800,descender:-200}},{identifier:"imgly_font_krona_one",fontFamily:"Krona One",fontWeight:"normal",fontStyle:"normal",fontURI:"./fonts/imgly_font_krona_one.woff",format:"woff",textMetrics:{unitsPerEm:2048,ascender:2030,descender:-530}},{identifier:"imgly_font_kumar_one_outline",fontFamily:"Kumar One Outline",fontWeight:"normal",fontStyle:"normal",fontURI:"./fonts/imgly_font_kumar_one_outline.woff",format:"woff",textMetrics:{unitsPerEm:1e3,ascender:1137,descender:-642}},{identifier:"imgly_font_lobster",fontFamily:"Lobster",fontWeight:"normal",fontURI:"./fonts/imgly_font_lobster.woff",format:"woff",textMetrics:{unitsPerEm:1e3,ascender:1e3,descender:-250}},{identifier:"imgly_font_molle",fontFamily:"Molle",fontWeight:"normal",fontStyle:"italic",fontURI:"./fonts/imgly_font_molle.woff",format:"woff",textMetrics:{unitsPerEm:2048,ascender:1852,descender:-701}},{identifier:"imgly_font_monoton",fontFamily:"Monoton",fontWeight:"normal",fontStyle:"normal",fontURI:"./fonts/imgly_font_monoton.woff",format:"woff",textMetrics:{unitsPerEm:2048,ascender:2366,descender:-822}},{identifier:"imgly_font_nixie_one",fontFamily:"Nixie One",fontWeight:"normal",fontStyle:"normal",fontURI:"./fonts/imgly_font_nixie_one.woff",format:"woff",textMetrics:{unitsPerEm:1e3,ascender:926,descender:-210}},{identifier:"imgly_font_notable",fontFamily:"Notable",fontWeight:"normal",fontStyle:"normal",fontURI:"./fonts/imgly_font_notable.woff",format:"woff",textMetrics:{unitsPerEm:1e3,ascender:1143,descender:-157}},{identifier:"imgly_font_ostrich_sans_black",fontFamily:"Ostrich",fontWeight:800,fontStyle:"normal",fontURI:"./fonts/imgly_font_ostrich_sans_black.woff",format:"woff",textMetrics:{unitsPerEm:1e3,ascender:950,descender:-250}},{identifier:"imgly_font_ostrich_sans_bold",fontFamily:"Ostrich",fontWeight:"bold",fontStyle:"normal",fontURI:"./fonts/imgly_font_ostrich_sans_bold.woff",format:"woff",textMetrics:{unitsPerEm:1e3,ascender:950,descender:-250}},{identifier:"imgly_font_oswald_semi_bold",fontFamily:"Oswald SemiBold",googleFamily:"Oswald",fontWeight:600,fontStyle:"normal",fontURI:"./fonts/imgly_font_oswald_semi_bold.woff",format:"woff",textMetrics:{unitsPerEm:1e3,ascender:1193,descender:-289}},{identifier:"imgly_font_palanquin_dark_semi_bold",fontFamily:"Palanquin Dark SemiBold",googleFamily:"Palanquin Dark",fontWeight:"bold",fontStyle:"normal",fontURI:"./fonts/imgly_font_palanquin_dark_semi_bold.woff",format:"woff",textMetrics:{unitsPerEm:1e3,ascender:1320,descender:-491}},{identifier:"imgly_font_poppins",fontFamily:"Poppins",fontWeight:"bold",fontStyle:"normal",fontURI:"./fonts/imgly_font_poppins.woff",format:"woff",textMetrics:{unitsPerEm:1e3,ascender:1050,descender:-350}},{identifier:"imgly_font_permanent_marker",fontFamily:"Permanent Marker",fontWeight:"normal",fontStyle:"normal",fontURI:"./fonts/imgly_font_permanent_marker.woff",format:"woff",textMetrics:{unitsPerEm:1024,ascender:1136,descender:-325}},{identifier:"imgly_font_roboto_black_italic",fontFamily:"Roboto Black",fontWeight:"bold",fontStyle:"italic",googleFamily:"Roboto",fontURI:"./fonts/imgly_font_roboto_black_italic.woff",format:"woff",textMetrics:{unitsPerEm:2048,ascender:1900,descender:-500}},{identifier:"imgly_font_roboto_light_italic",fontFamily:"Roboto Light",googleFamily:"Roboto",fontWeight:300,fontStyle:"italic",fontURI:"./fonts/imgly_font_roboto_light_italic.woff",format:"woff",textMetrics:{unitsPerEm:2048,ascender:1900,descender:-500}},{identifier:"imgly_font_sancreek",fontFamily:"Sancreek",fontWeight:"normal",fontStyle:"normal",fontURI:"./fonts/imgly_font_sancreek.woff",format:"woff",textMetrics:{unitsPerEm:2048,ascender:2104,descender:-738}},{identifier:"imgly_font_stint_ultra_expanded",fontFamily:"Stint Ultra Expanded",fontWeight:"normal",fontStyle:"normal",fontURI:"./fonts/imgly_font_stint_ultra_expanded.woff",format:"woff",textMetrics:{unitsPerEm:2048,ascender:1853,descender:-483}},{identifier:"imgly_font_trash_hand",fontFamily:"Trash Hand",fontWeight:"normal",fontURI:"./fonts/imgly_font_trash_hand.woff",format:"woff",textMetrics:{unitsPerEm:1e3,ascender:759,descender:-304}},{identifier:"imgly_font_vt323",fontFamily:"VT323",fontWeight:"normal",fontStyle:"normal",fontURI:"./fonts/imgly_font_vt323.woff",format:"woff",textMetrics:{unitsPerEm:1e3,ascender:800,descender:-200}},{identifier:"imgly_font_yeseva_one",fontFamily:"Yeseva One",fontWeight:"normal",fontStyle:"normal",fontURI:"./fonts/imgly_font_yeseva_one.woff",format:"woff",textMetrics:{unitsPerEm:1e3,ascender:915,descender:-240}},{identifier:"imgly_font_abril_fatface_regular",fontFamily:"Abril Fatface",fontWeight:"normal",fontStyle:"normal",fontURI:"./fonts/imgly_font_abril_fatface_regular.woff",format:"woff",textMetrics:{unitsPerEm:1e3,ascender:1058,descender:-291}},{identifier:"imgly_font_amberlight",fontFamily:"Amberlight",fontWeight:"normal",fontStyle:"normal",fontURI:"./fonts/imgly_font_amberlight.woff",format:"woff",textMetrics:{unitsPerEm:1e3,ascender:750,descender:-250}},{identifier:"imgly_font_montserrat_light",fontFamily:"Montserrat Light",googleFamily:"Montserrat",fontWeight:300,fontStyle:"normal",fontURI:"./fonts/imgly_font_montserrat_light.woff",format:"woff",textMetrics:{unitsPerEm:1e3,ascender:968,descender:-251}},{identifier:"imgly_font_handycheera_regular",fontFamily:"Handycheera",fontWeight:"normal",fontStyle:"normal",fontURI:"./fonts/imgly_font_handycheera_regular.woff",format:"woff",textMetrics:{unitsPerEm:2048,ascender:2199,descender:-808}},{identifier:"imgly_font_ostrich_sans_heavy",fontFamily:"Ostrich",fontWeight:900,fontStyle:"normal",fontURI:"./fonts/imgly_font_ostrich_sans_heavy.woff",format:"woff",textMetrics:{unitsPerEm:1e3,ascender:674,descender:0}},{identifier:"imgly_font_petit_formal_script",fontFamily:"Petit Formal Script",fontWeight:"normal",fontStyle:"normal",fontURI:"./fonts/imgly_font_petit_formal_script.woff",format:"woff",textMetrics:{unitsPerEm:2048,ascender:2033,descender:-527}},{identifier:"imgly_font_rasa_500",fontFamily:"Rasa",fontWeight:500,fontStyle:"normal",fontURI:"./fonts/imgly_font_rasa_500.woff",format:"woff",textMetrics:{unitsPerEm:2750,ascender:2300,descender:-1050}},{identifier:"imgly_font_rasa_regular",fontFamily:"Rasa",fontWeight:"normal",fontStyle:"normal",fontURI:"./fonts/imgly_font_rasa_regular.woff",format:"woff",textMetrics:{unitsPerEm:2750,ascender:2300,descender:-1050}},{identifier:"imgly_font_roboto_black",fontFamily:"Roboto Black",fontWeight:"normal",fontStyle:"normal",fontURI:"./fonts/imgly_font_roboto_black.woff",format:"woff",textMetrics:{unitsPerEm:2048,ascender:1900,descender:-500}},{identifier:"imgly_font_roboto_light",fontFamily:"Roboto Light",fontWeight:"normal",fontStyle:"normal",fontURI:"./fonts/imgly_font_roboto_light.woff",format:"woff",textMetrics:{unitsPerEm:2048,ascender:1900,descender:-500}},{identifier:"imgly_font_sue_ellen_francisco",fontFamily:"Sue Ellen Francisco",fontWeight:"normal",fontStyle:"normal",fontURI:"./fonts/imgly_font_sue_ellen_francisco.woff",format:"woff",textMetrics:{unitsPerEm:1024,ascender:1362,descender:-634}},{identifier:"imgly_font_ultra",fontFamily:"Ultra",fontWeight:"normal",fontStyle:"normal",fontURI:"./fonts/imgly_font_ultra.woff",format:"woff",textMetrics:{unitsPerEm:2048,ascender:2066,descender:-561}},{identifier:"imgly_font_wolesbro",fontFamily:"Wolesbro",fontWeight:"normal",fontStyle:"normal",fontURI:"./fonts/imgly_font_wolesbro.woff",format:"woff",textMetrics:{unitsPerEm:1e3,ascender:925,descender:-575}}];var Qn=Hg;const Qc=[];typeof F.Operations.SpriteOperation!="undefined"&&Qc.push(F.Operations.SpriteOperation.BrushSprite.Brushes.RadialBrush);var mi={EVENTS:{EXPORT:"export",OPERATION_CREATED:"operation:created",OPERATION_UPDATED:"operation:updated",OPERATION_REMOVED:"operation:removed"},DEFAULTS:{TRANSFORM_RATIO_CATEGORIES:[{identifier:"imgly_transforms_common",defaultName:"Common Ratios",ratios:[{identifier:"imgly_transform_common_custom",defaultName:"Custom",ratio:"*",selected:!0},{identifier:"imgly_transform_common_square",defaultName:"Square",ratio:1},{identifier:"imgly_transform_common_4-3",defaultName:"4:3",ratio:4/3},{identifier:"imgly_transform_common_16-9",defaultName:"16:9",ratio:16/9}]},{identifier:"imgly_transforms_facebook",defaultName:"Facebook",ratios:[{identifier:"imgly_transform_facebook_profile",defaultName:"Profile Pic",ratio:1/1},{identifier:"imgly_transform_facebook_ad",defaultName:"Ad",dimensions:new F.Math.Vector2(1200,627)},{identifier:"imgly_transform_facebook_post",defaultName:"Post",dimensions:new F.Math.Vector2(940,788)},{identifier:"imgly_transform_facebook_cover",defaultName:"Cover",dimensions:new F.Math.Vector2(851,315)}]}],FONTS:Qn,BRUSHES:Qc,TEXT_DESIGN_FONTS:Qn}};const{Utils:bI}=F,{Vector2:xI}=F.Math;const{Base64:kI}=F,{Color:yo}=F,{ColorMatrix:DI}=F.Math,{EventEmitter:Zc}=F,{EXIF:PI}=F,{OptionType:FI}=F,{Promise:wr}=F,Xr=F.Utils,{RenderType:AI}=F,{ImageFormat:II}=F,Zn=F,{UniformType:BI}=F,{Vector2:bo}=F.Math,{Rectangle:MI}=F.Math,{Range:LI}=F.Math,NI=typeof window!="undefined"&&window.performance&&window.performance.now?window.performance.now.bind(window.performance):wi();class Jn{constructor(e,t,i){this._editor=e,this._sdk=t,this._mediator=i,this._available=this._sdk.getOperations(),this._map={},this._stack=this._sdk.getOperationsStack(),this._preferredOrder=this._editor.getOptions().editor.operationsOrder,this._fixStack()}exists(e){return!!this._map[e]}add(e){const{identifier:t}=e.constructor;e.on("update",()=>{this._mediator.emit(mi.EVENTS.OPERATION_UPDATED,e)});const i=this._preferredOrder.indexOf(t);if(i===-1)throw new Error(`EditorOperations#add: \`${t}\` does not appear in \`operationsOrder\``);this._stack.set(i,e),this._map[t]=e,this._mediator.emit(mi.EVENTS.OPERATION_CREATED,e)}remove(e,t=!0){const i=typeof e=="object"?e.constructor.identifier:e,r=this._stack.getStack();e=this.get(i),delete this._map[i];const s=r.map(o=>o.constructor.identifier).indexOf(i);if(s!==-1){this._stack.removeAt(s);for(let o=s+1;o<r.length;o++){const n=r[o];if(!n)continue;n.setDirty(!0)}t&&this._mediator.emit(mi.EVENTS.OPERATION_REMOVED,e)}}get(e){return this._map[e]}getOrCreate(e,t={}){if(this._map[e]){const s=this._map[e];return s.set(t,!1),s}const i=this._available[e],r=new i(this._sdk,t);return this.add(r),r}getStack(){return this._stack}reset(){for(const e in this._map){const t=this._map[e];t.dispose()}this._map={}}_fixStack(){const e=this._stack.getStack().slice();this._stack.clear(),e.forEach(t=>{this.add(t)})}}class $n{constructor(e,t,i){this._image=e,this._maxPixels=t,this._maxDimensions=i}needsResize(){const e=new bo(this._image.width,this._image.height),t=e.x*e.y,i=this._maxPixels!==null&&t>this._maxPixels,r=this._maxDimensions!==null&&(e.x>this._maxDimensions||e.y>this._maxDimensions);return i||r}resize(){let e=null,t=null;const i=this._maxDimensions;return new wr((r,s)=>{setTimeout(()=>{const o=new bo(this._image.width,this._image.height),n=o.clone();if(this._maxPixels!==null&&n.x*n.y>this._maxPixels&&(n.copy(this._getDimensionsByMaxPixels()),e="maxMegaPixels"),i!==null&&(n.x>i||n.y>i)){const a=Math.min(i/n.x,i/n.y);n.multiply(a),e="maxDimensions"}n.floor(),t=this._createResizedImageCanvas(n),r({canvas:t,dimensions:n,reason:e})},1e3)})}_createResizedImageCanvas(e,t=e){const i=this._image,r=Xr.createCanvas();r.width=e.x,r.height=e.y;const s=e.clone().subtract(t).divide(2),o=r.getContext("2d");return o.drawImage(i,0,0,i.width,i.height,s.x,s.y,t.x,t.y),r}_getDimensionsByMaxPixels(){const e=this._image,t=this._maxPixels,i=e.width/e.height,r=e.height/e.width;return new bo(Math.sqrt(t*i),Math.sqrt(t*r)).floor()}}const qg=30,Yg="abcdefghijklmnopqrstuvwxzy";class xo{constructor(e){this._fontVariation=e||new vr({fontFamily:"Times New Roman",fontWeight:"normal",fontStyle:"normal"}),this._createRuler()}_createRuler(){this._ruler=document.createElement("div"),this._ruler.innerText=Yg,document.body.appendChild(this._ruler),this._setRulerStyle()}_setRulerStyle(){this._ruler.style.cssText=`
      position: absolute;
      top: -9999px;
      left: -9999px;
      opacity: 0;
      display: inline-block;
      font: ${this._fontVariation.getFontStyle()} ${this._fontVariation.getFontWeight()} ${qg}px ${this._fontVariation.getFontFamily()};
    `}setFontVariation(e){this._fontVariation=e,this._setRulerStyle()}getWidth(){return this._ruler?this._ruler.offsetWidth:-1}dispose(){this._ruler&&(this._ruler.parentNode.removeChild(this._ruler),this._ruler=null)}}const Jc=typeof window!="undefined"&&window.performance&&window.performance.now?window.performance.now.bind(window.performance):wi(),Xg=50,Qg=5e3;class ea{constructor(e){this._fontVariation=e,this._defaultFontRuler=new xo,this._customFontRuler=new xo(this._fontVariation)}observe(){const e=Jc();return new Promise((t,i)=>{const r=window.setInterval(()=>{const s=this._defaultFontRuler.getWidth()!==this._customFontRuler.getWidth();if(s)return window.clearInterval(r),t();if(Jc()-e>=Qg){const o=new Error(`Failed to load font ${this._fontVariation.getFontFamily()}.`);return o.font=this._fontVariation,i(o)}},Xg)})}dispose(){this._defaultFontRuler.dispose(),this._customFontRuler.dispose()}}class Qr{constructor(e){this._ui=e,this._fonts=[],this._observers=[]}add(e){this._fonts.push(e)}load(){return this._fonts.length===0?Promise.resolve():(this._observers=[],this._fonts.forEach(e=>{this._observers.push(new ea(e))}),S.executePromises(this._observers.map(e=>e.observe())))}dispose(){this._observers.forEach(e=>e.dispose())}}class ta extends Qr{load(){return Promise.resolve()}}const Zg={italic:"i"};class ia extends Qr{load(){return this._fonts.length&&this._addStylesheetTag(),super.load()}_addStylesheetTag(){const e=this._getFamiliesString(),t=document.createElement("link");t.rel="stylesheet",t.href=`https://fonts.googleapis.com/css?family=${e}`;const i=document.getElementsByTagName("head")[0];i.appendChild(t)}_getFamiliesString(){const e={};this._fonts.forEach(i=>{const r=i.getFontFamily(),s=i.getFontStyle(),o=i.getFontWeight();e[r]=e[r]||[],typeof o!="undefined"?e[r].push(`${o}${Zg[s]||""}`):e[r].push(400)});const t=[];for(const i in e){const r=e[i],s=r.length?`:${r.join(",")}`:"",o=i.replace(" ","+")+s;t.push(o)}return t.join("|")}}class Zr{constructor(e,t){this._ui=e,this._fonts=t,this._loadedFonts=[]}setFonts(e){this._fonts=e}needsToLoad(){for(let e=0;e<this._fonts.length;e++){let t;if(this._fonts[e].getVariations().forEach(i=>{t=t||i.getProvider()}),!t)continue;return!0}}fontLoaded(e){const t=e.getFontFamily();return this._loadedFonts.indexOf(t)!==-1}setFontLoaded(e){if(!this.fontLoaded(e)){const t=e.getFontFamily();this._loadedFonts.push(t)}}load(){const e=this._fonts,t={google:new ia(this._ui),file:new ta(this._ui)},i=()=>{for(const s in t){const o=t[s];o.dispose()}};e.filter(s=>!this.fontLoaded(s)).forEach(s=>{s.getVariations().forEach(o=>{const n=o.getProvider();if(!n)return;const a=t[n];a.add(o)})});const r=[];for(const s in t)r.push(t[s].load());return Promise.all(r).then(()=>{i(),e.forEach(s=>{this.setFontLoaded(s)})}).catch(s=>{throw i(),s})}}class ra{constructor(e,t){this._ui=e,this._options=t,this._brushes=[],this._brushesById={},this._addBrushes(Oe.DEFAULTS.BRUSHES);const{brushes:i,replaceBrushes:r,availableBrushes:s}=this._options;this._options.brushes&&this._addBrushes(i,r),s&&(this._brushes=this._brushes.filter(o=>s.indexOf(o.identifier)!==-1))}_addBrushes(e,t){t&&(this._brushes=[],this._brushesById={}),e.forEach(i=>{this._brushes.push(i),this._brushesById[i.identifier]=i})}getBrushByIdentifier(e){return this._brushesById[e]}getBrushes(){return this._brushes}getFirstBrush(){return this._brushes[0]}}class $t{constructor(e,t,i=!1){this._ui=e,this._options=t,this._categoriesById={},this._filtersByIdentifier={identity:Y.Operations.FilterOperation.Filters.IdentityFilter},this._categories=ze.wrapFiltersInCategories(bt.DEFAULTS.FILTERS.slice(0),$t.CATEGORY_ITEMS_PROPERTY),this._customAssetsAllowed=i||e.getEditor().getSDK()._l.areCustomAssetsAllowed(),this._customAssetsAllowed&&this._options.categories&&(this._options.categories=ze.wrapFiltersInCategories(this._options.categories,$t.CATEGORY_ITEMS_PROPERTY)),this._initCategories()}instantiateFilterWithIdentifier(e){const t={value:this._ui._options.crossOrigin,cors:!0},i=this.getFilterByIdentifier(e);if(!i)return Promise.reject(new Error(`Unknown filter with identifier \`${e}\`!`));if(!(i.prototype instanceof Y.Operations.FilterOperation.Filter)){const{lutImage:r,resolution:s,horizontalTileCount:o,verticalTileCount:n}=i;let{lightColor:a,darkColor:l}=i;if(a&&l)return a=le.fromHex(a),l=le.fromHex(l),Promise.resolve(new Y.Operations.FilterOperation.Filters.DuoToneFilter({lightColor:a,darkColor:l}));let d;this._ui.getPreloader&&(d=this._ui.getPreloader().getAsset(r));let p;return d?p=Promise.resolve(d):p=je.loadImage(this._ui.getAssetPath(r),t),p.then(()=>je.loadImage(this._ui.getAssetPath(r),t).then(u=>new Y.Operations.FilterOperation.Filters.ThreeDLUTFilter({image:u,resolution:s,horizontalTileCount:o,verticalTileCount:n})))}return Promise.resolve(new i)}_initCategories(){if(this._customAssetsAllowed&&this._options.categories&&(this._options.replaceCategories?this._categories=ze.wrapFiltersInCategories(this._options.categories,$t.CATEGORY_ITEMS_PROPERTY):this._categories=ze.mergeCategories(this._categories,this._options.categories,$t.CATEGORY_ITEMS_PROPERTY)),this._customAssetsAllowed&&this._options.availableFilters){const t=[];this._categories.forEach(i=>{const r=i.filters.filter(s=>this._options.availableFilters.indexOf(s.identifier)!==-1);r.length>0&&t.push({identifier:i.identifier,defaultName:i.defaultName,filters:r})}),this._categories=t}const e={identifier:"all",defaultName:"All",visible:!1,filters:this._categories.length<=0?[]:this._categories.map(t=>t.filters).reduce((t,i)=>t.concat(i))};this._categories.unshift(e),this._categoriesById.all=e,this._categories.forEach(t=>{this._categoriesById[t.identifier]=t}),e.filters.forEach(t=>{this._filtersByIdentifier[t.identifier]=t})}getFiltersForCategory(e){if(!this._categoriesById[e])throw new Error(`Unknown filter category '${e}'`);return this._categoriesById[e].filters}getItemsByCategory(e){return this.getFiltersForCategory(e)}getFilterByIdentifier(e){return this._filtersByIdentifier[e]}getCategories(){return this._categories}getCategoryByIdentifier(e){return this._categoriesById[e]}}$t.CATEGORY_ITEMS_PROPERTY="filters";const sa="imgly_sticker_custom";class fi{constructor(e,t,i){this._ui=e,this._options=t,this._dynamicAssetsLibrary=i||this._ui.getEditor().getDynamicAssetsLibrary()||new fo,this._categoriesById={},this._categories=[],this._stickersById={},this._customStickerCanvas=S.createCanvas(),this.reload()}reload(){this._categoriesById={},this._categories=[],this._stickersById={};const e=this._ui.getEditor().getSDK()._l.areCustomAssetsAllowed();this._addCategories(bt.DEFAULTS.STICKER_CATEGORIES);const{categories:t,replaceCategories:i}=this._options;if(e&&this._options.categories?this._addCategories(t,i):(this._updateCategoriesMap(),this._updateAllCategory()),e){const r=this._dynamicAssetsLibrary.getAssets("sticker");if(r.length>0){const s=this._createCustomStickerCategory(r);this._addCategories([s],!1,!0)}}}loadExternal(e){const t=new rt(e);return t.load().then(i=>{this._addCategories(i.categories,this._options.replaceCategories)})}_addCategories(e,t=!1,i=!1){t?this._categories=e.slice(0):i?this._categories=this._mergeCategories(e,this._categories):this._categories=this._mergeCategories(this._categories,e),this._updateCategoriesMap(),this._updateAllCategory()}_mergeCategories(e,t){e=ze.cloneCategories(e,"stickers");for(const i of t){let r=!1;for(const s of e)if(i.identifier===s.identifier){for(const o of i.stickers){let n=!1;for(const a of s.stickers)if(o.identifier===a.identifier){Object.assign(a,o),n=!0;break}n||s.stickers.push(o)}r=!0;break}r||e.push(i)}return e}_updateCategoriesMap(){this._categoriesById={},this._categories.forEach(e=>{this._categoriesById[e.identifier]=e}),this._categories.forEach(e=>{e.stickers.forEach(t=>{this._stickersById[t.identifier]=t})}),typeof this._options.availableStickers!="undefined"&&this._options.availableStickers!==null&&(this._categories.forEach(e=>{e.identifier!==sa&&(e.stickers=e.stickers.filter(t=>this._options.availableStickers.indexOf(t.identifier)!==-1))}),this._categories=this._categories.filter(e=>e.stickers.length>0)),this._updateAllCategory()}_updateAllCategory(){this._allCategory={identifier:"all",defaultName:"All",stickers:this._categories.map(e=>e.stickers).reduce((e,t)=>e.concat(t),[])},this._categoriesById.all=this._allCategory}renderStickerThumbnailFromImage(e){const t=this._customStickerCanvas,i=t.getContext("2d");i.save();const r=62,s=r/e.width,o=s*e.height;t.width=r,t.height=r,i.clearRect(0,0,e.width,e.height),i.translate(0,.5*(t.height-o)),i.scale(s,s),i.drawImage(e,0,0);const n=t.toDataURL("image/png");return i.restore(),{data:n,width:r,height:o}}addCustomStickerFromImage(e,t,i="none"){const r=f=>{const y=this._ui.getEditor().getSDK(),b=y.getRenderer(),g=new Z(f.width,f.height),E=this._ui.getEditor().getMaxMegapixels()*1e6;let v=b.getMaxDimensions();const w=g.x*g.y>E,A=v!==null&&(g.x>v||g.y>v);if(w){const z=f.width/f.height,H=f.height/f.width;v=new Z(Math.sqrt(E*z),Math.sqrt(E*H)).floor().max()}const I=g.clone();return(w||A)&&(g.x/g.y>1?(I.x=v,I.y=v/g.x*g.y):(I.x=v/g.y*g.x,I.y=v)),I},s=(f,y)=>{const b=f.x/f.y;return b>1?new Z(y,y/b):new Z(y*b,y)},o=e.src.substring(0,14)==="data:image/svg",n=this._ui.getEditor().getSDK();e=n.correctExifOrientation(e);const a=s(new Z(e.width,e.height),2048),l=o?a:r(e),d=this._customStickerCanvas,p=d.getContext("2d");p.save();const u=this.renderStickerThumbnailFromImage(e);o?(e.width>e.height?(d.width=2048,d.height=2048/e.width*e.height):(d.height=2048,d.width=2048/e.height*e.width),e.width=d.width,e.height=d.height):(d.width=l.x,d.height=l.y,p.scale(l.x/e.width,l.y/e.height)),p.drawImage(e,0,0,e.width,e.height);const c=d.toDataURL();p.restore();const m={identifier:S.generateUUID(),defaultName:t||"",tintMode:i,images:{mediaThumb:{uris:[u.data],rawData:!0,width:u.width,height:u.height},mediaBase:{uris:o?[c,e.src]:[c],rawData:!0,isSVG:o,width:l.x,height:l.y}}},x=this._dynamicAssetsLibrary;x.addAsset("sticker",m,!0);const _=x.getAssets("sticker");if(_.length===1){const f=this._createCustomStickerCategory(_);this._addCategories([f],!1,!0)}else this.getCategory(sa).stickers=_,this._updateAllCategory();this._updateCategoriesMap()}_createCustomStickerCategory(e){return{identifier:sa,defaultName:"Custom",metaData:{backgroundImage:e[e.length-1].images.mediaBase.uris[0],rawData:!0},stickers:e}}getStickersForCategory(e){if(!this._categoriesById[e])throw new Error(`Unknown sticker category '${e}'`);return this._categoriesById[e].stickers}getStickerByIdentifier(e){return this._stickersById[e]}getCategories(e=!1){return e?[this._allCategory].concat(this._categories):this._categories}getCategory(e){return this._categoriesById[e]}static getURLForSticker(e,t="base"){const{images:i}=e,r=t==="base"&&i.mediaBase||i.mediaThumb,s=r.uris||[r.uri];if(process.env.REACT_APP_BROWSER&&!ze.Browser.getIEVersion()){const n=s.filter(a=>/\.svg$/i.test(a));return n.length?n[0]:s[0]}const o=s.filter(n=>!/\.svg$/i.test(n));return o.length?o[0]:s[0]}}const $c=Cr(require("p-map"));let oa;typeof Y.Operations.SpriteOperation!="undefined"&&(oa=Y.Operations.SpriteOperation.BrushSprite);class Si{constructor(e,t){this._editor=e,this._ui=this._editor.getUI(),this._data=t,this._filterManager=new $t(this._ui,this._getOptions("filter")),this._stickerManager=new fi(this._ui,this._getOptions("sticker")),this._brushManager=new ra(this._ui,this._getOptions("brush")),this._fontManager=new it(this._ui,this._getOptions("text"))}_getOptions(e){const{controls:t}=this._editor;let i={};t&&t.get(e)&&(i=t.get(e).defaultOptions);const r=this._editor.getOptions();return ue.deepDefaults({},r.editor.controlsOptions[e]||{},i)}deserialize(){return this._validateVersion().then(()=>this._deserializeInputImage()).then(()=>this._deserializeOperations())}_validateVersion(){return this._data.version!==this.constructor.version?Promise.reject(new Error(`Invalid version ${this._data.version}, expected ${this.constructor.version}`)):Promise.resolve()}_deserializeInputImage(){return new Promise((e,t)=>{const{data:i,type:r}=this._data.inputImage;if(i&&r){const s=new window.Image;s.addEventListener("load",()=>{this._editor.setImage(s),e()}),s.src=`data:${r};base64,${i}`}else e()})}_deserializeOperations(){return _i(this,null,function*(){const{operations:e}=this._data;return $c.default(e,t=>_i(this,null,function*(){return this._deserializeOperation(t)}))})}_deserializeOperation(e){switch(e.type){case"crop":return this._deserializeCropOperation(e);case"orientation":return this._deserializeOrientationOperation(e);case"filter":return this._deserializeFilterOperation(e);case"adjustments":return this._deserializeAdjustmentsOperation(e);case"sprite":return this._deserializeSpriteOperation(e);case"focus":return this._deserializeFocusOperation(e)}}_deserializeCropOperation(e){const{options:t}=e;let{rotation:i}=t;const r=Z.fromObject(t.start),s=Z.fromObject(t.end);i>Math.PI&&(i-=Math.PI*2);const o={start:r,end:s};typeof i!="undefined"&&(o.rotation=i);const n=this._editor.operations.getOrCreate("transform");return this._editor.broadcastTransform(n,o),n.set(o),Promise.resolve(n)}_deserializeOrientationOperation(e){const{options:t}=e,i=this._editor.operations.getOrCreate("orientation");return i?(i.set(t),Promise.resolve(i)):Promise.resolve()}_deserializeFilterOperation(e){const{options:t}=e;return this._filterManager.getFilterByIdentifier(t.name)?this._filterManager.instantiateFilterWithIdentifier(t.name).then(i=>{const r=this._editor.operations.getOrCreate("filter");return r.set({identifier:t.name,filter:i,intensity:t.intensity}),r}):(k.warn("Deserializer",`Unknown filter \`${t.name}\``),Promise.resolve())}_deserializeAdjustmentsOperation(e){const{AdjustmentsOperation:t}=Y.Operations,{options:i}=e,r=["brightness","saturation","contrast","exposure","shadows","highlights","clarity"],s={};return r.forEach(o=>{if(typeof i[o]=="undefined")return;const{minValue:n,midValue:a,maxValue:l}=t.prototype.availableOptions[o];let d=i[o];d=d<0?a+(a-n)*d:a+(l-a)*d,s[o]=d}),Promise.resolve(this._editor.operations.getOrCreate("adjustments",s))}_deserializeSpriteOperation(e){const{options:t}=e,i=this._editor.operations.getOrCreate("sprite");if(!i)return Promise.resolve();const r=t.sprites.map(s=>this._deserializeSprite(i,s)).filter(s=>s);return Promise.all(r).then(s=>(i.setSprites(s.filter(o=>o)),i))}_deserializeSprite(e,t){switch(t.type){case"sticker":return this._deserializeSticker(e,t);case"text":return this._deserializeText(e,t);case"brush":return this._deserializeBrush(e,t);case"textdesign":return this._deserializeTextDesign&&this._deserializeTextDesign(e,t)}}_deserializeSticker(e,t){const{SpriteOperation:i}=Y.Operations,{options:r}=t,s=this._stickerManager.getStickerByIdentifier(r.name),o=this._stickerManager.getURLForSticker(s);return s?new Promise((n,a)=>{const l=new window.Image;l.addEventListener("load",()=>{const d=i.StickerSprite.prototype.availableOptions.adjustments.structure,{rotation:p,flipHorizontally:u,flipVertically:c}=r,m={identifier:r.name,image:l,position:Z.fromObject(r.position),dimensions:Z.fromObject(r.dimensions),rotation:p,flipHorizontally:u,flipVertically:c,adjustments:{}};typeof r.adjustments!="undefined"&&["brightness","contrast","saturation"].forEach(x=>{typeof r.adjustments[x]!="undefined"&&(m.adjustments[x]=r.adjustments[x]+d[x].default)}),n(e.createSticker(m))}),l.crossOrigin=this._editor.getCrossOrigin(),l.src=this._editor.getUI().getAssetPath(o)}):(k.warn("Deserializer",`Unknown sticker '${r.name}'. Skipping sprite.`),Promise.resolve())}_deserializeText(e,t){const{options:i}=t,{fontSize:r,lineHeight:s,fontFamily:o,fontWeight:n,alignment:a,rotation:l,maxWidth:d,color:p,backgroundColor:u}=i,c=new Zr(this._ui);let m=this._fontManager.getFontByFontFamily(o);return m||(m=this._fontManager.getDefaultFont()),c.setFonts([m]),c.load().then(()=>{const x=e.createText({fontSize:r,lineHeight:s,fontFamily:o,fontWeight:n,alignment:a,rotation:l,maxWidth:d,text:i.text,color:le.fromArray(p),backgroundColor:le.fromArray(u),position:Z.fromObject(i.position)});return x._edited=!0,x})}_deserializeBrush(e,t){const{options:i}=t,{paths:r}=i,s=e.createBrush();return r.forEach(o=>{this._deserializeBrushPath(s,o)}),Promise.resolve(s)}_deserializeBrushPath(e,t){const{points:i}=t,r=this._createBrushForPath(t),s=e.createPath(r);s.setClosed(!0),i.forEach(o=>{s.addControlPoint(Z.fromObject(o))})}_createBrushForPath(e){const{color:t,size:i}=e,r=le.fromArray(t),s={color:r,size:i},o=this._brushManager.getFirstBrush();if(o.prototype&&o.prototype instanceof oa){const l=o;return new l(s)}const n=ue.extend({},o);delete n.image;class a extends oa{}return a.identifier=o.identifier,new a(ue.extend({},n,s))}_deserializeFocusOperation(e){const{options:t}=e.options;switch(e.options.type){case"radial":{const{position:i,radius:r,gradientRadius:s,blurRadius:o}=t;return Promise.resolve(this._editor.operations.getOrCreate("radial-focus",{position:Z.fromObject(i),radius:r,gradientRadius:s,blurRadius:o}))}case"linear":{const{start:i,end:r,size:s,gradientSize:o,blurRadius:n}=t;return Promise.resolve(this._editor.operations.getOrCreate("mirrored-focus",{start:Z.fromObject(i),end:Z.fromObject(r),size:s,gradientSize:o,blurRadius:n}))}}}_getInputDimensionsForOperation(e){let t=!1,i=this._editor.getInputDimensions();return this._editor.operations.getStack().forEach(r=>{if(r===e&&(t=!0),t)return;i=r.getNewDimensions(i)}),i}}Si.version="1.0.0";const Sr=Math.PI*2;class Ti{constructor(e){this._editor=e,this._serializeOperations=this._serializeOperations.bind(this)}serialize(e={}){this._options=ue.defaults(e,{image:!0});const t={version:this.constructor.version};return this._serializeInputImage(t).then(this._serializeOperations)}_serializeInputImage(e){const t=this._editor.getImage(),{width:i,height:r}=t;if(!this._options.image)return e.inputImage={width:i,height:r},Promise.resolve(e);const s=ue.createCanvas();s.width=t.width,s.height=t.height;const o=s.getContext("2d");o.drawImage(t,0,0);const n=s.toDataURL(qn.PNG);return e.inputImage={type:qn.PNG,data:n.replace(/^data:image\/(.*?);base64,/,""),width:i,height:r},Promise.resolve(e)}_serializeOperations(e){const t=[],i=this._editor.operations.getStack();return i.forEach(r=>{const s=this._serializeOperation(r,t);s&&t.push(s)}),e.operations=t.filter(r=>r),Promise.resolve(e)}_serializeOperation(e,t){switch(e.constructor.identifier){case"transform":return this._serializeTransformOperation(e);case"orientation":return this._serializeOrientationOperation(e);case"filter":return this._serializeFilterOperation(e);case"adjustments":return this._serializeAdjustmentsOperation(e);case"sprite":return this._serializeSpriteOperation(e,t);case"radial-focus":return this._serializeRadialFocusOperation(e);case"mirrored-focus":return this._serializeLinearFocusOperation(e);default:k.warn(`Unable to serialize operation of type ${e.constructor.identifier}`)}}_serializeTransformOperation(e){const t=e.serializeOptions(["start","end","rotation"],!0);return t.rotation=(t.rotation+Sr)%Sr,{type:"crop",options:t}}_serializeOrientationOperation(e){return{type:"orientation",options:e.serializeOptions(["flipVertically","flipHorizontally","rotation"],!0)}}_serializeFilterOperation(e){return e.getIdentifier()==="identity"?null:{type:"filter",options:{intensity:e.getIntensity(),name:e.getIdentifier()}}}_serializeAdjustmentsOperation(e){const{availableOptions:t}=e,i=["brightness","saturation","contrast","exposure","shadows","highlights","clarity"],r={};return i.forEach(s=>{const o=t[s],n=e.getOption(s),{minValue:a,midValue:l,maxValue:d}=o;r[s]=n<=l?(n-a)/(l-a)-1:(n-l)/(d-l)}),{type:"adjustments",options:r}}_serializeSpriteOperation(e,t){const i=t.filter(o=>o.type==="sprite");let r,s=!0;if(i.length?(r=i.pop(),s=!1):r={type:"sprite",options:{sprites:[]}},e.getSprites().forEach(o=>{let n=null;o instanceof e.constructor.StickerSprite?n=this._serializeSticker(e,o):o instanceof e.constructor.TextSprite?n=this._serializeText(e,o):o instanceof e.constructor.BrushSprite?n=this._serializeBrush(e,o):o instanceof e.constructor.TextDesignSprite&&(n=this._serializeTextDesign&&this._serializeTextDesign(e,o)),n&&r.options.sprites.push(n)}),s)return r}_serializeSticker(e,t){const i=t.getAdjustments(),r=t.serializeOptions(["identifier","position","dimensions","flipVertically","flipHorizontally","rotation"],!0);r.name=r.identifier,delete r.identifier,r.rotation=(r.rotation+Sr)%Sr;const s=i.availableOptions;return r.adjustments={brightness:i.getBrightness()-s.brightness.default,saturation:i.getSaturation()-s.saturation.default,contrast:i.getContrast()-s.contrast.default},{type:"sticker",options:r}}_serializeText(e,t){const i=t.serializeOptions(["fontSize","lineHeight","fontFamily","fontWeight","alignment","color","backgroundColor","position","rotation","text","maxWidth"],!0);return i.rotation=(i.rotation+Sr)%Sr,{type:"text",options:i}}_serializeBrush(e,t){return{type:"brush",options:{paths:t.getPaths().map(i=>this._serializePath(i))}}}_serializePath(e){const t=e.getBrush().serializeOptions(["color","size"],!0);return t.points=e.getControlPoints().map(i=>i.getPosition().toObject()),t}_serializeRadialFocusOperation(e){return{type:"focus",options:{type:"radial",options:e.serializeOptions(["position","radius","gradientRadius","blurRadius"],!0)}}}_serializeLinearFocusOperation(e){return{type:"focus",options:{type:"linear",options:e.serializeOptions(["start","end","blurRadius","size","gradientSize"],!0)}}}_getInputDimensionsForOperation(e){let t=!1,i=this._editor.getInputDimensions();return this._editor.operations.getStack().forEach(r=>{if(r===e&&(t=!0),t)return;i=r.getNewDimensions(i)}),i}}Ti.version="1.0.0";class Ri extends Si{_deserializeOperation(e){return e.type==="selective-blur"?this._deserializeSelectiveBlurOperation(e):super._deserializeOperation(e)}_deserializeCropOperation(e){const{options:t}=e;let{rotation:i}=t;const r=Z.fromObject(t.start),s=Z.fromObject(t.end),o=t.dimensions?Z.fromObject(t.dimensions):null;if(s.x-r.x<=0||s.y-r.y<=0)throw new Error(`A crop should not result in negative or zero dimensions - start: ${r} - end: ${s}`);i>Math.PI&&(i-=Math.PI*2);const n={start:r,end:s};typeof i!="undefined"&&(n.rotation=i);const a=this._editor.operations.getOrCreate("transform");if(!a)return Promise.resolve();if(this._editor.broadcastTransform(a,n),a.set(n),o){const l=s.clone().subtract(r),d=a.getInputDimensions(!1).multiply(l);a.setTextureScale(o.x/d.x)}return Promise.resolve(a)}}Ri.version="1.0.1";const ep=Math.PI*2;class Ei extends Ti{_serializeTransformOperation(e){const t=e.serializeOptions(["start","end","rotation","textureScale"],!0);return t.rotation=(t.rotation+ep)%ep,t.textureScale!==1&&(t.dimensions=e.getNewDimensions(e.getInputDimensions(!1))),delete t.textureScale,{type:"crop",options:t}}}Ei.version="1.0.1";const{OptionType:Tr}=Y;class vo extends Y.Configurable{constructor(e,t={}){super(t);this._loaded=!1,this._loading=!1,this._ui=e,this._frame=Y.Utils.deepClone(this._options)}load(){if(this._loaded)return Promise.resolve();if(this._loading)return Promise.reject(new Error("Called Frame#load while it's already loading"));this._loading=!0;const{imageGroups:e}=this._frame,t=[];return["top","left","right","bottom"].forEach(i=>{if(!(i in e))return;const r=e[i];["start","mid","end"].forEach(s=>{if(!(s in r))return;t.push(this._loadPart(i,s))})}),Promise.all(t).then(()=>{this._loaded=!0,this._loading=!1}).catch(i=>{this._loaded=!1,this._loading=!1})}_loadPart(e,t){const{imageGroups:i}=this._frame,r=i[e][t];let s=r;return typeof r!="string"&&"image"in r&&(s=r.image),je.load(this._ui.getAssetPath(s)).then(o=>(typeof r!="string"?this._frame.imageGroups[e][t].image=o:this._frame.imageGroups[e][t]=o,o))}getFrame(){return this._frame}}vo.prototype.availableOptions={identifier:{type:Tr.STRING,required:!0},defaultName:{type:Tr.STRING},thumbnail:{type:Tr.STRING},tintable:{type:Tr.BOOLEAN,default:!1},layoutMode:{type:Tr.STRING,default:"horizontal-inside",available:["horizontal-inside","vertical-inside"]},imageGroups:{type:Tr.OBJECT,required:!0}};class na{constructor(e,t){this._ui=e,this._options=t,this._categoriesById={},this._categories=[],this._framesById={},this._addCategories(bt.DEFAULTS.FRAME_CATEGORIES),this._customAssetsAllowed=e.getEditor().getSDK()._l.areCustomAssetsAllowed();const{categories:i,replaceCategories:r}=this._options;this._customAssetsAllowed&&this._options.categories?this._addCategories(i,r):this._updateAllCategory()}_addCategories(e,t=!1){t?this._categories=e.slice(0):this._categories=ze.mergeCategories(this._categories,e,"frames"),this._categoriesById={},this._categories.forEach(r=>{this._categoriesById[r.identifier]=r});const{availableFrames:i}=this._options;this._customAssetsAllowed&&i&&this._categories.forEach(r=>{r.frames=r.frames.filter(s=>i.indexOf(s.identifier)!==-1)}),this._categories.forEach(r=>{r.frames.forEach(s=>{this._framesById[s.identifier]=s})}),this._updateAllCategory()}_updateAllCategory(){this._allCategory={identifier:"all",defaultName:"All",frames:this._categories.map(e=>e.frames).reduce((e,t)=>e.concat(t),[])},this._categoriesById.all=this._allCategory}getFramesForCategory(e){if(!this._categoriesById[e])throw new Error(`Unknown frame category '${e}'`);return this._categoriesById[e].frames}getFrameByIdentifier(e){return this._framesById[e]}getCategories(){return this._categories}getCategory(e){return this._categoriesById[e]}}class aa{constructor(e,t){this._ui=e,this._options=t,this._overlays=bt.DEFAULTS.OVERLAYS.slice(0),this._overlaysByIdentifier={};const i=e.getEditor().getSDK()._l.areCustomAssetsAllowed();i&&t.overlays&&(t.replaceOverlays?this._overlays=t.overlays:this._overlays=this._overlays.concat(t.overlays)),i&&t.availableOverlays&&(this._overlays=this._overlays.filter(r=>t.availableOverlays.indexOf(r.identifier)!==-1)),this._overlays.forEach(r=>{this._overlaysByIdentifier[r.identifier]=r})}getOverlays(){return this._overlays}getOverlayByIdentifier(e){return this._overlaysByIdentifier[e]}}const{OverlayFilter:It}=Y.Engine.Filters;var Rr={[It.BLEND_MODES.NORMAL]:"normal",[It.BLEND_MODES.OVERLAY]:"overlay",[It.BLEND_MODES.HARD_LIGHT]:"hard light",[It.BLEND_MODES.SOFT_LIGHT]:"soft light",[It.BLEND_MODES.MULTIPLY]:"multiply",[It.BLEND_MODES.DARKEN]:"darken",[It.BLEND_MODES.LIGHTEN]:"lighten",[It.BLEND_MODES.SCREEN]:"screen",[It.BLEND_MODES.COLOR_BURN]:"color burn"};const Jg=ue.flipObject(Rr);class Oi extends Ri{constructor(...e){super(...e);this._frameManager=new na(this._ui,this._getOptions("frame"));const t=this._getOptions("overlay");t&&(this._overlayManager=new aa(this._ui,t))}_deserializeSprite(e,t){return t.type==="frame"?this._deserializeFrame(e,t):t.type==="overlay"?this._deserializeOverlay(e,t):super._deserializeSprite(e,t)}_deserializeOperation(e){return e.type==="transform"?this._deserializeTransformOperation(e):super._deserializeOperation(e)}_deserializeOrientationOperation(e){if(this._data.meta&&this._data.meta.platform!=="html5")return super._deserializeOrientationOperation(e);const{rotation:t,flipHorizontally:i,flipVertically:r}=e.options;let s=t===90&&!i&&!r;return s|=t===90&&i&&r,s|=t===270&&!i&&!r,s|=t===270&&i&&r,s&&(e.options.flipHorizontally=!e.options.flipHorizontally,e.options.flipVertically=!e.options.flipVertically),super._deserializeOrientationOperation(e)}_deserializeTransformOperation(e){return super._deserializeCropOperation(e).then(t=>{if(!t)return;const i=ue.Array.find(this._data.operations,r=>r.type==="orientation");if(i){const{options:r}=i;let{rotation:s,flipHorizontally:o,flipVertically:n}=r;(s===90||s===270)&&((!o&&n||o&&!n)&&(o=!o,n=!n)),t.rotate(r.rotation),o&&(t.flip("horizontal"),t.setRotation(t.getRotation()*-1)),n&&(t.flip("vertical"),t.setRotation(t.getRotation()*-1))}return t})}_deserializeFrame(e,t){const{identifier:i}=t.options,r=this._frameManager.getFrameByIdentifier(i);if(!r)return k.warn("Deserializer",`Unknown frame \`${i}\`. Skipping frame.`),Promise.resolve();const s=new vo(this._ui,r);return s.load().then(()=>{this._editor.operations.getOrCreate("frame",{frame:s.getFrame()})})}_deserializeOverlay(e,t){const{blendMode:i,intensity:r,identifier:s}=t.options,o=this._overlayManager.getOverlayByIdentifier(s);if(!o)return k.warn("Deserializer",`Unknown overlay \`${s}\`. Skipping overlay.`),Promise.resolve();const n=this._editor.getUI().getAssetPath(o.image);return je.load(n).then(a=>{this._editor.operations.getOrCreate("overlay",{alpha:r,identifier:s,blendMode:parseInt(Jg[i||o.blendMode],10),image:a})})}_createBrushForPath(e){const t=super._createBrushForPath(e);return typeof e.hardness!="undefined"&&t.hasOption("hardness")&&t.setHardness(e.hardness),t}_deserializeSticker(e,t){const{SpriteOperation:i}=Y.Operations,{options:r}=t,s=this._stickerManager.getStickerByIdentifier(r.identifier),o=fi.getURLForSticker(s,"base");if(!s)return k.warn("Deserializer",`Unknown sticker \`${r.identifier}\`. Skipping sprite.`),Promise.resolve();const n=e.getInputDimensions(!1);return new Promise((a,l)=>{const d=new window.Image;d.addEventListener("load",()=>{const p=i.StickerSprite.prototype.availableOptions.adjustments.structure,{rotation:u,flipHorizontally:c,flipVertically:m}=r,x={identifier:r.identifier,image:d,position:Z.fromObject(r.position),dimensions:Z.fromObject(r.dimensions).multiply(n.min()),rotation:u,flipHorizontally:c,flipVertically:m,adjustments:{}};typeof r.adjustments!="undefined"&&["brightness","contrast","saturation"].forEach(_=>{typeof r.adjustments[_]!="undefined"&&(x.adjustments[_]=r.adjustments[_]+p[_].default)}),typeof r.tintColor!="undefined"&&typeof s.tintMode!="undefined"&&(x.tintColor=le.fromArray(r.tintColor),x.tintMode=s.tintMode),a(e.createSticker(x))}),d.crossOrigin=this._editor.getCrossOrigin(),d.src=this._editor.getUI().getAssetPath(o)})}_deserializeFilterOperation(e){const{options:t}=e;return this._filterManager.getFilterByIdentifier(t.identifier)?this._filterManager.instantiateFilterWithIdentifier(t.identifier).then(i=>{const r=this._editor.operations.getOrCreate("filter");return r?(r.set({identifier:t.identifier,filter:i,intensity:t.intensity}),r):void 0}):(k.warn("Deserializer",`Unknown filter \`${t.identifier}\``),Promise.resolve())}_deserializeFocusOperation(e){const{options:t,type:i}=e.options;if(i!=="radial")return super._deserializeFocusOperation(e);const r=this._editor.getImage(),s=r.width/r.height,{start:o,end:n,gradientRadius:a,blurRadius:l}=t,d=Z.fromObject(n).subtract(Z.fromObject(o)).multiply(s,1).len();return Promise.resolve(this._editor.operations.getOrCreate("radial-focus",{position:Z.fromObject(o),radius:d,gradientRadius:a,blurRadius:l}))}_deserializeText(e,t){const{options:i}=t,{fontSize:r,lineHeight:s,fontIdentifier:o,alignment:n,rotation:a,maxWidth:l,color:d,backgroundColor:p}=i,u=new Zr(this._ui);let c=this._fontManager.getVariationByIdentifier(o);return c?u.setFonts([c.getFont()]):c=this._fontManager.getDefaultFont(),u.load().then(()=>{const m=e.getInputDimensions(!1),x=l*m.min()/m.x,_=e.createText({fontSize:r,lineHeight:s,fontFamily:c.getFontFamily(),fontWeight:c.getFontWeight(),fontIdentifier:c.getIdentifier(),alignment:n,rotation:a,maxWidth:x,text:i.text,color:le.fromArray(d),backgroundColor:le.fromArray(p),position:Z.fromObject(i.position)});return _._edited=!0,_})}}Oi.version="2.0.0";class Ci extends Ei{_serializeSticker(e,t){const i=e.getInputDimensions(!1),r=super._serializeSticker(e,t);return t.getTintMode()!=="none"&&(r.options.tintColor=t.serializeOption("tintColor",!0)),r.options.dimensions=t.getDimensions().clone().divide(i.min()).toObject(),r.options.identifier=r.options.name,delete r.options.name,r}_serializePath(e){const t=super._serializePath(e),i=e.getBrush();return i.hasOption("hardness")&&(t.hardness=i.getOption("hardness")),t}_serializeOperation(e,t){return e.constructor.identifier==="frame"?(this._serializeFrameOperation(e,t),null):e.constructor.identifier==="overlay"?(this._serializeOverlayOperation(e,t),null):super._serializeOperation(e,t)}_serializeFrameOperation(e,t){const i=t.filter(s=>s.type==="sprite");let r;i.length?r=i.pop():(r={type:"sprite",options:{sprites:[]}},t.push(r)),r.options.sprites.push({type:"frame",options:this._getFrameOptions(e)})}_serializeOverlayOperation(e,t){if(!e.getIdentifier())return;const i=t.filter(s=>s.type==="sprite");let r;i.length?r=i.pop():(r={type:"sprite",options:{sprites:[]}},t.push(r)),r.options.sprites.push({type:"overlay",options:{identifier:e.getIdentifier(),intensity:e.getAlpha(),blendMode:Rr[e.getBlendMode()]}})}_getFrameOptions(e){return{identifier:e.getFrame().identifier}}_serializeOrientationOperation(e){const t=super._serializeOrientationOperation(e);return(t.options.rotation===90||t.options.rotation===270)&&(t.options.flipHorizontally=!t.options.flipHorizontally,t.options.flipVertically=!t.options.flipVertically),t}_serializeTransformOperation(e){const{operations:t}=this._editor;if(t.exists("orientation")){e=e.clone();const r=t.get("orientation");e.rotate(-r.getRotation()),r.getFlipVertically()&&(e.flip("vertical"),e.setRotation(e.getRotation()*-1)),r.getFlipHorizontally()&&(e.flip("horizontal"),e.setRotation(e.getRotation()*-1))}const i=super._serializeTransformOperation(e);return i.type="transform",i}_serializeText(e,t){const i=super._serializeText(e,t),r=e.getInputDimensions(!1);return i.options.fontIdentifier=t.getFontIdentifier(),i.options.maxWidth=i.options.maxWidth*r.x/r.min(),delete i.options.fontFamily,i}_serializeFilterOperation(e){const t=super._serializeFilterOperation(e);return t?(t.options.identifier=t.options.name,delete t.options.name,t):null}_serializeRadialFocusOperation(e){const t=super._serializeRadialFocusOperation(e),i=t.options.options;return i.start=i.position,delete i.position,i.end={x:i.start.x+i.radius,y:i.start.y},delete i.radius,t}}Ci.version="2.0.0";class Bt{constructor(e,t={}){this._ui=e,this._options=t,this._defaultLayouts=Y.Operations.SpriteOperation.TextDesignSprite.Layouts,this._legacyLayouts=Y.Operations.SpriteOperation.TextDesignSprite.LegacyLayouts,this._layouts=[],this._init()}_init(){const{availableLayouts:e}=this._options,t=R(R({},this._defaultLayouts),this._legacyLayouts);this._layouts=Object.keys(t).map(i=>({identifier:t[i].identifier,layout:t[i]})),e&&(e.push(...Object.values(this._legacyLayouts).map(i=>i.identifier)),this._layouts=this._layouts.filter(i=>e.indexOf(i.identifier)>=0))}getLayoutByIdentifier(e){const t=ue.Array.find(this._layouts,i=>i.identifier===e);return t&&t.layout}getLayouts(){return[...this._layouts]}getDefaultLayout(){return this.getLayouts()[0]}}let la;typeof Y.Operations.SpriteOperation!="undefined"&&(la=Y.Operations.SpriteOperation.BrushSprite.Brush);class ki extends Oi{_deserializeSticker(e,t){const{SpriteOperation:i}=Y.Operations,{options:r}=t,s=this._stickerManager.getStickerByIdentifier(r.identifier);if(!s)return k.warn("Deserializer",`Unknown sticker \`${r.identifier}\`. Skipping sprite.`),Promise.resolve();const{mediaBase:o}=s.images,n=fi.getURLForSticker(s,"base"),a=o.rawData?o.uris[0]:this._editor.getUI().getAssetPath(n),l=e.getInputDimensions(!1);return je.load(a).then(d=>{const p=i.StickerSprite.prototype.availableOptions.adjustments.structure,{rotation:u,flipHorizontally:c,flipVertically:m}=r,x={identifier:r.identifier,image:d,position:Z.fromObject(r.position),dimensions:Z.fromObject(r.dimensions).multiply(l.min()),rotation:u||0,flipHorizontally:c,flipVertically:m,resizeMode:s.resizeMode||"keepAspect",adjustments:{}};return typeof r.adjustments!="undefined"&&["brightness","contrast","saturation"].forEach(_=>{typeof r.adjustments[_]!="undefined"&&(x.adjustments[_]=r.adjustments[_]+p[_].default)}),typeof r.tintMode!="undefined"&&typeof r.tintColor!="undefined"?(x.tintColor=le.fromArray(r.tintColor.rgba),x.tintMode=r.tintMode):typeof r.tintColor!="undefined"&&typeof s.tintMode!="undefined"&&(x.tintColor=le.fromArray(r.tintColor.rgba),x.tintMode=s.tintMode),typeof r.alpha!="undefined"&&(x.alpha=r.alpha),e.createSticker(x)})}_deserializeTransformOperation(e){return super._deserializeTransformOperation(e).then(t=>t?(t._ratio=null,t):void 0)}_deserializeInputImage(){let{data:e,type:t,uri:i}=this._data.image;return e&&t&&(i=`data:${t};base64,${e}`),i?je.load(i).then(r=>{this._editor.setImage(r)}):Promise.resolve()}_deserializeAdjustmentsOperation(e){const{AdjustmentsOperation:t}=Y.Operations;return super._deserializeAdjustmentsOperation(e).then(i=>{if(!i)return null;const{options:r}=e,s=["gamma","whites","blacks","temperature"],o={};return s.forEach(n=>{if(typeof r[n]=="undefined")return;const{minValue:a,midValue:l,maxValue:d}=t.prototype.availableOptions[n];let p=r[n];p=p<0?l+(l-a)*p:l+(d-l)*p,o[n]=p}),i.set(o),i})}_deserializeFocusOperation(e){const{options:t}=e.options;switch(e.options.type){case"radial":return super._deserializeFocusOperation(e);case"linear":{const{start:i,end:r,blurRadius:s}=t;return Promise.resolve(this._editor.operations.getOrCreate("linear-focus",{controlPoint1:Z.fromObject(i),controlPoint2:Z.fromObject(r),blurRadius:s}))}case"mirrored":{const{start:i,end:r,size:s,gradientSize:o,blurRadius:n}=t;return Promise.resolve(this._editor.operations.getOrCreate("mirrored-focus",{start:Z.fromObject(i),end:Z.fromObject(r),size:s,gradientSize:o,blurRadius:n}))}case"gaussian":{const{blurRadius:i}=t;return Promise.resolve(this._editor.operations.getOrCreate("blur",{blurRadius:i}))}}}_deserializeText(e,t){const{options:i}=t,{fontSize:r,lineHeight:s,fontIdentifier:o,alignment:n,rotation:a,maxWidth:l,color:d,backgroundColor:p}=i,u=this._ui.getFontLoader();let c=this._fontManager.getVariationByIdentifier(o);return c?u.setFonts([c.getFont()]):c=this._fontManager.getDefaultVariation(),u.load().then(()=>{const m=e.getInputDimensions(!1),x=l*m.min()/m.x,_=e.createText({fontSize:r,lineHeight:s,fontFamily:c.getFontFamily(),fontWeight:c.getFontWeight(),fontIdentifier:c.getIdentifier(),textMetrics:c.getTextMetrics(),alignment:n,rotation:a,maxWidth:x,text:i.text,color:le.fromArray(d.rgba),backgroundColor:le.fromArray(p.rgba),position:Z.fromObject(i.position)});return _._edited=!0,_})}_createBrushForPath(e){const{identifier:t,color:i,size:r,hardness:s}=e.brush,o=le.fromArray(i.rgba),n={color:o,size:r};typeof s!="undefined"&&(n.hardness=s);let a=this._brushManager.getBrushByIdentifier(t);if(a||(a=this._brushManager.getFirstBrush()),a.prototype&&a.prototype instanceof la){const p=a;return new p(n)}const l=ue.extend({},a);delete l.image;class d extends la{}return d.identifier=a.identifier,new d(ue.extend({},l,n))}_deserializeFrame(e,t){return super._deserializeFrame(e,t).then(()=>{const i=this._editor.operations.get("frame"),{size:r,alpha:s,tintColor:o}=t.options,n={};typeof r!="undefined"&&(n.scale=r),typeof s!="undefined"&&(n.alpha=s),typeof o!="undefined"&&(n.tintColor=le.fromArray(o.rgba)),i.set(n)})}_deserializeTextDesign(e,t){const{options:i}=t,{position:r,rotation:s,flipHorizontally:o,flipVertically:n,text:a,color:l,width:d,seed:p,inverted:u}=i;let{identifier:c}=i;c===Y.Operations.SpriteOperation.TextDesignSprite.Layouts.TextDesignBlocksLight.identifier?c=Y.Operations.SpriteOperation.TextDesignSprite.LegacyLayouts.TextDesignBlocksLightV310.identifier:c===Y.Operations.SpriteOperation.TextDesignSprite.Layouts.TextDesignSunshine.identifier&&(c=Y.Operations.SpriteOperation.TextDesignSprite.LegacyLayouts.TextDesignSunshineV310.identifier);const m=new Bt(this._ui,this._getOptions("textdesign")),x=new it(this._ui,{fonts:Oe.DEFAULTS.TEXT_DESIGN_FONTS,replaceFonts:!0}),{AssetManager:_}=e.constructor.TextDesignSprite,f=this._ui.getFontLoader(),y=m.getLayoutByIdentifier(c),b=new y;return f.setFonts(x.getFonts()),_.setFonts(R(R({},_.getFonts()),x.getVariationsByIdentifier())),f.load().then(()=>{const g=b.getImagePaths().map(E=>({path:E,fullPath:this._ui.getAssetPath(E),image:null}));return _.loadImages(g).then(()=>(b.onImagesLoaded(),e.createTextDesign({position:r,rotation:s,flipHorizontally:o,flipVertically:n,text:a,color:le.fromArray(l.rgba),width:d,seed:p,inverted:u,layout:b})))})}}ki.version="3.0.0";class Er extends G{}Er.prototype.availableOptions={identifier:{type:h.STRING,required:!0},defaultName:{type:h.STRING,required:!0},ratio:{type:h.ALL,required:!1,default:null},selected:{type:h.BOOLEAN,required:!1},dimensions:{type:h.VECTOR2,required:!1},lockDimensions:{type:h.BOOLEAN,required:!1,default:null},forceDimensions:{type:h.BOOLEAN,required:!1,default:null}};class Di extends Ci{serialize(e={}){return super.serialize(e).then(t=>(t.meta={platform:"html5",version:this._editor.getSDK().version,createdAt:ue.ISODateString(new Date)},t.image=t.inputImage,delete t.inputImage,t))}_serializeSticker(e,t){const i=super._serializeSticker(e,t);return i.options.alpha=t.getAlpha(),i.options.tintColor&&(i.options.tintColor={rgba:i.options.tintColor}),i}_serializeText(e,t){const i=super._serializeText(e,t);return i.options.color={rgba:i.options.color},i.options.backgroundColor={rgba:i.options.backgroundColor},i.options.flipHorizontally=!1,i.options.flipVertically=!1,delete i.options.fontWeight,i}_serializePath(e){const t=super._serializePath(e);delete t.hardness,delete t.size,delete t.color;const i=e.getBrush();t.brush=i.serializeOptions(["identifier","size","color"],!0),typeof t.brush.identifier=="undefined"&&delete t.brush.identifier,t.brush.color={rgba:t.brush.color};const r=i.getOption("hardness");return r!=="undefined"&&(t.brush.hardness=r),t}_serializeFrameOperation(e,t){super._serializeFrameOperation(e,t);const i=t.filter(s=>s.type==="sprite");let r;if(i.length){r=i.pop();const s=r.options.sprites.filter(a=>a.type==="frame")[0],o=e.getTintColor();o.equals(new le(1,1,1,0))||(s.options.tintColor={rgba:e.serializeOption("tintColor",!0)});const n=e.serializeOptions(["scale","alpha"],!0);s.options=ue.extend(s.options,n),s.options.size=s.options.scale,delete s.options.scale}}_serializeTransformOperation(e){const t=super._serializeTransformOperation(e);if(e._ratio){let i;e._ratio instanceof Er?i=e._ratio.getIdentifier():i=e._ratio.identifier,t.options.meta={identifier:i}}return delete t.options.scale,t}_serializeAdjustmentsOperation(e){const t=super._serializeAdjustmentsOperation(e),i=["gamma","whites","blacks","temperature"],{availableOptions:r}=e,s={};return i.forEach(o=>{const n=r[o],a=e.getOption(o),{minValue:l,midValue:d,maxValue:p}=n;s[o]=a<=d?(a-l)/(d-l)-1:(a-d)/(p-d)}),t.options=R(R({},t.options),s),t}_serializeOperation(e,t){switch(e.constructor.identifier){case"mirrored-focus":return this._serializeMirroredFocusOperation(e);case"linear-focus":return this._serializeLinearFocusOperation(e);case"blur":return this._serializeBlurOperation(e);default:return super._serializeOperation(e,t)}}_serializeMirroredFocusOperation(e){return{type:"focus",options:{type:"mirrored",options:e.serializeOptions(["start","end","blurRadius","size","gradientSize"],!0)}}}_serializeLinearFocusOperation(e){const t=e.serializeOptions(["controlPoint1","controlPoint2","blurRadius"],!0);return t.start=t.controlPoint1,delete t.controlPoint1,t.end=t.controlPoint2,delete t.controlPoint2,{type:"focus",options:{type:"linear",options:t}}}_serializeBlurOperation(e){return{type:"focus",options:{type:"gaussian",options:e.serializeOptions(["blurRadius"],!0)}}}}Di.version="3.0.0";class Pi extends ki{_deserializeTextDesign(e,t){const{options:i}=t,{position:r,rotation:s,flipHorizontally:o,flipVertically:n,text:a,color:l,width:d,seed:p,inverted:u}=i;let{identifier:c}=i;c===Y.Operations.SpriteOperation.TextDesignSprite.Layouts.TextDesignBlocksLight.identifier?c=Y.Operations.SpriteOperation.TextDesignSprite.LegacyLayouts.TextDesignBlocksLightV310.identifier:c===Y.Operations.SpriteOperation.TextDesignSprite.Layouts.TextDesignSunshine.identifier&&(c=Y.Operations.SpriteOperation.TextDesignSprite.LegacyLayouts.TextDesignSunshineV310.identifier);const m=new Bt(this._ui,this._getOptions("textdesign")),x=new it(this._ui,{fonts:Oe.DEFAULTS.TEXT_DESIGN_FONTS,replaceFonts:!0}),{AssetManager:_}=e.constructor.TextDesignSprite,f=this._ui.getFontLoader(),y=m.getLayoutByIdentifier(c),b=new y;return f.setFonts(x.getFonts()),_.setFonts(R(R({},_.getFonts()),x.getVariationsByIdentifier())),f.load().then(()=>{const g=b.getImagePaths().map(E=>({path:E,fullPath:this._ui.getAssetPath(E),image:null}));return _.loadImages(g).then(()=>(b.onImagesLoaded(),e.createTextDesign({position:r,rotation:s,flipHorizontally:o,flipVertically:n,text:a,color:le.fromArray(l.rgba),width:d,seed:p,inverted:u,layout:b})))})}}Pi.version="3.1.0";class Fi extends Di{_serializeTextDesign(e,t){const i=t.serializeOptions(["position","rotation","flipHorizontally","flipVertically","text","color","width","seed","inverted"],!0);i.color={rgba:i.color};const r=t.getLayout();return r&&(i.identifier=r.constructor.identifier),{type:"textdesign",options:i}}}Fi.version="3.1.0";class Ai extends Pi{_deserializeTextDesign(e,t){const{options:i}=t,{position:r,rotation:s,flipHorizontally:o,flipVertically:n,text:a,color:l,width:d,seed:p,inverted:u}=i;let{identifier:c}=i;c===Y.Operations.SpriteOperation.TextDesignSprite.Layouts.TextDesignBlocksLight.identifier?c=Y.Operations.SpriteOperation.TextDesignSprite.LegacyLayouts.TextDesignBlocksLightV310.identifier:c===Y.Operations.SpriteOperation.TextDesignSprite.Layouts.TextDesignSunshine.identifier&&(c=Y.Operations.SpriteOperation.TextDesignSprite.LegacyLayouts.TextDesignSunshineV310.identifier);const m="padding"in i?i.padding/d:-1,x=new Bt(this._ui,this._getOptions("textdesign")),_=new it(this._ui,{fonts:Oe.DEFAULTS.TEXT_DESIGN_FONTS,replaceFonts:!0}),{AssetManager:f}=e.constructor.TextDesignSprite,y=this._ui.getFontLoader(),b=x.getLayoutByIdentifier(c),g=new b;return y.setFonts(_.getFonts()),f.setFonts(R(R({},f.getFonts()),_.getVariationsByIdentifier())),y.load().then(()=>{const E=g.getImagePaths().map(v=>({path:v,fullPath:this._ui.getAssetPath(v),image:null}));return f.loadImages(E).then(()=>(g.onImagesLoaded(),e.createTextDesign({position:r,rotation:s,flipHorizontally:o,flipVertically:n,text:a,color:le.fromArray(l.rgba),width:d,seed:p,inverted:u,layout:g,padding:m})))})}}Ai.version="3.2.0";class Ii extends Fi{_serializeTextDesign(e,t){const i=t.serializeOptions(["position","rotation","flipHorizontally","flipVertically","text","color","width","seed","inverted","padding"],!0);i.color={rgba:i.color};const r=t.getLayout();return r&&(i.identifier=r.constructor.identifier),i.padding*=i.width,{type:"textdesign",options:i}}}Ii.version="3.2.0";class Bi extends Ai{_deserializeOperation(e){return super._deserializeOperation(e)}_deserializeOrientationOperation(e){const{options:t}=e,i=this._editor.operations.getOrCreate("orientation");return i?(i.set(t),Promise.resolve(i)):Promise.resolve()}}Bi.version="3.4.0";class Mi extends Ii{_serializeOperation(e,t){switch(e.constructor.identifier){case"artfilter":return this._serializeStyle(e);default:return super._serializeOperation(e,t)}}_serializeOrientationOperation(e){return{type:"orientation",options:e.serializeOptions(["flipVertically","flipHorizontally","rotation"],!0)}}_serializeStyle(e){const{identifier:t,intensity:i,blendMode:r}=e.getOptions(),{tileEdgeLength:s,overlappingFactor:o}=e.getStyleTransferModel().getOptions();return{type:"artFilter",options:{identifier:t,intensity:i,blendMode:Rr[r],tileEdgeLength:s,overlappingFactor:o}}}}Mi.version="3.4.0";class Li extends Bi{_deserializeTextDesign(e,t){const{options:i}=t,{position:r,rotation:s,flipHorizontally:o,flipVertically:n,text:a,color:l,width:d,seed:p,inverted:u,identifier:c}=i,m="padding"in i?i.padding/d:-1,x=new Bt(this._ui,this._getOptions("textdesign")),_=new it(this._ui,{fonts:Oe.DEFAULTS.TEXT_DESIGN_FONTS,replaceFonts:!0}),{AssetManager:f}=e.constructor.TextDesignSprite,y=this._ui.getFontLoader(),b=x.getLayoutByIdentifier(c),g=new b;return y.setFonts(_.getFonts()),f.setFonts(R(R({},f.getFonts()),_.getVariationsByIdentifier())),y.load().then(()=>{const E=g.getImagePaths().map(v=>({path:v,fullPath:this._ui.getAssetPath(v),image:null}));return f.loadImages(E).then(()=>(g.onImagesLoaded(),e.createTextDesign({position:r,rotation:s,flipHorizontally:o,flipVertically:n,text:a,color:le.fromArray(l.rgba),width:d,seed:p,inverted:u,layout:g,padding:m})))})}}Li.version="3.5.0";class Ni extends Mi{}Ni.version="3.5.0";class zi extends Li{_deserializeAdjustmentsOperation(e){const{AdjustmentsOperation:t}=Y.Operations;return super._deserializeAdjustmentsOperation(e).then(i=>{if(!i)return null;const{options:r}=e,s="sharpness",o={};if(typeof r[s]=="undefined")return;const{minValue:n,midValue:a,maxValue:l}=t.prototype.availableOptions[s];let d=r[s];return d=d<0?a+(a-n)*d:a+(l-a)*d,o[s]=d,i.set(o),i})}}zi.version="3.6.0";class Gi extends Ni{_serializeAdjustmentsOperation(e){const t=super._serializeAdjustmentsOperation(e),i="sharpness",{availableOptions:r}=e,s={},o=r[i],n=e.getOption(i),{minValue:a,midValue:l,maxValue:d}=o;return s[i]=n<=l?(n-a)/(l-a)-1:(n-l)/(d-l),t.options=R(R({},t.options),s),t}}Gi.version="3.6.0";class Ui extends zi{deserialize(){return this._validateVersion().then(()=>this._deserializeAssetLibrary()).then(()=>this._deserializeInputImage()).then(()=>this._deserializeOperations())}_deserializeAssetLibrary(){return new Promise((e,t)=>{const i=this._data;if(!i.assetLibrary){e();return}const{assets:r}=i.assetLibrary,s=[];for(const o in r)s.push(this._deserializeCustomAssets(o,r[o]));return Promise.all(s).then(()=>{e()}).catch(o=>{console.error(o),t(o)})})}_deserializeCustomAssets(e,t){switch(e){case"stickers":return this._deserializeCustomStickerAssets(t);default:return Promise.reject(new Error(`Unknown asset type: ${e}`))}}_deserializeCustomStickerAssets(e){let t="none";const i=this._editor.getOptions().editor;i&&i.controlsOptions&&i.controlsOptions.sticker&&(t=i.controlsOptions.sticker.customStickerTintMode||"none");const r=e.map(s=>new Promise((o,n)=>{const{identifier:a,raster:l}=s,d=s.svg!==void 0;let p=`data:${l.type};base64,${l.data}`,u=new Se;u.onload=()=>{const c=this._editor.getSDK();u=c.correctExifOrientation(u),u.toDataURL&&(p=u.toDataURL());let m={data:"",width:1,height:1};process.env.REACT_APP_BROWSER&&(m=this._stickerManager.renderStickerThumbnailFromImage(u));const x={identifier:a,defaultName:s.name||"",tintMode:t,images:{mediaBase:{uris:[p],rawData:!0,isSVG:d,width:u.width,height:u.height},mediaThumb:{uris:[m.data],rawData:!0,width:m.width,height:m.height}}};if(d){const _=`data:image/svg+xml;base64,${s.svg.data}`;x.images.mediaBase.uris.push(_)}o(x)},u.onerror=()=>{n(new Error(`Invalid base64 data: ${p}`))},u.src=p}));return Promise.all(r).then(s=>{const o=this._editor.getDynamicAssetsLibrary();o.setAssets("sticker",s),this._stickerManager.reload()})}}Ui.version="3.7.0";class Ki extends Gi{serialize(e={}){return super.serialize(e).then(t=>this._serializeAssetLibrary(t).then(i=>i))}_serializeAssetLibrary(e){if(!this._editor.getDynamicAssetsLibrary)return Promise.resolve(e);const t=this._editor.getDynamicAssetsLibrary(),i=this._serializeCustomStickerAssets(e,t);return i.length===0||(e.assetLibrary={assets:{stickers:i}}),Promise.resolve(e)}_serializeCustomStickerAssets(e,t){const i=t.getAssets("sticker");if(i.length===0)return[];const r=e.operations.filter(n=>n.type==="sprite").flatMap(n=>n.options.sprites).filter(n=>n.type==="sticker").map(n=>n.options.identifier),s={};r.forEach(n=>{s[n]=!0});const o=i.filter(n=>s[n.identifier]);return o.map(n=>{const{identifier:a,defaultName:l,images:d}=n,p=d.mediaBase.uris[0],{isSVG:u}=d.mediaBase,c=/^data:(image\/(jpeg|png));base64,(.*)$/g,m=c.exec(p),x=m[1],_=m[3],f={identifier:a,name:l,raster:{type:x,data:_}};return l&&(f.name=l),u&&(f.svg={data:d.mediaBase.uris[1].replace(/^data:image\/svg\+xml;base64,/g,"")}),f})}}Ki.version="3.7.0";class ji extends Ui{}ji.version="3.8.0";class Wi extends Ki{_serializeSticker(e,t){const i=super._serializeSticker(e,t);return i.options.tintMode=t.getTintMode(),i}}Wi.version="3.8.0";class ss extends ji{_deserializeTransformOperation(e){return super._deserializeCropOperation(e).then(t=>{if(!t)return;const i=ue.Array.find(this._data.operations,r=>r.type==="orientation");if(i){const{options:r}=i;t.rotate(r.rotation),r.flipHorizontally&&(t.flip("horizontal"),t.setRotation(t.getRotation()*-1)),r.flipVertically&&(t.flip("vertical"),t.setRotation(t.getRotation()*-1))}return t._ratio=null,t})}_deserializeText(e,t){const{options:i}=t,{fontSize:r,lineHeight:s,fontIdentifier:o,alignment:n,rotation:a,maxWidth:l,color:d,backgroundColor:p}=i,u=this._ui.getFontLoader();let c=this._fontManager.getVariationByIdentifier(o);return c?u.setFonts([c.getFont()]):c=this._fontManager.getDefaultVariation(),u.load().then(()=>{const m=e.getInputDimensions(!1),x=m.min(),_=m.x,f=m.y,y=l*x/_,b=r*x/f,g=e.createText({fontSize:b,lineHeight:s,fontFamily:c.getFontFamily(),fontWeight:c.getFontWeight(),fontIdentifier:c.getIdentifier(),textMetrics:c.getTextMetrics(),alignment:n,rotation:a,maxWidth:y,text:i.text,color:le.fromArray(d.rgba),backgroundColor:le.fromArray(p.rgba),position:Z.fromObject(i.position)});return g._edited=!0,g})}}ss.version="3.9.0";const tp=Math.PI*2;class os extends Wi{_serializeTransformOperation(e){const{operations:t}=this._editor;if(t.exists("orientation")){e=e.clone();const s=t.get("orientation");s.getFlipVertically()&&(e.flip("vertical"),e.setRotation(e.getRotation()*-1)),s.getFlipHorizontally()&&(e.flip("horizontal"),e.setRotation(e.getRotation()*-1)),e.rotate(-s.getRotation())}const i=e.serializeOptions(["start","end","rotation","textureScale"],!0);i.rotation=(i.rotation+tp)%tp,i.textureScale!==1&&(i.dimensions=e.getNewDimensions(e.getInputDimensions(!1))),delete i.textureScale;const r={type:"transform",options:i};if(e._ratio){let s;e._ratio instanceof Er?s=e._ratio.getIdentifier():s=e._ratio.identifier,r.options.meta={identifier:s}}return delete r.options.scale,r}_serializeText(e,t){const i=e.getInputDimensions(!1),r=super._serializeText(e,t);return r.options.fontSize=r.options.fontSize*i.y/i.min(),r}}os.version="3.9.0";class $g extends Zc{constructor(e,t,i,r=!1){super();this._ui=e,this._options=t,this._mediator=i,this._shallow=r,this._initFonts(),r||(this._initSDK(),this.operations=new Jn(this,this._sdk,this._mediator),this._initSerializers()),this._dynamicAssetsLibrary=new fo}_initFonts(){const e=Xr.defaults(this._options.editor.controlsOptions.text,{additionalFonts:[],replaceFonts:!1,availableVariations:null});this._fontManager=new it(this._ui,e);const t=this._fontManager.getFonts(),i=this._ui.getFontLoader();i.setFonts(t),i.load()}setImage(e=this._options.editor.image,t=!0){t&&this.reset();let i=null;i=this._sdk.parseExif(e),this._setImage(e,i),this._initWatermark()}_initWatermark(){this._options.editor.watermarkImage&&(this._watermarkOperation=this.operations.getOrCreate("watermark",{image:this._options.editor.watermarkImage}))}_initSDK(){const{logLevel:e,displayWelcomeMessage:t,debug:i,license:r,crossOrigin:s}=this._options,{smoothDownscaling:o,smoothUpscaling:n,preferredRenderer:a,pixelRatio:l,transparent:d,clearColor:p}=this._options.editor;let u;Array.isArray(p)?u=yo.fromArray(p):typeof p=="string"?u=yo.fromHex(p):p instanceof yo&&(u=p.clone());const c={logLevel:e,debug:i,displayWelcomeMessage:t,pixelRatio:l,smoothDownscaling:o,smoothUpscaling:n,transparent:d,crossOrigin:s,clearColor:u,license:r};this._sdk=new Zn(a,c)}getMaxMegapixels(){const{maxMegaPixels:e}=this._options.editor;return e}getCrossOrigin(){return Xr.getCrossOriginValue(this._options.crossOrigin||"anonymous")}getOutputDimensions(e=!1){return this._sdk.getOutputDimensions(e)}getOutputTextureDimensions(e=!1){return this._sdk.getOutputTextureDimensions(e)}getFinalDimensions(e=!1){return this._sdk.getFinalDimensions(e)}_setImage(e=this._options.editor.image,t=null){this._sdk.setAllOperationsToDirty(),this._options.editor.image=e,this._sdk.setImage(e,t)}_ensureImageIsResized(){const e=this._sdk.getImage(),t=this._sdk.getRenderer(),i=this.getMaxMegapixels(),r=i?i*1e6:null,s=t.getMaxDimensions(),o=new $n(e,r,s);return!this._resizedImage&&o.needsResize()?o.resize().then(({canvas:n,dimensions:a,reason:l})=>(this._resizedImage=n,this._sdk.setImage(n),n)):wr.resolve(e)}export(e=!1,t={}){return this._watermarkOperation&&this._watermarkOperation.setEnabled(!1),this._sdk.setAllOperationsToDirty(),this._ensureImageIsResized().then(i=>{const r=R(R({},this._options.editor.export),t),s=new Yn(this._sdk,r,!1);return s.export().then(o=>(this.emit("export",o),this._mediator.emit(mi.EVENTS.EXPORT,o,this),this._watermarkOperation&&(this._watermarkOperation.setEnabled(!0),this._sdk.render()),this._sdk.setAllOperationsToDirty(),o))})}broadcastTransform(e,t){const i=new Zn.Operations.TransformOperation.TransformChange(e,t),r=["sprite","selective-blur","radial-focus","mirrored-focus","linear-focus","blur"];r.forEach(s=>{const o=this.operations.get(s);if(!o)return;o.transform(i)})}broadcastFlip(e){const t=["mirrored-focus","radial-focus","linear-focus","sprite","selective-blur"];t.forEach(i=>{const r=this.operations.get(i);if(!r)return;r.flip(e)})}broadcastRotate(e){const t=["transform","mirrored-focus","linear-focus","radial-focus","sprite","selective-blur"];t.forEach(i=>{const r=this.operations.get(i);if(!r)return;r.rotate(e)})}_initSerializers(){this._serializers={"1.0.0":Ga().default,"1.0.1":Ua().default,"2.0.0":Ka().default,"3.0.0":ja().default,"3.1.0":Wa().default,"3.2.0":Va().default,"3.4.0":Ha().default,"3.5.0":qa().default,"3.6.0":Ya().default,"3.7.0":Xa().default,"3.8.0":Qa().default,"3.9.0":Za().default}}serialize(e={},t="3.9.0"){const i=this._serializers[t];if(!i)return wr.reject(new Error(`No serializer for version ${t} found.`));const r=new i(this);return r.serialize(e)}deserialize(e){const t=this._serializers[e.version];if(!t)return wr.reject(new Error(`No serializer for version ${e.version} found.`));const i=new t(this);return i.deserialize(e)}reset(){this._sdk.reset(),this.operations.reset()}dispose(){this.stop(),this._sdk.dispose()}getRenderer(){return this._sdk.getRenderer()}getSDK(){return this._sdk}getInputDimensions(){return this._sdk.getInputDimensions()}getImage(){return this._options.editor.image}getOptions(){return this._options}getUI(){return this._ui}getMediator(){return this._mediator}getDynamicAssetsLibrary(){return this._dynamicAssetsLibrary}}var ip=$g;class ha{constructor(e){this._ui=e,this._fonts=[]}add(e){this._fonts.push(e)}load(){return Promise.resolve()}dispose(){}}const rp=Cr(require("canvas"));class da extends ha{load(){return this._fonts.forEach(e=>{const t=this._ui.getAssetPath(e.getFilePath(),!1,!0);rp.registerFont(t,{family:e.getFont().getFontFamily(),weight:e.getFontWeight(),style:e.getFontStyle()})}),super.load()}}class ca{constructor(e,t){this._ui=e,this._fonts=t,this._loadedFonts=[]}setFonts(e){this._fonts=e}needsToLoad(){for(let e=0;e<this._fonts.length;e++){let t;if(this._fonts[e].getVariations().forEach(i=>{t=t||i.getProvider()}),!t)continue;return!0}}fontLoaded(e){const t=e.getFontFamily();return this._loadedFonts.indexOf(t)!==-1}setFontLoaded(e){if(!this.fontLoaded(e)){const t=e.getFontFamily();this._loadedFonts.push(t)}}load(){const e=this._fonts,t={file:new da(this._ui)},i=()=>{for(const s in t){const o=t[s];o.dispose()}};e.filter(s=>!this.fontLoaded(s)).forEach(s=>{s.getVariations().forEach(o=>{const n=o.getProvider();if(!n)return;const a=t[n];if(!a)return k.warn(`No font loader for provider \`${n}\` found.`);a.add(o)})});const r=[];for(const s in t)r.push(t[s].load());return Promise.all(r).then(()=>{i(),e.forEach(s=>{this.setFontLoaded(s)})}).catch(s=>{throw i(),s})}}xe(exports,{default:()=>e_});const Or=e=>ue.byteArrayToString(mo.decode(e));class gi extends Hn{constructor(e={}){super();this._mediator=new Hn,this._fontLoader=new ca(this),this._options=e,this._initOptions(),this._initEvents(),this._disposed=!1,this._editor=new ip(this,this._options,this._mediator),this._options.editor.image&&this._editor.setImage(this._options.editor.image),k.setLevel(this._options.logLevel),this._v()}export(...e){return this._editor.export(...e)}serialize(...e){return this._editor.serialize(...e)}deserialize(e){return this._editor.deserialize(e)}getEditor(){return this._editor}_initOptions(){this._options=ue.defaults(this._options,{logLevel:"warn",crossOrigin:"Anonymous",editor:{},assets:{},responsive:!1,preloader:!0}),this._options.editor=ue.defaults(this._options.editor||{},{preferredRenderer:"webgl",displayResizeMessage:!0,controlsOptions:{},operationsOrder:["exif-orientation","orientation","transform","filter","adjustments","radial-focus","mirrored-focus","linear-focus","blur","selective-blur","overlay","sprite","frame","watermark"],maxMegaPixels:null}),this._options.editor.export=ue.defaults(this._options.editor.export||{},{format:"image/png",type:Jt.IMAGE,download:!0,fileBasename:"photoeditorsdk-export",quality:.8}),this._options.assets=ue.defaults(this._options.assets||{},{baseUrl:process.cwd(),resolver:null})}_v(){return this[Or("X29wdGlvbnM=")][Or("bGljZW5zZQ==")]?!0:(k.error(Or("TGljZW5zaW5n"),Or("Tm8gYGxpY2Vuc2VgIG9wdGlvbiBnaXZlbg==")),k.error(Or("TGljZW5zaW5n"),Or("SW4gY2FzZSB5b3UgZG9uJ3QgaGF2ZSBhIGxpY2Vuc2UgeWV0LCBwbGVhc2UgY29udGFjdCBvdXIgc2FsZXMgc3RhZmYgYXQgc2FsZXNAcGhvdG9lZGl0b3JzZGsuY29tIHRvIG9idGFpbiBhIGxpY2Vuc2Ugb3IgbG9nIGluIHRvIHlvdXIgY3VzdG9tZXIgZGFzaGJvYXJkLg==")),!1)}_initEvents(){this._mediator.pipeEvents(this)}_disposeEvents(){this._mediator.unpipeEvents(this)}setImage(e){this._editor.setImage(e)}getAssetPath(e,t=!1,i=!1){const{baseUrl:r,resolver:s}=this._options.assets;let o=`${r}/${e}`;if(e.match(/(ftp|http|https):\/\//)&&(o=e),t){if(!i){const n=typeof window!="undefined"&&window.devicePixelRatio||1;if(n>1){const a=/\.[\w?=]+$/;e=e.replace(a,l=>`@2x${l}`)}}o=`${r}/ui/desktop/${e}`}return typeof s!="undefined"&&s!==null&&(o=s(o)),o}getFontLoader(){return this._fontLoader}dispose(){if(this._disposed)throw new Error("This instance of PhotoEditorSDK is already disposed.");this._disposed=!0,this._disposeEvents()}render(e){return this.deserialize(e).then(()=>this.export())}}gi.prototype.identifier="node";gi.Constants=Oe;gi.Events=Oe.EVENTS;gi.Utils=ze;gi.JSONLoader=rt;gi.SDK=Y;var e_=gi;
/*
 * Based on https://github.com/exif-js/exif-js by Jacob Seidelin
 * Licensed under MIT
 * @license
 */
/*
 * Extracted from MinifyJpeg (Copyright (c) 2014 Hiroaki Matoba, MIT License):
 * https://github.com/hMatoba/MinifyJpeg
 * @license
 */
/*
 * http://paulirish.com/2011/requestanimationframe-for-smart-animating/
 * http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating
 * requestAnimationFrame polyfill by Erik Möller. fixes from Paul Irish and Tino Zijdel
 * MIT license
 * @license
 */
/*!
 *  Secure Hash Algorithm (SHA256)
 *  http://www.webtoolkit.info/
 *
 *  Original code by Angel Marin, Paul Johnston.
 */
/*!
 * Copyright (c) 2003-2005  Tom Wu
 * All Rights Reserved.
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS-IS" AND WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS, IMPLIED OR OTHERWISE, INCLUDING WITHOUT LIMITATION, ANY
 * WARRANTY OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.
 *
 * IN NO EVENT SHALL TOM WU BE LIABLE FOR ANY SPECIAL, INCIDENTAL,
 * INDIRECT OR CONSEQUENTIAL DAMAGES OF ANY KIND, OR ANY DAMAGES WHATSOEVER
 * RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER OR NOT ADVISED OF
 * THE POSSIBILITY OF DAMAGE, AND ON ANY THEORY OF LIABILITY, ARISING OUT
 * OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * In addition, the following condition applies:
 *
 * All redistributions must retain an intact copy of this copyright notice
 * and disclaimer.
 */
/*!
 * Native Promise Only
 * v0.8.0-a (c) Kyle Simpson
 * MIT License: http://getify.mit-license.org
 */
/*!
StackBlur - a fast almost Gaussian Blur For Canvas

Version:  0.5
Author:   Mario Klingemann
Contact:  mario@quasimondo.com
Website:  http://www.quasimondo.com/StackBlurForCanvas
Twitter:  @quasimondo

In case you find this class useful - especially in commercial projects -
I am not totally unhappy for a small donation to my PayPal account
mario@quasimondo.de

Or support me on flattr:
https://flattr.com/thing/72791/StackBlur-a-fast-almost-Gaussian-Blur-Effect-for-CanvasJavascript

Copyright (c) 2010 Mario Klingemann

Permission is hereby granted, free of charge, to any person
obtaining a copy of this software and associated documentation
files (the "Software"), to deal in the Software without
restriction, including without limitation the rights to use,
copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the
Software is furnished to do so, subject to the following
conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
OTHER DEALINGS IN THE SOFTWARE.
@license
*/
